import{a as If,f as wf}from"../chunks/B5ygKLIW.js";import"../chunks/CovPwqVR.js";import{o as mo,q as Af,aM as Cf,aN as Sf,aO as Rf,aP as bf,aQ as Pf,aJ as Nf,b as Df,E as kf,ao as Hn,aR as Vf,y as Of,v as _t,x as xf,g as mt,A as Mf,B as Ji,C as Zi,ay as Gn,aI as vr}from"../chunks/DIHBuI8y.js";import{e as Lf}from"../chunks/DHtf0l6T.js";import{i as Ff}from"../chunks/Igi4uuXM.js";const Uf=Symbol("is custom element"),Bf=Symbol("is html"),jf=bf?"link":"LINK";function Er(n){if(mo){var e=!1,t=()=>{if(!e){if(e=!0,n.hasAttribute("value")){var i=n.value;_l(n,"value",null),n.value=i}if(n.hasAttribute("checked")){var s=n.checked;_l(n,"checked",null),n.checked=s}}};n.__on_r=t,Af(t),Cf()}}function _l(n,e,t,i){var s=$f(n);mo&&(s[e]=n.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&n.nodeName===jf)||s[e]!==(s[e]=t)&&(e==="loading"&&(n[Sf]=t),n.removeAttribute(e))}function $f(n){return n.__attributes??={[Uf]:n.nodeName.includes("-"),[Bf]:n.namespaceURI===Rf}}function Tr(n,e,t=e){var i=new WeakSet;Pf(n,"input",async s=>{var o=s?n.defaultValue:n.value;if(o=Ir(n)?wr(o):o,t(o),Hn!==null&&i.add(Hn),await Nf(),o!==(o=e())){var a=n.selectionStart,c=n.selectionEnd,h=n.value.length;if(n.value=o??"",c!==null){var d=n.value.length;a===c&&c===h&&d>h?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=a,n.selectionEnd=Math.min(c,d))}}}),(mo&&n.defaultValue!==n.value||Df(e)==null&&n.value)&&(t(Ir(n)?wr(n.value):n.value),Hn!==null&&i.add(Hn)),kf(()=>{var s=e();if(n===document.activeElement){var o=Vf??Hn;if(i.has(o))return}Ir(n)&&s===wr(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function Ir(n){var e=n.type;return e==="number"||e==="range"}function wr(n){return n===""?null:+n}const Wf=()=>{};var ml={};const Jc={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const D=function(n,e){if(!n)throw Tn(e)},Tn=function(n){return new Error("Firebase Database ("+Jc.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Zc=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},qf=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],c=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|c&63)-65536;e[i++]=String.fromCharCode(55296+(h>>10)),e[i++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},go={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,c=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,_=(o&3)<<4|c>>4;let v=(c&15)<<2|d>>6,R=d&63;h||(R=64,a||(v=64)),i.push(t[p],t[_],t[v],t[R])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Zc(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],c=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const _=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||c==null||d==null||_==null)throw new Hf;const v=o<<2|c>>4;if(i.push(v),d!==64){const R=c<<4&240|d>>2;if(i.push(R),_!==64){const b=d<<6&192|_;i.push(b)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Hf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const eu=function(n){const e=Zc(n);return go.encodeByteArray(e,!0)},ps=function(n){return eu(n).replace(/\./g,"")},Fr=function(n){try{return go.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Gf(n){return tu(void 0,n)}function tu(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!zf(t)||(n[t]=tu(n[t],e[t]));return n}function zf(n){return n!=="__proto__"}function Kf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Qf=()=>Kf().__FIREBASE_DEFAULTS__,Yf=()=>{if(typeof process>"u"||typeof ml>"u")return;const n=ml.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Xf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Fr(n[1]);return e&&JSON.parse(e)},yo=()=>{try{return Wf()||Qf()||Yf()||Xf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Jf=n=>{var e,t;return(t=(e=yo())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},nu=n=>{const e=Jf(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},iu=()=>{var n;return(n=yo())===null||n===void 0?void 0:n.config};class vo{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}function Ti(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function su(n){return(await fetch(n,{credentials:"include"})).ok}function ru(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ps(JSON.stringify(t)),ps(JSON.stringify(a)),""].join(".")}const Zn={};function Zf(){const n={prod:[],emulator:[]};for(const e of Object.keys(Zn))Zn[e]?n.emulator.push(e):n.prod.push(e);return n}function ep(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let gl=!1;function ou(n,e){if(typeof window>"u"||typeof document>"u"||!Ti(window.location.host)||Zn[n]===e||Zn[n]||gl)return;Zn[n]=e;function t(v){return`__firebase__banner__${v}`}const i="__firebase__banner",o=Zf().prod.length>0;function a(){const v=document.getElementById(i);v&&v.remove()}function c(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,R){v.setAttribute("width","24"),v.setAttribute("id",R),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{gl=!0,a()},v}function p(v,R){v.setAttribute("id",R),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function _(){const v=ep(i),R=t("text"),b=document.getElementById(R)||document.createElement("span"),k=t("learnmore"),V=document.getElementById(k)||document.createElement("a"),K=t("preprendIcon"),F=document.getElementById(K)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const G=v.element;c(G),p(V,k);const ae=d();h(F,K),G.append(F,b,V,ae),document.body.appendChild(G)}o?(b.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function au(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function lu(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(au())}function tp(){var n;const e=(n=yo())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function np(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ip(){return Jc.NODE_ADMIN===!0}function sp(){return!tp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function rp(){try{return typeof indexedDB=="object"}catch{return!1}}function op(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}const ap="FirebaseError";class In extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=ap,Object.setPrototypeOf(this,In.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cu.prototype.create)}}class cu{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?lp(o,i):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new In(s,c,i)}}function lp(n,e){return n.replace(cp,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const cp=/\{\$([^}]+)}/g;function ci(n){return JSON.parse(n)}function ge(n){return JSON.stringify(n)}const uu=function(n){let e={},t={},i={},s="";try{const o=n.split(".");e=ci(Fr(o[0])||""),t=ci(Fr(o[1])||""),s=o[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}},up=function(n){const e=uu(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},hp=function(n){const e=uu(n).claims;return typeof e=="object"&&e.admin===!0};function ut(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function hn(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function yl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function _s(n,e,t){const i={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function ui(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const o=n[s],a=e[s];if(vl(o)&&vl(a)){if(!ui(o,a))return!1}else if(o!==a)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function vl(n){return n!==null&&typeof n=="object"}function dp(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}class fp{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let _=0;_<16;_++)i[_]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let _=0;_<16;_++)i[_]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let _=16;_<80;_++){const v=i[_-3]^i[_-8]^i[_-14]^i[_-16];i[_]=(v<<1|v>>>31)&4294967295}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],h=this.chain_[4],d,p;for(let _=0;_<80;_++){_<40?_<20?(d=c^o&(a^c),p=1518500249):(d=o^a^c,p=1859775393):_<60?(d=o&a|c&(o|a),p=2400959708):(d=o^a^c,p=3395469782);const v=(s<<5|s>>>27)+d+h+p+i[_]&4294967295;h=c,c=a,a=(o<<30|o>>>2)&4294967295,o=s,s=v}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let s=0;const o=this.buf_;let a=this.inbuf_;for(;s<t;){if(a===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(o[a]=e.charCodeAt(s),++a,++s,a===this.blockSize){this.compress_(o),a=0;break}}else for(;s<t;)if(o[a]=e[s],++a,++s,a===this.blockSize){this.compress_(o),a=0;break}}this.inbuf_=a,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let o=24;o>=0;o-=8)e[i]=this.chain_[s]>>o&255,++i;return e}}function pp(n,e){return`${n} failed: ${e} argument `}const _p=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){const o=s-55296;i++,D(i<n.length,"Surrogate pair missing trail surrogate.");const a=n.charCodeAt(i)-56320;s=65536+(o<<10)+a}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},xs=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};function Ut(n){return n&&n._delegate?n._delegate:n}class dn{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Vt="[DEFAULT]";class mp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new vo;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),s=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(o){if(s)return null;throw o}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(yp(e))try{this.getOrInitializeService({instanceIdentifier:Vt})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});i.resolve(o)}catch{}}}}clearInstance(e=Vt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Vt){return this.instances.has(e)}getOptions(e=Vt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[o,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(o);i===c&&a.resolve(s)}return s}onInit(e,t){var i;const s=this.normalizeInstanceIdentifier(t),o=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;o.add(e),this.onInitCallbacks.set(s,o);const a=this.instances.get(s);return a&&e(a,s),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:gp(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Vt){return this.component?this.component.multipleInstances?e:Vt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function gp(n){return n===Vt?void 0:n}function yp(n){return n.instantiationMode==="EAGER"}class vp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new mp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var U;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(U||(U={}));const Ep={debug:U.DEBUG,verbose:U.VERBOSE,info:U.INFO,warn:U.WARN,error:U.ERROR,silent:U.SILENT},Tp=U.INFO,Ip={[U.DEBUG]:"log",[U.VERBOSE]:"log",[U.INFO]:"info",[U.WARN]:"warn",[U.ERROR]:"error"},wp=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=Ip[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Eo{constructor(e){this.name=e,this._logLevel=Tp,this._logHandler=wp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in U))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Ep[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,U.DEBUG,...e),this._logHandler(this,U.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,U.VERBOSE,...e),this._logHandler(this,U.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,U.INFO,...e),this._logHandler(this,U.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,U.WARN,...e),this._logHandler(this,U.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,U.ERROR,...e),this._logHandler(this,U.ERROR,...e)}}const Ap=(n,e)=>e.some(t=>n instanceof t);let El,Tl;function Cp(){return El||(El=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Sp(){return Tl||(Tl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const hu=new WeakMap,Ur=new WeakMap,du=new WeakMap,Ar=new WeakMap,To=new WeakMap;function Rp(n){const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(gt(n.result)),s()},a=()=>{i(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&hu.set(t,n)}).catch(()=>{}),To.set(e,n),e}function bp(n){if(Ur.has(n))return;const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Ur.set(n,e)}let Br={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ur.get(n);if(e==="objectStoreNames")return n.objectStoreNames||du.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return gt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Pp(n){Br=n(Br)}function Np(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Cr(this),e,...t);return du.set(i,e.sort?e.sort():[e]),gt(i)}:Sp().includes(n)?function(...e){return n.apply(Cr(this),e),gt(hu.get(this))}:function(...e){return gt(n.apply(Cr(this),e))}}function Dp(n){return typeof n=="function"?Np(n):(n instanceof IDBTransaction&&bp(n),Ap(n,Cp())?new Proxy(n,Br):n)}function gt(n){if(n instanceof IDBRequest)return Rp(n);if(Ar.has(n))return Ar.get(n);const e=Dp(n);return e!==n&&(Ar.set(n,e),To.set(e,n)),e}const Cr=n=>To.get(n);function kp(n,e,{blocked:t,upgrade:i,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),c=gt(a);return i&&a.addEventListener("upgradeneeded",h=>{i(gt(a.result),h.oldVersion,h.newVersion,gt(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),c.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const Vp=["get","getKey","getAll","getAllKeys","count"],Op=["put","add","delete","clear"],Sr=new Map;function Il(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Sr.get(e))return Sr.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,s=Op.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||Vp.includes(t)))return;const o=async function(a,...c){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return i&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),s&&h.done]))[0]};return Sr.set(e,o),o}Pp(n=>({...n,get:(e,t,i)=>Il(e,t)||n.get(e,t,i),has:(e,t)=>!!Il(e,t)||n.has(e,t)}));class xp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Mp(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function Mp(n){const e=n.getComponent();return e?.type==="VERSION"}const jr="@firebase/app",wl="0.13.2";const lt=new Eo("@firebase/app"),Lp="@firebase/app-compat",Fp="@firebase/analytics-compat",Up="@firebase/analytics",Bp="@firebase/app-check-compat",jp="@firebase/app-check",$p="@firebase/auth",Wp="@firebase/auth-compat",qp="@firebase/database",Hp="@firebase/data-connect",Gp="@firebase/database-compat",zp="@firebase/functions",Kp="@firebase/functions-compat",Qp="@firebase/installations",Yp="@firebase/installations-compat",Xp="@firebase/messaging",Jp="@firebase/messaging-compat",Zp="@firebase/performance",e_="@firebase/performance-compat",t_="@firebase/remote-config",n_="@firebase/remote-config-compat",i_="@firebase/storage",s_="@firebase/storage-compat",r_="@firebase/firestore",o_="@firebase/ai",a_="@firebase/firestore-compat",l_="firebase",c_="11.10.0";const $r="[DEFAULT]",u_={[jr]:"fire-core",[Lp]:"fire-core-compat",[Up]:"fire-analytics",[Fp]:"fire-analytics-compat",[jp]:"fire-app-check",[Bp]:"fire-app-check-compat",[$p]:"fire-auth",[Wp]:"fire-auth-compat",[qp]:"fire-rtdb",[Hp]:"fire-data-connect",[Gp]:"fire-rtdb-compat",[zp]:"fire-fn",[Kp]:"fire-fn-compat",[Qp]:"fire-iid",[Yp]:"fire-iid-compat",[Xp]:"fire-fcm",[Jp]:"fire-fcm-compat",[Zp]:"fire-perf",[e_]:"fire-perf-compat",[t_]:"fire-rc",[n_]:"fire-rc-compat",[i_]:"fire-gcs",[s_]:"fire-gcs-compat",[r_]:"fire-fst",[a_]:"fire-fst-compat",[o_]:"fire-vertex","fire-js":"fire-js",[l_]:"fire-js-all"};const hi=new Map,h_=new Map,Wr=new Map;function Al(n,e){try{n.container.addComponent(e)}catch(t){lt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function di(n){const e=n.name;if(Wr.has(e))return lt.debug(`There were multiple attempts to register component ${e}.`),!1;Wr.set(e,n);for(const t of hi.values())Al(t,n);for(const t of h_.values())Al(t,n);return!0}function fu(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function pu(n){return n==null?!1:n.settings!==void 0}const d_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yt=new cu("app","Firebase",d_);class f_{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new dn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw yt.create("app-deleted",{appName:this._name})}}const _u=c_;function mu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:$r,automaticDataCollectionEnabled:!0},e),s=i.name;if(typeof s!="string"||!s)throw yt.create("bad-app-name",{appName:String(s)});if(t||(t=iu()),!t)throw yt.create("no-options");const o=hi.get(s);if(o){if(ui(t,o.options)&&ui(i,o.config))return o;throw yt.create("duplicate-app",{appName:s})}const a=new vp(s);for(const h of Wr.values())a.addComponent(h);const c=new f_(t,i,a);return hi.set(s,c),c}function Io(n=$r){const e=hi.get(n);if(!e&&n===$r&&iu())return mu();if(!e)throw yt.create("no-app",{appName:n});return e}function p_(){return Array.from(hi.values())}function vt(n,e,t){var i;let s=(i=u_[n])!==null&&i!==void 0?i:n;t&&(s+=`-${t}`);const o=s.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const c=[`Unable to register library "${s}" with version "${e}":`];o&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),lt.warn(c.join(" "));return}di(new dn(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const __="firebase-heartbeat-database",m_=1,fi="firebase-heartbeat-store";let Rr=null;function gu(){return Rr||(Rr=kp(__,m_,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(fi)}catch(t){console.warn(t)}}}}).catch(n=>{throw yt.create("idb-open",{originalErrorMessage:n.message})})),Rr}async function g_(n){try{const t=(await gu()).transaction(fi),i=await t.objectStore(fi).get(yu(n));return await t.done,i}catch(e){if(e instanceof In)lt.warn(e.message);else{const t=yt.create("idb-get",{originalErrorMessage:e?.message});lt.warn(t.message)}}}async function Cl(n,e){try{const i=(await gu()).transaction(fi,"readwrite");await i.objectStore(fi).put(e,yu(n)),await i.done}catch(t){if(t instanceof In)lt.warn(t.message);else{const i=yt.create("idb-set",{originalErrorMessage:t?.message});lt.warn(i.message)}}}function yu(n){return`${n.name}!${n.options.appId}`}const y_=1024,v_=30;class E_{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new I_(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Sl();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>v_){const a=w_(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){lt.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Sl(),{heartbeatsToSend:i,unsentEntries:s}=T_(this._heartbeatsCache.heartbeats),o=ps(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return lt.warn(t),""}}}function Sl(){return new Date().toISOString().substring(0,10)}function T_(n,e=y_){const t=[];let i=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Rl(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Rl(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class I_{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return rp()?op().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await g_(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Cl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Cl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Rl(n){return ps(JSON.stringify({version:2,heartbeats:n})).length}function w_(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}function A_(n){di(new dn("platform-logger",e=>new xp(e),"PRIVATE")),di(new dn("heartbeat",e=>new E_(e),"PRIVATE")),vt(jr,wl,n),vt(jr,wl,"esm2017"),vt("fire-js","")}A_("");var bl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var wo;(function(){var n;function e(I,m){function y(){}y.prototype=m.prototype,I.D=m.prototype,I.prototype=new y,I.prototype.constructor=I,I.C=function(E,T,A){for(var g=Array(arguments.length-2),Ze=2;Ze<arguments.length;Ze++)g[Ze-2]=arguments[Ze];return m.prototype[T].apply(E,g)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,m,y){y||(y=0);var E=Array(16);if(typeof m=="string")for(var T=0;16>T;++T)E[T]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(T=0;16>T;++T)E[T]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=I.g[0],y=I.g[1],T=I.g[2];var A=I.g[3],g=m+(A^y&(T^A))+E[0]+3614090360&4294967295;m=y+(g<<7&4294967295|g>>>25),g=A+(T^m&(y^T))+E[1]+3905402710&4294967295,A=m+(g<<12&4294967295|g>>>20),g=T+(y^A&(m^y))+E[2]+606105819&4294967295,T=A+(g<<17&4294967295|g>>>15),g=y+(m^T&(A^m))+E[3]+3250441966&4294967295,y=T+(g<<22&4294967295|g>>>10),g=m+(A^y&(T^A))+E[4]+4118548399&4294967295,m=y+(g<<7&4294967295|g>>>25),g=A+(T^m&(y^T))+E[5]+1200080426&4294967295,A=m+(g<<12&4294967295|g>>>20),g=T+(y^A&(m^y))+E[6]+2821735955&4294967295,T=A+(g<<17&4294967295|g>>>15),g=y+(m^T&(A^m))+E[7]+4249261313&4294967295,y=T+(g<<22&4294967295|g>>>10),g=m+(A^y&(T^A))+E[8]+1770035416&4294967295,m=y+(g<<7&4294967295|g>>>25),g=A+(T^m&(y^T))+E[9]+2336552879&4294967295,A=m+(g<<12&4294967295|g>>>20),g=T+(y^A&(m^y))+E[10]+4294925233&4294967295,T=A+(g<<17&4294967295|g>>>15),g=y+(m^T&(A^m))+E[11]+2304563134&4294967295,y=T+(g<<22&4294967295|g>>>10),g=m+(A^y&(T^A))+E[12]+1804603682&4294967295,m=y+(g<<7&4294967295|g>>>25),g=A+(T^m&(y^T))+E[13]+4254626195&4294967295,A=m+(g<<12&4294967295|g>>>20),g=T+(y^A&(m^y))+E[14]+2792965006&4294967295,T=A+(g<<17&4294967295|g>>>15),g=y+(m^T&(A^m))+E[15]+1236535329&4294967295,y=T+(g<<22&4294967295|g>>>10),g=m+(T^A&(y^T))+E[1]+4129170786&4294967295,m=y+(g<<5&4294967295|g>>>27),g=A+(y^T&(m^y))+E[6]+3225465664&4294967295,A=m+(g<<9&4294967295|g>>>23),g=T+(m^y&(A^m))+E[11]+643717713&4294967295,T=A+(g<<14&4294967295|g>>>18),g=y+(A^m&(T^A))+E[0]+3921069994&4294967295,y=T+(g<<20&4294967295|g>>>12),g=m+(T^A&(y^T))+E[5]+3593408605&4294967295,m=y+(g<<5&4294967295|g>>>27),g=A+(y^T&(m^y))+E[10]+38016083&4294967295,A=m+(g<<9&4294967295|g>>>23),g=T+(m^y&(A^m))+E[15]+3634488961&4294967295,T=A+(g<<14&4294967295|g>>>18),g=y+(A^m&(T^A))+E[4]+3889429448&4294967295,y=T+(g<<20&4294967295|g>>>12),g=m+(T^A&(y^T))+E[9]+568446438&4294967295,m=y+(g<<5&4294967295|g>>>27),g=A+(y^T&(m^y))+E[14]+3275163606&4294967295,A=m+(g<<9&4294967295|g>>>23),g=T+(m^y&(A^m))+E[3]+4107603335&4294967295,T=A+(g<<14&4294967295|g>>>18),g=y+(A^m&(T^A))+E[8]+1163531501&4294967295,y=T+(g<<20&4294967295|g>>>12),g=m+(T^A&(y^T))+E[13]+2850285829&4294967295,m=y+(g<<5&4294967295|g>>>27),g=A+(y^T&(m^y))+E[2]+4243563512&4294967295,A=m+(g<<9&4294967295|g>>>23),g=T+(m^y&(A^m))+E[7]+1735328473&4294967295,T=A+(g<<14&4294967295|g>>>18),g=y+(A^m&(T^A))+E[12]+2368359562&4294967295,y=T+(g<<20&4294967295|g>>>12),g=m+(y^T^A)+E[5]+4294588738&4294967295,m=y+(g<<4&4294967295|g>>>28),g=A+(m^y^T)+E[8]+2272392833&4294967295,A=m+(g<<11&4294967295|g>>>21),g=T+(A^m^y)+E[11]+1839030562&4294967295,T=A+(g<<16&4294967295|g>>>16),g=y+(T^A^m)+E[14]+4259657740&4294967295,y=T+(g<<23&4294967295|g>>>9),g=m+(y^T^A)+E[1]+2763975236&4294967295,m=y+(g<<4&4294967295|g>>>28),g=A+(m^y^T)+E[4]+1272893353&4294967295,A=m+(g<<11&4294967295|g>>>21),g=T+(A^m^y)+E[7]+4139469664&4294967295,T=A+(g<<16&4294967295|g>>>16),g=y+(T^A^m)+E[10]+3200236656&4294967295,y=T+(g<<23&4294967295|g>>>9),g=m+(y^T^A)+E[13]+681279174&4294967295,m=y+(g<<4&4294967295|g>>>28),g=A+(m^y^T)+E[0]+3936430074&4294967295,A=m+(g<<11&4294967295|g>>>21),g=T+(A^m^y)+E[3]+3572445317&4294967295,T=A+(g<<16&4294967295|g>>>16),g=y+(T^A^m)+E[6]+76029189&4294967295,y=T+(g<<23&4294967295|g>>>9),g=m+(y^T^A)+E[9]+3654602809&4294967295,m=y+(g<<4&4294967295|g>>>28),g=A+(m^y^T)+E[12]+3873151461&4294967295,A=m+(g<<11&4294967295|g>>>21),g=T+(A^m^y)+E[15]+530742520&4294967295,T=A+(g<<16&4294967295|g>>>16),g=y+(T^A^m)+E[2]+3299628645&4294967295,y=T+(g<<23&4294967295|g>>>9),g=m+(T^(y|~A))+E[0]+4096336452&4294967295,m=y+(g<<6&4294967295|g>>>26),g=A+(y^(m|~T))+E[7]+1126891415&4294967295,A=m+(g<<10&4294967295|g>>>22),g=T+(m^(A|~y))+E[14]+2878612391&4294967295,T=A+(g<<15&4294967295|g>>>17),g=y+(A^(T|~m))+E[5]+4237533241&4294967295,y=T+(g<<21&4294967295|g>>>11),g=m+(T^(y|~A))+E[12]+1700485571&4294967295,m=y+(g<<6&4294967295|g>>>26),g=A+(y^(m|~T))+E[3]+2399980690&4294967295,A=m+(g<<10&4294967295|g>>>22),g=T+(m^(A|~y))+E[10]+4293915773&4294967295,T=A+(g<<15&4294967295|g>>>17),g=y+(A^(T|~m))+E[1]+2240044497&4294967295,y=T+(g<<21&4294967295|g>>>11),g=m+(T^(y|~A))+E[8]+1873313359&4294967295,m=y+(g<<6&4294967295|g>>>26),g=A+(y^(m|~T))+E[15]+4264355552&4294967295,A=m+(g<<10&4294967295|g>>>22),g=T+(m^(A|~y))+E[6]+2734768916&4294967295,T=A+(g<<15&4294967295|g>>>17),g=y+(A^(T|~m))+E[13]+1309151649&4294967295,y=T+(g<<21&4294967295|g>>>11),g=m+(T^(y|~A))+E[4]+4149444226&4294967295,m=y+(g<<6&4294967295|g>>>26),g=A+(y^(m|~T))+E[11]+3174756917&4294967295,A=m+(g<<10&4294967295|g>>>22),g=T+(m^(A|~y))+E[2]+718787259&4294967295,T=A+(g<<15&4294967295|g>>>17),g=y+(A^(T|~m))+E[9]+3951481745&4294967295,I.g[0]=I.g[0]+m&4294967295,I.g[1]=I.g[1]+(T+(g<<21&4294967295|g>>>11))&4294967295,I.g[2]=I.g[2]+T&4294967295,I.g[3]=I.g[3]+A&4294967295}i.prototype.u=function(I,m){m===void 0&&(m=I.length);for(var y=m-this.blockSize,E=this.B,T=this.h,A=0;A<m;){if(T==0)for(;A<=y;)s(this,I,A),A+=this.blockSize;if(typeof I=="string"){for(;A<m;)if(E[T++]=I.charCodeAt(A++),T==this.blockSize){s(this,E),T=0;break}}else for(;A<m;)if(E[T++]=I[A++],T==this.blockSize){s(this,E),T=0;break}}this.h=T,this.o+=m},i.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var m=1;m<I.length-8;++m)I[m]=0;var y=8*this.o;for(m=I.length-8;m<I.length;++m)I[m]=y&255,y/=256;for(this.u(I),I=Array(16),m=y=0;4>m;++m)for(var E=0;32>E;E+=8)I[y++]=this.g[m]>>>E&255;return I};function o(I,m){var y=c;return Object.prototype.hasOwnProperty.call(y,I)?y[I]:y[I]=m(I)}function a(I,m){this.h=m;for(var y=[],E=!0,T=I.length-1;0<=T;T--){var A=I[T]|0;E&&A==m||(y[T]=A,E=!1)}this.g=y}var c={};function h(I){return-128<=I&&128>I?o(I,function(m){return new a([m|0],0>m?-1:0)}):new a([I|0],0>I?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return _;if(0>I)return V(d(-I));for(var m=[],y=1,E=0;I>=y;E++)m[E]=I/y|0,y*=4294967296;return new a(m,0)}function p(I,m){if(I.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(I.charAt(0)=="-")return V(p(I.substring(1),m));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=d(Math.pow(m,8)),E=_,T=0;T<I.length;T+=8){var A=Math.min(8,I.length-T),g=parseInt(I.substring(T,T+A),m);8>A?(A=d(Math.pow(m,A)),E=E.j(A).add(d(g))):(E=E.j(y),E=E.add(d(g)))}return E}var _=h(0),v=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(k(this))return-V(this).m();for(var I=0,m=1,y=0;y<this.g.length;y++){var E=this.i(y);I+=(0<=E?E:4294967296+E)*m,m*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(b(this))return"0";if(k(this))return"-"+V(this).toString(I);for(var m=d(Math.pow(I,6)),y=this,E="";;){var T=ae(y,m).g;y=K(y,T.j(m));var A=((0<y.g.length?y.g[0]:y.h)>>>0).toString(I);if(y=T,b(y))return A+E;for(;6>A.length;)A="0"+A;E=A+E}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function b(I){if(I.h!=0)return!1;for(var m=0;m<I.g.length;m++)if(I.g[m]!=0)return!1;return!0}function k(I){return I.h==-1}n.l=function(I){return I=K(this,I),k(I)?-1:b(I)?0:1};function V(I){for(var m=I.g.length,y=[],E=0;E<m;E++)y[E]=~I.g[E];return new a(y,~I.h).add(v)}n.abs=function(){return k(this)?V(this):this},n.add=function(I){for(var m=Math.max(this.g.length,I.g.length),y=[],E=0,T=0;T<=m;T++){var A=E+(this.i(T)&65535)+(I.i(T)&65535),g=(A>>>16)+(this.i(T)>>>16)+(I.i(T)>>>16);E=g>>>16,A&=65535,g&=65535,y[T]=g<<16|A}return new a(y,y[y.length-1]&-2147483648?-1:0)};function K(I,m){return I.add(V(m))}n.j=function(I){if(b(this)||b(I))return _;if(k(this))return k(I)?V(this).j(V(I)):V(V(this).j(I));if(k(I))return V(this.j(V(I)));if(0>this.l(R)&&0>I.l(R))return d(this.m()*I.m());for(var m=this.g.length+I.g.length,y=[],E=0;E<2*m;E++)y[E]=0;for(E=0;E<this.g.length;E++)for(var T=0;T<I.g.length;T++){var A=this.i(E)>>>16,g=this.i(E)&65535,Ze=I.i(T)>>>16,bn=I.i(T)&65535;y[2*E+2*T]+=g*bn,F(y,2*E+2*T),y[2*E+2*T+1]+=A*bn,F(y,2*E+2*T+1),y[2*E+2*T+1]+=g*Ze,F(y,2*E+2*T+1),y[2*E+2*T+2]+=A*Ze,F(y,2*E+2*T+2)}for(E=0;E<m;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=m;E<2*m;E++)y[E]=0;return new a(y,0)};function F(I,m){for(;(I[m]&65535)!=I[m];)I[m+1]+=I[m]>>>16,I[m]&=65535,m++}function G(I,m){this.g=I,this.h=m}function ae(I,m){if(b(m))throw Error("division by zero");if(b(I))return new G(_,_);if(k(I))return m=ae(V(I),m),new G(V(m.g),V(m.h));if(k(m))return m=ae(I,V(m)),new G(V(m.g),m.h);if(30<I.g.length){if(k(I)||k(m))throw Error("slowDivide_ only works with positive integers.");for(var y=v,E=m;0>=E.l(I);)y=bt(y),E=bt(E);var T=Ve(y,1),A=Ve(E,1);for(E=Ve(E,2),y=Ve(y,2);!b(E);){var g=A.add(E);0>=g.l(I)&&(T=T.add(y),A=g),E=Ve(E,1),y=Ve(y,1)}return m=K(I,T.j(m)),new G(T,m)}for(T=_;0<=I.l(m);){for(y=Math.max(1,Math.floor(I.m()/m.m())),E=Math.ceil(Math.log(y)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),A=d(y),g=A.j(m);k(g)||0<g.l(I);)y-=E,A=d(y),g=A.j(m);b(A)&&(A=v),T=T.add(A),I=K(I,g)}return new G(T,I)}n.A=function(I){return ae(this,I).h},n.and=function(I){for(var m=Math.max(this.g.length,I.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)&I.i(E);return new a(y,this.h&I.h)},n.or=function(I){for(var m=Math.max(this.g.length,I.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)|I.i(E);return new a(y,this.h|I.h)},n.xor=function(I){for(var m=Math.max(this.g.length,I.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)^I.i(E);return new a(y,this.h^I.h)};function bt(I){for(var m=I.g.length+1,y=[],E=0;E<m;E++)y[E]=I.i(E)<<1|I.i(E-1)>>>31;return new a(y,I.h)}function Ve(I,m){var y=m>>5;m%=32;for(var E=I.g.length-y,T=[],A=0;A<E;A++)T[A]=0<m?I.i(A+y)>>>m|I.i(A+y+1)<<32-m:I.i(A+y);return new a(T,I.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,wo=a}).apply(typeof bl<"u"?bl:typeof self<"u"?self:typeof window<"u"?window:{});var es=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var vu,Jn,Eu,ls,qr,Tu,Iu,wu;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(r,l,u){return r==Array.prototype||r==Object.prototype||(r[l]=u.value),r};function t(r){r=[typeof globalThis=="object"&&globalThis,r,typeof window=="object"&&window,typeof self=="object"&&self,typeof es=="object"&&es];for(var l=0;l<r.length;++l){var u=r[l];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var i=t(this);function s(r,l){if(l)e:{var u=i;r=r.split(".");for(var f=0;f<r.length-1;f++){var w=r[f];if(!(w in u))break e;u=u[w]}r=r[r.length-1],f=u[r],l=l(f),l!=f&&l!=null&&e(u,r,{configurable:!0,writable:!0,value:l})}}function o(r,l){r instanceof String&&(r+="");var u=0,f=!1,w={next:function(){if(!f&&u<r.length){var C=u++;return{value:l(C,r[C]),done:!1}}return f=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}s("Array.prototype.values",function(r){return r||function(){return o(this,function(l,u){return u})}});var a=a||{},c=this||self;function h(r){var l=typeof r;return l=l!="object"?l:r?Array.isArray(r)?"array":l:"null",l=="array"||l=="object"&&typeof r.length=="number"}function d(r){var l=typeof r;return l=="object"&&r!=null||l=="function"}function p(r,l,u){return r.call.apply(r.bind,arguments)}function _(r,l,u){if(!r)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,f),r.apply(l,w)}}return function(){return r.apply(l,arguments)}}function v(r,l,u){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:_,v.apply(null,arguments)}function R(r,l){var u=Array.prototype.slice.call(arguments,1);return function(){var f=u.slice();return f.push.apply(f,arguments),r.apply(this,f)}}function b(r,l){function u(){}u.prototype=l.prototype,r.aa=l.prototype,r.prototype=new u,r.prototype.constructor=r,r.Qb=function(f,w,C){for(var N=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)N[Y-2]=arguments[Y];return l.prototype[w].apply(f,N)}}function k(r){const l=r.length;if(0<l){const u=Array(l);for(let f=0;f<l;f++)u[f]=r[f];return u}return[]}function V(r,l){for(let u=1;u<arguments.length;u++){const f=arguments[u];if(h(f)){const w=r.length||0,C=f.length||0;r.length=w+C;for(let N=0;N<C;N++)r[w+N]=f[N]}else r.push(f)}}class K{constructor(l,u){this.i=l,this.j=u,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function F(r){return/^[\s\xa0]*$/.test(r)}function G(){var r=c.navigator;return r&&(r=r.userAgent)?r:""}function ae(r){return ae[" "](r),r}ae[" "]=function(){};var bt=G().indexOf("Gecko")!=-1&&!(G().toLowerCase().indexOf("webkit")!=-1&&G().indexOf("Edge")==-1)&&!(G().indexOf("Trident")!=-1||G().indexOf("MSIE")!=-1)&&G().indexOf("Edge")==-1;function Ve(r,l,u){for(const f in r)l.call(u,r[f],f,r)}function I(r,l){for(const u in r)l.call(void 0,r[u],u,r)}function m(r){const l={};for(const u in r)l[u]=r[u];return l}const y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(r,l){let u,f;for(let w=1;w<arguments.length;w++){f=arguments[w];for(u in f)r[u]=f[u];for(let C=0;C<y.length;C++)u=y[C],Object.prototype.hasOwnProperty.call(f,u)&&(r[u]=f[u])}}function T(r){var l=1;r=r.split(":");const u=[];for(;0<l&&r.length;)u.push(r.shift()),l--;return r.length&&u.push(r.join(":")),u}function A(r){c.setTimeout(()=>{throw r},0)}function g(){var r=Qs;let l=null;return r.g&&(l=r.g,r.g=r.g.next,r.g||(r.h=null),l.next=null),l}class Ze{constructor(){this.h=this.g=null}add(l,u){const f=bn.get();f.set(l,u),this.h?this.h.next=f:this.g=f,this.h=f}}var bn=new K(()=>new Bd,r=>r.reset());class Bd{constructor(){this.next=this.g=this.h=null}set(l,u){this.h=l,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let Pn,Nn=!1,Qs=new Ze,_a=()=>{const r=c.Promise.resolve(void 0);Pn=()=>{r.then(jd)}};var jd=()=>{for(var r;r=g();){try{r.h.call(r.g)}catch(u){A(u)}var l=bn;l.j(r),100>l.h&&(l.h++,r.next=l.g,l.g=r)}Nn=!1};function ht(){this.s=this.s,this.C=this.C}ht.prototype.s=!1,ht.prototype.ma=function(){this.s||(this.s=!0,this.N())},ht.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ee(r,l){this.type=r,this.g=this.target=l,this.defaultPrevented=!1}Ee.prototype.h=function(){this.defaultPrevented=!0};var $d=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var r=!1,l=Object.defineProperty({},"passive",{get:function(){r=!0}});try{const u=()=>{};c.addEventListener("test",u,l),c.removeEventListener("test",u,l)}catch{}return r})();function Dn(r,l){if(Ee.call(this,r?r.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,r){var u=this.type=r.type,f=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:null;if(this.target=r.target||r.srcElement,this.g=l,l=r.relatedTarget){if(bt){e:{try{ae(l.nodeName);var w=!0;break e}catch{}w=!1}w||(l=null)}}else u=="mouseover"?l=r.fromElement:u=="mouseout"&&(l=r.toElement);this.relatedTarget=l,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0),this.button=r.button,this.key=r.key||"",this.ctrlKey=r.ctrlKey,this.altKey=r.altKey,this.shiftKey=r.shiftKey,this.metaKey=r.metaKey,this.pointerId=r.pointerId||0,this.pointerType=typeof r.pointerType=="string"?r.pointerType:Wd[r.pointerType]||"",this.state=r.state,this.i=r,r.defaultPrevented&&Dn.aa.h.call(this)}}b(Dn,Ee);var Wd={2:"touch",3:"pen",4:"mouse"};Dn.prototype.h=function(){Dn.aa.h.call(this);var r=this.i;r.preventDefault?r.preventDefault():r.returnValue=!1};var Vi="closure_listenable_"+(1e6*Math.random()|0),qd=0;function Hd(r,l,u,f,w){this.listener=r,this.proxy=null,this.src=l,this.type=u,this.capture=!!f,this.ha=w,this.key=++qd,this.da=this.fa=!1}function Oi(r){r.da=!0,r.listener=null,r.proxy=null,r.src=null,r.ha=null}function xi(r){this.src=r,this.g={},this.h=0}xi.prototype.add=function(r,l,u,f,w){var C=r.toString();r=this.g[C],r||(r=this.g[C]=[],this.h++);var N=Xs(r,l,f,w);return-1<N?(l=r[N],u||(l.fa=!1)):(l=new Hd(l,this.src,C,!!f,w),l.fa=u,r.push(l)),l};function Ys(r,l){var u=l.type;if(u in r.g){var f=r.g[u],w=Array.prototype.indexOf.call(f,l,void 0),C;(C=0<=w)&&Array.prototype.splice.call(f,w,1),C&&(Oi(l),r.g[u].length==0&&(delete r.g[u],r.h--))}}function Xs(r,l,u,f){for(var w=0;w<r.length;++w){var C=r[w];if(!C.da&&C.listener==l&&C.capture==!!u&&C.ha==f)return w}return-1}var Js="closure_lm_"+(1e6*Math.random()|0),Zs={};function ma(r,l,u,f,w){if(Array.isArray(l)){for(var C=0;C<l.length;C++)ma(r,l[C],u,f,w);return null}return u=va(u),r&&r[Vi]?r.K(l,u,d(f)?!!f.capture:!1,w):Gd(r,l,u,!1,f,w)}function Gd(r,l,u,f,w,C){if(!l)throw Error("Invalid event type");var N=d(w)?!!w.capture:!!w,Y=tr(r);if(Y||(r[Js]=Y=new xi(r)),u=Y.add(l,u,f,N,C),u.proxy)return u;if(f=zd(),u.proxy=f,f.src=r,f.listener=u,r.addEventListener)$d||(w=N),w===void 0&&(w=!1),r.addEventListener(l.toString(),f,w);else if(r.attachEvent)r.attachEvent(ya(l.toString()),f);else if(r.addListener&&r.removeListener)r.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return u}function zd(){function r(u){return l.call(r.src,r.listener,u)}const l=Kd;return r}function ga(r,l,u,f,w){if(Array.isArray(l))for(var C=0;C<l.length;C++)ga(r,l[C],u,f,w);else f=d(f)?!!f.capture:!!f,u=va(u),r&&r[Vi]?(r=r.i,l=String(l).toString(),l in r.g&&(C=r.g[l],u=Xs(C,u,f,w),-1<u&&(Oi(C[u]),Array.prototype.splice.call(C,u,1),C.length==0&&(delete r.g[l],r.h--)))):r&&(r=tr(r))&&(l=r.g[l.toString()],r=-1,l&&(r=Xs(l,u,f,w)),(u=-1<r?l[r]:null)&&er(u))}function er(r){if(typeof r!="number"&&r&&!r.da){var l=r.src;if(l&&l[Vi])Ys(l.i,r);else{var u=r.type,f=r.proxy;l.removeEventListener?l.removeEventListener(u,f,r.capture):l.detachEvent?l.detachEvent(ya(u),f):l.addListener&&l.removeListener&&l.removeListener(f),(u=tr(l))?(Ys(u,r),u.h==0&&(u.src=null,l[Js]=null)):Oi(r)}}}function ya(r){return r in Zs?Zs[r]:Zs[r]="on"+r}function Kd(r,l){if(r.da)r=!0;else{l=new Dn(l,this);var u=r.listener,f=r.ha||r.src;r.fa&&er(r),r=u.call(f,l)}return r}function tr(r){return r=r[Js],r instanceof xi?r:null}var nr="__closure_events_fn_"+(1e9*Math.random()>>>0);function va(r){return typeof r=="function"?r:(r[nr]||(r[nr]=function(l){return r.handleEvent(l)}),r[nr])}function Te(){ht.call(this),this.i=new xi(this),this.M=this,this.F=null}b(Te,ht),Te.prototype[Vi]=!0,Te.prototype.removeEventListener=function(r,l,u,f){ga(this,r,l,u,f)};function De(r,l){var u,f=r.F;if(f)for(u=[];f;f=f.F)u.push(f);if(r=r.M,f=l.type||l,typeof l=="string")l=new Ee(l,r);else if(l instanceof Ee)l.target=l.target||r;else{var w=l;l=new Ee(f,r),E(l,w)}if(w=!0,u)for(var C=u.length-1;0<=C;C--){var N=l.g=u[C];w=Mi(N,f,!0,l)&&w}if(N=l.g=r,w=Mi(N,f,!0,l)&&w,w=Mi(N,f,!1,l)&&w,u)for(C=0;C<u.length;C++)N=l.g=u[C],w=Mi(N,f,!1,l)&&w}Te.prototype.N=function(){if(Te.aa.N.call(this),this.i){var r=this.i,l;for(l in r.g){for(var u=r.g[l],f=0;f<u.length;f++)Oi(u[f]);delete r.g[l],r.h--}}this.F=null},Te.prototype.K=function(r,l,u,f){return this.i.add(String(r),l,!1,u,f)},Te.prototype.L=function(r,l,u,f){return this.i.add(String(r),l,!0,u,f)};function Mi(r,l,u,f){if(l=r.i.g[String(l)],!l)return!0;l=l.concat();for(var w=!0,C=0;C<l.length;++C){var N=l[C];if(N&&!N.da&&N.capture==u){var Y=N.listener,_e=N.ha||N.src;N.fa&&Ys(r.i,N),w=Y.call(_e,f)!==!1&&w}}return w&&!f.defaultPrevented}function Ea(r,l,u){if(typeof r=="function")u&&(r=v(r,u));else if(r&&typeof r.handleEvent=="function")r=v(r.handleEvent,r);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(r,l||0)}function Ta(r){r.g=Ea(()=>{r.g=null,r.i&&(r.i=!1,Ta(r))},r.l);const l=r.h;r.h=null,r.m.apply(null,l)}class Qd extends ht{constructor(l,u){super(),this.m=l,this.l=u,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Ta(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kn(r){ht.call(this),this.h=r,this.g={}}b(kn,ht);var Ia=[];function wa(r){Ve(r.g,function(l,u){this.g.hasOwnProperty(u)&&er(l)},r),r.g={}}kn.prototype.N=function(){kn.aa.N.call(this),wa(this)},kn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ir=c.JSON.stringify,Yd=c.JSON.parse,Xd=class{stringify(r){return c.JSON.stringify(r,void 0)}parse(r){return c.JSON.parse(r,void 0)}};function sr(){}sr.prototype.h=null;function Aa(r){return r.h||(r.h=r.i())}function Ca(){}var Vn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function rr(){Ee.call(this,"d")}b(rr,Ee);function or(){Ee.call(this,"c")}b(or,Ee);var Pt={},Sa=null;function Li(){return Sa=Sa||new Te}Pt.La="serverreachability";function Ra(r){Ee.call(this,Pt.La,r)}b(Ra,Ee);function On(r){const l=Li();De(l,new Ra(l))}Pt.STAT_EVENT="statevent";function ba(r,l){Ee.call(this,Pt.STAT_EVENT,r),this.stat=l}b(ba,Ee);function ke(r){const l=Li();De(l,new ba(l,r))}Pt.Ma="timingevent";function Pa(r,l){Ee.call(this,Pt.Ma,r),this.size=l}b(Pa,Ee);function xn(r,l){if(typeof r!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){r()},l)}function Mn(){this.g=!0}Mn.prototype.xa=function(){this.g=!1};function Jd(r,l,u,f,w,C){r.info(function(){if(r.g)if(C)for(var N="",Y=C.split("&"),_e=0;_e<Y.length;_e++){var H=Y[_e].split("=");if(1<H.length){var Ie=H[0];H=H[1];var we=Ie.split("_");N=2<=we.length&&we[1]=="type"?N+(Ie+"="+H+"&"):N+(Ie+"=redacted&")}}else N=null;else N=C;return"XMLHTTP REQ ("+f+") [attempt "+w+"]: "+l+`
`+u+`
`+N})}function Zd(r,l,u,f,w,C,N){r.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+w+"]: "+l+`
`+u+`
`+C+" "+N})}function Xt(r,l,u,f){r.info(function(){return"XMLHTTP TEXT ("+l+"): "+tf(r,u)+(f?" "+f:"")})}function ef(r,l){r.info(function(){return"TIMEOUT: "+l})}Mn.prototype.info=function(){};function tf(r,l){if(!r.g)return l;if(!l)return null;try{var u=JSON.parse(l);if(u){for(r=0;r<u.length;r++)if(Array.isArray(u[r])){var f=u[r];if(!(2>f.length)){var w=f[1];if(Array.isArray(w)&&!(1>w.length)){var C=w[0];if(C!="noop"&&C!="stop"&&C!="close")for(var N=1;N<w.length;N++)w[N]=""}}}}return ir(u)}catch{return l}}var Fi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Na={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ar;function Ui(){}b(Ui,sr),Ui.prototype.g=function(){return new XMLHttpRequest},Ui.prototype.i=function(){return{}},ar=new Ui;function dt(r,l,u,f){this.j=r,this.i=l,this.l=u,this.R=f||1,this.U=new kn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Da}function Da(){this.i=null,this.g="",this.h=!1}var ka={},lr={};function cr(r,l,u){r.L=1,r.v=Wi(et(l)),r.m=u,r.P=!0,Va(r,null)}function Va(r,l){r.F=Date.now(),Bi(r),r.A=et(r.v);var u=r.A,f=r.R;Array.isArray(f)||(f=[String(f)]),za(u.i,"t",f),r.C=0,u=r.j.J,r.h=new Da,r.g=hl(r.j,u?l:null,!r.m),0<r.O&&(r.M=new Qd(v(r.Y,r,r.g),r.O)),l=r.U,u=r.g,f=r.ca;var w="readystatechange";Array.isArray(w)||(w&&(Ia[0]=w.toString()),w=Ia);for(var C=0;C<w.length;C++){var N=ma(u,w[C],f||l.handleEvent,!1,l.h||l);if(!N)break;l.g[N.key]=N}l=r.H?m(r.H):{},r.m?(r.u||(r.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",r.g.ea(r.A,r.u,r.m,l)):(r.u="GET",r.g.ea(r.A,r.u,null,l)),On(),Jd(r.i,r.u,r.A,r.l,r.R,r.m)}dt.prototype.ca=function(r){r=r.target;const l=this.M;l&&tt(r)==3?l.j():this.Y(r)},dt.prototype.Y=function(r){try{if(r==this.g)e:{const we=tt(this.g);var l=this.g.Ba();const en=this.g.Z();if(!(3>we)&&(we!=3||this.g&&(this.h.h||this.g.oa()||el(this.g)))){this.J||we!=4||l==7||(l==8||0>=en?On(3):On(2)),ur(this);var u=this.g.Z();this.X=u;t:if(Oa(this)){var f=el(this.g);r="";var w=f.length,C=tt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Nt(this),Ln(this);var N="";break t}this.h.i=new c.TextDecoder}for(l=0;l<w;l++)this.h.h=!0,r+=this.h.i.decode(f[l],{stream:!(C&&l==w-1)});f.length=0,this.h.g+=r,this.C=0,N=this.h.g}else N=this.g.oa();if(this.o=u==200,Zd(this.i,this.u,this.A,this.l,this.R,we,u),this.o){if(this.T&&!this.K){t:{if(this.g){var Y,_e=this.g;if((Y=_e.g?_e.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(Y)){var H=Y;break t}}H=null}if(u=H)Xt(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hr(this,u);else{this.o=!1,this.s=3,ke(12),Nt(this),Ln(this);break e}}if(this.P){u=!0;let Be;for(;!this.J&&this.C<N.length;)if(Be=nf(this,N),Be==lr){we==4&&(this.s=4,ke(14),u=!1),Xt(this.i,this.l,null,"[Incomplete Response]");break}else if(Be==ka){this.s=4,ke(15),Xt(this.i,this.l,N,"[Invalid Chunk]"),u=!1;break}else Xt(this.i,this.l,Be,null),hr(this,Be);if(Oa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),we!=4||N.length!=0||this.h.h||(this.s=1,ke(16),u=!1),this.o=this.o&&u,!u)Xt(this.i,this.l,N,"[Invalid Chunked Response]"),Nt(this),Ln(this);else if(0<N.length&&!this.W){this.W=!0;var Ie=this.j;Ie.g==this&&Ie.ba&&!Ie.M&&(Ie.j.info("Great, no buffering proxy detected. Bytes received: "+N.length),gr(Ie),Ie.M=!0,ke(11))}}else Xt(this.i,this.l,N,null),hr(this,N);we==4&&Nt(this),this.o&&!this.J&&(we==4?al(this.j,this):(this.o=!1,Bi(this)))}else Ef(this.g),u==400&&0<N.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),Nt(this),Ln(this)}}}catch{}};function Oa(r){return r.g?r.u=="GET"&&r.L!=2&&r.j.Ca:!1}function nf(r,l){var u=r.C,f=l.indexOf(`
`,u);return f==-1?lr:(u=Number(l.substring(u,f)),isNaN(u)?ka:(f+=1,f+u>l.length?lr:(l=l.slice(f,f+u),r.C=f+u,l)))}dt.prototype.cancel=function(){this.J=!0,Nt(this)};function Bi(r){r.S=Date.now()+r.I,xa(r,r.I)}function xa(r,l){if(r.B!=null)throw Error("WatchDog timer not null");r.B=xn(v(r.ba,r),l)}function ur(r){r.B&&(c.clearTimeout(r.B),r.B=null)}dt.prototype.ba=function(){this.B=null;const r=Date.now();0<=r-this.S?(ef(this.i,this.A),this.L!=2&&(On(),ke(17)),Nt(this),this.s=2,Ln(this)):xa(this,this.S-r)};function Ln(r){r.j.G==0||r.J||al(r.j,r)}function Nt(r){ur(r);var l=r.M;l&&typeof l.ma=="function"&&l.ma(),r.M=null,wa(r.U),r.g&&(l=r.g,r.g=null,l.abort(),l.ma())}function hr(r,l){try{var u=r.j;if(u.G!=0&&(u.g==r||dr(u.h,r))){if(!r.K&&dr(u.h,r)&&u.G==3){try{var f=u.Da.g.parse(l)}catch{f=null}if(Array.isArray(f)&&f.length==3){var w=f;if(w[0]==0){e:if(!u.u){if(u.g)if(u.g.F+3e3<r.F)Qi(u),zi(u);else break e;mr(u),ke(18)}}else u.za=w[1],0<u.za-u.T&&37500>w[2]&&u.F&&u.v==0&&!u.C&&(u.C=xn(v(u.Za,u),6e3));if(1>=Fa(u.h)&&u.ca){try{u.ca()}catch{}u.ca=void 0}}else kt(u,11)}else if((r.K||u.g==r)&&Qi(u),!F(l))for(w=u.Da.g.parse(l),l=0;l<w.length;l++){let H=w[l];if(u.T=H[0],H=H[1],u.G==2)if(H[0]=="c"){u.K=H[1],u.ia=H[2];const Ie=H[3];Ie!=null&&(u.la=Ie,u.j.info("VER="+u.la));const we=H[4];we!=null&&(u.Aa=we,u.j.info("SVER="+u.Aa));const en=H[5];en!=null&&typeof en=="number"&&0<en&&(f=1.5*en,u.L=f,u.j.info("backChannelRequestTimeoutMs_="+f)),f=u;const Be=r.g;if(Be){const Xi=Be.g?Be.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xi){var C=f.h;C.g||Xi.indexOf("spdy")==-1&&Xi.indexOf("quic")==-1&&Xi.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(fr(C,C.h),C.h=null))}if(f.D){const yr=Be.g?Be.g.getResponseHeader("X-HTTP-Session-Id"):null;yr&&(f.ya=yr,J(f.I,f.D,yr))}}u.G=3,u.l&&u.l.ua(),u.ba&&(u.R=Date.now()-r.F,u.j.info("Handshake RTT: "+u.R+"ms")),f=u;var N=r;if(f.qa=ul(f,f.J?f.ia:null,f.W),N.K){Ua(f.h,N);var Y=N,_e=f.L;_e&&(Y.I=_e),Y.B&&(ur(Y),Bi(Y)),f.g=N}else rl(f);0<u.i.length&&Ki(u)}else H[0]!="stop"&&H[0]!="close"||kt(u,7);else u.G==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?kt(u,7):_r(u):H[0]!="noop"&&u.l&&u.l.ta(H),u.v=0)}}On(4)}catch{}}var sf=class{constructor(r,l){this.g=r,this.map=l}};function Ma(r){this.l=r||10,c.PerformanceNavigationTiming?(r=c.performance.getEntriesByType("navigation"),r=0<r.length&&(r[0].nextHopProtocol=="hq"||r[0].nextHopProtocol=="h2")):r=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=r?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function La(r){return r.h?!0:r.g?r.g.size>=r.j:!1}function Fa(r){return r.h?1:r.g?r.g.size:0}function dr(r,l){return r.h?r.h==l:r.g?r.g.has(l):!1}function fr(r,l){r.g?r.g.add(l):r.h=l}function Ua(r,l){r.h&&r.h==l?r.h=null:r.g&&r.g.has(l)&&r.g.delete(l)}Ma.prototype.cancel=function(){if(this.i=Ba(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const r of this.g.values())r.cancel();this.g.clear()}};function Ba(r){if(r.h!=null)return r.i.concat(r.h.D);if(r.g!=null&&r.g.size!==0){let l=r.i;for(const u of r.g.values())l=l.concat(u.D);return l}return k(r.i)}function rf(r){if(r.V&&typeof r.V=="function")return r.V();if(typeof Map<"u"&&r instanceof Map||typeof Set<"u"&&r instanceof Set)return Array.from(r.values());if(typeof r=="string")return r.split("");if(h(r)){for(var l=[],u=r.length,f=0;f<u;f++)l.push(r[f]);return l}l=[],u=0;for(f in r)l[u++]=r[f];return l}function of(r){if(r.na&&typeof r.na=="function")return r.na();if(!r.V||typeof r.V!="function"){if(typeof Map<"u"&&r instanceof Map)return Array.from(r.keys());if(!(typeof Set<"u"&&r instanceof Set)){if(h(r)||typeof r=="string"){var l=[];r=r.length;for(var u=0;u<r;u++)l.push(u);return l}l=[],u=0;for(const f in r)l[u++]=f;return l}}}function ja(r,l){if(r.forEach&&typeof r.forEach=="function")r.forEach(l,void 0);else if(h(r)||typeof r=="string")Array.prototype.forEach.call(r,l,void 0);else for(var u=of(r),f=rf(r),w=f.length,C=0;C<w;C++)l.call(void 0,f[C],u&&u[C],r)}var $a=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function af(r,l){if(r){r=r.split("&");for(var u=0;u<r.length;u++){var f=r[u].indexOf("="),w=null;if(0<=f){var C=r[u].substring(0,f);w=r[u].substring(f+1)}else C=r[u];l(C,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}function Dt(r){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,r instanceof Dt){this.h=r.h,ji(this,r.j),this.o=r.o,this.g=r.g,$i(this,r.s),this.l=r.l;var l=r.i,u=new Bn;u.i=l.i,l.g&&(u.g=new Map(l.g),u.h=l.h),Wa(this,u),this.m=r.m}else r&&(l=String(r).match($a))?(this.h=!1,ji(this,l[1]||"",!0),this.o=Fn(l[2]||""),this.g=Fn(l[3]||"",!0),$i(this,l[4]),this.l=Fn(l[5]||"",!0),Wa(this,l[6]||"",!0),this.m=Fn(l[7]||"")):(this.h=!1,this.i=new Bn(null,this.h))}Dt.prototype.toString=function(){var r=[],l=this.j;l&&r.push(Un(l,qa,!0),":");var u=this.g;return(u||l=="file")&&(r.push("//"),(l=this.o)&&r.push(Un(l,qa,!0),"@"),r.push(encodeURIComponent(String(u)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.s,u!=null&&r.push(":",String(u))),(u=this.l)&&(this.g&&u.charAt(0)!="/"&&r.push("/"),r.push(Un(u,u.charAt(0)=="/"?uf:cf,!0))),(u=this.i.toString())&&r.push("?",u),(u=this.m)&&r.push("#",Un(u,df)),r.join("")};function et(r){return new Dt(r)}function ji(r,l,u){r.j=u?Fn(l,!0):l,r.j&&(r.j=r.j.replace(/:$/,""))}function $i(r,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);r.s=l}else r.s=null}function Wa(r,l,u){l instanceof Bn?(r.i=l,ff(r.i,r.h)):(u||(l=Un(l,hf)),r.i=new Bn(l,r.h))}function J(r,l,u){r.i.set(l,u)}function Wi(r){return J(r,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),r}function Fn(r,l){return r?l?decodeURI(r.replace(/%25/g,"%2525")):decodeURIComponent(r):""}function Un(r,l,u){return typeof r=="string"?(r=encodeURI(r).replace(l,lf),u&&(r=r.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),r):null}function lf(r){return r=r.charCodeAt(0),"%"+(r>>4&15).toString(16)+(r&15).toString(16)}var qa=/[#\/\?@]/g,cf=/[#\?:]/g,uf=/[#\?]/g,hf=/[#\?@]/g,df=/#/g;function Bn(r,l){this.h=this.g=null,this.i=r||null,this.j=!!l}function ft(r){r.g||(r.g=new Map,r.h=0,r.i&&af(r.i,function(l,u){r.add(decodeURIComponent(l.replace(/\+/g," ")),u)}))}n=Bn.prototype,n.add=function(r,l){ft(this),this.i=null,r=Jt(this,r);var u=this.g.get(r);return u||this.g.set(r,u=[]),u.push(l),this.h+=1,this};function Ha(r,l){ft(r),l=Jt(r,l),r.g.has(l)&&(r.i=null,r.h-=r.g.get(l).length,r.g.delete(l))}function Ga(r,l){return ft(r),l=Jt(r,l),r.g.has(l)}n.forEach=function(r,l){ft(this),this.g.forEach(function(u,f){u.forEach(function(w){r.call(l,w,f,this)},this)},this)},n.na=function(){ft(this);const r=Array.from(this.g.values()),l=Array.from(this.g.keys()),u=[];for(let f=0;f<l.length;f++){const w=r[f];for(let C=0;C<w.length;C++)u.push(l[f])}return u},n.V=function(r){ft(this);let l=[];if(typeof r=="string")Ga(this,r)&&(l=l.concat(this.g.get(Jt(this,r))));else{r=Array.from(this.g.values());for(let u=0;u<r.length;u++)l=l.concat(r[u])}return l},n.set=function(r,l){return ft(this),this.i=null,r=Jt(this,r),Ga(this,r)&&(this.h-=this.g.get(r).length),this.g.set(r,[l]),this.h+=1,this},n.get=function(r,l){return r?(r=this.V(r),0<r.length?String(r[0]):l):l};function za(r,l,u){Ha(r,l),0<u.length&&(r.i=null,r.g.set(Jt(r,l),k(u)),r.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const r=[],l=Array.from(this.g.keys());for(var u=0;u<l.length;u++){var f=l[u];const C=encodeURIComponent(String(f)),N=this.V(f);for(f=0;f<N.length;f++){var w=C;N[f]!==""&&(w+="="+encodeURIComponent(String(N[f]))),r.push(w)}}return this.i=r.join("&")};function Jt(r,l){return l=String(l),r.j&&(l=l.toLowerCase()),l}function ff(r,l){l&&!r.j&&(ft(r),r.i=null,r.g.forEach(function(u,f){var w=f.toLowerCase();f!=w&&(Ha(this,f),za(this,w,u))},r)),r.j=l}function pf(r,l){const u=new Mn;if(c.Image){const f=new Image;f.onload=R(pt,u,"TestLoadImage: loaded",!0,l,f),f.onerror=R(pt,u,"TestLoadImage: error",!1,l,f),f.onabort=R(pt,u,"TestLoadImage: abort",!1,l,f),f.ontimeout=R(pt,u,"TestLoadImage: timeout",!1,l,f),c.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=r}else l(!1)}function _f(r,l){const u=new Mn,f=new AbortController,w=setTimeout(()=>{f.abort(),pt(u,"TestPingServer: timeout",!1,l)},1e4);fetch(r,{signal:f.signal}).then(C=>{clearTimeout(w),C.ok?pt(u,"TestPingServer: ok",!0,l):pt(u,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(w),pt(u,"TestPingServer: error",!1,l)})}function pt(r,l,u,f,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),f(u)}catch{}}function mf(){this.g=new Xd}function gf(r,l,u){const f=u||"";try{ja(r,function(w,C){let N=w;d(w)&&(N=ir(w)),l.push(f+C+"="+encodeURIComponent(N))})}catch(w){throw l.push(f+"type="+encodeURIComponent("_badmap")),w}}function qi(r){this.l=r.Ub||null,this.j=r.eb||!1}b(qi,sr),qi.prototype.g=function(){return new Hi(this.l,this.j)},qi.prototype.i=(function(r){return function(){return r}})({});function Hi(r,l){Te.call(this),this.D=r,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}b(Hi,Te),n=Hi.prototype,n.open=function(r,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=r,this.A=l,this.readyState=1,$n(this)},n.send=function(r){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};r&&(l.body=r),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,jn(this)),this.readyState=0},n.Sa=function(r){if(this.g&&(this.l=r,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=r.headers,this.readyState=2,$n(this)),this.g&&(this.readyState=3,$n(this),this.g)))if(this.responseType==="arraybuffer")r.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in r){if(this.j=r.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ka(this)}else r.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ka(r){r.j.read().then(r.Pa.bind(r)).catch(r.ga.bind(r))}n.Pa=function(r){if(this.g){if(this.o&&r.value)this.response.push(r.value);else if(!this.o){var l=r.value?r.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!r.done}))&&(this.response=this.responseText+=l)}r.done?jn(this):$n(this),this.readyState==3&&Ka(this)}},n.Ra=function(r){this.g&&(this.response=this.responseText=r,jn(this))},n.Qa=function(r){this.g&&(this.response=r,jn(this))},n.ga=function(){this.g&&jn(this)};function jn(r){r.readyState=4,r.l=null,r.j=null,r.v=null,$n(r)}n.setRequestHeader=function(r,l){this.u.append(r,l)},n.getResponseHeader=function(r){return this.h&&this.h.get(r.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const r=[],l=this.h.entries();for(var u=l.next();!u.done;)u=u.value,r.push(u[0]+": "+u[1]),u=l.next();return r.join(`\r
`)};function $n(r){r.onreadystatechange&&r.onreadystatechange.call(r)}Object.defineProperty(Hi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(r){this.m=r?"include":"same-origin"}});function Qa(r){let l="";return Ve(r,function(u,f){l+=f,l+=":",l+=u,l+=`\r
`}),l}function pr(r,l,u){e:{for(f in u){var f=!1;break e}f=!0}f||(u=Qa(u),typeof r=="string"?u!=null&&encodeURIComponent(String(u)):J(r,l,u))}function re(r){Te.call(this),this.headers=new Map,this.o=r||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}b(re,Te);var yf=/^https?$/i,vf=["POST","PUT"];n=re.prototype,n.Ha=function(r){this.J=r},n.ea=function(r,l,u,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+r);l=l?l.toUpperCase():"GET",this.D=r,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ar.g(),this.v=this.o?Aa(this.o):Aa(ar),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(l,String(r),!0),this.B=!1}catch(C){Ya(this,C);return}if(r=u||"",u=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var w in f)u.set(w,f[w]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const C of f.keys())u.set(C,f.get(C));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(u.keys()).find(C=>C.toLowerCase()=="content-type"),w=c.FormData&&r instanceof c.FormData,!(0<=Array.prototype.indexOf.call(vf,l,void 0))||f||w||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[C,N]of u)this.g.setRequestHeader(C,N);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Za(this),this.u=!0,this.g.send(r),this.u=!1}catch(C){Ya(this,C)}};function Ya(r,l){r.h=!1,r.g&&(r.j=!0,r.g.abort(),r.j=!1),r.l=l,r.m=5,Xa(r),Gi(r)}function Xa(r){r.A||(r.A=!0,De(r,"complete"),De(r,"error"))}n.abort=function(r){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=r||7,De(this,"complete"),De(this,"abort"),Gi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gi(this,!0)),re.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ja(this):this.bb())},n.bb=function(){Ja(this)};function Ja(r){if(r.h&&typeof a<"u"&&(!r.v[1]||tt(r)!=4||r.Z()!=2)){if(r.u&&tt(r)==4)Ea(r.Ea,0,r);else if(De(r,"readystatechange"),tt(r)==4){r.h=!1;try{const N=r.Z();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var u;if(!(u=l)){var f;if(f=N===0){var w=String(r.D).match($a)[1]||null;!w&&c.self&&c.self.location&&(w=c.self.location.protocol.slice(0,-1)),f=!yf.test(w?w.toLowerCase():"")}u=f}if(u)De(r,"complete"),De(r,"success");else{r.m=6;try{var C=2<tt(r)?r.g.statusText:""}catch{C=""}r.l=C+" ["+r.Z()+"]",Xa(r)}}finally{Gi(r)}}}}function Gi(r,l){if(r.g){Za(r);const u=r.g,f=r.v[0]?()=>{}:null;r.g=null,r.v=null,l||De(r,"ready");try{u.onreadystatechange=f}catch{}}}function Za(r){r.I&&(c.clearTimeout(r.I),r.I=null)}n.isActive=function(){return!!this.g};function tt(r){return r.g?r.g.readyState:0}n.Z=function(){try{return 2<tt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(r){if(this.g){var l=this.g.responseText;return r&&l.indexOf(r)==0&&(l=l.substring(r.length)),Yd(l)}};function el(r){try{if(!r.g)return null;if("response"in r.g)return r.g.response;switch(r.H){case"":case"text":return r.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in r.g)return r.g.mozResponseArrayBuffer}return null}catch{return null}}function Ef(r){const l={};r=(r.g&&2<=tt(r)&&r.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<r.length;f++){if(F(r[f]))continue;var u=T(r[f]);const w=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();const C=l[w]||[];l[w]=C,C.push(u)}I(l,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Wn(r,l,u){return u&&u.internalChannelParams&&u.internalChannelParams[r]||l}function tl(r){this.Aa=0,this.i=[],this.j=new Mn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wn("failFast",!1,r),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wn("baseRetryDelayMs",5e3,r),this.cb=Wn("retryDelaySeedMs",1e4,r),this.Wa=Wn("forwardChannelMaxRetries",2,r),this.wa=Wn("forwardChannelRequestTimeoutMs",2e4,r),this.pa=r&&r.xmlHttpFactory||void 0,this.Xa=r&&r.Tb||void 0,this.Ca=r&&r.useFetchStreams||!1,this.L=void 0,this.J=r&&r.supportsCrossDomainXhr||!1,this.K="",this.h=new Ma(r&&r.concurrentRequestLimit),this.Da=new mf,this.P=r&&r.fastHandshake||!1,this.O=r&&r.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=r&&r.Rb||!1,r&&r.xa&&this.j.xa(),r&&r.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&r&&r.detectBufferingProxy||!1,this.ja=void 0,r&&r.longPollingTimeout&&0<r.longPollingTimeout&&(this.ja=r.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=tl.prototype,n.la=8,n.G=1,n.connect=function(r,l,u,f){ke(0),this.W=r,this.H=l||{},u&&f!==void 0&&(this.H.OSID=u,this.H.OAID=f),this.F=this.X,this.I=ul(this,null,this.W),Ki(this)};function _r(r){if(nl(r),r.G==3){var l=r.U++,u=et(r.I);if(J(u,"SID",r.K),J(u,"RID",l),J(u,"TYPE","terminate"),qn(r,u),l=new dt(r,r.j,l),l.L=2,l.v=Wi(et(u)),u=!1,c.navigator&&c.navigator.sendBeacon)try{u=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!u&&c.Image&&(new Image().src=l.v,u=!0),u||(l.g=hl(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Bi(l)}cl(r)}function zi(r){r.g&&(gr(r),r.g.cancel(),r.g=null)}function nl(r){zi(r),r.u&&(c.clearTimeout(r.u),r.u=null),Qi(r),r.h.cancel(),r.s&&(typeof r.s=="number"&&c.clearTimeout(r.s),r.s=null)}function Ki(r){if(!La(r.h)&&!r.s){r.s=!0;var l=r.Ga;Pn||_a(),Nn||(Pn(),Nn=!0),Qs.add(l,r),r.B=0}}function Tf(r,l){return Fa(r.h)>=r.h.j-(r.s?1:0)?!1:r.s?(r.i=l.D.concat(r.i),!0):r.G==1||r.G==2||r.B>=(r.Va?0:r.Wa)?!1:(r.s=xn(v(r.Ga,r,l),ll(r,r.B)),r.B++,!0)}n.Ga=function(r){if(this.s)if(this.s=null,this.G==1){if(!r){this.U=Math.floor(1e5*Math.random()),r=this.U++;const w=new dt(this,this.j,r);let C=this.o;if(this.S&&(C?(C=m(C),E(C,this.S)):C=this.S),this.m!==null||this.O||(w.H=C,C=null),this.P)e:{for(var l=0,u=0;u<this.i.length;u++){t:{var f=this.i[u];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(l+=f,4096<l){l=u;break e}if(l===4096||u===this.i.length-1){l=u+1;break e}}l=1e3}else l=1e3;l=sl(this,w,l),u=et(this.I),J(u,"RID",r),J(u,"CVER",22),this.D&&J(u,"X-HTTP-Session-Id",this.D),qn(this,u),C&&(this.O?l="headers="+encodeURIComponent(String(Qa(C)))+"&"+l:this.m&&pr(u,this.m,C)),fr(this.h,w),this.Ua&&J(u,"TYPE","init"),this.P?(J(u,"$req",l),J(u,"SID","null"),w.T=!0,cr(w,u,null)):cr(w,u,l),this.G=2}}else this.G==3&&(r?il(this,r):this.i.length==0||La(this.h)||il(this))};function il(r,l){var u;l?u=l.l:u=r.U++;const f=et(r.I);J(f,"SID",r.K),J(f,"RID",u),J(f,"AID",r.T),qn(r,f),r.m&&r.o&&pr(f,r.m,r.o),u=new dt(r,r.j,u,r.B+1),r.m===null&&(u.H=r.o),l&&(r.i=l.D.concat(r.i)),l=sl(r,u,1e3),u.I=Math.round(.5*r.wa)+Math.round(.5*r.wa*Math.random()),fr(r.h,u),cr(u,f,l)}function qn(r,l){r.H&&Ve(r.H,function(u,f){J(l,f,u)}),r.l&&ja({},function(u,f){J(l,f,u)})}function sl(r,l,u){u=Math.min(r.i.length,u);var f=r.l?v(r.l.Na,r.l,r):null;e:{var w=r.i;let C=-1;for(;;){const N=["count="+u];C==-1?0<u?(C=w[0].g,N.push("ofs="+C)):C=0:N.push("ofs="+C);let Y=!0;for(let _e=0;_e<u;_e++){let H=w[_e].g;const Ie=w[_e].map;if(H-=C,0>H)C=Math.max(0,w[_e].g-100),Y=!1;else try{gf(Ie,N,"req"+H+"_")}catch{f&&f(Ie)}}if(Y){f=N.join("&");break e}}}return r=r.i.splice(0,u),l.D=r,f}function rl(r){if(!r.g&&!r.u){r.Y=1;var l=r.Fa;Pn||_a(),Nn||(Pn(),Nn=!0),Qs.add(l,r),r.v=0}}function mr(r){return r.g||r.u||3<=r.v?!1:(r.Y++,r.u=xn(v(r.Fa,r),ll(r,r.v)),r.v++,!0)}n.Fa=function(){if(this.u=null,ol(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var r=2*this.R;this.j.info("BP detection timer enabled: "+r),this.A=xn(v(this.ab,this),r)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),zi(this),ol(this))};function gr(r){r.A!=null&&(c.clearTimeout(r.A),r.A=null)}function ol(r){r.g=new dt(r,r.j,"rpc",r.Y),r.m===null&&(r.g.H=r.o),r.g.O=0;var l=et(r.qa);J(l,"RID","rpc"),J(l,"SID",r.K),J(l,"AID",r.T),J(l,"CI",r.F?"0":"1"),!r.F&&r.ja&&J(l,"TO",r.ja),J(l,"TYPE","xmlhttp"),qn(r,l),r.m&&r.o&&pr(l,r.m,r.o),r.L&&(r.g.I=r.L);var u=r.g;r=r.ia,u.L=1,u.v=Wi(et(l)),u.m=null,u.P=!0,Va(u,r)}n.Za=function(){this.C!=null&&(this.C=null,zi(this),mr(this),ke(19))};function Qi(r){r.C!=null&&(c.clearTimeout(r.C),r.C=null)}function al(r,l){var u=null;if(r.g==l){Qi(r),gr(r),r.g=null;var f=2}else if(dr(r.h,l))u=l.D,Ua(r.h,l),f=1;else return;if(r.G!=0){if(l.o)if(f==1){u=l.m?l.m.length:0,l=Date.now()-l.F;var w=r.B;f=Li(),De(f,new Pa(f,u)),Ki(r)}else rl(r);else if(w=l.s,w==3||w==0&&0<l.X||!(f==1&&Tf(r,l)||f==2&&mr(r)))switch(u&&0<u.length&&(l=r.h,l.i=l.i.concat(u)),w){case 1:kt(r,5);break;case 4:kt(r,10);break;case 3:kt(r,6);break;default:kt(r,2)}}}function ll(r,l){let u=r.Ta+Math.floor(Math.random()*r.cb);return r.isActive()||(u*=2),u*l}function kt(r,l){if(r.j.info("Error code "+l),l==2){var u=v(r.fb,r),f=r.Xa;const w=!f;f=new Dt(f||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||ji(f,"https"),Wi(f),w?pf(f.toString(),u):_f(f.toString(),u)}else ke(2);r.G=0,r.l&&r.l.sa(l),cl(r),nl(r)}n.fb=function(r){r?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))};function cl(r){if(r.G=0,r.ka=[],r.l){const l=Ba(r.h);(l.length!=0||r.i.length!=0)&&(V(r.ka,l),V(r.ka,r.i),r.h.i.length=0,k(r.i),r.i.length=0),r.l.ra()}}function ul(r,l,u){var f=u instanceof Dt?et(u):new Dt(u);if(f.g!="")l&&(f.g=l+"."+f.g),$i(f,f.s);else{var w=c.location;f=w.protocol,l=l?l+"."+w.hostname:w.hostname,w=+w.port;var C=new Dt(null);f&&ji(C,f),l&&(C.g=l),w&&$i(C,w),u&&(C.l=u),f=C}return u=r.D,l=r.ya,u&&l&&J(f,u,l),J(f,"VER",r.la),qn(r,f),f}function hl(r,l,u){if(l&&!r.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=r.Ca&&!r.pa?new re(new qi({eb:u})):new re(r.pa),l.Ha(r.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function dl(){}n=dl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Yi(){}Yi.prototype.g=function(r,l){return new Me(r,l)};function Me(r,l){Te.call(this),this.g=new tl(l),this.l=r,this.h=l&&l.messageUrlParams||null,r=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(r?r["X-Client-Protocol"]="webchannel":r={"X-Client-Protocol":"webchannel"}),this.g.o=r,r=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(r?r["X-WebChannel-Content-Type"]=l.messageContentType:r={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(r?r["X-WebChannel-Client-Profile"]=l.va:r={"X-WebChannel-Client-Profile":l.va}),this.g.S=r,(r=l&&l.Sb)&&!F(r)&&(this.g.m=r),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!F(l)&&(this.g.D=l,r=this.h,r!==null&&l in r&&(r=this.h,l in r&&delete r[l])),this.j=new Zt(this)}b(Me,Te),Me.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Me.prototype.close=function(){_r(this.g)},Me.prototype.o=function(r){var l=this.g;if(typeof r=="string"){var u={};u.__data__=r,r=u}else this.u&&(u={},u.__data__=ir(r),r=u);l.i.push(new sf(l.Ya++,r)),l.G==3&&Ki(l)},Me.prototype.N=function(){this.g.l=null,delete this.j,_r(this.g),delete this.g,Me.aa.N.call(this)};function fl(r){rr.call(this),r.__headers__&&(this.headers=r.__headers__,this.statusCode=r.__status__,delete r.__headers__,delete r.__status__);var l=r.__sm__;if(l){e:{for(const u in l){r=u;break e}r=void 0}(this.i=r)&&(r=this.i,l=l!==null&&r in l?l[r]:void 0),this.data=l}else this.data=r}b(fl,rr);function pl(){or.call(this),this.status=1}b(pl,or);function Zt(r){this.g=r}b(Zt,dl),Zt.prototype.ua=function(){De(this.g,"a")},Zt.prototype.ta=function(r){De(this.g,new fl(r))},Zt.prototype.sa=function(r){De(this.g,new pl)},Zt.prototype.ra=function(){De(this.g,"b")},Yi.prototype.createWebChannel=Yi.prototype.g,Me.prototype.send=Me.prototype.o,Me.prototype.open=Me.prototype.m,Me.prototype.close=Me.prototype.close,wu=function(){return new Yi},Iu=function(){return Li()},Tu=Pt,qr={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fi.NO_ERROR=0,Fi.TIMEOUT=8,Fi.HTTP_ERROR=6,ls=Fi,Na.COMPLETE="complete",Eu=Na,Ca.EventType=Vn,Vn.OPEN="a",Vn.CLOSE="b",Vn.ERROR="c",Vn.MESSAGE="d",Te.prototype.listen=Te.prototype.K,Jn=Ca,re.prototype.listenOnce=re.prototype.L,re.prototype.getLastError=re.prototype.Ka,re.prototype.getLastErrorCode=re.prototype.Ba,re.prototype.getStatus=re.prototype.Z,re.prototype.getResponseJson=re.prototype.Oa,re.prototype.getResponseText=re.prototype.oa,re.prototype.send=re.prototype.ea,re.prototype.setWithCredentials=re.prototype.Ha,vu=re}).apply(typeof es<"u"?es:typeof self<"u"?self:typeof window<"u"?window:{});const Pl="@firebase/firestore",Nl="4.8.0";class Ce{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ce.UNAUTHENTICATED=new Ce(null),Ce.GOOGLE_CREDENTIALS=new Ce("google-credentials-uid"),Ce.FIRST_PARTY=new Ce("first-party-uid"),Ce.MOCK_USER=new Ce("mock-user");let wn="11.10.0";const Bt=new Eo("@firebase/firestore");function nn(){return Bt.logLevel}function O(n,...e){if(Bt.logLevel<=U.DEBUG){const t=e.map(Ao);Bt.debug(`Firestore (${wn}): ${n}`,...t)}}function jt(n,...e){if(Bt.logLevel<=U.ERROR){const t=e.map(Ao);Bt.error(`Firestore (${wn}): ${n}`,...t)}}function fn(n,...e){if(Bt.logLevel<=U.WARN){const t=e.map(Ao);Bt.warn(`Firestore (${wn}): ${n}`,...t)}}function Ao(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function L(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,Au(n,i,t)}function Au(n,e,t){let i=`FIRESTORE (${wn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw jt(i),new Error(i)}function oe(n,e,t,i){let s="Unexpected state";typeof t=="string"?s=t:i=t,n||Au(e,s,i)}function X(n,e){return n}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends In{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Lt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Cu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class C_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ce.UNAUTHENTICATED)))}shutdown(){}}class S_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class R_{constructor(e){this.t=e,this.currentUser=Ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){oe(this.o===void 0,42304);let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let o=new Lt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Lt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},c=h=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>c(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Lt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(oe(typeof i.accessToken=="string",31837,{l:i}),new Cu(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return oe(e===null||typeof e=="string",2055,{h:e}),new Ce(e)}}class b_{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=Ce.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class P_{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new b_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Ce.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Dl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class N_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,pu(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){oe(this.o===void 0,3512);const i=o=>{o.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>i(o)))};const s=o=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Dl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(oe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Dl(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function D_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}function k_(){return new TextEncoder}class Co{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const s=D_(40);for(let o=0;o<s.length;++o)i.length<20&&s[o]<t&&(i+=e.charAt(s[o]%62))}return i}}function q(n,e){return n<e?-1:n>e?1:0}function Hr(n,e){let t=0;for(;t<n.length&&t<e.length;){const i=n.codePointAt(t),s=e.codePointAt(t);if(i!==s){if(i<128&&s<128)return q(i,s);{const o=k_(),a=V_(o.encode(kl(n,t)),o.encode(kl(e,t)));return a!==0?a:q(i,s)}}t+=i>65535?2:1}return q(n.length,e.length)}function kl(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function V_(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return q(n[t],e[t]);return q(n.length,e.length)}function pn(n,e,t){return n.length===e.length&&n.every(((i,s)=>t(i,e[s])))}const Vl="__name__";class Qe{constructor(e,t,i){t===void 0?t=0:t>e.length&&L(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&L(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Qe.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qe?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const o=Qe.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return q(e.length,t.length)}static compareSegments(e,t){const i=Qe.isNumericId(e),s=Qe.isNumericId(t);return i&&!s?-1:!i&&s?1:i&&s?Qe.extractNumericId(e).compare(Qe.extractNumericId(t)):Hr(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return wo.fromString(e.substring(4,e.length-2))}}class se extends Qe{construct(e,t,i){return new se(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((s=>s.length>0)))}return new se(t)}static emptyPath(){return new se([])}}const O_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ye extends Qe{construct(e,t,i){return new ye(e,t,i)}static isValidIdentifier(e){return O_.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ye.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Vl}static keyField(){return new ye([Vl])}static fromServerFormat(e){const t=[];let i="",s=0;const o=()=>{if(i.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=h,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(i+=c,s++):(o(),s++)}if(o(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ye(t)}static emptyPath(){return new ye([])}}class M{constructor(e){this.path=e}static fromPath(e){return new M(se.fromString(e))}static fromName(e){return new M(se.fromString(e).popFirst(5))}static empty(){return new M(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new M(new se(e.slice()))}}function Su(n,e,t){if(!t)throw new x(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function x_(n,e,t,i){if(e===!0&&i===!0)throw new x(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ol(n){if(!M.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function xl(n){if(M.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ru(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function So(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function bu(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=So(n);throw new x(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ce(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ii(n,e){if(!Ru(n))throw new x(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const s=e[i].typeString,o="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const a=n[i];if(s&&typeof a!==s){t=`JSON field '${i}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${i}' field to equal '${o.value}'`;break}}if(t)throw new x(P.INVALID_ARGUMENT,t);return!0}const Ml=-62135596800,Ll=1e6;class ie{static now(){return ie.fromMillis(Date.now())}static fromDate(e){return ie.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*Ll);return new ie(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Ml)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ll}_compareTo(e){return this.seconds===e.seconds?q(this.nanoseconds,e.nanoseconds):q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ie._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ii(e,ie._jsonSchema))return new ie(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Ml;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ie._jsonSchemaVersion="firestore/timestamp/1.0",ie._jsonSchema={type:ce("string",ie._jsonSchemaVersion),seconds:ce("number"),nanoseconds:ce("number")};class ne{static fromTimestamp(e){return new ne(e)}static min(){return new ne(new ie(0,0))}static max(){return new ne(new ie(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const pi=-1;function M_(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=ne.fromTimestamp(i===1e9?new ie(t+1,0):new ie(t,i));return new wt(s,M.empty(),e)}function L_(n){return new wt(n.readTime,n.key,pi)}class wt{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new wt(ne.min(),M.empty(),pi)}static max(){return new wt(ne.max(),M.empty(),pi)}}function F_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:q(n.largestBatchId,e.largestBatchId))}const U_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class B_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ro(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==U_)throw n;O("LocalStore","Unexpectedly lost primary lease")}class S{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new S(((i,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(i,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(i,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof S?t:S.resolve(t)}catch(t){return S.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):S.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):S.reject(t)}static resolve(e){return new S(((t,i)=>{t(e)}))}static reject(e){return new S(((t,i)=>{i(e)}))}static waitFor(e){return new S(((t,i)=>{let s=0,o=0,a=!1;e.forEach((c=>{++s,c.next((()=>{++o,a&&o===s&&t()}),(h=>i(h)))})),a=!0,o===s&&t()}))}static or(e){let t=S.resolve(!1);for(const i of e)t=t.next((s=>s?S.resolve(s):i()));return t}static forEach(e,t){const i=[];return e.forEach(((s,o)=>{i.push(t.call(this,s,o))})),this.waitFor(i)}static mapArray(e,t){return new S(((i,s)=>{const o=e.length,a=new Array(o);let c=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((p=>{a[d]=p,++c,c===o&&i(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new S(((i,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):i()};o()}))}}function j_(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function wi(n){return n.name==="IndexedDbTransactionError"}class bo{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this._e(i),this.ae=i=>t.writeSequenceNumber(i))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}bo.ue=-1;const Po=-1;function No(n){return n==null}function ms(n){return n===0&&1/n==-1/0}function $_(n){return typeof n=="number"&&Number.isInteger(n)&&!ms(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Pu="";function W_(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Fl(e)),e=q_(n.get(t),e);return Fl(e)}function q_(n,e){let t=e;const i=n.length;for(let s=0;s<i;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case Pu:t+="";break;default:t+=o}}return t}function Fl(n){return n+Pu+""}function Ul(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function An(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Nu(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}let Ke=class Gr{constructor(e,t){this.comparator=e,this.root=t||Et.EMPTY}insert(e,t){return new Gr(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Et.BLACK,null,null))}remove(e){return new Gr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Et.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return t+i.left.size;s<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ts(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ts(this.root,e,this.comparator,!1)}getReverseIterator(){return new ts(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ts(this.root,e,this.comparator,!0)}},ts=class{constructor(e,t,i,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Et=class nt{constructor(e,t,i,s,o){this.key=e,this.value=t,this.color=i??nt.RED,this.left=s??nt.EMPTY,this.right=o??nt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,s,o){return new nt(e??this.key,t??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const o=i(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,i),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return nt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return nt.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw L(27949);return e+(this.isRed()?0:1)}};Et.EMPTY=null,Et.RED=!0,Et.BLACK=!1;Et.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(e,t,i,s,o){return this}insert(e,t,i){return new Et(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ve{constructor(e){this.comparator=e,this.data=new Ke(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Bl(this.data.getIterator())}getIteratorFrom(e){return new Bl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof ve)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=i.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ve(this.comparator);return t.data=e,t}}class Bl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class He{constructor(e){this.fields=e,e.sort(ye.comparator)}static empty(){return new He([])}unionWith(e){let t=new ve(ye.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new He(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return pn(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}class H_ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Xe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new H_("Invalid base64 string: "+o):o}})(e);return new Xe(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Xe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xe.EMPTY_BYTE_STRING=new Xe("");const G_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $t(n){if(oe(!!n,39018),typeof n=="string"){let e=0;const t=G_.exec(n);if(oe(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:me(n.seconds),nanos:me(n.nanos)}}function me(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _n(n){return typeof n=="string"?Xe.fromBase64String(n):Xe.fromUint8Array(n)}const Du="server_timestamp",ku="__type__",Vu="__previous_value__",Ou="__local_write_time__";function Do(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[ku])===null||t===void 0?void 0:t.stringValue)===Du}function ko(n){const e=n.mapValue.fields[Vu];return Do(e)?ko(e):e}function gs(n){const e=$t(n.mapValue.fields[Ou].timestampValue);return new ie(e.seconds,e.nanos)}class z_{constructor(e,t,i,s,o,a,c,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const ys="(default)";class vs{constructor(e,t){this.projectId=e,this.database=t||ys}static empty(){return new vs("","")}get isDefaultDatabase(){return this.database===ys}isEqual(e){return e instanceof vs&&e.projectId===this.projectId&&e.database===this.database}}const xu="__type__",K_="__max__",ns={mapValue:{}},Mu="__vector__",zr="value";function Wt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Do(n)?4:Y_(n)?9007199254740991:Q_(n)?10:11:L(28295,{value:n})}function Je(n,e){if(n===e)return!0;const t=Wt(n);if(t!==Wt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return gs(n).isEqual(gs(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=$t(s.timestampValue),c=$t(o.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return _n(s.bytesValue).isEqual(_n(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return me(s.geoPointValue.latitude)===me(o.geoPointValue.latitude)&&me(s.geoPointValue.longitude)===me(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return me(s.integerValue)===me(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=me(s.doubleValue),c=me(o.doubleValue);return a===c?ms(a)===ms(c):isNaN(a)&&isNaN(c)}return!1})(n,e);case 9:return pn(n.arrayValue.values||[],e.arrayValue.values||[],Je);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},c=o.mapValue.fields||{};if(Ul(a)!==Ul(c))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(c[h]===void 0||!Je(a[h],c[h])))return!1;return!0})(n,e);default:return L(52216,{left:n})}}function _i(n,e){return(n.values||[]).find((t=>Je(t,e)))!==void 0}function mn(n,e){if(n===e)return 0;const t=Wt(n),i=Wt(e);if(t!==i)return q(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const c=me(o.integerValue||o.doubleValue),h=me(a.integerValue||a.doubleValue);return c<h?-1:c>h?1:c===h?0:isNaN(c)?isNaN(h)?0:-1:1})(n,e);case 3:return jl(n.timestampValue,e.timestampValue);case 4:return jl(gs(n),gs(e));case 5:return Hr(n.stringValue,e.stringValue);case 6:return(function(o,a){const c=_n(o),h=_n(a);return c.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const c=o.split("/"),h=a.split("/");for(let d=0;d<c.length&&d<h.length;d++){const p=q(c[d],h[d]);if(p!==0)return p}return q(c.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const c=q(me(o.latitude),me(a.latitude));return c!==0?c:q(me(o.longitude),me(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return $l(n.arrayValue,e.arrayValue);case 10:return(function(o,a){var c,h,d,p;const _=o.fields||{},v=a.fields||{},R=(c=_[zr])===null||c===void 0?void 0:c.arrayValue,b=(h=v[zr])===null||h===void 0?void 0:h.arrayValue,k=q(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((p=b?.values)===null||p===void 0?void 0:p.length)||0);return k!==0?k:$l(R,b)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===ns.mapValue&&a===ns.mapValue)return 0;if(o===ns.mapValue)return 1;if(a===ns.mapValue)return-1;const c=o.fields||{},h=Object.keys(c),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let _=0;_<h.length&&_<p.length;++_){const v=Hr(h[_],p[_]);if(v!==0)return v;const R=mn(c[h[_]],d[p[_]]);if(R!==0)return R}return q(h.length,p.length)})(n.mapValue,e.mapValue);default:throw L(23264,{le:t})}}function jl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return q(n,e);const t=$t(n),i=$t(e),s=q(t.seconds,i.seconds);return s!==0?s:q(t.nanos,i.nanos)}function $l(n,e){const t=n.values||[],i=e.values||[];for(let s=0;s<t.length&&s<i.length;++s){const o=mn(t[s],i[s]);if(o)return o}return q(t.length,i.length)}function gn(n){return Kr(n)}function Kr(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=$t(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return _n(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return M.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",s=!0;for(const o of t.values||[])s?s=!1:i+=",",i+=Kr(o);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of i)o?o=!1:s+=",",s+=`${a}:${Kr(t.fields[a])}`;return s+"}"})(n.mapValue):L(61005,{value:n})}function cs(n){switch(Wt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ko(n);return e?16+cs(e):16;case 5:return 2*n.stringValue.length;case 6:return _n(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(i){return(i.values||[]).reduce(((s,o)=>s+cs(o)),0)})(n.arrayValue);case 10:case 11:return(function(i){let s=0;return An(i.fields,((o,a)=>{s+=o.length+cs(a)})),s})(n.mapValue);default:throw L(13486,{value:n})}}function Qr(n){return!!n&&"integerValue"in n}function Vo(n){return!!n&&"arrayValue"in n}function us(n){return!!n&&"mapValue"in n}function Q_(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[xu])===null||t===void 0?void 0:t.stringValue)===Mu}function ei(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return An(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=ei(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ei(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Y_(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===K_}class $e{constructor(e){this.value=e}static empty(){return new $e({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!us(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ei(t)}setAll(e){let t=ye.emptyPath(),i={},s=[];e.forEach(((a,c)=>{if(!t.isImmediateParentOf(c)){const h=this.getFieldsMap(t);this.applyChanges(h,i,s),i={},s=[],t=c.popLast()}a?i[c.lastSegment()]=ei(a):s.push(c.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,i,s)}delete(e){const t=this.field(e.popLast());us(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Je(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=t.mapValue.fields[e.get(i)];us(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,i){An(t,((s,o)=>e[s]=o));for(const s of i)delete e[s]}clone(){return new $e(ei(this.value))}}function Lu(n){const e=[];return An(n.fields,((t,i)=>{const s=new ye([t]);if(us(i)){const o=Lu(i.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new He(e)}class je{constructor(e,t,i,s,o,a,c){this.key=e,this.documentType=t,this.version=i,this.readTime=s,this.createTime=o,this.data=a,this.documentState=c}static newInvalidDocument(e){return new je(e,0,ne.min(),ne.min(),ne.min(),$e.empty(),0)}static newFoundDocument(e,t,i,s){return new je(e,1,t,ne.min(),i,s,0)}static newNoDocument(e,t){return new je(e,2,t,ne.min(),ne.min(),$e.empty(),0)}static newUnknownDocument(e,t){return new je(e,3,t,ne.min(),ne.min(),$e.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ne.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=$e.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=$e.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ne.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof je&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new je(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Es{constructor(e,t){this.position=e,this.inclusive=t}}function Wl(n,e,t){let i=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?i=M.comparator(M.fromName(a.referenceValue),t.key):i=mn(a,t.data.field(o.field)),o.dir==="desc"&&(i*=-1),i!==0)break}return i}function ql(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Je(n.position[t],e.position[t]))return!1;return!0}class Ts{constructor(e,t="asc"){this.field=e,this.dir=t}}function X_(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Fu{}class fe extends Fu{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new Z_(e,t,i):t==="array-contains"?new nm(e,i):t==="in"?new im(e,i):t==="not-in"?new sm(e,i):t==="array-contains-any"?new rm(e,i):new fe(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new em(e,i):new tm(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(mn(t,this.value)):t!==null&&Wt(this.value)===Wt(t)&&this.matchesComparison(mn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class At extends Fu{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new At(e,t)}matches(e){return Uu(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function Uu(n){return n.op==="and"}function Bu(n){return J_(n)&&Uu(n)}function J_(n){for(const e of n.filters)if(e instanceof At)return!1;return!0}function Yr(n){if(n instanceof fe)return n.field.canonicalString()+n.op.toString()+gn(n.value);if(Bu(n))return n.filters.map((e=>Yr(e))).join(",");{const e=n.filters.map((t=>Yr(t))).join(",");return`${n.op}(${e})`}}function ju(n,e){return n instanceof fe?(function(i,s){return s instanceof fe&&i.op===s.op&&i.field.isEqual(s.field)&&Je(i.value,s.value)})(n,e):n instanceof At?(function(i,s){return s instanceof At&&i.op===s.op&&i.filters.length===s.filters.length?i.filters.reduce(((o,a,c)=>o&&ju(a,s.filters[c])),!0):!1})(n,e):void L(19439)}function $u(n){return n instanceof fe?(function(t){return`${t.field.canonicalString()} ${t.op} ${gn(t.value)}`})(n):n instanceof At?(function(t){return t.op.toString()+" {"+t.getFilters().map($u).join(" ,")+"}"})(n):"Filter"}class Z_ extends fe{constructor(e,t,i){super(e,t,i),this.key=M.fromName(i.referenceValue)}matches(e){const t=M.comparator(e.key,this.key);return this.matchesComparison(t)}}class em extends fe{constructor(e,t){super(e,"in",t),this.keys=Wu("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class tm extends fe{constructor(e,t){super(e,"not-in",t),this.keys=Wu("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Wu(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map((i=>M.fromName(i.referenceValue)))}class nm extends fe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Vo(t)&&_i(t.arrayValue,this.value)}}class im extends fe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&_i(this.value.arrayValue,t)}}class sm extends fe{constructor(e,t){super(e,"not-in",t)}matches(e){if(_i(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!_i(this.value.arrayValue,t)}}class rm extends fe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Vo(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>_i(this.value.arrayValue,i)))}}class om{constructor(e,t=null,i=[],s=[],o=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=s,this.limit=o,this.startAt=a,this.endAt=c,this.Pe=null}}function Hl(n,e=null,t=[],i=[],s=null,o=null,a=null){return new om(n,e,t,i,s,o,a)}function Oo(n){const e=X(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>Yr(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(o){return o.field.canonicalString()+o.dir})(i))).join(","),No(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>gn(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>gn(i))).join(",")),e.Pe=t}return e.Pe}function xo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!X_(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!ju(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ql(n.startAt,e.startAt)&&ql(n.endAt,e.endAt)}class Ms{constructor(e,t=null,i=[],s=[],o=null,a="F",c=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=o,this.limitType=a,this.startAt=c,this.endAt=h,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function am(n,e,t,i,s,o,a,c){return new Ms(n,e,t,i,s,o,a,c)}function lm(n){return new Ms(n)}function Gl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function cm(n){return n.collectionGroup!==null}function ti(n){const e=X(n);if(e.Te===null){e.Te=[];const t=new Set;for(const o of e.explicitOrderBy)e.Te.push(o),t.add(o.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new ve(ye.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(c=c.add(d.field))}))})),c})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Te.push(new Ts(o,i))})),t.has(ye.keyField().canonicalString())||e.Te.push(new Ts(ye.keyField(),i))}return e.Te}function Ft(n){const e=X(n);return e.Ie||(e.Ie=um(e,ti(n))),e.Ie}function um(n,e){if(n.limitType==="F")return Hl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Ts(s.field,o)}));const t=n.endAt?new Es(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Es(n.startAt.position,n.startAt.inclusive):null;return Hl(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function Xr(n,e,t){return new Ms(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function qu(n,e){return xo(Ft(n),Ft(e))&&n.limitType===e.limitType}function Hu(n){return`${Oo(Ft(n))}|lt:${n.limitType}`}function zn(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((s=>$u(s))).join(", ")}]`),No(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((s=>gn(s))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((s=>gn(s))).join(",")),`Target(${i})`})(Ft(n))}; limitType=${n.limitType})`}function Mo(n,e){return e.isFoundDocument()&&(function(i,s){const o=s.key.path;return i.collectionGroup!==null?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(o):M.isDocumentKey(i.path)?i.path.isEqual(o):i.path.isImmediateParentOf(o)})(n,e)&&(function(i,s){for(const o of ti(i))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(i,s){for(const o of i.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(i,s){return!(i.startAt&&!(function(a,c,h){const d=Wl(a,c,h);return a.inclusive?d<=0:d<0})(i.startAt,ti(i),s)||i.endAt&&!(function(a,c,h){const d=Wl(a,c,h);return a.inclusive?d>=0:d>0})(i.endAt,ti(i),s))})(n,e)}function hm(n){return(e,t)=>{let i=!1;for(const s of ti(n)){const o=dm(s,e,t);if(o!==0)return o;i=i||s.field.isKeyField()}return 0}}function dm(n,e,t){const i=n.field.isKeyField()?M.comparator(e.key,t.key):(function(o,a,c){const h=a.data.field(o),d=c.data.field(o);return h!==null&&d!==null?mn(h,d):L(42886)})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return L(19790,{direction:n.dir})}}class zt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[s,o]of i)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[t]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){An(this.inner,((t,i)=>{for(const[s,o]of i)e(s,o)}))}isEmpty(){return Nu(this.inner)}size(){return this.innerSize}}const fm=new Ke(M.comparator);function Is(){return fm}const Gu=new Ke(M.comparator);function is(...n){let e=Gu;for(const t of n)e=e.insert(t.key,t);return e}function zu(n){let e=Gu;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function xt(){return ni()}function Ku(){return ni()}function ni(){return new zt((n=>n.toString()),((n,e)=>n.isEqual(e)))}const pm=new Ke(M.comparator),_m=new ve(M.comparator);function Se(...n){let e=_m;for(const t of n)e=e.add(t);return e}const mm=new ve(q);function gm(){return mm}function Lo(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ms(e)?"-0":e}}function Qu(n){return{integerValue:""+n}}function ym(n,e){return $_(e)?Qu(e):Lo(n,e)}class Ls{constructor(){this._=void 0}}function vm(n,e,t){return n instanceof mi?(function(s,o){const a={fields:{[ku]:{stringValue:Du},[Ou]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Do(o)&&(o=ko(o)),o&&(a.fields[Vu]=o),{mapValue:a}})(t,e):n instanceof gi?Xu(n,e):n instanceof yi?Ju(n,e):(function(s,o){const a=Yu(s,o),c=zl(a)+zl(s.Ee);return Qr(a)&&Qr(s.Ee)?Qu(c):Lo(s.serializer,c)})(n,e)}function Em(n,e,t){return n instanceof gi?Xu(n,e):n instanceof yi?Ju(n,e):t}function Yu(n,e){return n instanceof ws?(function(i){return Qr(i)||(function(o){return!!o&&"doubleValue"in o})(i)})(e)?e:{integerValue:0}:null}class mi extends Ls{}class gi extends Ls{constructor(e){super(),this.elements=e}}function Xu(n,e){const t=Zu(e);for(const i of n.elements)t.some((s=>Je(s,i)))||t.push(i);return{arrayValue:{values:t}}}class yi extends Ls{constructor(e){super(),this.elements=e}}function Ju(n,e){let t=Zu(e);for(const i of n.elements)t=t.filter((s=>!Je(s,i)));return{arrayValue:{values:t}}}class ws extends Ls{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function zl(n){return me(n.integerValue||n.doubleValue)}function Zu(n){return Vo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Tm{constructor(e,t){this.field=e,this.transform=t}}function Im(n,e){return n.field.isEqual(e.field)&&(function(i,s){return i instanceof gi&&s instanceof gi||i instanceof yi&&s instanceof yi?pn(i.elements,s.elements,Je):i instanceof ws&&s instanceof ws?Je(i.Ee,s.Ee):i instanceof mi&&s instanceof mi})(n.transform,e.transform)}class wm{constructor(e,t){this.version=e,this.transformResults=t}}class st{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new st}static exists(e){return new st(void 0,e)}static updateTime(e){return new st(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Fs{}function eh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new nh(n.key,st.none()):new Ai(n.key,n.data,st.none());{const t=n.data,i=$e.empty();let s=new ve(ye.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?i.delete(o):i.set(o,a),s=s.add(o)}return new Kt(n.key,i,new He(s.toArray()),st.none())}}function Am(n,e,t){n instanceof Ai?(function(s,o,a){const c=s.value.clone(),h=Ql(s.fieldTransforms,o,a.transformResults);c.setAll(h),o.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,e,t):n instanceof Kt?(function(s,o,a){if(!hs(s.precondition,o))return void o.convertToUnknownDocument(a.version);const c=Ql(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(th(s)),h.setAll(c),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function ii(n,e,t,i){return n instanceof Ai?(function(o,a,c,h){if(!hs(o.precondition,a))return c;const d=o.value.clone(),p=Yl(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,i):n instanceof Kt?(function(o,a,c,h){if(!hs(o.precondition,a))return c;const d=Yl(o.fieldTransforms,h,a),p=a.data;return p.setAll(th(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),c===null?null:c.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((_=>_.field)))})(n,e,t,i):(function(o,a,c){return hs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(n,e,t)}function Cm(n,e){let t=null;for(const i of n.fieldTransforms){const s=e.data.field(i.field),o=Yu(i.transform,s||null);o!=null&&(t===null&&(t=$e.empty()),t.set(i.field,o))}return t||null}function Kl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,s){return i===void 0&&s===void 0||!(!i||!s)&&pn(i,s,((o,a)=>Im(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ai extends Fs{constructor(e,t,i,s=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Kt extends Fs{constructor(e,t,i,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function th(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function Ql(n,e,t){const i=new Map;oe(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,c=e.data.field(o.field);i.set(o.field,Em(a,c,t[s]))}return i}function Yl(n,e,t){const i=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);i.set(s.field,vm(o,a,e))}return i}class nh extends Fs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Sm extends Fs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Rm{constructor(e,t,i,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&Am(o,e,i[s])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=ii(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=ii(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=Ku();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let c=this.applyToLocalView(a,o.mutatedFields);c=t.has(s.key)?null:c;const h=eh(a,c);h!==null&&i.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(ne.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Se())}isEqual(e){return this.batchId===e.batchId&&pn(this.mutations,e.mutations,((t,i)=>Kl(t,i)))&&pn(this.baseMutations,e.baseMutations,((t,i)=>Kl(t,i)))}}class Fo{constructor(e,t,i,s){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=s}static from(e,t,i){oe(e.mutations.length===i.length,58842,{Ve:e.mutations.length,me:i.length});let s=(function(){return pm})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,i[a].version);return new Fo(e,t,i,s)}}class bm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}var le,j;function Pm(n){switch(n){case P.OK:return L(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function Nm(n){if(n===void 0)return jt("GRPC error has no .code"),P.UNKNOWN;switch(n){case le.OK:return P.OK;case le.CANCELLED:return P.CANCELLED;case le.UNKNOWN:return P.UNKNOWN;case le.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case le.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case le.INTERNAL:return P.INTERNAL;case le.UNAVAILABLE:return P.UNAVAILABLE;case le.UNAUTHENTICATED:return P.UNAUTHENTICATED;case le.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case le.NOT_FOUND:return P.NOT_FOUND;case le.ALREADY_EXISTS:return P.ALREADY_EXISTS;case le.PERMISSION_DENIED:return P.PERMISSION_DENIED;case le.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case le.ABORTED:return P.ABORTED;case le.OUT_OF_RANGE:return P.OUT_OF_RANGE;case le.UNIMPLEMENTED:return P.UNIMPLEMENTED;case le.DATA_LOSS:return P.DATA_LOSS;default:return L(39323,{code:n})}}(j=le||(le={}))[j.OK=0]="OK",j[j.CANCELLED=1]="CANCELLED",j[j.UNKNOWN=2]="UNKNOWN",j[j.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",j[j.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",j[j.NOT_FOUND=5]="NOT_FOUND",j[j.ALREADY_EXISTS=6]="ALREADY_EXISTS",j[j.PERMISSION_DENIED=7]="PERMISSION_DENIED",j[j.UNAUTHENTICATED=16]="UNAUTHENTICATED",j[j.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",j[j.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",j[j.ABORTED=10]="ABORTED",j[j.OUT_OF_RANGE=11]="OUT_OF_RANGE",j[j.UNIMPLEMENTED=12]="UNIMPLEMENTED",j[j.INTERNAL=13]="INTERNAL",j[j.UNAVAILABLE=14]="UNAVAILABLE",j[j.DATA_LOSS=15]="DATA_LOSS";new wo([4294967295,4294967295],0);class Dm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Jr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function km(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Vm(n,e){return Jr(n,e.toTimestamp())}function an(n){return oe(!!n,49232),ne.fromTimestamp((function(t){const i=$t(t);return new ie(i.seconds,i.nanos)})(n))}function ih(n,e){return Zr(n,e).canonicalString()}function Zr(n,e){const t=(function(s){return new se(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Om(n){const e=se.fromString(n);return oe($m(e),10190,{key:e.toString()}),e}function eo(n,e){return ih(n.databaseId,e.path)}function xm(n){const e=Om(n);return e.length===4?se.emptyPath():Lm(e)}function Mm(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Lm(n){return oe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Xl(n,e,t){return{name:eo(n,e),fields:t.value.mapValue.fields}}function Fm(n,e){let t;if(e instanceof Ai)t={update:Xl(n,e.key,e.value)};else if(e instanceof nh)t={delete:eo(n,e.key)};else if(e instanceof Kt)t={update:Xl(n,e.key,e.data),updateMask:jm(e.fieldMask)};else{if(!(e instanceof Sm))return L(16599,{Rt:e.type});t={verify:eo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(o,a){const c=a.transform;if(c instanceof mi)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof gi)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof yi)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof ws)return{fieldPath:a.field.canonicalString(),increment:c.Ee};throw L(20930,{transform:a.transform})})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:Vm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:L(27497)})(n,e.precondition)),t}function Um(n,e){return n&&n.length>0?(oe(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?an(s.updateTime):an(o);return a.isEqual(ne.min())&&(a=an(o)),new wm(a,s.transformResults||[])})(t,e)))):[]}function Bm(n){let e=xm(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let s=null;if(i>0){oe(i===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(_){const v=sh(_);return v instanceof At&&Bu(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(_){return _.map((v=>(function(b){return new Ts(sn(b.field),(function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(v)))})(t.orderBy));let c=null;t.limit&&(c=(function(_){let v;return v=typeof _=="object"?_.value:_,No(v)?null:v})(t.limit));let h=null;t.startAt&&(h=(function(_){const v=!!_.before,R=_.values||[];return new Es(R,v)})(t.startAt));let d=null;return t.endAt&&(d=(function(_){const v=!_.before,R=_.values||[];return new Es(R,v)})(t.endAt)),am(e,s,a,o,c,"F",h,d)}function sh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=sn(t.unaryFilter.field);return fe.create(i,"==",{doubleValue:NaN});case"IS_NULL":const s=sn(t.unaryFilter.field);return fe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=sn(t.unaryFilter.field);return fe.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=sn(t.unaryFilter.field);return fe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(n):n.fieldFilter!==void 0?(function(t){return fe.create(sn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return At.create(t.compositeFilter.filters.map((i=>sh(i))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(t.compositeFilter.op))})(n):L(30097,{filter:n})}function sn(n){return ye.fromServerFormat(n.fieldPath)}function jm(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $m(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Wm{constructor(e){this.gt=e}}function qm(n){const e=Bm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Xr(e,e.limit,"L"):e}class Hm{constructor(){this.Dn=new Gm}addToCollectionParentIndex(e,t){return this.Dn.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(wt.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(wt.min())}updateCollectionGroup(e,t,i){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}}class Gm{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t]||new ve(se.comparator),o=!s.has(i);return this.index[t]=s.add(i),o}has(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t];return s&&s.has(i)}getEntries(e){return(this.index[e]||new ve(se.comparator)).toArray()}}const Jl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},rh=41943040;class Oe{static withCacheSize(e){return new Oe(e,Oe.DEFAULT_COLLECTION_PERCENTILE,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}Oe.DEFAULT_COLLECTION_PERCENTILE=10,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Oe.DEFAULT=new Oe(rh,Oe.DEFAULT_COLLECTION_PERCENTILE,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Oe.DISABLED=new Oe(-1,0,0);class yn{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new yn(0)}static ur(){return new yn(-1)}}const Zl="LruGarbageCollector",zm=1048576;function ec([n,e],[t,i]){const s=q(n,t);return s===0?q(e,i):s}class Km{constructor(e){this.Tr=e,this.buffer=new ve(ec),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();ec(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Qm{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){O(Zl,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){wi(t)?O(Zl,"Ignoring IndexedDB error during garbage collection: ",t):await Ro(t)}await this.Rr(3e5)}))}}class Ym{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next((i=>Math.floor(t/100*i)))}nthSequenceNumber(e,t){if(t===0)return S.resolve(bo.ue);const i=new Km(t);return this.Vr.forEachTarget(e,(s=>i.Er(s.sequenceNumber))).next((()=>this.Vr.gr(e,(s=>i.Er(s))))).next((()=>i.maxValue))}removeTargets(e,t,i){return this.Vr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Jl)):this.getCacheSize(e).next((i=>i<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Jl):this.pr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let i,s,o,a,c,h,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),s=this.params.maximumSequenceNumbersToCollect):s=_,a=Date.now(),this.nthSequenceNumber(e,s)))).next((_=>(i=_,c=Date.now(),this.removeTargets(e,i,t)))).next((_=>(o=_,h=Date.now(),this.removeOrphanedDocuments(e,i)))).next((_=>(d=Date.now(),nn()<=U.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${o} targets in `+(h-c)+`ms
	Removed ${_} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:_}))))}}function Xm(n,e){return new Ym(n,e)}class Jm{constructor(){this.changes=new zt((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,je.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?S.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Zm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class eg{constructor(e,t,i,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(i=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(i!==null&&ii(i.mutation,s,He.empty(),ie.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,Se()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=Se()){const s=xt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,i).next((o=>{let a=is();return o.forEach(((c,h)=>{a=a.insert(c,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const i=xt();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,Se())))}populateOverlays(e,t,i){const s=[];return i.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,c)=>{t.set(a,c)}))}))}computeViews(e,t,i,s){let o=Is();const a=ni(),c=(function(){return ni()})();return t.forEach(((h,d)=>{const p=i.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof Kt)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),ii(p.mutation,d,p.mutation.getFieldMask(),ie.now())):a.set(d.key,He.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>{var _;return c.set(d,new Zm(p,(_=a.get(d))!==null&&_!==void 0?_:null))})),c)))}recalculateAndSaveOverlays(e,t){const i=ni();let s=new Ke(((a,c)=>a-c)),o=Se();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const c of a)c.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let p=i.get(h)||He.empty();p=c.applyToLocalView(d,p),i.set(h,p);const _=(s.get(c.batchId)||Se()).add(h);s=s.insert(c.batchId,_)}))})).next((()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const h=c.getNext(),d=h.key,p=h.value,_=Ku();p.forEach((v=>{if(!o.has(v)){const R=eh(t.get(v),i.get(v));R!==null&&_.set(v,R),o=o.add(v)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,_))}return S.waitFor(a)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,s){return(function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):cm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,s):this.getDocumentsMatchingCollectionQuery(e,t,i,s)}getNextDocuments(e,t,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,s-o.size):S.resolve(xt());let c=pi,h=o;return a.next((d=>S.forEach(d,((p,_)=>(c<_.largestBatchId&&(c=_.largestBatchId),o.get(p)?S.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,Se()))).next((p=>({batchId:c,changes:zu(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next((i=>{let s=is();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,s){const o=t.collectionGroup;let a=is();return this.indexManager.getCollectionParents(e,o).next((c=>S.forEach(c,(h=>{const d=(function(_,v){return new Ms(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,i,s).next((p=>{p.forEach(((_,v)=>{a=a.insert(_,v)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,i,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,je.newInvalidDocument(p)))}));let c=is();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&ii(p.mutation,d,He.empty(),ie.now()),Mo(t,d)&&(c=c.insert(h,d))})),c}))}}class tg{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return S.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:an(s.createTime)}})(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(s){return{name:s.name,query:qm(s.bundledQuery),readTime:an(s.readTime)}})(t)),S.resolve()}}class ng{constructor(){this.overlays=new Ke(M.comparator),this.kr=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){const i=xt();return S.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&i.set(s,o)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((s,o)=>{this.wt(e,t,o)})),S.resolve()}removeOverlaysForBatchId(e,t,i){const s=this.kr.get(i);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.kr.delete(i)),S.resolve()}getOverlaysForCollection(e,t,i){const s=xt(),o=t.length+1,a=new M(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const h=c.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>i&&s.set(h.getKey(),h)}return S.resolve(s)}getOverlaysForCollectionGroup(e,t,i,s){let o=new Ke(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>i){let p=o.get(d.largestBatchId);p===null&&(p=xt(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const c=xt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>c.set(d,p))),!(c.size()>=s)););return S.resolve(c)}wt(e,t,i){const s=this.overlays.get(i.key);if(s!==null){const a=this.kr.get(s.largestBatchId).delete(i.key);this.kr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(i.key,new bm(t,i));let o=this.kr.get(t);o===void 0&&(o=Se(),this.kr.set(t,o)),this.kr.set(t,o.add(i.key))}}class ig{constructor(){this.sessionToken=Xe.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}}class Uo{constructor(){this.qr=new ve(he.Qr),this.$r=new ve(he.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const i=new he(e,t);this.qr=this.qr.add(i),this.$r=this.$r.add(i)}Kr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Wr(new he(e,t))}Gr(e,t){e.forEach((i=>this.removeReference(i,t)))}zr(e){const t=new M(new se([])),i=new he(t,e),s=new he(t,e+1),o=[];return this.$r.forEachInRange([i,s],(a=>{this.Wr(a),o.push(a.key)})),o}jr(){this.qr.forEach((e=>this.Wr(e)))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new M(new se([])),i=new he(t,e),s=new he(t,e+1);let o=Se();return this.$r.forEachInRange([i,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new he(e,0),i=this.qr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class he{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return M.comparator(e.key,t.key)||q(e.Hr,t.Hr)}static Ur(e,t){return q(e.Hr,t.Hr)||M.comparator(e.key,t.key)}}class sg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new ve(he.Qr)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,s){const o=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Rm(o,t,i,s);this.mutationQueue.push(a);for(const c of s)this.Yr=this.Yr.add(new he(c.key,o)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return S.resolve(a)}lookupMutationBatch(e,t){return S.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=this.Xr(i),o=s<0?0:s;return S.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?Po:this.er-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new he(t,0),s=new he(t,Number.POSITIVE_INFINITY),o=[];return this.Yr.forEachInRange([i,s],(a=>{const c=this.Zr(a.Hr);o.push(c)})),S.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new ve(q);return t.forEach((s=>{const o=new he(s,0),a=new he(s,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([o,a],(c=>{i=i.add(c.Hr)}))})),S.resolve(this.ei(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1;let o=i;M.isDocumentKey(o)||(o=o.child(""));const a=new he(new M(o),0);let c=new ve(q);return this.Yr.forEachWhile((h=>{const d=h.key.path;return!!i.isPrefixOf(d)&&(d.length===s&&(c=c.add(h.Hr)),!0)}),a),S.resolve(this.ei(c))}ei(e){const t=[];return e.forEach((i=>{const s=this.Zr(i);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){oe(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Yr;return S.forEach(t.mutations,(s=>{const o=new he(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Yr=i}))}rr(e){}containsKey(e,t){const i=new he(t,0),s=this.Yr.firstAfterOrEqual(i);return S.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class rg{constructor(e){this.ni=e,this.docs=(function(){return new Ke(M.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,s=this.docs.get(i),o=s?s.size:0,a=this.ni(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return S.resolve(i?i.document.mutableCopy():je.newInvalidDocument(t))}getEntries(e,t){let i=Is();return t.forEach((s=>{const o=this.docs.get(s);i=i.insert(s,o?o.document.mutableCopy():je.newInvalidDocument(s))})),S.resolve(i)}getDocumentsMatchingQuery(e,t,i,s){let o=Is();const a=t.path,c=new M(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(c);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||F_(L_(p),i)<=0||(s.has(p.key)||Mo(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return S.resolve(o)}getAllFromCollectionGroup(e,t,i,s){L(9500)}ri(e,t){return S.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new og(this)}getSize(e){return S.resolve(this.size)}}class og extends Jm{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach(((i,s)=>{s.isValidDocument()?t.push(this.Or.addEntry(e,s)):this.Or.removeEntry(i)})),S.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class ag{constructor(e){this.persistence=e,this.ii=new zt((t=>Oo(t)),xo),this.lastRemoteSnapshotVersion=ne.min(),this.highestTargetId=0,this.si=0,this.oi=new Uo,this.targetCount=0,this._i=yn.ar()}forEachTarget(e,t){return this.ii.forEach(((i,s)=>t(s))),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.si&&(this.si=t),S.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new yn(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.hr(t),S.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,i){let s=0;const o=[];return this.ii.forEach(((a,c)=>{c.sequenceNumber<=t&&i.get(c.targetId)===null&&(this.ii.delete(a),o.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)})),S.waitFor(o).next((()=>s))}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){const i=this.ii.get(t)||null;return S.resolve(i)}addMatchingKeys(e,t,i){return this.oi.Kr(t,i),S.resolve()}removeMatchingKeys(e,t,i){this.oi.Gr(t,i);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),S.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),S.resolve()}getMatchingKeysForTargetId(e,t){const i=this.oi.Jr(t);return S.resolve(i)}containsKey(e,t){return S.resolve(this.oi.containsKey(t))}}class oh{constructor(e,t){this.ai={},this.overlays={},this.ui=new bo(0),this.ci=!1,this.ci=!0,this.li=new ig,this.referenceDelegate=e(this),this.hi=new ag(this),this.indexManager=new Hm,this.remoteDocumentCache=(function(s){return new rg(s)})((i=>this.referenceDelegate.Pi(i))),this.serializer=new Wm(t),this.Ti=new tg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ng,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ai[e.toKey()];return i||(i=new sg(t,this.referenceDelegate),this.ai[e.toKey()]=i),i}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,i){O("MemoryPersistence","Starting transaction:",e);const s=new lg(this.ui.next());return this.referenceDelegate.Ii(),i(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ei(e,t){return S.or(Object.values(this.ai).map((i=>()=>i.containsKey(e,t))))}}class lg extends B_{constructor(e){super(),this.currentSequenceNumber=e}}class Bo{constructor(e){this.persistence=e,this.Ai=new Uo,this.Ri=null}static Vi(e){return new Bo(e)}get mi(){if(this.Ri)return this.Ri;throw L(60996)}addReference(e,t,i){return this.Ai.addReference(i,t),this.mi.delete(i.toString()),S.resolve()}removeReference(e,t,i){return this.Ai.removeReference(i,t),this.mi.add(i.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),S.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach((s=>this.mi.add(s.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.mi.add(o.toString())))})).next((()=>i.removeTargetData(e,t)))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.mi,(i=>{const s=M.fromPath(i);return this.fi(e,s).next((o=>{o||t.removeEntry(s,ne.min())}))})).next((()=>(this.Ri=null,t.apply(e))))}updateLimboDocument(e,t){return this.fi(e,t).next((i=>{i?this.mi.delete(t.toString()):this.mi.add(t.toString())}))}Pi(e){return 0}fi(e,t){return S.or([()=>S.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class As{constructor(e,t){this.persistence=e,this.gi=new zt((i=>W_(i.path)),((i,s)=>i.isEqual(s))),this.garbageCollector=Xm(this,t)}static Vi(e,t){return new As(e,t)}Ii(){}di(e){return S.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next((i=>t.next((s=>i+s))))}yr(e){let t=0;return this.gr(e,(i=>{t++})).next((()=>t))}gr(e,t){return S.forEach(this.gi,((i,s)=>this.Sr(e,i,s).next((o=>o?S.resolve():t(s)))))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ri(e,(a=>this.Sr(e,a,t).next((c=>{c||(i++,o.removeEntry(a,ne.min()))})))).next((()=>o.apply(e))).next((()=>i))}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),S.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.gi.set(i,e.currentSequenceNumber),S.resolve()}removeReference(e,t,i){return this.gi.set(i,e.currentSequenceNumber),S.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),S.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=cs(e.data.value)),t}Sr(e,t,i){return S.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.gi.get(t);return S.resolve(s!==void 0&&s>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class jo{constructor(e,t,i,s){this.targetId=e,this.fromCache=t,this.Is=i,this.ds=s}static Es(e,t){let i=Se(),s=Se();for(const o of t.docChanges)switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new jo(e,t.fromCache,i,s)}}class cg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ug{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return sp()?8:j_(au())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,i,s){const o={result:null};return this.ps(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ys(e,t,s,i).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new cg;return this.ws(e,t,a).next((c=>{if(o.result=c,this.Rs)return this.Ss(e,t,a,c.size)}))})).next((()=>o.result))}Ss(e,t,i,s){return i.documentReadCount<this.Vs?(nn()<=U.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",zn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),S.resolve()):(nn()<=U.DEBUG&&O("QueryEngine","Query:",zn(t),"scans",i.documentReadCount,"local documents and returns",s,"documents as results."),i.documentReadCount>this.fs*s?(nn()<=U.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",zn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ft(t))):S.resolve())}ps(e,t){if(Gl(t))return S.resolve(null);let i=Ft(t);return this.indexManager.getIndexType(e,i).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Xr(t,null,"F"),i=Ft(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((o=>{const a=Se(...o);return this.gs.getDocuments(e,a).next((c=>this.indexManager.getMinOffset(e,i).next((h=>{const d=this.bs(t,c);return this.Ds(t,d,a,h.readTime)?this.ps(e,Xr(t,null,"F")):this.vs(e,d,t,h)}))))})))))}ys(e,t,i,s){return Gl(t)||s.isEqual(ne.min())?S.resolve(null):this.gs.getDocuments(e,i).next((o=>{const a=this.bs(t,o);return this.Ds(t,a,i,s)?S.resolve(null):(nn()<=U.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),zn(t)),this.vs(e,a,t,M_(s,pi)).next((c=>c)))}))}bs(e,t){let i=new ve(hm(e));return t.forEach(((s,o)=>{Mo(e,o)&&(i=i.add(o))})),i}Ds(e,t,i,s){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ws(e,t,i){return nn()<=U.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",zn(t)),this.gs.getDocumentsMatchingQuery(e,t,wt.min(),i)}vs(e,t,i,s){return this.gs.getDocumentsMatchingQuery(e,i,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const hg="LocalStore";class dg{constructor(e,t,i,s){this.persistence=e,this.Cs=t,this.serializer=s,this.Fs=new Ke(q),this.Ms=new zt((o=>Oo(o)),xo),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(i)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new eg(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Fs)))}}function fg(n,e,t,i){return new dg(n,e,t,i)}async function ah(n,e){const t=X(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next((o=>(s=o,t.Ns(e),t.mutationQueue.getAllMutationBatches(i)))).next((o=>{const a=[],c=[];let h=Se();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){c.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(i,h).next((d=>({Bs:d,removedBatchIds:a,addedBatchIds:c})))}))}))}function pg(n,e){const t=X(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const s=e.batch.keys(),o=t.Os.newChangeBuffer({trackRemovals:!0});return(function(c,h,d,p){const _=d.batch,v=_.keys();let R=S.resolve();return v.forEach((b=>{R=R.next((()=>p.getEntry(h,b))).next((k=>{const V=d.docVersions.get(b);oe(V!==null,48541),k.version.compareTo(V)<0&&(_.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),p.addEntry(k)))}))})),R.next((()=>c.mutationQueue.removeMutationBatch(h,_)))})(t,i,e,o).next((()=>o.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(c){let h=Se();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(h=h.add(c.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(i,s)))}))}function _g(n){const e=X(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.hi.getLastRemoteSnapshotVersion(t)))}function mg(n,e){const t=X(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=Po),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}class tc{constructor(){this.activeTargetIds=gm()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class gg{constructor(){this.Fo=new tc,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,i){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new tc,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class yg{xo(e){}shutdown(){}}const nc="ConnectivityMonitor";class ic{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){O(nc,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){O(nc,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ss=null;function to(){return ss===null?ss=(function(){return 268435456+Math.round(2147483648*Math.random())})():ss++,"0x"+ss.toString(16)}const br="RestConnection",vg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Eg{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${i}/databases/${s}`,this.Ko=this.databaseId.database===ys?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Wo(e,t,i,s,o){const a=to(),c=this.Go(e,t.toUriEncodedString());O(br,`Sending RPC '${e}' ${a}:`,c,i);const h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(h,s,o);const{host:d}=new URL(c),p=Ti(d);return this.jo(e,c,h,i,p).then((_=>(O(br,`Received RPC '${e}' ${a}: `,_),_)),(_=>{throw fn(br,`RPC '${e}' ${a} failed with error: `,_,"url: ",c,"request:",i),_}))}Jo(e,t,i,s,o,a){return this.Wo(e,t,i,s,o)}zo(e,t,i){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+wn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),i&&i.headers.forEach(((s,o)=>e[o]=s))}Go(e,t){const i=vg[e];return`${this.$o}/v1/${t}:${i}`}terminate(){}}class Tg{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const Ae="WebChannelConnection";class Ig extends Eg{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,i,s,o){const a=to();return new Promise(((c,h)=>{const d=new vu;d.setWithCredentials(!0),d.listenOnce(Eu.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case ls.NO_ERROR:const _=d.getResponseJson();O(Ae,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(_)),c(_);break;case ls.TIMEOUT:O(Ae,`RPC '${e}' ${a} timed out`),h(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case ls.HTTP_ERROR:const v=d.getStatus();if(O(Ae,`RPC '${e}' ${a} failed with status:`,v,"response text:",d.getResponseText()),v>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);const b=R?.error;if(b&&b.status&&b.message){const k=(function(K){const F=K.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(F)>=0?F:P.UNKNOWN})(b.status);h(new x(k,b.message))}else h(new x(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new x(P.UNAVAILABLE,"Connection failed."));break;default:L(9055,{c_:e,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{O(Ae,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);O(Ae,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,i,15)}))}P_(e,t,i){const s=to(),o=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=wu(),c=Iu(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.zo(h.initMessageHeaders,t,i),h.encodeInitMessageHeaders=!0;const p=o.join("");O(Ae,`Creating RPC '${e}' stream ${s}: ${p}`,h);const _=a.createWebChannel(p,h);this.T_(_);let v=!1,R=!1;const b=new Tg({Ho:V=>{R?O(Ae,`Not sending because RPC '${e}' stream ${s} is closed:`,V):(v||(O(Ae,`Opening RPC '${e}' stream ${s} transport.`),_.open(),v=!0),O(Ae,`RPC '${e}' stream ${s} sending:`,V),_.send(V))},Yo:()=>_.close()}),k=(V,K,F)=>{V.listen(K,(G=>{try{F(G)}catch(ae){setTimeout((()=>{throw ae}),0)}}))};return k(_,Jn.EventType.OPEN,(()=>{R||(O(Ae,`RPC '${e}' stream ${s} transport opened.`),b.s_())})),k(_,Jn.EventType.CLOSE,(()=>{R||(R=!0,O(Ae,`RPC '${e}' stream ${s} transport closed`),b.__(),this.I_(_))})),k(_,Jn.EventType.ERROR,(V=>{R||(R=!0,fn(Ae,`RPC '${e}' stream ${s} transport errored. Name:`,V.name,"Message:",V.message),b.__(new x(P.UNAVAILABLE,"The operation could not be completed")))})),k(_,Jn.EventType.MESSAGE,(V=>{var K;if(!R){const F=V.data[0];oe(!!F,16349);const G=F,ae=G?.error||((K=G[0])===null||K===void 0?void 0:K.error);if(ae){O(Ae,`RPC '${e}' stream ${s} received error:`,ae);const bt=ae.status;let Ve=(function(y){const E=le[y];if(E!==void 0)return Nm(E)})(bt),I=ae.message;Ve===void 0&&(Ve=P.INTERNAL,I="Unknown error status: "+bt+" with message "+ae.message),R=!0,b.__(new x(Ve,I)),_.close()}else O(Ae,`RPC '${e}' stream ${s} received:`,F),b.a_(F)}})),k(c,Tu.STAT_EVENT,(V=>{V.stat===qr.PROXY?O(Ae,`RPC '${e}' stream ${s} detected buffering proxy`):V.stat===qr.NOPROXY&&O(Ae,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{b.o_()}),0),b}terminate(){this.u_.forEach((e=>e.close())),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter((t=>t===e))}}function Pr(){return typeof document<"u"?document:null}function Us(n){return new Dm(n,!0)}class lh{constructor(e,t,i=1e3,s=1.5,o=6e4){this.Fi=e,this.timerId=t,this.d_=i,this.E_=s,this.A_=o,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),i=Math.max(0,Date.now()-this.m_),s=Math.max(0,t-i);s>0&&O("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,s,(()=>(this.m_=Date.now(),e()))),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const sc="PersistentStream";class wg{constructor(e,t,i,s,o,a,c,h){this.Fi=e,this.w_=i,this.S_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=h,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new lh(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,(()=>this.L_())))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(jt(t.toString()),jt("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,s])=>{this.b_===t&&this.W_(i,s)}),(i=>{e((()=>{const s=new x(P.UNKNOWN,"Fetching auth token failed: "+i.message);return this.G_(s)}))}))}W_(e,t){const i=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo((()=>{i((()=>this.listener.Zo()))})),this.stream.e_((()=>{i((()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,(()=>(this.x_()&&(this.state=3),Promise.resolve()))),this.listener.e_())))})),this.stream.n_((s=>{i((()=>this.G_(s)))})),this.stream.onMessage((s=>{i((()=>++this.C_==1?this.j_(s):this.onNext(s)))}))}O_(){this.state=5,this.F_.g_((async()=>{this.state=0,this.start()}))}G_(e){return O(sc,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget((()=>this.b_===e?t():(O(sc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ag extends wg{constructor(e,t,i,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,s,a),this.serializer=o}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return oe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,oe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){oe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=Um(e.writeResults,e.commitTime),i=an(e.commitTime);return this.listener.ta(i,t)}na(){const e={};e.database=Mm(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>Fm(this.serializer,i)))};this.k_(t)}}class Cg{}class Sg extends Cg{constructor(e,t,i,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=s,this.ra=!1}ia(){if(this.ra)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Wo(e,Zr(t,i),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(P.UNKNOWN,o.toString())}))}Jo(e,t,i,s,o){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.Jo(e,Zr(t,i),s,a,c,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())}))}terminate(){this.ra=!0,this.connection.terminate()}}class Rg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve()))))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(jt(t),this._a=!1):O("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}const Ci="RemoteStore";class bg{constructor(e,t,i,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=o,this.Ea.xo((a=>{i.enqueueAndForget((async()=>{Ri(this)&&(O(Ci,"Restarting streams for network reachability change."),await(async function(h){const d=X(h);d.Ia.add(4),await Si(d),d.Aa.set("Unknown"),d.Ia.delete(4),await Bs(d)})(this))}))})),this.Aa=new Rg(i,s)}}async function Bs(n){if(Ri(n))for(const e of n.da)await e(!0)}async function Si(n){for(const e of n.da)await e(!1)}function Ri(n){return X(n).Ia.size===0}async function ch(n,e,t){if(!wi(e))throw e;n.Ia.add(1),await Si(n),n.Aa.set("Offline"),t||(t=()=>_g(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{O(Ci,"Retrying IndexedDB access"),await t(),n.Ia.delete(1),await Bs(n)}))}function uh(n,e){return e().catch((t=>ch(n,t,e)))}async function js(n){const e=X(n),t=Ct(e);let i=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Po;for(;Pg(e);)try{const s=await mg(e.localStore,i);if(s===null){e.Pa.length===0&&t.B_();break}i=s.batchId,Ng(e,s)}catch(s){await ch(e,s)}hh(e)&&dh(e)}function Pg(n){return Ri(n)&&n.Pa.length<10}function Ng(n,e){n.Pa.push(e);const t=Ct(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function hh(n){return Ri(n)&&!Ct(n).M_()&&n.Pa.length>0}function dh(n){Ct(n).start()}async function Dg(n){Ct(n).na()}async function kg(n){const e=Ct(n);for(const t of n.Pa)e.X_(t.mutations)}async function Vg(n,e,t){const i=n.Pa.shift(),s=Fo.from(i,e,t);await uh(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await js(n)}async function Og(n,e){e&&Ct(n).Z_&&await(async function(i,s){if((function(a){return Pm(a)&&a!==P.ABORTED})(s.code)){const o=i.Pa.shift();Ct(i).N_(),await uh(i,(()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s))),await js(i)}})(n,e),hh(n)&&dh(n)}async function rc(n,e){const t=X(n);t.asyncQueue.verifyOperationInProgress(),O(Ci,"RemoteStore received new credentials");const i=Ri(t);t.Ia.add(3),await Si(t),i&&t.Aa.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),await Bs(t)}async function xg(n,e){const t=X(n);e?(t.Ia.delete(2),await Bs(t)):e||(t.Ia.add(2),await Si(t),t.Aa.set("Unknown"))}function Ct(n){return n.ma||(n.ma=(function(t,i,s){const o=X(t);return o.ia(),new Ag(i,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:Dg.bind(null,n),n_:Og.bind(null,n),ea:kg.bind(null,n),ta:Vg.bind(null,n)}),n.da.push((async e=>{e?(n.ma.N_(),await js(n)):(await n.ma.stop(),n.Pa.length>0&&(O(Ci,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}class $o{constructor(e,t,i,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=o,this.deferred=new Lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,s,o){const a=Date.now()+i,c=new $o(e,t,a,s,o);return c.start(i),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fh(n,e){if(jt("AsyncQueue",`${e}: ${n}`),wi(n))return new x(P.UNAVAILABLE,`${e}: ${n}`);throw n}class Mg{constructor(){this.queries=oc(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,i){const s=X(t),o=s.queries;s.queries=oc(),o.forEach(((a,c)=>{for(const h of c.wa)h.onError(i)}))})(this,new x(P.ABORTED,"Firestore shutting down"))}}function oc(){return new zt((n=>Hu(n)),qu)}function Lg(n){n.Da.forEach((e=>{e.next()}))}var ac,lc;(lc=ac||(ac={})).Fa="default",lc.Cache="cache";const Fg="SyncEngine";class Ug{constructor(e,t,i,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new zt((c=>Hu(c)),qu),this.Tu=new Map,this.Iu=new Set,this.du=new Ke(M.comparator),this.Eu=new Map,this.Au=new Uo,this.Ru={},this.Vu=new Map,this.mu=yn.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function Bg(n,e,t){const i=qg(n);try{const s=await(function(a,c){const h=X(a),d=ie.now(),p=c.reduce(((R,b)=>R.add(b.key)),Se());let _,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let b=Is(),k=Se();return h.Os.getEntries(R,p).next((V=>{b=V,b.forEach(((K,F)=>{F.isValidDocument()||(k=k.add(K))}))})).next((()=>h.localDocuments.getOverlayedDocuments(R,b))).next((V=>{_=V;const K=[];for(const F of c){const G=Cm(F,_.get(F.key).overlayedDocument);G!=null&&K.push(new Kt(F.key,G,Lu(G.value.mapValue),st.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,K,c)})).next((V=>{v=V;const K=V.applyToLocalDocumentSet(_,k);return h.documentOverlayCache.saveOverlays(R,V.batchId,K)}))})).then((()=>({batchId:v.batchId,changes:zu(_)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),(function(a,c,h){let d=a.Ru[a.currentUser.toKey()];d||(d=new Ke(q)),d=d.insert(c,h),a.Ru[a.currentUser.toKey()]=d})(i,s.batchId,t),await $s(i,s.changes),await js(i.remoteStore)}catch(s){const o=fh(s,"Failed to persist write");t.reject(o)}}function cc(n,e,t){const i=X(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const s=[];i.Pu.forEach(((o,a)=>{const c=a.view.va(e);c.snapshot&&s.push(c.snapshot)})),(function(a,c){const h=X(a);h.onlineState=c;let d=!1;h.queries.forEach(((p,_)=>{for(const v of _.wa)v.va(c)&&(d=!0)})),d&&Lg(h)})(i.eventManager,e),s.length&&i.hu.J_(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function jg(n,e){const t=X(n),i=e.batch.batchId;try{const s=await pg(t.localStore,e);_h(t,i,null),ph(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await $s(t,s)}catch(s){await Ro(s)}}async function $g(n,e,t){const i=X(n);try{const s=await(function(a,c){const h=X(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,c).next((_=>(oe(_!==null,37113),p=_.keys(),h.mutationQueue.removeMutationBatch(d,_)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,c))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(i.localStore,e);_h(i,e,t),ph(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await $s(i,s)}catch(s){await Ro(s)}}function ph(n,e){(n.Vu.get(e)||[]).forEach((t=>{t.resolve()})),n.Vu.delete(e)}function _h(n,e,t){const i=X(n);let s=i.Ru[i.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),i.Ru[i.currentUser.toKey()]=s}}async function $s(n,e,t){const i=X(n),s=[],o=[],a=[];i.Pu.isEmpty()||(i.Pu.forEach(((c,h)=>{a.push(i.gu(h,e,t).then((d=>{var p;if((d||t)&&i.isPrimaryClient){const _=d?!d.fromCache:(p=void 0)===null||p===void 0?void 0:p.current;i.sharedClientState.updateQueryState(h.targetId,_?"current":"not-current")}if(d){s.push(d);const _=jo.Es(h.targetId,d);o.push(_)}})))})),await Promise.all(a),i.hu.J_(s),await(async function(h,d){const p=X(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>S.forEach(d,(v=>S.forEach(v.Is,(R=>p.persistence.referenceDelegate.addReference(_,v.targetId,R))).next((()=>S.forEach(v.ds,(R=>p.persistence.referenceDelegate.removeReference(_,v.targetId,R)))))))))}catch(_){if(!wi(_))throw _;O(hg,"Failed to update sequence numbers: "+_)}for(const _ of d){const v=_.targetId;if(!_.fromCache){const R=p.Fs.get(v),b=R.snapshotVersion,k=R.withLastLimboFreeSnapshotVersion(b);p.Fs=p.Fs.insert(v,k)}}})(i.localStore,o))}async function Wg(n,e){const t=X(n);if(!t.currentUser.isEqual(e)){O(Fg,"User change. New user:",e.toKey());const i=await ah(t.localStore,e);t.currentUser=e,(function(o,a){o.Vu.forEach((c=>{c.forEach((h=>{h.reject(new x(P.CANCELLED,a))}))})),o.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await $s(t,i.Bs)}}function qg(n){const e=X(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=jg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$g.bind(null,e),e}class Cs{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Us(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return fg(this.persistence,new ug,e.initialUser,this.serializer)}Du(e){return new oh(Bo.Vi,this.serializer)}bu(e){return new gg}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Cs.provider={build:()=>new Cs};class Hg extends Cs{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){oe(this.persistence.referenceDelegate instanceof As,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new Qm(i,e.asyncQueue,t)}Du(e){const t=this.cacheSizeBytes!==void 0?Oe.withCacheSize(this.cacheSizeBytes):Oe.DEFAULT;return new oh((i=>As.Vi(i,t)),this.serializer)}}class no{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>cc(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Wg.bind(null,this.syncEngine),await xg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Mg})()}createDatastore(e){const t=Us(e.databaseInfo.databaseId),i=(function(o){return new Ig(o)})(e.databaseInfo);return(function(o,a,c,h){return new Sg(o,a,c,h)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,s,o,a,c){return new bg(i,s,o,a,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>cc(this.syncEngine,t,0)),(function(){return ic.C()?new ic:new yg})())}createSyncEngine(e,t){return(function(s,o,a,c,h,d,p){const _=new Ug(s,o,a,c,h,d);return p&&(_.fu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(s){const o=X(s);O(Ci,"RemoteStore shutting down."),o.Ia.add(5),await Si(o),o.Ea.shutdown(),o.Aa.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}no.provider={build:()=>new no};const St="FirestoreClient";class Gg{constructor(e,t,i,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=s,this.user=Ce.UNAUTHENTICATED,this.clientId=Co.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(i,(async a=>{O(St,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(i,(a=>(O(St,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=fh(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function Nr(n,e){n.asyncQueue.verifyOperationInProgress(),O(St,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async s=>{i.isEqual(s)||(await ah(e.localStore,s),i=s)})),e.persistence.setDatabaseDeletedListener((()=>{fn("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then((()=>{O("Terminating Firestore due to IndexedDb database deletion completed successfully")})).catch((s=>{fn("Terminating Firestore due to IndexedDb database deletion failed",s)}))})),n._offlineComponents=e}async function uc(n,e){n.asyncQueue.verifyOperationInProgress();const t=await zg(n);O(St,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>rc(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,s)=>rc(e.remoteStore,s))),n._onlineComponents=e}async function zg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(St,"Using user provided OfflineComponentProvider");try{await Nr(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;fn("Error using user provided cache. Falling back to memory cache: "+t),await Nr(n,new Cs)}}else O(St,"Using default OfflineComponentProvider"),await Nr(n,new Hg(void 0));return n._offlineComponents}async function Kg(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(St,"Using user provided OnlineComponentProvider"),await uc(n,n._uninitializedComponentsProvider._online)):(O(St,"Using default OnlineComponentProvider"),await uc(n,new no))),n._onlineComponents}function Qg(n){return Kg(n).then((e=>e.syncEngine))}function mh(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const hc=new Map;const gh="firestore.googleapis.com",dc=!0;class fc{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=gh,this.ssl=dc}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:dc;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=rh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<zm)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}x_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=mh((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),(function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,s){return i.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ws{constructor(e,t,i,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new C_;switch(i.type){case"firstParty":return new P_(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=hc.get(t);i&&(O("ComponentProvider","Removing Datastore"),hc.delete(t),i.terminate())})(this),Promise.resolve()}}function Yg(n,e,t,i={}){var s;n=bu(n,Ws);const o=Ti(e),a=n._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),h=`${e}:${t}`;o&&(su(`https://${h}`),ou("Firestore",!0)),a.host!==gh&&a.host!==h&&fn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d=Object.assign(Object.assign({},a),{host:h,ssl:o,emulatorOptions:i});if(!ui(d,c)&&(n._setSettings(d),i.mockUserToken)){let p,_;if(typeof i.mockUserToken=="string")p=i.mockUserToken,_=Ce.MOCK_USER;else{p=ru(i.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const v=i.mockUserToken.sub||i.mockUserToken.user_id;if(!v)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new Ce(v)}n._authCredentials=new S_(new Cu(p,_))}}class Wo{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Wo(this.firestore,e,this._query)}}class Pe{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pe(this.firestore,e,this._key)}toJSON(){return{type:Pe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(Ii(t,Pe._jsonSchema))return new Pe(e,i||null,new M(se.fromString(t.referencePath)))}}Pe._jsonSchemaVersion="firestore/documentReference/1.0",Pe._jsonSchema={type:ce("string",Pe._jsonSchemaVersion),referencePath:ce("string")};class Tt extends Wo{constructor(e,t,i){super(e,t,lm(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pe(this.firestore,null,new M(e))}withConverter(e){return new Tt(this.firestore,e,this._path)}}function Xg(n,e,...t){if(n=Ut(n),Su("collection","path",e),n instanceof Ws){const i=se.fromString(e,...t);return xl(i),new Tt(n,null,i)}{if(!(n instanceof Pe||n instanceof Tt))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(se.fromString(e,...t));return xl(i),new Tt(n.firestore,null,i)}}function Jg(n,e,...t){if(n=Ut(n),arguments.length===1&&(e=Co.newId()),Su("doc","path",e),n instanceof Ws){const i=se.fromString(e,...t);return Ol(i),new Pe(n,null,new M(i))}{if(!(n instanceof Pe||n instanceof Tt))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(se.fromString(e,...t));return Ol(i),new Pe(n.firestore,n instanceof Tt?n.converter:null,new M(i))}}const pc="AsyncQueue";class _c{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new lh(this,"async_queue_retry"),this.oc=()=>{const i=Pr();i&&O(pc,"Visibility state changed to "+i.visibilityState),this.F_.y_()},this._c=e;const t=Pr();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=Pr();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise((()=>{}));const t=new Lt;return this.uc((()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Zu.push(e),this.cc())))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!wi(e))throw e;O(pc,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_((()=>this.cc()))}}uc(e){const t=this._c.then((()=>(this.nc=!0,e().catch((i=>{throw this.tc=i,this.nc=!1,jt("INTERNAL UNHANDLED ERROR: ",mc(i)),i})).then((i=>(this.nc=!1,i))))));return this._c=t,t}enqueueAfterDelay(e,t,i){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const s=$o.createAndSchedule(this,e,t,i,(o=>this.lc(o)));return this.ec.push(s),s}ac(){this.tc&&L(47125,{hc:mc(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then((()=>{this.ec.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()}))}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function mc(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class yh extends Ws{constructor(e,t,i,s){super(e,t,i,s),this.type="firestore",this._queue=new _c,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new _c(e),this._firestoreClient=void 0,await e}}}function Zg(n,e){const t=typeof n=="object"?n:Io(),i=typeof n=="string"?n:ys,s=fu(t,"firestore").getImmediate({identifier:i});if(!s._initialized){const o=nu("firestore");o&&Yg(s,...o)}return s}function ey(n){if(n._terminated)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||ty(n),n._firestoreClient}function ty(n){var e,t,i;const s=n._freezeSettings(),o=(function(c,h,d,p){return new z_(c,h,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,mh(p.experimentalLongPollingOptions),p.useFetchStreams,p.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=s.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new Gg(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&(function(c){const h=c?._online.build();return{_offline:c?._offline.build(h),_online:h}})(n._componentsProvider))}class We{constructor(e){this._byteString=e}static fromBase64String(e){try{return new We(Xe.fromBase64String(e))}catch(t){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new We(Xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:We._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ii(e,We._jsonSchema))return We.fromBase64String(e.bytes)}}We._jsonSchemaVersion="firestore/bytes/1.0",We._jsonSchema={type:ce("string",We._jsonSchemaVersion),bytes:ce("string")};class qo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ho{constructor(e){this._methodName=e}}class rt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return q(this._lat,e._lat)||q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:rt._jsonSchemaVersion}}static fromJSON(e){if(Ii(e,rt._jsonSchema))return new rt(e.latitude,e.longitude)}}rt._jsonSchemaVersion="firestore/geoPoint/1.0",rt._jsonSchema={type:ce("string",rt._jsonSchemaVersion),latitude:ce("number"),longitude:ce("number")};class ot{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,s){if(i.length!==s.length)return!1;for(let o=0;o<i.length;++o)if(i[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:ot._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ii(e,ot._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new ot(e.vectorValues);throw new x(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ot._jsonSchemaVersion="firestore/vectorValue/1.0",ot._jsonSchema={type:ce("string",ot._jsonSchemaVersion),vectorValues:ce("object")};const ny=/^__.*__$/;class iy{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Kt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ai(e,this.data,t,this.fieldTransforms)}}function vh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ec:n})}}class Go{constructor(e,t,i,s,o,a){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=s,o===void 0&&this.Ac(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new Go(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Rc({path:i,mc:!1});return s.fc(e),s}gc(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Rc({path:i,mc:!1});return s.Ac(),s}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Ss(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(vh(this.Ec)&&ny.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class sy{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Us(e)}Dc(e,t,i,s=!1){return new Go({Ec:e,methodName:t,bc:i,path:ye.emptyPath(),mc:!1,Sc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ry(n){const e=n._freezeSettings(),t=Us(n._databaseId);return new sy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function oy(n,e,t,i,s,o={}){const a=n.Dc(o.merge||o.mergeFields?2:0,e,t,s);wh("Data must be an object, but it was:",a,i);const c=Th(i,a);let h,d;if(o.merge)h=new He(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const _ of o.mergeFields){const v=ay(e,_,t);if(!a.contains(v))throw new x(P.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);cy(p,v)||p.push(v)}h=new He(p),d=a.fieldTransforms.filter((_=>h.covers(_.field)))}else h=null,d=a.fieldTransforms;return new iy(new $e(c),h,d)}class zo extends Ho{_toFieldTransform(e){return new Tm(e.path,new mi)}isEqual(e){return e instanceof zo}}function Eh(n,e){if(Ih(n=Ut(n)))return wh("Unsupported field value:",e,n),Th(n,e);if(n instanceof Ho)return(function(i,s){if(!vh(s.Ec))throw s.wc(`${i._methodName}() can only be used with update() and set()`);if(!s.path)throw s.wc(`${i._methodName}() is not currently supported inside arrays`);const o=i._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(i,s){const o=[];let a=0;for(const c of i){let h=Eh(c,s.yc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(i,s){if((i=Ut(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return ym(s.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const o=ie.fromDate(i);return{timestampValue:Jr(s.serializer,o)}}if(i instanceof ie){const o=new ie(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Jr(s.serializer,o)}}if(i instanceof rt)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof We)return{bytesValue:km(s.serializer,i._byteString)};if(i instanceof Pe){const o=s.databaseId,a=i.firestore._databaseId;if(!a.isEqual(o))throw s.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:ih(i.firestore._databaseId||s.databaseId,i._key.path)}}if(i instanceof ot)return(function(a,c){return{mapValue:{fields:{[xu]:{stringValue:Mu},[zr]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw c.wc("VectorValues must only contain numeric values.");return Lo(c.serializer,d)}))}}}}}})(i,s);throw s.wc(`Unsupported field value: ${So(i)}`)})(n,e)}function Th(n,e){const t={};return Nu(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):An(n,((i,s)=>{const o=Eh(s,e.Vc(i));o!=null&&(t[i]=o)})),{mapValue:{fields:t}}}function Ih(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ie||n instanceof rt||n instanceof We||n instanceof Pe||n instanceof Ho||n instanceof ot)}function wh(n,e,t){if(!Ih(t)||!Ru(t)){const i=So(t);throw i==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+i)}}function ay(n,e,t){if((e=Ut(e))instanceof qo)return e._internalPath;if(typeof e=="string")return Ah(n,e);throw Ss("Field path arguments must be of type string or ",n,!1,void 0,t)}const ly=new RegExp("[~\\*/\\[\\]]");function Ah(n,e,t){if(e.search(ly)>=0)throw Ss(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qo(...e.split("."))._internalPath}catch{throw Ss(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ss(n,e,t,i,s){const o=i&&!i.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${i}`),a&&(h+=` in document ${s}`),h+=")"),new x(P.INVALID_ARGUMENT,c+n+h)}function cy(n,e){return n.some((t=>t.isEqual(e)))}class Ch{constructor(e,t,i,s,o){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new uy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Sh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class uy extends Ch{data(){return super.data()}}function Sh(n,e){return typeof e=="string"?Ah(n,e):e instanceof qo?e._internalPath:e._delegate._internalPath}function hy(n,e,t){let i;return i=n?n.toFirestore(e):e,i}class rs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ln extends Ch{constructor(e,t,i,s,o,a){super(e,t,i,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ds(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Sh("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=ln._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}ln._jsonSchemaVersion="firestore/documentSnapshot/1.0",ln._jsonSchema={type:ce("string",ln._jsonSchemaVersion),bundleSource:ce("string","DocumentSnapshot"),bundleName:ce("string"),bundle:ce("string")};class ds extends ln{data(e={}){return super.data(e)}}class si{constructor(e,t,i,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new rs(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new ds(this._firestore,this._userDataWriter,i.key,i,new rs(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const h=new ds(s._firestore,s._userDataWriter,c.doc.key,c.doc,new rs(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>o||c.type!==3)).map((c=>{const h=new ds(s._firestore,s._userDataWriter,c.doc.key,c.doc,new rs(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),p=a.indexOf(c.doc.key)),{type:dy(c.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=si._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Co.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),i.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function dy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}si._jsonSchemaVersion="firestore/querySnapshot/1.0",si._jsonSchema={type:ce("string",si._jsonSchemaVersion),bundleSource:ce("string","QuerySnapshot"),bundleName:ce("string"),bundle:ce("string")};function fy(n,e){const t=bu(n.firestore,yh),i=Jg(n),s=hy(n.converter,e);return py(t,[oy(ry(n.firestore),"addDoc",i._key,s,n.converter!==null,{}).toMutation(i._key,st.exists(!1))]).then((()=>i))}function py(n,e){return(function(i,s){const o=new Lt;return i.asyncQueue.enqueueAndForget((async()=>Bg(await Qg(i),s,o))),o.promise})(ey(n),e)}function _y(){return new zo("serverTimestamp")}(function(e,t=!0){(function(s){wn=s})(_u),di(new dn("firestore",((i,{instanceIdentifier:s,options:o})=>{const a=i.getProvider("app").getImmediate(),c=new yh(new R_(i.getProvider("auth-internal")),new N_(a,i.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vs(d.options.projectId,p)})(a,s),a);return o=Object.assign({useFetchStreams:t},o),c._setSettings(o),c}),"PUBLIC").setMultipleInstances(!0)),vt(Pl,Nl,e),vt(Pl,Nl,"esm2017")})();var my="firebase",gy="11.10.0";vt(my,gy,"app");var gc={};const yc="@firebase/database",vc="1.0.20";let Rh="";function yy(n){Rh=n}class vy{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ge(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:ci(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Ey{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ut(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const bh=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new vy(e)}}catch{}return new Ey},Mt=bh("localStorage"),Ty=bh("sessionStorage");const cn=new Eo("@firebase/database"),Iy=(function(){let n=1;return function(){return n++}})(),Ph=function(n){const e=_p(n),t=new fp;t.update(e);const i=t.digest();return go.encodeByteArray(i)},bi=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=bi.apply(null,i):typeof i=="object"?e+=ge(i):e+=i,e+=" "}return e};let ri=null,Ec=!0;const wy=function(n,e){D(!0,"Can't turn on custom loggers persistently."),cn.logLevel=U.VERBOSE,ri=cn.log.bind(cn)},Re=function(...n){if(Ec===!0&&(Ec=!1,ri===null&&Ty.get("logging_enabled")===!0&&wy()),ri){const e=bi.apply(null,n);ri(e)}},Pi=function(n){return function(...e){Re(n,...e)}},io=function(...n){const e="FIREBASE INTERNAL ERROR: "+bi(...n);cn.error(e)},ct=function(...n){const e=`FIREBASE FATAL ERROR: ${bi(...n)}`;throw cn.error(e),new Error(e)},Le=function(...n){const e="FIREBASE WARNING: "+bi(...n);cn.warn(e)},Ay=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Le("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Nh=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Cy=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},vn="[MIN_NAME]",qt="[MAX_NAME]",Cn=function(n,e){if(n===e)return 0;if(n===vn||e===qt)return-1;if(e===vn||n===qt)return 1;{const t=Tc(n),i=Tc(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},Sy=function(n,e){return n===e?0:n<e?-1:1},Kn=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ge(e))},Ko=function(n){if(typeof n!="object"||n===null)return ge(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=ge(e[i]),t+=":",t+=Ko(n[e[i]]);return t+="}",t},Dh=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function Ue(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const kh=function(n){D(!Nh(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,o,a,c,h;n===0?(o=0,a=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(c=Math.min(Math.floor(Math.log(n)/Math.LN2),i),o=c+i,a=Math.round(n*Math.pow(2,t-c)-Math.pow(2,t))):(o=0,a=Math.round(n/Math.pow(2,1-i-t))));const d=[];for(h=t;h;h-=1)d.push(a%2?1:0),a=Math.floor(a/2);for(h=e;h;h-=1)d.push(o%2?1:0),o=Math.floor(o/2);d.push(s?1:0),d.reverse();const p=d.join("");let _="";for(h=0;h<64;h+=8){let v=parseInt(p.substr(h,8),2).toString(16);v.length===1&&(v="0"+v),_=_+v}return _.toLowerCase()},Ry=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},by=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},Py=new RegExp("^-?(0*)\\d{1,10}$"),Ny=-2147483648,Dy=2147483647,Tc=function(n){if(Py.test(n)){const e=Number(n);if(e>=Ny&&e<=Dy)return e}return null},Ni=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Le("Exception was thrown by user callback.",t),e},Math.floor(0))}},ky=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},oi=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class Vy{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,pu(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){Le(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Oy{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Re("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Le(e)}}class fs{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}fs.OWNER="owner";const Qo="5",Vh="v",Oh="s",xh="r",Mh="f",Lh=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Fh="ls",Uh="p",so="ac",Bh="websocket",jh="long_polling";class $h{constructor(e,t,i,s,o=!1,a="",c=!1,h=!1,d=null){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=o,this.persistenceKey=a,this.includeNamespaceInQueryParams=c,this.isUsingEmulator=h,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Mt.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Mt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function xy(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Wh(n,e,t){D(typeof e=="string","typeof type must == string"),D(typeof t=="object","typeof params must == object");let i;if(e===Bh)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===jh)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);xy(n)&&(t.ns=n.namespace);const s=[];return Ue(t,(o,a)=>{s.push(o+"="+a)}),i+s.join("&")}class My{constructor(){this.counters_={}}incrementCounter(e,t=1){ut(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Gf(this.counters_)}}const Dr={},kr={};function Yo(n){const e=n.toString();return Dr[e]||(Dr[e]=new My),Dr[e]}function Ly(n,e){const t=n.toString();return kr[t]||(kr[t]=e()),kr[t]}class Fy{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Ni(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Ic="start",Uy="close",By="pLPCommand",jy="pRTLPCB",qh="id",Hh="pw",Gh="ser",$y="cb",Wy="seg",qy="ts",Hy="d",Gy="dframe",zh=1870,Kh=30,zy=zh-Kh,Ky=25e3,Qy=3e4;class rn{constructor(e,t,i,s,o,a,c){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.transportSessionId=a,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Pi(e),this.stats_=Yo(t),this.urlFn=h=>(this.appCheckToken&&(h[so]=this.appCheckToken),Wh(t,jh,h))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Fy(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Qy)),Cy(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Xo((...o)=>{const[a,c,h,d,p]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===Ic)this.id=c,this.password=h;else if(a===Uy)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...o)=>{const[a,c]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(a,c)},()=>{this.onClosed_()},this.urlFn);const i={};i[Ic]="t",i[Gh]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[$y]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Vh]=Qo,this.transportSessionId&&(i[Oh]=this.transportSessionId),this.lastSessionId&&(i[Fh]=this.lastSessionId),this.applicationId&&(i[Uh]=this.applicationId),this.appCheckToken&&(i[so]=this.appCheckToken),typeof location<"u"&&location.hostname&&Lh.test(location.hostname)&&(i[xh]=Mh);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){rn.forceAllow_=!0}static forceDisallow(){rn.forceDisallow_=!0}static isAvailable(){return rn.forceAllow_?!0:!rn.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Ry()&&!by()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=ge(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=eu(t),s=Dh(i,zy);for(let o=0;o<s.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[o]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[Gy]="t",i[qh]=e,i[Hh]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=ge(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Xo{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Iy(),window[By+this.uniqueCallbackIdentifier]=e,window[jy+this.uniqueCallbackIdentifier]=t,this.myIFrame=Xo.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(c){Re("frame writing exception"),c.stack&&Re(c.stack),Re(c)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Re("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[qh]=this.myID,e[Hh]=this.myPW,e[Gh]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Kh+i.length<=zh;){const a=this.pendingSegs.shift();i=i+"&"+Wy+s+"="+a.seg+"&"+qy+s+"="+a.ts+"&"+Hy+s+"="+a.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(Ky)),o=()=>{clearTimeout(s),i()};this.addTag(e,o)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Re("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}const Yy=16384,Xy=45e3;let Rs=null;typeof MozWebSocket<"u"?Rs=MozWebSocket:typeof WebSocket<"u"&&(Rs=WebSocket);class qe{constructor(e,t,i,s,o,a,c){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Pi(this.connId),this.stats_=Yo(t),this.connURL=qe.connectionURL_(t,a,c,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s,o){const a={};return a[Vh]=Qo,typeof location<"u"&&location.hostname&&Lh.test(location.hostname)&&(a[xh]=Mh),t&&(a[Oh]=t),i&&(a[Fh]=i),s&&(a[so]=s),o&&(a[Uh]=o),Wh(e,Bh,a)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Mt.set("previous_websocket_failure",!0);try{let i;ip(),this.mySock=new Rs(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){qe.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&Rs!==null&&!qe.forceDisallow_}static previouslyFailed(){return Mt.isInMemoryStorage||Mt.get("previous_websocket_failure")===!0}markConnectionHealthy(){Mt.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=ci(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(D(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=ge(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Dh(t,Yy);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Xy))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}qe.responsesRequiredToBeHealthy=2;qe.healthyTimeout=3e4;class vi{static get ALL_TRANSPORTS(){return[rn,qe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=qe&&qe.isAvailable();let i=t&&!qe.previouslyFailed();if(e.webSocketOnly&&(t||Le("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[qe];else{const s=this.transports_=[];for(const o of vi.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);vi.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}vi.globalTransportInitialized_=!1;const Jy=6e4,Zy=5e3,ev=10*1024,tv=100*1024,Vr="t",wc="d",nv="s",Ac="r",iv="e",Cc="o",Sc="a",Rc="n",bc="p",sv="h";class rv{constructor(e,t,i,s,o,a,c,h,d,p){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=o,this.onMessage_=a,this.onReady_=c,this.onDisconnect_=h,this.onKill_=d,this.lastSessionId=p,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Pi("c:"+this.id+":"),this.transportManager_=new vi(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=oi(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>tv?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>ev?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Vr in e){const t=e[Vr];t===Sc?this.upgradeIfSecondaryHealthy_():t===Ac?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Cc&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Kn("t",e),i=Kn("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:bc,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Sc,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Rc,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Kn("t",e),i=Kn("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Kn(Vr,e);if(wc in e){const i=e[wc];if(t===sv){const s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===Rc){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===nv?this.onConnectionShutdown_(i):t===Ac?this.onReset_(i):t===iv?io("Server Error: "+i):t===Cc?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):io("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Qo!==i&&Le("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),oi(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Jy))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):oi(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Zy))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:bc,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Mt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Qh{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class Yh{constructor(e){this.allowedEvents_=e,this.listeners_={},D(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let o=0;o<s.length;o++)if(s[o].callback===t&&(!i||i===s[o].context)){s.splice(o,1);return}}validateEventType_(e){D(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class bs extends Yh{static getInstance(){return new bs}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!lu()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return D(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Pc=32,Nc=768;class te{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Q(){return new te("")}function $(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Rt(n){return n.pieces_.length-n.pieceNum_}function ee(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new te(n.pieces_,e)}function Xh(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function ov(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Jh(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Zh(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new te(e,0)}function pe(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof te)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new te(t,0)}function B(n){return n.pieceNum_>=n.pieces_.length}function Fe(n,e){const t=$(n),i=$(e);if(t===null)return e;if(t===i)return Fe(ee(n),ee(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function ed(n,e){if(Rt(n)!==Rt(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Ge(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Rt(n)>Rt(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class av{constructor(e,t){this.errorPrefix_=t,this.parts_=Jh(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=xs(this.parts_[i]);td(this)}}function lv(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=xs(e),td(n)}function cv(n){const e=n.parts_.pop();n.byteLength_-=xs(e),n.parts_.length>0&&(n.byteLength_-=1)}function td(n){if(n.byteLength_>Nc)throw new Error(n.errorPrefix_+"has a key path longer than "+Nc+" bytes ("+n.byteLength_+").");if(n.parts_.length>Pc)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Pc+") or object contains a cycle "+Ot(n))}function Ot(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class Jo extends Yh{static getInstance(){return new Jo}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return D(e==="visible","Unknown event type: "+e),[this.visible_]}}const Qn=1e3,uv=300*1e3,Dc=30*1e3,hv=1.3,dv=3e4,fv="server_kill",kc=3;class at extends Qh{constructor(e,t,i,s,o,a,c,h){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=h,this.id=at.nextPersistentConnectionId_++,this.log_=Pi("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Qn,this.maxReconnectDelay_=uv,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Jo.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&bs.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,o={r:s,a:e,b:t};this.log_(ge(o)),D(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new vo,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const c=a.d;a.s==="ok"?t.resolve(c):t.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),t.promise}listen(e,t,i,s){this.initConnection_();const o=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),D(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),D(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const c={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const o={p:i},a="q";e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest(a,o,c=>{const h=c.d,d=c.s;at.warnOnListenWarnings_(h,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(d,h))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&ut(e,"w")){const i=hn(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();Le(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||hp(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Dc)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=up(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const o=s.s,a=s.d||"error";this.authToken_===e&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),D(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const o={p:e},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const o={p:t,d:i};this.log_("onDisconnect "+e,o),this.sendRequest(e,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,o){this.initConnection_();const a={p:t,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:e,request:a,onComplete:s}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,o=>{this.log_(t+" response",o),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ge(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):io("Unrecognized action received from server: "+ge(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){D(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Qn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Qn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>dv&&(this.reconnectDelay_=Qn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*hv)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+at.nextConnectionId_++,o=this.lastSessionId;let a=!1,c=null;const h=function(){c?c.close():(a=!0,i())},d=function(_){D(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(_)};this.realtime_={close:h,sendRequest:d};const p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[_,v]=await Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?Re("getToken() completed but was canceled"):(Re("getToken() completed. Creating connection."),this.authToken_=_&&_.accessToken,this.appCheckToken_=v&&v.token,c=new rv(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,R=>{Le(R+" ("+this.repoInfo_.toString()+")"),this.interrupt(fv)},o))}catch(_){this.log_("Failed to get token: "+_),a||(this.repoInfo_.nodeAdmin&&Le(_),h())}}}interrupt(e){Re("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Re("Resuming connection for reason: "+e),delete this.interruptReasons_[e],yl(this.interruptReasons_)&&(this.reconnectDelay_=Qn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(o=>Ko(o)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new te(e).toString();let s;if(this.listens.has(i)){const o=this.listens.get(i);s=o.get(t),o.delete(t),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){Re("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=kc&&(this.reconnectDelay_=Dc,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Re("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=kc&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Rh.replace(/\./g,"-")]=1,lu()?e["framework.cordova"]=1:np()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=bs.getInstance().currentlyOnline();return yl(this.interruptReasons_)&&e}}at.nextPersistentConnectionId_=0;at.nextConnectionId_=0;class W{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new W(e,t)}}class qs{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new W(vn,e),s=new W(vn,t);return this.compare(i,s)!==0}minPost(){return W.MIN}}let os;class nd extends qs{static get __EMPTY_NODE(){return os}static set __EMPTY_NODE(e){os=e}compare(e,t){return Cn(e.name,t.name)}isDefinedOn(e){throw Tn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return W.MIN}maxPost(){return new W(qt,os)}makePost(e,t){return D(typeof e=="string","KeyIndex indexValue must always be a string."),new W(e,os)}toString(){return".key"}}const un=new nd;class as{constructor(e,t,i,s,o=null){this.isReverse_=s,this.resultGenerator_=o,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=t?i(e.key,t):1,s&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class de{constructor(e,t,i,s,o){this.key=e,this.value=t,this.color=i??de.RED,this.left=s??xe.EMPTY_NODE,this.right=o??xe.EMPTY_NODE}copy(e,t,i,s,o){return new de(e??this.key,t??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const o=i(e,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):o===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return xe.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return xe.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,de.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,de.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}de.RED=!0;de.BLACK=!1;class pv{copy(e,t,i,s,o){return this}insert(e,t,i){return new de(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class xe{constructor(e,t=xe.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new xe(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,de.BLACK,null,null))}remove(e){return new xe(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,de.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new as(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new as(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new as(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new as(this.root_,null,this.comparator_,!0,e)}}xe.EMPTY_NODE=new pv;function _v(n,e){return Cn(n.name,e.name)}function Zo(n,e){return Cn(n,e)}let ro;function mv(n){ro=n}const id=function(n){return typeof n=="number"?"number:"+kh(n):"string:"+n},sd=function(n){if(n.isLeafNode()){const e=n.val();D(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ut(e,".sv"),"Priority must be a string or number.")}else D(n===ro||n.isEmpty(),"priority of unexpected type.");D(n===ro||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Vc;class ue{static set __childrenNodeConstructor(e){Vc=e}static get __childrenNodeConstructor(){return Vc}constructor(e,t=ue.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,D(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),sd(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ue(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ue.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return B(e)?this:$(e)===".priority"?this.priorityNode_:ue.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:ue.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=$(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(D(i!==".priority"||Rt(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,ue.__childrenNodeConstructor.EMPTY_NODE.updateChild(ee(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+id(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=kh(this.value_):e+=this.value_,this.lazyHash_=Ph(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ue.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ue.__childrenNodeConstructor?-1:(D(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=ue.VALUE_TYPE_ORDER.indexOf(t),o=ue.VALUE_TYPE_ORDER.indexOf(i);return D(s>=0,"Unknown leaf type: "+t),D(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}ue.VALUE_TYPE_ORDER=["object","boolean","number","string"];let rd,od;function gv(n){rd=n}function yv(n){od=n}class vv extends qs{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),o=i.compareTo(s);return o===0?Cn(e.name,t.name):o}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return W.MIN}maxPost(){return new W(qt,new ue("[PRIORITY-POST]",od))}makePost(e,t){const i=rd(e);return new W(t,new ue("[PRIORITY-POST]",i))}toString(){return".priority"}}const Ne=new vv;const Ev=Math.log(2);class Tv{constructor(e){const t=o=>parseInt(Math.log(o)/Ev,10),i=o=>parseInt(Array(o+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ps=function(n,e,t,i){n.sort(e);const s=function(h,d){const p=d-h;let _,v;if(p===0)return null;if(p===1)return _=n[h],v=t?t(_):_,new de(v,_.node,de.BLACK,null,null);{const R=parseInt(p/2,10)+h,b=s(h,R),k=s(R+1,d);return _=n[R],v=t?t(_):_,new de(v,_.node,de.BLACK,b,k)}},o=function(h){let d=null,p=null,_=n.length;const v=function(b,k){const V=_-b,K=_;_-=b;const F=s(V+1,K),G=n[V],ae=t?t(G):G;R(new de(ae,G.node,k,null,F))},R=function(b){d?(d.left=b,d=b):(p=b,d=b)};for(let b=0;b<h.count;++b){const k=h.nextBitIsOne(),V=Math.pow(2,h.count-(b+1));k?v(V,de.BLACK):(v(V,de.BLACK),v(V,de.RED))}return p},a=new Tv(n.length),c=o(a);return new xe(i||e,c)};let Or;const tn={};class it{static get Default(){return D(tn&&Ne,"ChildrenNode.ts has not been loaded"),Or=Or||new it({".priority":tn},{".priority":Ne}),Or}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=hn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof xe?t:null}hasIndex(e){return ut(this.indexSet_,e.toString())}addIndex(e,t){D(e!==un,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const o=t.getIterator(W.Wrap);let a=o.getNext();for(;a;)s=s||e.isDefinedOn(a.node),i.push(a),a=o.getNext();let c;s?c=Ps(i,e.getCompare()):c=tn;const h=e.toString(),d=Object.assign({},this.indexSet_);d[h]=e;const p=Object.assign({},this.indexes_);return p[h]=c,new it(p,d)}addToIndexes(e,t){const i=_s(this.indexes_,(s,o)=>{const a=hn(this.indexSet_,o);if(D(a,"Missing index implementation for "+o),s===tn)if(a.isDefinedOn(e.node)){const c=[],h=t.getIterator(W.Wrap);let d=h.getNext();for(;d;)d.name!==e.name&&c.push(d),d=h.getNext();return c.push(e),Ps(c,a.getCompare())}else return tn;else{const c=t.get(e.name);let h=s;return c&&(h=h.remove(new W(e.name,c))),h.insert(e,e.node)}});return new it(i,this.indexSet_)}removeFromIndexes(e,t){const i=_s(this.indexes_,s=>{if(s===tn)return s;{const o=t.get(e.name);return o?s.remove(new W(e.name,o)):s}});return new it(i,this.indexSet_)}}let Yn;class z{static get EMPTY_NODE(){return Yn||(Yn=new z(new xe(Zo),null,it.Default))}constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&sd(this.priorityNode_),this.children_.isEmpty()&&D(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Yn}updatePriority(e){return this.children_.isEmpty()?this:new z(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Yn:t}}getChild(e){const t=$(e);return t===null?this:this.getImmediateChild(t).getChild(ee(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(D(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new W(e,t);let s,o;t.isEmpty()?(s=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(i,this.children_));const a=s.isEmpty()?Yn:this.priorityNode_;return new z(s,a,o)}}updateChild(e,t){const i=$(e);if(i===null)return t;{D($(e)!==".priority"||Rt(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(ee(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,o=!0;if(this.forEachChild(Ne,(a,c)=>{t[a]=c.val(e),i++,o&&z.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!e&&o&&s<2*i){const a=[];for(const c in t)a[c]=t[c];return a}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+id(this.getPriority().val())+":"),this.forEachChild(Ne,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":Ph(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const o=s.getPredecessorKey(new W(e,t));return o?o.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new W(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new W(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,W.Wrap);let o=s.peek();for(;o!=null&&t.compare(o,e)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,W.Wrap);let o=s.peek();for(;o!=null&&t.compare(o,e)>0;)s.getNext(),o=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Di?-1:0}withIndex(e){if(e===un||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new z(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===un||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(Ne),s=t.getIterator(Ne);let o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===un?null:this.indexMap_.get(e.toString())}}z.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Iv extends z{constructor(){super(new xe(Zo),z.EMPTY_NODE,it.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return z.EMPTY_NODE}isEmpty(){return!1}}const Di=new Iv;Object.defineProperties(W,{MIN:{value:new W(vn,z.EMPTY_NODE)},MAX:{value:new W(qt,Di)}});nd.__EMPTY_NODE=z.EMPTY_NODE;ue.__childrenNodeConstructor=z;mv(Di);yv(Di);const wv=!0;function be(n,e=null){if(n===null)return z.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),D(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new ue(t,be(e))}if(!(n instanceof Array)&&wv){const t=[];let i=!1;if(Ue(n,(a,c)=>{if(a.substring(0,1)!=="."){const h=be(c);h.isEmpty()||(i=i||!h.getPriority().isEmpty(),t.push(new W(a,h)))}}),t.length===0)return z.EMPTY_NODE;const o=Ps(t,_v,a=>a.name,Zo);if(i){const a=Ps(t,Ne.getCompare());return new z(o,be(e),new it({".priority":a},{".priority":Ne}))}else return new z(o,be(e),it.Default)}else{let t=z.EMPTY_NODE;return Ue(n,(i,s)=>{if(ut(n,i)&&i.substring(0,1)!=="."){const o=be(s);(o.isLeafNode()||!o.isEmpty())&&(t=t.updateImmediateChild(i,o))}}),t.updatePriority(be(e))}}gv(be);class Av extends qs{constructor(e){super(),this.indexPath_=e,D(!B(e)&&$(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),o=i.compareTo(s);return o===0?Cn(e.name,t.name):o}makePost(e,t){const i=be(e),s=z.EMPTY_NODE.updateChild(this.indexPath_,i);return new W(t,s)}maxPost(){const e=z.EMPTY_NODE.updateChild(this.indexPath_,Di);return new W(qt,e)}toString(){return Jh(this.indexPath_,0).join("/")}}class Cv extends qs{compare(e,t){const i=e.node.compareTo(t.node);return i===0?Cn(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return W.MIN}maxPost(){return W.MAX}makePost(e,t){const i=be(e);return new W(t,i)}toString(){return".value"}}const Sv=new Cv;function Rv(n){return{type:"value",snapshotNode:n}}function bv(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Pv(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Oc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Nv(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class ea{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ne}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return D(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return D(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:vn}hasEnd(){return this.endSet_}getIndexEndValue(){return D(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return D(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:qt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return D(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ne}copy(){const e=new ea;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function xc(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Ne?t="$priority":n.index_===Sv?t="$value":n.index_===un?t="$key":(D(n.index_ instanceof Av,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ge(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=ge(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+ge(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=ge(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+ge(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Mc(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Ne&&(e.i=n.index_.toString()),e}class Ns extends Qh{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(D(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Pi("p:rest:"),this.listens_={}}listen(e,t,i,s){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const a=Ns.getListenId_(e,i),c={};this.listens_[a]=c;const h=xc(e._queryParams);this.restRequest_(o+".json",h,(d,p)=>{let _=p;if(d===404&&(_=null,d=null),d===null&&this.onDataUpdate_(o,_,!1,i),hn(this.listens_,a)===c){let v;d?d===401?v="permission_denied":v="rest_error:"+d:v="ok",s(v,null)}})}unlisten(e,t){const i=Ns.getListenId_(e,t);delete this.listens_[i]}get(e){const t=xc(e._queryParams),i=e._path.toString(),s=new vo;return this.restRequest_(i+".json",t,(o,a)=>{let c=a;o===404&&(c=null,o=null),o===null?(this.onDataUpdate_(i,c,!1,null),s.resolve(c)):s.reject(new Error(c))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,o])=>{s&&s.accessToken&&(t.auth=s.accessToken),o&&o.token&&(t.ac=o.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+dp(t);this.log_("Sending REST request for "+a);const c=new XMLHttpRequest;c.onreadystatechange=()=>{if(i&&c.readyState===4){this.log_("REST Response for "+a+" received. status:",c.status,"response:",c.responseText);let h=null;if(c.status>=200&&c.status<300){try{h=ci(c.responseText)}catch{Le("Failed to parse JSON response for "+a+": "+c.responseText)}i(null,h)}else c.status!==401&&c.status!==404&&Le("Got unsuccessful REST response for "+a+" Status: "+c.status),i(c.status);i=null}},c.open("GET",a,!0),c.send()})}}class Dv{constructor(){this.rootNode_=z.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Ds(){return{value:null,children:new Map}}function ad(n,e,t){if(B(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=$(e);n.children.has(i)||n.children.set(i,Ds());const s=n.children.get(i);e=ee(e),ad(s,e,t)}}function oo(n,e,t){n.value!==null?t(e,n.value):kv(n,(i,s)=>{const o=new te(e.toString()+"/"+i);oo(s,o,t)})}function kv(n,e){n.children.forEach((t,i)=>{e(i,t)})}class Vv{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ue(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}const Lc=10*1e3,Ov=30*1e3,xv=300*1e3;class Mv{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Vv(e);const i=Lc+(Ov-Lc)*Math.random();oi(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;Ue(e,(s,o)=>{o>0&&ut(this.statsToReport_,s)&&(t[s]=o,i=!0)}),i&&this.server_.reportStats(t),oi(this.reportStats_.bind(this),Math.floor(Math.random()*2*xv))}}var Ye;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ye||(Ye={}));function ld(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function cd(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ud(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class ks{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Ye.ACK_USER_WRITE,this.source=ld()}operationForChild(e){if(B(this.path)){if(this.affectedTree.value!=null)return D(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new te(e));return new ks(Q(),t,this.revert)}}else return D($(this.path)===e,"operationForChild called for unrelated child."),new ks(ee(this.path),this.affectedTree,this.revert)}}class Ht{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Ye.OVERWRITE}operationForChild(e){return B(this.path)?new Ht(this.source,Q(),this.snap.getImmediateChild(e)):new Ht(this.source,ee(this.path),this.snap)}}class Ei{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Ye.MERGE}operationForChild(e){if(B(this.path)){const t=this.children.subtree(new te(e));return t.isEmpty()?null:t.value?new Ht(this.source,Q(),t.value):new Ei(this.source,Q(),t)}else return D($(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ei(this.source,ee(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ta{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(B(e))return this.isFullyInitialized()&&!this.filtered_;const t=$(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Lv(n,e,t,i){const s=[],o=[];return e.forEach(a=>{a.type==="child_changed"&&n.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&o.push(Nv(a.childName,a.snapshotNode))}),Xn(n,s,"child_removed",e,i,t),Xn(n,s,"child_added",e,i,t),Xn(n,s,"child_moved",o,i,t),Xn(n,s,"child_changed",e,i,t),Xn(n,s,"value",e,i,t),s}function Xn(n,e,t,i,s,o){const a=i.filter(c=>c.type===t);a.sort((c,h)=>Uv(n,c,h)),a.forEach(c=>{const h=Fv(n,c,o);s.forEach(d=>{d.respondsTo(c.type)&&e.push(d.createEvent(h,n.query_))})})}function Fv(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Uv(n,e,t){if(e.childName==null||t.childName==null)throw Tn("Should only compare child_ events.");const i=new W(e.childName,e.snapshotNode),s=new W(t.childName,t.snapshotNode);return n.index_.compare(i,s)}function hd(n,e){return{eventCache:n,serverCache:e}}function ai(n,e,t,i){return hd(new ta(e,t,i),n.serverCache)}function dd(n,e,t,i){return hd(n.eventCache,new ta(e,t,i))}function ao(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Gt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let xr;const Bv=()=>(xr||(xr=new xe(Sy)),xr);class Z{static fromObject(e){let t=new Z(null);return Ue(e,(i,s)=>{t=t.set(new te(i),s)}),t}constructor(e,t=Bv()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Q(),value:this.value};if(B(e))return null;{const i=$(e),s=this.children.get(i);if(s!==null){const o=s.findRootMostMatchingPathAndValue(ee(e),t);return o!=null?{path:pe(new te(i),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(B(e))return this;{const t=$(e),i=this.children.get(t);return i!==null?i.subtree(ee(e)):new Z(null)}}set(e,t){if(B(e))return new Z(t,this.children);{const i=$(e),o=(this.children.get(i)||new Z(null)).set(ee(e),t),a=this.children.insert(i,o);return new Z(this.value,a)}}remove(e){if(B(e))return this.children.isEmpty()?new Z(null):new Z(null,this.children);{const t=$(e),i=this.children.get(t);if(i){const s=i.remove(ee(e));let o;return s.isEmpty()?o=this.children.remove(t):o=this.children.insert(t,s),this.value===null&&o.isEmpty()?new Z(null):new Z(this.value,o)}else return this}}get(e){if(B(e))return this.value;{const t=$(e),i=this.children.get(t);return i?i.get(ee(e)):null}}setTree(e,t){if(B(e))return t;{const i=$(e),o=(this.children.get(i)||new Z(null)).setTree(ee(e),t);let a;return o.isEmpty()?a=this.children.remove(i):a=this.children.insert(i,o),new Z(this.value,a)}}fold(e){return this.fold_(Q(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,o)=>{i[s]=o.fold_(pe(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Q(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(B(e))return null;{const o=$(e),a=this.children.get(o);return a?a.findOnPath_(ee(e),pe(t,o),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Q(),t)}foreachOnPath_(e,t,i){if(B(e))return this;{this.value&&i(t,this.value);const s=$(e),o=this.children.get(s);return o?o.foreachOnPath_(ee(e),pe(t,s),i):new Z(null)}}foreach(e){this.foreach_(Q(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(pe(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class ze{constructor(e){this.writeTree_=e}static empty(){return new ze(new Z(null))}}function li(n,e,t){if(B(e))return new ze(new Z(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let o=i.value;const a=Fe(s,e);return o=o.updateChild(a,t),new ze(n.writeTree_.set(s,o))}else{const s=new Z(t),o=n.writeTree_.setTree(e,s);return new ze(o)}}}function Fc(n,e,t){let i=n;return Ue(t,(s,o)=>{i=li(i,pe(e,s),o)}),i}function Uc(n,e){if(B(e))return ze.empty();{const t=n.writeTree_.setTree(e,new Z(null));return new ze(t)}}function lo(n,e){return Qt(n,e)!=null}function Qt(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Fe(t.path,e)):null}function Bc(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ne,(i,s)=>{e.push(new W(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new W(i,s.value))}),e}function It(n,e){if(B(e))return n;{const t=Qt(n,e);return t!=null?new ze(new Z(t)):new ze(n.writeTree_.subtree(e))}}function co(n){return n.writeTree_.isEmpty()}function En(n,e){return fd(Q(),n.writeTree_,e)}function fd(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,o)=>{s===".priority"?(D(o.value!==null,"Priority writes must always be leaf nodes"),i=o.value):t=fd(pe(n,s),o,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(pe(n,".priority"),i)),t}}function pd(n,e){return vd(e,n)}function jv(n,e,t,i,s){D(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=li(n.visibleWrites,e,t)),n.lastWriteId=i}function $v(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function Wv(n,e){const t=n.allWrites.findIndex(c=>c.writeId===e);D(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,o=!1,a=n.allWrites.length-1;for(;s&&a>=0;){const c=n.allWrites[a];c.visible&&(a>=t&&qv(c,i.path)?s=!1:Ge(i.path,c.path)&&(o=!0)),a--}if(s){if(o)return Hv(n),!0;if(i.snap)n.visibleWrites=Uc(n.visibleWrites,i.path);else{const c=i.children;Ue(c,h=>{n.visibleWrites=Uc(n.visibleWrites,pe(i.path,h))})}return!0}else return!1}function qv(n,e){if(n.snap)return Ge(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ge(pe(n.path,t),e))return!0;return!1}function Hv(n){n.visibleWrites=_d(n.allWrites,Gv,Q()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Gv(n){return n.visible}function _d(n,e,t){let i=ze.empty();for(let s=0;s<n.length;++s){const o=n[s];if(e(o)){const a=o.path;let c;if(o.snap)Ge(t,a)?(c=Fe(t,a),i=li(i,c,o.snap)):Ge(a,t)&&(c=Fe(a,t),i=li(i,Q(),o.snap.getChild(c)));else if(o.children){if(Ge(t,a))c=Fe(t,a),i=Fc(i,c,o.children);else if(Ge(a,t))if(c=Fe(a,t),B(c))i=Fc(i,Q(),o.children);else{const h=hn(o.children,$(c));if(h){const d=h.getChild(ee(c));i=li(i,Q(),d)}}}else throw Tn("WriteRecord should have .snap or .children")}}return i}function md(n,e,t,i,s){if(!i&&!s){const o=Qt(n.visibleWrites,e);if(o!=null)return o;{const a=It(n.visibleWrites,e);if(co(a))return t;if(t==null&&!lo(a,Q()))return null;{const c=t||z.EMPTY_NODE;return En(a,c)}}}else{const o=It(n.visibleWrites,e);if(!s&&co(o))return t;if(!s&&t==null&&!lo(o,Q()))return null;{const a=function(d){return(d.visible||s)&&(!i||!~i.indexOf(d.writeId))&&(Ge(d.path,e)||Ge(e,d.path))},c=_d(n.allWrites,a,e),h=t||z.EMPTY_NODE;return En(c,h)}}}function zv(n,e,t){let i=z.EMPTY_NODE;const s=Qt(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Ne,(o,a)=>{i=i.updateImmediateChild(o,a)}),i;if(t){const o=It(n.visibleWrites,e);return t.forEachChild(Ne,(a,c)=>{const h=En(It(o,new te(a)),c);i=i.updateImmediateChild(a,h)}),Bc(o).forEach(a=>{i=i.updateImmediateChild(a.name,a.node)}),i}else{const o=It(n.visibleWrites,e);return Bc(o).forEach(a=>{i=i.updateImmediateChild(a.name,a.node)}),i}}function Kv(n,e,t,i,s){D(i||s,"Either existingEventSnap or existingServerSnap must exist");const o=pe(e,t);if(lo(n.visibleWrites,o))return null;{const a=It(n.visibleWrites,o);return co(a)?s.getChild(t):En(a,s.getChild(t))}}function Qv(n,e,t,i){const s=pe(e,t),o=Qt(n.visibleWrites,s);if(o!=null)return o;if(i.isCompleteForChild(t)){const a=It(n.visibleWrites,s);return En(a,i.getNode().getImmediateChild(t))}else return null}function Yv(n,e){return Qt(n.visibleWrites,e)}function Xv(n,e,t,i,s,o,a){let c;const h=It(n.visibleWrites,e),d=Qt(h,Q());if(d!=null)c=d;else if(t!=null)c=En(h,t);else return[];if(c=c.withIndex(a),!c.isEmpty()&&!c.isLeafNode()){const p=[],_=a.getCompare(),v=o?c.getReverseIteratorFrom(i,a):c.getIteratorFrom(i,a);let R=v.getNext();for(;R&&p.length<s;)_(R,i)!==0&&p.push(R),R=v.getNext();return p}else return[]}function Jv(){return{visibleWrites:ze.empty(),allWrites:[],lastWriteId:-1}}function uo(n,e,t,i){return md(n.writeTree,n.treePath,e,t,i)}function gd(n,e){return zv(n.writeTree,n.treePath,e)}function jc(n,e,t,i){return Kv(n.writeTree,n.treePath,e,t,i)}function Vs(n,e){return Yv(n.writeTree,pe(n.treePath,e))}function Zv(n,e,t,i,s,o){return Xv(n.writeTree,n.treePath,e,t,i,s,o)}function na(n,e,t){return Qv(n.writeTree,n.treePath,e,t)}function yd(n,e){return vd(pe(n.treePath,e),n.writeTree)}function vd(n,e){return{treePath:n,writeTree:e}}class eE{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;D(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),D(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const o=s.type;if(t==="child_added"&&o==="child_removed")this.changeMap.set(i,Oc(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&o==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&o==="child_changed")this.changeMap.set(i,Pv(i,s.oldSnap));else if(t==="child_changed"&&o==="child_added")this.changeMap.set(i,bv(i,e.snapshotNode));else if(t==="child_changed"&&o==="child_changed")this.changeMap.set(i,Oc(i,e.snapshotNode,s.oldSnap));else throw Tn("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}class tE{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const Ed=new tE;class ia{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new ta(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return na(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Gt(this.viewCache_),o=Zv(this.writes_,s,t,1,i,e);return o.length===0?null:o[0]}}function nE(n,e){D(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),D(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function iE(n,e,t,i,s){const o=new eE;let a,c;if(t.type===Ye.OVERWRITE){const d=t;d.source.fromUser?a=ho(n,e,d.path,d.snap,i,s,o):(D(d.source.fromServer,"Unknown source."),c=d.source.tagged||e.serverCache.isFiltered()&&!B(d.path),a=Os(n,e,d.path,d.snap,i,s,c,o))}else if(t.type===Ye.MERGE){const d=t;d.source.fromUser?a=rE(n,e,d.path,d.children,i,s,o):(D(d.source.fromServer,"Unknown source."),c=d.source.tagged||e.serverCache.isFiltered(),a=fo(n,e,d.path,d.children,i,s,c,o))}else if(t.type===Ye.ACK_USER_WRITE){const d=t;d.revert?a=lE(n,e,d.path,i,s,o):a=oE(n,e,d.path,d.affectedTree,i,s,o)}else if(t.type===Ye.LISTEN_COMPLETE)a=aE(n,e,t.path,i,o);else throw Tn("Unknown operation type: "+t.type);const h=o.getChanges();return sE(e,a,h),{viewCache:a,changes:h}}function sE(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),o=ao(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(o)||!i.getNode().getPriority().equals(o.getPriority()))&&t.push(Rv(ao(e)))}}function Td(n,e,t,i,s,o){const a=e.eventCache;if(Vs(i,t)!=null)return e;{let c,h;if(B(t))if(D(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Gt(e),p=d instanceof z?d:z.EMPTY_NODE,_=gd(i,p);c=n.filter.updateFullNode(e.eventCache.getNode(),_,o)}else{const d=uo(i,Gt(e));c=n.filter.updateFullNode(e.eventCache.getNode(),d,o)}else{const d=$(t);if(d===".priority"){D(Rt(t)===1,"Can't have a priority with additional path components");const p=a.getNode();h=e.serverCache.getNode();const _=jc(i,t,p,h);_!=null?c=n.filter.updatePriority(p,_):c=a.getNode()}else{const p=ee(t);let _;if(a.isCompleteForChild(d)){h=e.serverCache.getNode();const v=jc(i,t,a.getNode(),h);v!=null?_=a.getNode().getImmediateChild(d).updateChild(p,v):_=a.getNode().getImmediateChild(d)}else _=na(i,d,e.serverCache);_!=null?c=n.filter.updateChild(a.getNode(),d,_,p,s,o):c=a.getNode()}}return ai(e,c,a.isFullyInitialized()||B(t),n.filter.filtersNodes())}}function Os(n,e,t,i,s,o,a,c){const h=e.serverCache;let d;const p=a?n.filter:n.filter.getIndexedFilter();if(B(t))d=p.updateFullNode(h.getNode(),i,null);else if(p.filtersNodes()&&!h.isFiltered()){const R=h.getNode().updateChild(t,i);d=p.updateFullNode(h.getNode(),R,null)}else{const R=$(t);if(!h.isCompleteForPath(t)&&Rt(t)>1)return e;const b=ee(t),V=h.getNode().getImmediateChild(R).updateChild(b,i);R===".priority"?d=p.updatePriority(h.getNode(),V):d=p.updateChild(h.getNode(),R,V,b,Ed,null)}const _=dd(e,d,h.isFullyInitialized()||B(t),p.filtersNodes()),v=new ia(s,_,o);return Td(n,_,t,s,v,c)}function ho(n,e,t,i,s,o,a){const c=e.eventCache;let h,d;const p=new ia(s,e,o);if(B(t))d=n.filter.updateFullNode(e.eventCache.getNode(),i,a),h=ai(e,d,!0,n.filter.filtersNodes());else{const _=$(t);if(_===".priority")d=n.filter.updatePriority(e.eventCache.getNode(),i),h=ai(e,d,c.isFullyInitialized(),c.isFiltered());else{const v=ee(t),R=c.getNode().getImmediateChild(_);let b;if(B(v))b=i;else{const k=p.getCompleteChild(_);k!=null?Xh(v)===".priority"&&k.getChild(Zh(v)).isEmpty()?b=k:b=k.updateChild(v,i):b=z.EMPTY_NODE}if(R.equals(b))h=e;else{const k=n.filter.updateChild(c.getNode(),_,b,v,p,a);h=ai(e,k,c.isFullyInitialized(),n.filter.filtersNodes())}}}return h}function $c(n,e){return n.eventCache.isCompleteForChild(e)}function rE(n,e,t,i,s,o,a){let c=e;return i.foreach((h,d)=>{const p=pe(t,h);$c(e,$(p))&&(c=ho(n,c,p,d,s,o,a))}),i.foreach((h,d)=>{const p=pe(t,h);$c(e,$(p))||(c=ho(n,c,p,d,s,o,a))}),c}function Wc(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function fo(n,e,t,i,s,o,a,c){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h=e,d;B(t)?d=i:d=new Z(null).setTree(t,i);const p=e.serverCache.getNode();return d.children.inorderTraversal((_,v)=>{if(p.hasChild(_)){const R=e.serverCache.getNode().getImmediateChild(_),b=Wc(n,R,v);h=Os(n,h,new te(_),b,s,o,a,c)}}),d.children.inorderTraversal((_,v)=>{const R=!e.serverCache.isCompleteForChild(_)&&v.value===null;if(!p.hasChild(_)&&!R){const b=e.serverCache.getNode().getImmediateChild(_),k=Wc(n,b,v);h=Os(n,h,new te(_),k,s,o,a,c)}}),h}function oE(n,e,t,i,s,o,a){if(Vs(s,t)!=null)return e;const c=e.serverCache.isFiltered(),h=e.serverCache;if(i.value!=null){if(B(t)&&h.isFullyInitialized()||h.isCompleteForPath(t))return Os(n,e,t,h.getNode().getChild(t),s,o,c,a);if(B(t)){let d=new Z(null);return h.getNode().forEachChild(un,(p,_)=>{d=d.set(new te(p),_)}),fo(n,e,t,d,s,o,c,a)}else return e}else{let d=new Z(null);return i.foreach((p,_)=>{const v=pe(t,p);h.isCompleteForPath(v)&&(d=d.set(p,h.getNode().getChild(v)))}),fo(n,e,t,d,s,o,c,a)}}function aE(n,e,t,i,s){const o=e.serverCache,a=dd(e,o.getNode(),o.isFullyInitialized()||B(t),o.isFiltered());return Td(n,a,t,i,Ed,s)}function lE(n,e,t,i,s,o){let a;if(Vs(i,t)!=null)return e;{const c=new ia(i,e,s),h=e.eventCache.getNode();let d;if(B(t)||$(t)===".priority"){let p;if(e.serverCache.isFullyInitialized())p=uo(i,Gt(e));else{const _=e.serverCache.getNode();D(_ instanceof z,"serverChildren would be complete if leaf node"),p=gd(i,_)}p=p,d=n.filter.updateFullNode(h,p,o)}else{const p=$(t);let _=na(i,p,e.serverCache);_==null&&e.serverCache.isCompleteForChild(p)&&(_=h.getImmediateChild(p)),_!=null?d=n.filter.updateChild(h,p,_,ee(t),c,o):e.eventCache.getNode().hasChild(p)?d=n.filter.updateChild(h,p,z.EMPTY_NODE,ee(t),c,o):d=h,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=uo(i,Gt(e)),a.isLeafNode()&&(d=n.filter.updateFullNode(d,a,o)))}return a=e.serverCache.isFullyInitialized()||Vs(i,Q())!=null,ai(e,d,a,n.filter.filtersNodes())}}function cE(n,e){const t=Gt(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!B(e)&&!t.getImmediateChild($(e)).isEmpty())?t.getChild(e):null}function qc(n,e,t,i){e.type===Ye.MERGE&&e.source.queryId!==null&&(D(Gt(n.viewCache_),"We should always have a full cache before handling merges"),D(ao(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,o=iE(n.processor_,s,e,t,i);return nE(n.processor_,o.viewCache),D(o.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=o.viewCache,uE(n,o.changes,o.viewCache.eventCache.getNode())}function uE(n,e,t,i){const s=n.eventRegistrations_;return Lv(n.eventGenerator_,e,t,s)}let Hc;function hE(n){D(!Hc,"__referenceConstructor has already been defined"),Hc=n}function sa(n,e,t,i){const s=e.source.queryId;if(s!==null){const o=n.views.get(s);return D(o!=null,"SyncTree gave us an op for an invalid query."),qc(o,e,t,i)}else{let o=[];for(const a of n.views.values())o=o.concat(qc(a,e,t,i));return o}}function ra(n,e){let t=null;for(const i of n.views.values())t=t||cE(i,e);return t}let Gc;function dE(n){D(!Gc,"__referenceConstructor has already been defined"),Gc=n}class zc{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Z(null),this.pendingWriteTree_=Jv(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function fE(n,e,t,i,s){return jv(n.pendingWriteTree_,e,t,i,s),s?Gs(n,new Ht(ld(),e,t)):[]}function on(n,e,t=!1){const i=$v(n.pendingWriteTree_,e);if(Wv(n.pendingWriteTree_,e)){let o=new Z(null);return i.snap!=null?o=o.set(Q(),!0):Ue(i.children,a=>{o=o.set(new te(a),!0)}),Gs(n,new ks(i.path,o,t))}else return[]}function Hs(n,e,t){return Gs(n,new Ht(cd(),e,t))}function pE(n,e,t){const i=Z.fromObject(t);return Gs(n,new Ei(cd(),e,i))}function _E(n,e,t,i){const s=Cd(n,i);if(s!=null){const o=Sd(s),a=o.path,c=o.queryId,h=Fe(a,e),d=new Ht(ud(c),h,t);return Rd(n,a,d)}else return[]}function mE(n,e,t,i){const s=Cd(n,i);if(s){const o=Sd(s),a=o.path,c=o.queryId,h=Fe(a,e),d=Z.fromObject(t),p=new Ei(ud(c),h,d);return Rd(n,a,p)}else return[]}function Id(n,e,t){const s=n.pendingWriteTree_,o=n.syncPointTree_.findOnPath(e,(a,c)=>{const h=Fe(a,e),d=ra(c,h);if(d)return d});return md(s,e,o,t,!0)}function Gs(n,e){return wd(e,n.syncPointTree_,null,pd(n.pendingWriteTree_,Q()))}function wd(n,e,t,i){if(B(n.path))return Ad(n,e,t,i);{const s=e.get(Q());t==null&&s!=null&&(t=ra(s,Q()));let o=[];const a=$(n.path),c=n.operationForChild(a),h=e.children.get(a);if(h&&c){const d=t?t.getImmediateChild(a):null,p=yd(i,a);o=o.concat(wd(c,h,d,p))}return s&&(o=o.concat(sa(s,n,i,t))),o}}function Ad(n,e,t,i){const s=e.get(Q());t==null&&s!=null&&(t=ra(s,Q()));let o=[];return e.children.inorderTraversal((a,c)=>{const h=t?t.getImmediateChild(a):null,d=yd(i,a),p=n.operationForChild(a);p&&(o=o.concat(Ad(p,c,h,d)))}),s&&(o=o.concat(sa(s,n,i,t))),o}function Cd(n,e){return n.tagToQueryMap.get(e)}function Sd(n){const e=n.indexOf("$");return D(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new te(n.substr(0,e))}}function Rd(n,e,t){const i=n.syncPointTree_.get(e);D(i,"Missing sync point for query tag that we're tracking");const s=pd(n.pendingWriteTree_,e);return sa(i,t,s,null)}class oa{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new oa(t)}node(){return this.node_}}class aa{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=pe(this.path_,e);return new aa(this.syncTree_,t)}node(){return Id(this.syncTree_,this.path_)}}const gE=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Kc=function(n,e,t){if(!n||typeof n!="object")return n;if(D(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return yE(n[".sv"],e,t);if(typeof n[".sv"]=="object")return vE(n[".sv"],e);D(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},yE=function(n,e,t){if(n==="timestamp")return t.timestamp;D(!1,"Unexpected server value: "+n)},vE=function(n,e,t){n.hasOwnProperty("increment")||D(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&D(!1,"Unexpected increment value: "+i);const s=e.node();if(D(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const a=s.getValue();return typeof a!="number"?i:a+i},EE=function(n,e,t,i){return la(e,new aa(t,n),i)},TE=function(n,e,t){return la(n,new oa(e),t)};function la(n,e,t){const i=n.getPriority().val(),s=Kc(i,e.getImmediateChild(".priority"),t);let o;if(n.isLeafNode()){const a=n,c=Kc(a.getValue(),e,t);return c!==a.getValue()||s!==a.getPriority().val()?new ue(c,be(s)):n}else{const a=n;return o=a,s!==a.getPriority().val()&&(o=o.updatePriority(new ue(s))),a.forEachChild(Ne,(c,h)=>{const d=la(h,e.getImmediateChild(c),t);d!==h&&(o=o.updateImmediateChild(c,d))}),o}}class ca{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function ua(n,e){let t=e instanceof te?e:new te(e),i=n,s=$(t);for(;s!==null;){const o=hn(i.node.children,s)||{children:{},childCount:0};i=new ca(s,i,o),t=ee(t),s=$(t)}return i}function Sn(n){return n.node.value}function bd(n,e){n.node.value=e,po(n)}function Pd(n){return n.node.childCount>0}function IE(n){return Sn(n)===void 0&&!Pd(n)}function zs(n,e){Ue(n.node.children,(t,i)=>{e(new ca(t,n,i))})}function Nd(n,e,t,i){t&&e(n),zs(n,s=>{Nd(s,e,!0)})}function wE(n,e,t){let i=n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function ki(n){return new te(n.parent===null?n.name:ki(n.parent)+"/"+n.name)}function po(n){n.parent!==null&&AE(n.parent,n.name,n)}function AE(n,e,t){const i=IE(t),s=ut(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,po(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,po(n))}const CE=/[\[\].#$\/\u0000-\u001F\u007F]/,SE=/[\[\].#$\u0000-\u001F\u007F]/,Mr=10*1024*1024,Dd=function(n){return typeof n=="string"&&n.length!==0&&!CE.test(n)},RE=function(n){return typeof n=="string"&&n.length!==0&&!SE.test(n)},bE=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),RE(n)},kd=function(n,e,t){const i=t instanceof te?new av(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Ot(i));if(typeof e=="function")throw new Error(n+"contains a function "+Ot(i)+" with contents = "+e.toString());if(Nh(e))throw new Error(n+"contains "+e.toString()+" "+Ot(i));if(typeof e=="string"&&e.length>Mr/3&&xs(e)>Mr)throw new Error(n+"contains a string greater than "+Mr+" utf8 bytes "+Ot(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,o=!1;if(Ue(e,(a,c)=>{if(a===".value")s=!0;else if(a!==".priority"&&a!==".sv"&&(o=!0,!Dd(a)))throw new Error(n+" contains an invalid key ("+a+") "+Ot(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);lv(i,a),kd(n,c,i),cv(i)}),s&&o)throw new Error(n+' contains ".value" child '+Ot(i)+" in addition to actual children.")}},PE=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Dd(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!bE(t))throw new Error(pp(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class NE{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function DE(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],o=s.getPath();t!==null&&!ed(o,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:o}),t.events.push(s)}t&&n.eventLists_.push(t)}function Yt(n,e,t){DE(n,t),kE(n,i=>Ge(i,e)||Ge(e,i))}function kE(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const o=s.path;e(o)?(VE(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function VE(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();ri&&Re("event: "+t.toString()),Ni(i)}}}const OE="repo_interrupt",xE=25;class ME{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new NE,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ds(),this.transactionQueueTree_=new ca,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function LE(n,e,t){if(n.stats_=Yo(n.repoInfo_),n.forceRestClient_||ky())n.server_=new Ns(n.repoInfo_,(i,s,o,a)=>{Qc(n,i,s,o,a)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Yc(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ge(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new at(n.repoInfo_,e,(i,s,o,a)=>{Qc(n,i,s,o,a)},i=>{Yc(n,i)},i=>{UE(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=Ly(n.repoInfo_,()=>new Mv(n.stats_,n.server_)),n.infoData_=new Dv,n.infoSyncTree_=new zc({startListening:(i,s,o,a)=>{let c=[];const h=n.infoData_.getNode(i._path);return h.isEmpty()||(c=Hs(n.infoSyncTree_,i._path,h),setTimeout(()=>{a("ok")},0)),c},stopListening:()=>{}}),ha(n,"connected",!1),n.serverSyncTree_=new zc({startListening:(i,s,o,a)=>(n.server_.listen(i,o,s,(c,h)=>{const d=a(c,h);Yt(n.eventQueue_,i._path,d)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function FE(n){const t=n.infoData_.getNode(new te(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Vd(n){return gE({timestamp:FE(n)})}function Qc(n,e,t,i,s){n.dataUpdateCount++;const o=new te(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let a=[];if(s)if(i){const h=_s(t,d=>be(d));a=mE(n.serverSyncTree_,o,h,s)}else{const h=be(t);a=_E(n.serverSyncTree_,o,h,s)}else if(i){const h=_s(t,d=>be(d));a=pE(n.serverSyncTree_,o,h)}else{const h=be(t);a=Hs(n.serverSyncTree_,o,h)}let c=o;a.length>0&&(c=fa(n,o)),Yt(n.eventQueue_,c,a)}function Yc(n,e){ha(n,"connected",e),e===!1&&jE(n)}function UE(n,e){Ue(e,(t,i)=>{ha(n,t,i)})}function ha(n,e,t){const i=new te("/.info/"+e),s=be(t);n.infoData_.updateSnapshot(i,s);const o=Hs(n.infoSyncTree_,i,s);Yt(n.eventQueue_,i,o)}function BE(n){return n.nextWriteId_++}function jE(n){Od(n,"onDisconnectEvents");const e=Vd(n),t=Ds();oo(n.onDisconnect_,Q(),(s,o)=>{const a=EE(s,o,n.serverSyncTree_,e);ad(t,s,a)});let i=[];oo(t,Q(),(s,o)=>{i=i.concat(Hs(n.serverSyncTree_,s,o));const a=HE(n,s);fa(n,a)}),n.onDisconnect_=Ds(),Yt(n.eventQueue_,Q(),i)}function $E(n){n.persistentConnection_&&n.persistentConnection_.interrupt(OE)}function Od(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Re(t,...e)}function xd(n,e,t){return Id(n.serverSyncTree_,e,t)||z.EMPTY_NODE}function da(n,e=n.transactionQueueTree_){if(e||Ks(n,e),Sn(e)){const t=Ld(n,e);D(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&WE(n,ki(e),t)}else Pd(e)&&zs(e,t=>{da(n,t)})}function WE(n,e,t){const i=t.map(d=>d.currentWriteId),s=xd(n,e,i);let o=s;const a=s.hash();for(let d=0;d<t.length;d++){const p=t[d];D(p.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++;const _=Fe(e,p.path);o=o.updateChild(_,p.currentOutputSnapshotRaw)}const c=o.val(!0),h=e;n.server_.put(h.toString(),c,d=>{Od(n,"transaction put response",{path:h.toString(),status:d});let p=[];if(d==="ok"){const _=[];for(let v=0;v<t.length;v++)t[v].status=2,p=p.concat(on(n.serverSyncTree_,t[v].currentWriteId)),t[v].onComplete&&_.push(()=>t[v].onComplete(null,!0,t[v].currentOutputSnapshotResolved)),t[v].unwatcher();Ks(n,ua(n.transactionQueueTree_,e)),da(n,n.transactionQueueTree_),Yt(n.eventQueue_,e,p);for(let v=0;v<_.length;v++)Ni(_[v])}else{if(d==="datastale")for(let _=0;_<t.length;_++)t[_].status===3?t[_].status=4:t[_].status=0;else{Le("transaction at "+h.toString()+" failed: "+d);for(let _=0;_<t.length;_++)t[_].status=4,t[_].abortReason=d}fa(n,e)}},a)}function fa(n,e){const t=Md(n,e),i=ki(t),s=Ld(n,t);return qE(n,s,i),i}function qE(n,e,t){if(e.length===0)return;const i=[];let s=[];const a=e.filter(c=>c.status===0).map(c=>c.currentWriteId);for(let c=0;c<e.length;c++){const h=e[c],d=Fe(t,h.path);let p=!1,_;if(D(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),h.status===4)p=!0,_=h.abortReason,s=s.concat(on(n.serverSyncTree_,h.currentWriteId,!0));else if(h.status===0)if(h.retryCount>=xE)p=!0,_="maxretry",s=s.concat(on(n.serverSyncTree_,h.currentWriteId,!0));else{const v=xd(n,h.path,a);h.currentInputSnapshot=v;const R=e[c].update(v.val());if(R!==void 0){kd("transaction failed: Data returned ",R,h.path);let b=be(R);typeof R=="object"&&R!=null&&ut(R,".priority")||(b=b.updatePriority(v.getPriority()));const V=h.currentWriteId,K=Vd(n),F=TE(b,v,K);h.currentOutputSnapshotRaw=b,h.currentOutputSnapshotResolved=F,h.currentWriteId=BE(n),a.splice(a.indexOf(V),1),s=s.concat(fE(n.serverSyncTree_,h.path,F,h.currentWriteId,h.applyLocally)),s=s.concat(on(n.serverSyncTree_,V,!0))}else p=!0,_="nodata",s=s.concat(on(n.serverSyncTree_,h.currentWriteId,!0))}Yt(n.eventQueue_,t,s),s=[],p&&(e[c].status=2,(function(v){setTimeout(v,Math.floor(0))})(e[c].unwatcher),e[c].onComplete&&(_==="nodata"?i.push(()=>e[c].onComplete(null,!1,e[c].currentInputSnapshot)):i.push(()=>e[c].onComplete(new Error(_),!1,null))))}Ks(n,n.transactionQueueTree_);for(let c=0;c<i.length;c++)Ni(i[c]);da(n,n.transactionQueueTree_)}function Md(n,e){let t,i=n.transactionQueueTree_;for(t=$(e);t!==null&&Sn(i)===void 0;)i=ua(i,t),e=ee(e),t=$(e);return i}function Ld(n,e){const t=[];return Fd(n,e,t),t.sort((i,s)=>i.order-s.order),t}function Fd(n,e,t){const i=Sn(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);zs(e,s=>{Fd(n,s,t)})}function Ks(n,e){const t=Sn(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,bd(e,t.length>0?t:void 0)}zs(e,i=>{Ks(n,i)})}function HE(n,e){const t=ki(Md(n,e)),i=ua(n.transactionQueueTree_,e);return wE(i,s=>{Lr(n,s)}),Lr(n,i),Nd(i,s=>{Lr(n,s)}),t}function Lr(n,e){const t=Sn(e);if(t){const i=[];let s=[],o=-1;for(let a=0;a<t.length;a++)t[a].status===3||(t[a].status===1?(D(o===a-1,"All SENT items should be at beginning of queue."),o=a,t[a].status=3,t[a].abortReason="set"):(D(t[a].status===0,"Unexpected transaction status in abort"),t[a].unwatcher(),s=s.concat(on(n.serverSyncTree_,t[a].currentWriteId,!0)),t[a].onComplete&&i.push(t[a].onComplete.bind(null,new Error("set"),!1,null))));o===-1?bd(e,void 0):t.length=o+1,Yt(n.eventQueue_,ki(e),s);for(let a=0;a<i.length;a++)Ni(i[a])}}function GE(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function zE(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Le(`Invalid query segment '${t}' in query '${n}'`)}return e}const Xc=function(n,e){const t=KE(n),i=t.namespace;t.domain==="firebase.com"&&ct(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&ct("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Ay();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new $h(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new te(t.pathString)}},KE=function(n){let e="",t="",i="",s="",o="",a=!0,c="https",h=443;if(typeof n=="string"){let d=n.indexOf("//");d>=0&&(c=n.substring(0,d-1),n=n.substring(d+2));let p=n.indexOf("/");p===-1&&(p=n.length);let _=n.indexOf("?");_===-1&&(_=n.length),e=n.substring(0,Math.min(p,_)),p<_&&(s=GE(n.substring(p,_)));const v=zE(n.substring(Math.min(n.length,_)));d=e.indexOf(":"),d>=0?(a=c==="https"||c==="wss",h=parseInt(e.substring(d+1),10)):d=e.length;const R=e.slice(0,d);if(R.toLowerCase()==="localhost")t="localhost";else if(R.split(".").length<=2)t=R;else{const b=e.indexOf(".");i=e.substring(0,b).toLowerCase(),t=e.substring(b+1),o=i}"ns"in v&&(o=v.ns)}return{host:e,port:h,domain:t,subdomain:i,secure:a,scheme:c,pathString:s,namespace:o}};class pa{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return B(this._path)?null:Xh(this._path)}get ref(){return new Rn(this._repo,this._path)}get _queryIdentifier(){const e=Mc(this._queryParams),t=Ko(e);return t==="{}"?"default":t}get _queryObject(){return Mc(this._queryParams)}isEqual(e){if(e=Ut(e),!(e instanceof pa))return!1;const t=this._repo===e._repo,i=ed(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+ov(this._path)}}class Rn extends pa{constructor(e,t){super(e,t,new ea,!1)}get parent(){const e=Zh(this._path);return e===null?null:new Rn(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}hE(Rn);dE(Rn);const QE="FIREBASE_DATABASE_EMULATOR_HOST",_o={};let YE=!1;function XE(n,e,t,i){const s=e.lastIndexOf(":"),o=e.substring(0,s),a=Ti(o);n.repoInfo_=new $h(e,a,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function JE(n,e,t,i,s){let o=i||n.options.databaseURL;o===void 0&&(n.options.projectId||ct("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Re("Using default host for project ",n.options.projectId),o=`${n.options.projectId}-default-rtdb.firebaseio.com`);let a=Xc(o,s),c=a.repoInfo,h;typeof process<"u"&&gc&&(h=gc[QE]),h?(o=`http://${h}?ns=${c.namespace}`,a=Xc(o,s),c=a.repoInfo):a.repoInfo.secure;const d=new Oy(n.name,n.options,e);PE("Invalid Firebase Database URL",a),B(a.path)||ct("Database URL must point to the root of a Firebase Database (not including a child path).");const p=eT(c,n,d,new Vy(n,t));return new tT(p,n)}function ZE(n,e){const t=_o[e];(!t||t[n.key]!==n)&&ct(`Database ${e}(${n.repoInfo_}) has already been deleted.`),$E(n),delete t[n.key]}function eT(n,e,t,i){let s=_o[e.name];s||(s={},_o[e.name]=s);let o=s[n.toURLString()];return o&&ct("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new ME(n,YE,t,i),s[n.toURLString()]=o,o}class tT{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(LE(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Rn(this._repo,Q())),this._rootInternal}_delete(){return this._rootInternal!==null&&(ZE(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ct("Cannot call "+e+" on a deleted database.")}}function nT(n=Io(),e){const t=fu(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const i=nu("database");i&&iT(t,...i)}return t}function iT(n,e,t,i={}){n=Ut(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,o=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&ui(i,o.repoInfo_.emulatorOptions))return;ct("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let a;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&ct('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new fs(fs.OWNER);else if(i.mockUserToken){const c=typeof i.mockUserToken=="string"?i.mockUserToken:ru(i.mockUserToken,n.app.options.projectId);a=new fs(c)}Ti(e)&&(su(e),ou("Database",!0)),XE(o,s,i,a)}function sT(n){yy(_u),di(new dn("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return JE(i,s,o,t)},"PUBLIC").setMultipleInstances(!0)),vt(yc,vc,n),vt(yc,vc,"esm2017")}at.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};at.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};sT();const rT={apiKey:"dummy",authDomain:"dummy",projectId:"dummy",storageBucket:"dummy",messagingSenderId:"dummy",appId:"dummy",databaseURL:"dummy"},Ud=p_().length?Io():mu(rT),oT=Zg(Ud);nT(Ud);const aT=async(n,e)=>{try{await fy(Xg(oT,"events"),{type:n,payload:e,timestamp:_y()}),console.log(`[EVENT LOGGED] ${n}`,e)}catch(t){throw console.error("Error logging event:",t),t}};var lT=wf('<h1>Admin Panel</h1> <div class="card svelte-1jef3w8"><h2>Add New Service</h2> <label class="svelte-1jef3w8">Name: <input placeholder="My API" class="svelte-1jef3w8"/></label> <label class="svelte-1jef3w8">URL: <input placeholder="https://api.example.com" class="svelte-1jef3w8"/></label> <label class="svelte-1jef3w8">Interval (min): <input type="number" min="1" class="svelte-1jef3w8"/></label> <button>Add Service</button></div>',1);function mT(n,e){Of(e,!1);let t=vr(""),i=vr(""),s=vr(1);async function o(){!mt(t)||!mt(i)||(await aT("SERVICE_ADDED",{id:crypto.randomUUID(),name:mt(t),url:mt(i),interval:Number(mt(s))}),Gn(t,""),Gn(i,""),alert("Service Added! (Event Logged)"))}Ff();var a=lT(),c=_t(xf(a),2),h=_t(Ji(c),2),d=_t(Ji(h));Er(d),Zi(h);var p=_t(h,2),_=_t(Ji(p));Er(_),Zi(p);var v=_t(p,2),R=_t(Ji(v));Er(R),Zi(v);var b=_t(v,2);Zi(c),Tr(d,()=>mt(t),k=>Gn(t,k)),Tr(_,()=>mt(i),k=>Gn(i,k)),Tr(R,()=>mt(s),k=>Gn(s,k)),Lf("click",b,o),If(n,a),Mf()}export{mT as component};
