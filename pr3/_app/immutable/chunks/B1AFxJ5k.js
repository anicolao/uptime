import{C as vh,aQ as p_,aR as __,aS as m_,q as g_,aT as y_,aU as v_,aV as E_}from"./BCO3mL48.js";const T_=Symbol("is custom element"),I_=Symbol("is html"),w_=__?"link":"LINK";function zA(n){if(vh){var e=!1,t=()=>{if(!e){if(e=!0,n.hasAttribute("value")){var i=n.value;vc(n,"value",null),n.value=i}if(n.hasAttribute("checked")){var s=n.checked;vc(n,"checked",null),n.checked=s}}};n.__on_r=t,g_(t),y_()}}function vc(n,e,t,i){var s=A_(n);vh&&(s[e]=n.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&n.nodeName===w_)||s[e]!==(s[e]=t)&&(e==="loading"&&(n[v_]=t),t==null?n.removeAttribute(e):typeof t!="string"&&C_(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function A_(n){return n.__attributes??={[T_]:n.nodeName.includes("-"),[I_]:n.namespaceURI===p_}}var Ec=new Map;function C_(n){var e=n.getAttribute("is")||n.nodeName,t=Ec.get(e);if(t)return t;Ec.set(e,t=[]);for(var i,s=n,r=Element.prototype;r!==s;){i=E_(s);for(var a in i)i[a].set&&t.push(a);s=m_(s)}return t}const S_=()=>{};var Tc={};const Eh={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const N=function(n,e){if(!n)throw zn(e)},zn=function(n){return new Error("Firebase Database ("+Eh.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const Th=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},R_=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[t++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=n[t++],a=n[t++],l=n[t++],u=((s&7)<<18|(r&63)<<12|(a&63)<<6|l&63)-65536;e[i++]=String.fromCharCode(55296+(u>>10)),e[i++]=String.fromCharCode(56320+(u&1023))}else{const r=n[t++],a=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|a&63)}}return e.join("")},ua={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],a=s+1<n.length,l=a?n[s+1]:0,u=s+2<n.length,d=u?n[s+2]:0,p=r>>2,_=(r&3)<<4|l>>4;let v=(l&15)<<2|d>>6,S=d&63;u||(S=64,a||(v=64)),i.push(t[p],t[_],t[v],t[S])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Th(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):R_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const _=s<n.length?t[n.charAt(s)]:64;if(++s,r==null||l==null||d==null||_==null)throw new b_;const v=r<<2|l>>4;if(i.push(v),d!==64){const S=l<<4&240|d>>2;if(i.push(S),_!==64){const b=d<<6&192|_;i.push(b)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class b_ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ih=function(n){const e=Th(n);return ua.encodeByteArray(e,!0)},zs=function(n){return Ih(n).replace(/\./g,"")},Gs=function(n){try{return ua.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function P_(n){return wh(void 0,n)}function wh(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!k_(t)||(n[t]=wh(n[t],e[t]));return n}function k_(n){return n!=="__proto__"}function N_(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const D_=()=>N_().__FIREBASE_DEFAULTS__,O_=()=>{if(typeof process>"u"||typeof Tc>"u")return;const n=Tc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},M_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Gs(n[1]);return e&&JSON.parse(e)},Er=()=>{try{return S_()||D_()||O_()||M_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ah=n=>{var e,t;return(t=(e=Er())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Ch=n=>{const e=Ah(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},Sh=()=>{var n;return(n=Er())===null||n===void 0?void 0:n.config},Rh=n=>{var e;return(e=Er())===null||e===void 0?void 0:e[`_${n}`]};class ha{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}function zt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function da(n){return(await fetch(n,{credentials:"include"})).ok}function bh(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n);return[zs(JSON.stringify(t)),zs(JSON.stringify(a)),""].join(".")}const wi={};function V_(){const n={prod:[],emulator:[]};for(const e of Object.keys(wi))wi[e]?n.emulator.push(e):n.prod.push(e);return n}function L_(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ic=!1;function fa(n,e){if(typeof window>"u"||typeof document>"u"||!zt(window.location.host)||wi[n]===e||wi[n]||Ic)return;wi[n]=e;function t(v){return`__firebase__banner__${v}`}const i="__firebase__banner",r=V_().prod.length>0;function a(){const v=document.getElementById(i);v&&v.remove()}function l(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function u(v,S){v.setAttribute("width","24"),v.setAttribute("id",S),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Ic=!0,a()},v}function p(v,S){v.setAttribute("id",S),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function _(){const v=L_(i),S=t("text"),b=document.getElementById(S)||document.createElement("span"),O=t("learnmore"),D=document.getElementById(O)||document.createElement("a"),K=t("preprendIcon"),F=document.getElementById(K)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const W=v.element;l(W),p(D,O);const re=d();u(F,K),W.append(F,b,D,re),document.body.appendChild(W)}r?(b.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function Oe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function pa(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Oe())}function x_(){var n;const e=(n=Er())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function F_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function U_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Ph(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function B_(){const n=Oe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function j_(){return Eh.NODE_ADMIN===!0}function W_(){return!x_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function $_(){try{return typeof indexedDB=="object"}catch{return!1}}function H_(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var r;e(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(t){e(t)}})}const q_="FirebaseError";class At extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=q_,Object.setPrototypeOf(this,At.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zi.prototype.create)}}class zi{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],a=r?z_(r,i):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new At(s,l,i)}}function z_(n,e){return n.replace(G_,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const G_=/\{\$([^}]+)}/g;function Mi(n){return JSON.parse(n)}function ve(n){return JSON.stringify(n)}const kh=function(n){let e={},t={},i={},s="";try{const r=n.split(".");e=Mi(Gs(r[0])||""),t=Mi(Gs(r[1])||""),s=r[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}},K_=function(n){const e=kh(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},Q_=function(n){const e=kh(n).claims;return typeof e=="object"&&e.admin===!0};function Ct(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ln(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Po(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ks(n,e,t){const i={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function Ut(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const r=n[s],a=e[s];if(wc(r)&&wc(a)){if(!Ut(r,a))return!1}else if(r!==a)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function wc(n){return n!==null&&typeof n=="object"}function Gn(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}class Y_{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let _=0;_<16;_++)i[_]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let _=0;_<16;_++)i[_]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let _=16;_<80;_++){const v=i[_-3]^i[_-8]^i[_-14]^i[_-16];i[_]=(v<<1|v>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],a=this.chain_[2],l=this.chain_[3],u=this.chain_[4],d,p;for(let _=0;_<80;_++){_<40?_<20?(d=l^r&(a^l),p=1518500249):(d=r^a^l,p=1859775393):_<60?(d=r&a|l&(r|a),p=2400959708):(d=r^a^l,p=3395469782);const v=(s<<5|s>>>27)+d+u+p+i[_]&4294967295;u=l,l=a,a=(r<<30|r>>>2)&4294967295,r=s,s=v}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let s=0;const r=this.buf_;let a=this.inbuf_;for(;s<t;){if(a===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(r[a]=e.charCodeAt(s),++a,++s,a===this.blockSize){this.compress_(r),a=0;break}}else for(;s<t;)if(r[a]=e[s],++a,++s,a===this.blockSize){this.compress_(r),a=0;break}}this.inbuf_=a,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}}function X_(n,e){const t=new J_(n,e);return t.subscribe.bind(t)}class J_{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let s;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");Z_(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:i},s.next===void 0&&(s.next=ho),s.error===void 0&&(s.error=ho),s.complete===void 0&&(s.complete=ho);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Z_(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ho(){}function em(n,e){return`${n} failed: ${e} argument `}const tm=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){const r=s-55296;i++,N(i<n.length,"Surrogate pair missing trail surrogate.");const a=n.charCodeAt(i)-56320;s=65536+(r<<10)+a}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Tr=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};function Le(n){return n&&n._delegate?n._delegate:n}class Bt{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Xt="[DEFAULT]";class nm{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new ha;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),s=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(sm(e))try{this.getOrInitializeService({instanceIdentifier:Xt})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=Xt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Xt){return this.instances.has(e)}getOptions(e=Xt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[r,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);i===l&&a.resolve(s)}return s}onInit(e,t){var i;const s=this.normalizeInstanceIdentifier(t),r=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;r.add(e),this.onInitCallbacks.set(s,r);const a=this.instances.get(s);return a&&e(a,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:im(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Xt){return this.component?this.component.multipleInstances?e:Xt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function im(n){return n===Xt?void 0:n}function sm(n){return n.instantiationMode==="EAGER"}class rm{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new nm(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var B;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(B||(B={}));const om={debug:B.DEBUG,verbose:B.VERBOSE,info:B.INFO,warn:B.WARN,error:B.ERROR,silent:B.SILENT},am=B.INFO,lm={[B.DEBUG]:"log",[B.VERBOSE]:"log",[B.INFO]:"info",[B.WARN]:"warn",[B.ERROR]:"error"},cm=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=lm[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ir{constructor(e){this.name=e,this._logLevel=am,this._logHandler=cm,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in B))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?om[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,B.DEBUG,...e),this._logHandler(this,B.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,B.VERBOSE,...e),this._logHandler(this,B.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,B.INFO,...e),this._logHandler(this,B.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,B.WARN,...e),this._logHandler(this,B.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,B.ERROR,...e),this._logHandler(this,B.ERROR,...e)}}const um=(n,e)=>e.some(t=>n instanceof t);let Ac,Cc;function hm(){return Ac||(Ac=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dm(){return Cc||(Cc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Nh=new WeakMap,ko=new WeakMap,Dh=new WeakMap,fo=new WeakMap,_a=new WeakMap;function fm(n){const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",a)},r=()=>{t(Mt(n.result)),s()},a=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Nh.set(t,n)}).catch(()=>{}),_a.set(e,n),e}function pm(n){if(ko.has(n))return;const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",a),n.removeEventListener("abort",a)},r=()=>{t(),s()},a=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",a),n.addEventListener("abort",a)});ko.set(n,e)}let No={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ko.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Dh.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Mt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function _m(n){No=n(No)}function mm(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(po(this),e,...t);return Dh.set(i,e.sort?e.sort():[e]),Mt(i)}:dm().includes(n)?function(...e){return n.apply(po(this),e),Mt(Nh.get(this))}:function(...e){return Mt(n.apply(po(this),e))}}function gm(n){return typeof n=="function"?mm(n):(n instanceof IDBTransaction&&pm(n),um(n,hm())?new Proxy(n,No):n)}function Mt(n){if(n instanceof IDBRequest)return fm(n);if(fo.has(n))return fo.get(n);const e=gm(n);return e!==n&&(fo.set(n,e),_a.set(e,n)),e}const po=n=>_a.get(n);function ym(n,e,{blocked:t,upgrade:i,blocking:s,terminated:r}={}){const a=indexedDB.open(n,e),l=Mt(a);return i&&a.addEventListener("upgradeneeded",u=>{i(Mt(a.result),u.oldVersion,u.newVersion,Mt(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{r&&u.addEventListener("close",()=>r()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const vm=["get","getKey","getAll","getAllKeys","count"],Em=["put","add","delete","clear"],_o=new Map;function Sc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(_o.get(e))return _o.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,s=Em.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||vm.includes(t)))return;const r=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return i&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&u.done]))[0]};return _o.set(e,r),r}_m(n=>({...n,get:(e,t,i)=>Sc(e,t)||n.get(e,t,i),has:(e,t)=>!!Sc(e,t)||n.has(e,t)}));class Tm{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Im(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function Im(n){const e=n.getComponent();return e?.type==="VERSION"}const Do="@firebase/app",Rc="0.13.2";const Tt=new Ir("@firebase/app"),wm="@firebase/app-compat",Am="@firebase/analytics-compat",Cm="@firebase/analytics",Sm="@firebase/app-check-compat",Rm="@firebase/app-check",bm="@firebase/auth",Pm="@firebase/auth-compat",km="@firebase/database",Nm="@firebase/data-connect",Dm="@firebase/database-compat",Om="@firebase/functions",Mm="@firebase/functions-compat",Vm="@firebase/installations",Lm="@firebase/installations-compat",xm="@firebase/messaging",Fm="@firebase/messaging-compat",Um="@firebase/performance",Bm="@firebase/performance-compat",jm="@firebase/remote-config",Wm="@firebase/remote-config-compat",$m="@firebase/storage",Hm="@firebase/storage-compat",qm="@firebase/firestore",zm="@firebase/ai",Gm="@firebase/firestore-compat",Km="firebase",Qm="11.10.0";const Oo="[DEFAULT]",Ym={[Do]:"fire-core",[wm]:"fire-core-compat",[Cm]:"fire-analytics",[Am]:"fire-analytics-compat",[Rm]:"fire-app-check",[Sm]:"fire-app-check-compat",[bm]:"fire-auth",[Pm]:"fire-auth-compat",[km]:"fire-rtdb",[Nm]:"fire-data-connect",[Dm]:"fire-rtdb-compat",[Om]:"fire-fn",[Mm]:"fire-fn-compat",[Vm]:"fire-iid",[Lm]:"fire-iid-compat",[xm]:"fire-fcm",[Fm]:"fire-fcm-compat",[Um]:"fire-perf",[Bm]:"fire-perf-compat",[jm]:"fire-rc",[Wm]:"fire-rc-compat",[$m]:"fire-gcs",[Hm]:"fire-gcs-compat",[qm]:"fire-fst",[Gm]:"fire-fst-compat",[zm]:"fire-vertex","fire-js":"fire-js",[Km]:"fire-js-all"};const Vi=new Map,Xm=new Map,Mo=new Map;function bc(n,e){try{n.container.addComponent(e)}catch(t){Tt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function on(n){const e=n.name;if(Mo.has(e))return Tt.debug(`There were multiple attempts to register component ${e}.`),!1;Mo.set(e,n);for(const t of Vi.values())bc(t,n);for(const t of Xm.values())bc(t,n);return!0}function wr(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function je(n){return n==null?!1:n.settings!==void 0}const Jm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Vt=new zi("app","Firebase",Jm);class Zm{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Bt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Vt.create("app-deleted",{appName:this._name})}}const _n=Qm;function Oh(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:Oo,automaticDataCollectionEnabled:!0},e),s=i.name;if(typeof s!="string"||!s)throw Vt.create("bad-app-name",{appName:String(s)});if(t||(t=Sh()),!t)throw Vt.create("no-options");const r=Vi.get(s);if(r){if(Ut(t,r.options)&&Ut(i,r.config))return r;throw Vt.create("duplicate-app",{appName:s})}const a=new rm(s);for(const u of Mo.values())a.addComponent(u);const l=new Zm(t,i,a);return Vi.set(s,l),l}function Ar(n=Oo){const e=Vi.get(n);if(!e&&n===Oo&&Sh())return Oh();if(!e)throw Vt.create("no-app",{appName:n});return e}function eg(){return Array.from(Vi.values())}function st(n,e,t){var i;let s=(i=Ym[n])!==null&&i!==void 0?i:n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),a=e.match(/\s|\//);if(r||a){const l=[`Unable to register library "${s}" with version "${e}":`];r&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Tt.warn(l.join(" "));return}on(new Bt(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const tg="firebase-heartbeat-database",ng=1,Li="firebase-heartbeat-store";let mo=null;function Mh(){return mo||(mo=ym(tg,ng,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Li)}catch(t){console.warn(t)}}}}).catch(n=>{throw Vt.create("idb-open",{originalErrorMessage:n.message})})),mo}async function ig(n){try{const t=(await Mh()).transaction(Li),i=await t.objectStore(Li).get(Vh(n));return await t.done,i}catch(e){if(e instanceof At)Tt.warn(e.message);else{const t=Vt.create("idb-get",{originalErrorMessage:e?.message});Tt.warn(t.message)}}}async function Pc(n,e){try{const i=(await Mh()).transaction(Li,"readwrite");await i.objectStore(Li).put(e,Vh(n)),await i.done}catch(t){if(t instanceof At)Tt.warn(t.message);else{const i=Vt.create("idb-set",{originalErrorMessage:t?.message});Tt.warn(i.message)}}}function Vh(n){return`${n.name}!${n.options.appId}`}const sg=1024,rg=30;class og{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new lg(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=kc();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats.length>rg){const a=cg(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Tt.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=kc(),{heartbeatsToSend:i,unsentEntries:s}=ag(this._heartbeatsCache.heartbeats),r=zs(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return Tt.warn(t),""}}}function kc(){return new Date().toISOString().substring(0,10)}function ag(n,e=sg){const t=[];let i=n.slice();for(const s of n){const r=t.find(a=>a.agent===s.agent);if(r){if(r.dates.push(s.date),Nc(t)>e){r.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Nc(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class lg{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return $_()?H_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await ig(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Pc(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Pc(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Nc(n){return zs(JSON.stringify({version:2,heartbeats:n})).length}function cg(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}function ug(n){on(new Bt("platform-logger",e=>new Tm(e),"PRIVATE")),on(new Bt("heartbeat",e=>new og(e),"PRIVATE")),st(Do,Rc,n),st(Do,Rc,"esm2017"),st("fire-js","")}ug("");var hg="firebase",dg="11.10.0";st(hg,dg,"app");var Dc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ma;(function(){var n;function e(I,m){function y(){}y.prototype=m.prototype,I.D=m.prototype,I.prototype=new y,I.prototype.constructor=I,I.C=function(E,T,A){for(var g=Array(arguments.length-2),ct=2;ct<arguments.length;ct++)g[ct-2]=arguments[ct];return m.prototype[T].apply(E,g)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,m,y){y||(y=0);var E=Array(16);if(typeof m=="string")for(var T=0;16>T;++T)E[T]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(T=0;16>T;++T)E[T]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=I.g[0],y=I.g[1],T=I.g[2];var A=I.g[3],g=m+(A^y&(T^A))+E[0]+3614090360&4294967295;m=y+(g<<7&4294967295|g>>>25),g=A+(T^m&(y^T))+E[1]+3905402710&4294967295,A=m+(g<<12&4294967295|g>>>20),g=T+(y^A&(m^y))+E[2]+606105819&4294967295,T=A+(g<<17&4294967295|g>>>15),g=y+(m^T&(A^m))+E[3]+3250441966&4294967295,y=T+(g<<22&4294967295|g>>>10),g=m+(A^y&(T^A))+E[4]+4118548399&4294967295,m=y+(g<<7&4294967295|g>>>25),g=A+(T^m&(y^T))+E[5]+1200080426&4294967295,A=m+(g<<12&4294967295|g>>>20),g=T+(y^A&(m^y))+E[6]+2821735955&4294967295,T=A+(g<<17&4294967295|g>>>15),g=y+(m^T&(A^m))+E[7]+4249261313&4294967295,y=T+(g<<22&4294967295|g>>>10),g=m+(A^y&(T^A))+E[8]+1770035416&4294967295,m=y+(g<<7&4294967295|g>>>25),g=A+(T^m&(y^T))+E[9]+2336552879&4294967295,A=m+(g<<12&4294967295|g>>>20),g=T+(y^A&(m^y))+E[10]+4294925233&4294967295,T=A+(g<<17&4294967295|g>>>15),g=y+(m^T&(A^m))+E[11]+2304563134&4294967295,y=T+(g<<22&4294967295|g>>>10),g=m+(A^y&(T^A))+E[12]+1804603682&4294967295,m=y+(g<<7&4294967295|g>>>25),g=A+(T^m&(y^T))+E[13]+4254626195&4294967295,A=m+(g<<12&4294967295|g>>>20),g=T+(y^A&(m^y))+E[14]+2792965006&4294967295,T=A+(g<<17&4294967295|g>>>15),g=y+(m^T&(A^m))+E[15]+1236535329&4294967295,y=T+(g<<22&4294967295|g>>>10),g=m+(T^A&(y^T))+E[1]+4129170786&4294967295,m=y+(g<<5&4294967295|g>>>27),g=A+(y^T&(m^y))+E[6]+3225465664&4294967295,A=m+(g<<9&4294967295|g>>>23),g=T+(m^y&(A^m))+E[11]+643717713&4294967295,T=A+(g<<14&4294967295|g>>>18),g=y+(A^m&(T^A))+E[0]+3921069994&4294967295,y=T+(g<<20&4294967295|g>>>12),g=m+(T^A&(y^T))+E[5]+3593408605&4294967295,m=y+(g<<5&4294967295|g>>>27),g=A+(y^T&(m^y))+E[10]+38016083&4294967295,A=m+(g<<9&4294967295|g>>>23),g=T+(m^y&(A^m))+E[15]+3634488961&4294967295,T=A+(g<<14&4294967295|g>>>18),g=y+(A^m&(T^A))+E[4]+3889429448&4294967295,y=T+(g<<20&4294967295|g>>>12),g=m+(T^A&(y^T))+E[9]+568446438&4294967295,m=y+(g<<5&4294967295|g>>>27),g=A+(y^T&(m^y))+E[14]+3275163606&4294967295,A=m+(g<<9&4294967295|g>>>23),g=T+(m^y&(A^m))+E[3]+4107603335&4294967295,T=A+(g<<14&4294967295|g>>>18),g=y+(A^m&(T^A))+E[8]+1163531501&4294967295,y=T+(g<<20&4294967295|g>>>12),g=m+(T^A&(y^T))+E[13]+2850285829&4294967295,m=y+(g<<5&4294967295|g>>>27),g=A+(y^T&(m^y))+E[2]+4243563512&4294967295,A=m+(g<<9&4294967295|g>>>23),g=T+(m^y&(A^m))+E[7]+1735328473&4294967295,T=A+(g<<14&4294967295|g>>>18),g=y+(A^m&(T^A))+E[12]+2368359562&4294967295,y=T+(g<<20&4294967295|g>>>12),g=m+(y^T^A)+E[5]+4294588738&4294967295,m=y+(g<<4&4294967295|g>>>28),g=A+(m^y^T)+E[8]+2272392833&4294967295,A=m+(g<<11&4294967295|g>>>21),g=T+(A^m^y)+E[11]+1839030562&4294967295,T=A+(g<<16&4294967295|g>>>16),g=y+(T^A^m)+E[14]+4259657740&4294967295,y=T+(g<<23&4294967295|g>>>9),g=m+(y^T^A)+E[1]+2763975236&4294967295,m=y+(g<<4&4294967295|g>>>28),g=A+(m^y^T)+E[4]+1272893353&4294967295,A=m+(g<<11&4294967295|g>>>21),g=T+(A^m^y)+E[7]+4139469664&4294967295,T=A+(g<<16&4294967295|g>>>16),g=y+(T^A^m)+E[10]+3200236656&4294967295,y=T+(g<<23&4294967295|g>>>9),g=m+(y^T^A)+E[13]+681279174&4294967295,m=y+(g<<4&4294967295|g>>>28),g=A+(m^y^T)+E[0]+3936430074&4294967295,A=m+(g<<11&4294967295|g>>>21),g=T+(A^m^y)+E[3]+3572445317&4294967295,T=A+(g<<16&4294967295|g>>>16),g=y+(T^A^m)+E[6]+76029189&4294967295,y=T+(g<<23&4294967295|g>>>9),g=m+(y^T^A)+E[9]+3654602809&4294967295,m=y+(g<<4&4294967295|g>>>28),g=A+(m^y^T)+E[12]+3873151461&4294967295,A=m+(g<<11&4294967295|g>>>21),g=T+(A^m^y)+E[15]+530742520&4294967295,T=A+(g<<16&4294967295|g>>>16),g=y+(T^A^m)+E[2]+3299628645&4294967295,y=T+(g<<23&4294967295|g>>>9),g=m+(T^(y|~A))+E[0]+4096336452&4294967295,m=y+(g<<6&4294967295|g>>>26),g=A+(y^(m|~T))+E[7]+1126891415&4294967295,A=m+(g<<10&4294967295|g>>>22),g=T+(m^(A|~y))+E[14]+2878612391&4294967295,T=A+(g<<15&4294967295|g>>>17),g=y+(A^(T|~m))+E[5]+4237533241&4294967295,y=T+(g<<21&4294967295|g>>>11),g=m+(T^(y|~A))+E[12]+1700485571&4294967295,m=y+(g<<6&4294967295|g>>>26),g=A+(y^(m|~T))+E[3]+2399980690&4294967295,A=m+(g<<10&4294967295|g>>>22),g=T+(m^(A|~y))+E[10]+4293915773&4294967295,T=A+(g<<15&4294967295|g>>>17),g=y+(A^(T|~m))+E[1]+2240044497&4294967295,y=T+(g<<21&4294967295|g>>>11),g=m+(T^(y|~A))+E[8]+1873313359&4294967295,m=y+(g<<6&4294967295|g>>>26),g=A+(y^(m|~T))+E[15]+4264355552&4294967295,A=m+(g<<10&4294967295|g>>>22),g=T+(m^(A|~y))+E[6]+2734768916&4294967295,T=A+(g<<15&4294967295|g>>>17),g=y+(A^(T|~m))+E[13]+1309151649&4294967295,y=T+(g<<21&4294967295|g>>>11),g=m+(T^(y|~A))+E[4]+4149444226&4294967295,m=y+(g<<6&4294967295|g>>>26),g=A+(y^(m|~T))+E[11]+3174756917&4294967295,A=m+(g<<10&4294967295|g>>>22),g=T+(m^(A|~y))+E[2]+718787259&4294967295,T=A+(g<<15&4294967295|g>>>17),g=y+(A^(T|~m))+E[9]+3951481745&4294967295,I.g[0]=I.g[0]+m&4294967295,I.g[1]=I.g[1]+(T+(g<<21&4294967295|g>>>11))&4294967295,I.g[2]=I.g[2]+T&4294967295,I.g[3]=I.g[3]+A&4294967295}i.prototype.u=function(I,m){m===void 0&&(m=I.length);for(var y=m-this.blockSize,E=this.B,T=this.h,A=0;A<m;){if(T==0)for(;A<=y;)s(this,I,A),A+=this.blockSize;if(typeof I=="string"){for(;A<m;)if(E[T++]=I.charCodeAt(A++),T==this.blockSize){s(this,E),T=0;break}}else for(;A<m;)if(E[T++]=I[A++],T==this.blockSize){s(this,E),T=0;break}}this.h=T,this.o+=m},i.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var m=1;m<I.length-8;++m)I[m]=0;var y=8*this.o;for(m=I.length-8;m<I.length;++m)I[m]=y&255,y/=256;for(this.u(I),I=Array(16),m=y=0;4>m;++m)for(var E=0;32>E;E+=8)I[y++]=this.g[m]>>>E&255;return I};function r(I,m){var y=l;return Object.prototype.hasOwnProperty.call(y,I)?y[I]:y[I]=m(I)}function a(I,m){this.h=m;for(var y=[],E=!0,T=I.length-1;0<=T;T--){var A=I[T]|0;E&&A==m||(y[T]=A,E=!1)}this.g=y}var l={};function u(I){return-128<=I&&128>I?r(I,function(m){return new a([m|0],0>m?-1:0)}):new a([I|0],0>I?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return _;if(0>I)return D(d(-I));for(var m=[],y=1,E=0;I>=y;E++)m[E]=I/y|0,y*=4294967296;return new a(m,0)}function p(I,m){if(I.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(I.charAt(0)=="-")return D(p(I.substring(1),m));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=d(Math.pow(m,8)),E=_,T=0;T<I.length;T+=8){var A=Math.min(8,I.length-T),g=parseInt(I.substring(T,T+A),m);8>A?(A=d(Math.pow(m,A)),E=E.j(A).add(d(g))):(E=E.j(y),E=E.add(d(g)))}return E}var _=u(0),v=u(1),S=u(16777216);n=a.prototype,n.m=function(){if(O(this))return-D(this).m();for(var I=0,m=1,y=0;y<this.g.length;y++){var E=this.i(y);I+=(0<=E?E:4294967296+E)*m,m*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(b(this))return"0";if(O(this))return"-"+D(this).toString(I);for(var m=d(Math.pow(I,6)),y=this,E="";;){var T=re(y,m).g;y=K(y,T.j(m));var A=((0<y.g.length?y.g[0]:y.h)>>>0).toString(I);if(y=T,b(y))return A+E;for(;6>A.length;)A="0"+A;E=A+E}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function b(I){if(I.h!=0)return!1;for(var m=0;m<I.g.length;m++)if(I.g[m]!=0)return!1;return!0}function O(I){return I.h==-1}n.l=function(I){return I=K(this,I),O(I)?-1:b(I)?0:1};function D(I){for(var m=I.g.length,y=[],E=0;E<m;E++)y[E]=~I.g[E];return new a(y,~I.h).add(v)}n.abs=function(){return O(this)?D(this):this},n.add=function(I){for(var m=Math.max(this.g.length,I.g.length),y=[],E=0,T=0;T<=m;T++){var A=E+(this.i(T)&65535)+(I.i(T)&65535),g=(A>>>16)+(this.i(T)>>>16)+(I.i(T)>>>16);E=g>>>16,A&=65535,g&=65535,y[T]=g<<16|A}return new a(y,y[y.length-1]&-2147483648?-1:0)};function K(I,m){return I.add(D(m))}n.j=function(I){if(b(this)||b(I))return _;if(O(this))return O(I)?D(this).j(D(I)):D(D(this).j(I));if(O(I))return D(this.j(D(I)));if(0>this.l(S)&&0>I.l(S))return d(this.m()*I.m());for(var m=this.g.length+I.g.length,y=[],E=0;E<2*m;E++)y[E]=0;for(E=0;E<this.g.length;E++)for(var T=0;T<I.g.length;T++){var A=this.i(E)>>>16,g=this.i(E)&65535,ct=I.i(T)>>>16,ei=I.i(T)&65535;y[2*E+2*T]+=g*ei,F(y,2*E+2*T),y[2*E+2*T+1]+=A*ei,F(y,2*E+2*T+1),y[2*E+2*T+1]+=g*ct,F(y,2*E+2*T+1),y[2*E+2*T+2]+=A*ct,F(y,2*E+2*T+2)}for(E=0;E<m;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=m;E<2*m;E++)y[E]=0;return new a(y,0)};function F(I,m){for(;(I[m]&65535)!=I[m];)I[m+1]+=I[m]>>>16,I[m]&=65535,m++}function W(I,m){this.g=I,this.h=m}function re(I,m){if(b(m))throw Error("division by zero");if(b(I))return new W(_,_);if(O(I))return m=re(D(I),m),new W(D(m.g),D(m.h));if(O(m))return m=re(I,D(m)),new W(D(m.g),m.h);if(30<I.g.length){if(O(I)||O(m))throw Error("slowDivide_ only works with positive integers.");for(var y=v,E=m;0>=E.l(I);)y=tt(y),E=tt(E);var T=he(y,1),A=he(E,1);for(E=he(E,2),y=he(y,2);!b(E);){var g=A.add(E);0>=g.l(I)&&(T=T.add(y),A=g),E=he(E,1),y=he(y,1)}return m=K(I,T.j(m)),new W(T,m)}for(T=_;0<=I.l(m);){for(y=Math.max(1,Math.floor(I.m()/m.m())),E=Math.ceil(Math.log(y)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),A=d(y),g=A.j(m);O(g)||0<g.l(I);)y-=E,A=d(y),g=A.j(m);b(A)&&(A=v),T=T.add(A),I=K(I,g)}return new W(T,I)}n.A=function(I){return re(this,I).h},n.and=function(I){for(var m=Math.max(this.g.length,I.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)&I.i(E);return new a(y,this.h&I.h)},n.or=function(I){for(var m=Math.max(this.g.length,I.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)|I.i(E);return new a(y,this.h|I.h)},n.xor=function(I){for(var m=Math.max(this.g.length,I.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)^I.i(E);return new a(y,this.h^I.h)};function tt(I){for(var m=I.g.length+1,y=[],E=0;E<m;E++)y[E]=I.i(E)<<1|I.i(E-1)>>>31;return new a(y,I.h)}function he(I,m){var y=m>>5;m%=32;for(var E=I.g.length-y,T=[],A=0;A<E;A++)T[A]=0<m?I.i(A+y)>>>m|I.i(A+y+1)<<32-m:I.i(A+y);return new a(T,I.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,ma=a}).apply(typeof Dc<"u"?Dc:typeof self<"u"?self:typeof window<"u"?window:{});var Ss=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Lh,Ii,xh,Ls,Vo,Fh,Uh,Bh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ss=="object"&&Ss];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var i=t(this);function s(o,c){if(c)e:{var h=i;o=o.split(".");for(var f=0;f<o.length-1;f++){var w=o[f];if(!(w in h))break e;h=h[w]}o=o[o.length-1],f=h[o],c=c(f),c!=f&&c!=null&&e(h,o,{configurable:!0,writable:!0,value:c})}}function r(o,c){o instanceof String&&(o+="");var h=0,f=!1,w={next:function(){if(!f&&h<o.length){var C=h++;return{value:c(C,o[C]),done:!1}}return f=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}s("Array.prototype.values",function(o){return o||function(){return r(this,function(c,h){return h})}});var a=a||{},l=this||self;function u(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function p(o,c,h){return o.call.apply(o.bind,arguments)}function _(o,c,h){if(!o)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,f),o.apply(c,w)}}return function(){return o.apply(c,arguments)}}function v(o,c,h){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:_,v.apply(null,arguments)}function S(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function b(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(f,w,C){for(var k=Array(arguments.length-2),X=2;X<arguments.length;X++)k[X-2]=arguments[X];return c.prototype[w].apply(f,k)}}function O(o){const c=o.length;if(0<c){const h=Array(c);for(let f=0;f<c;f++)h[f]=o[f];return h}return[]}function D(o,c){for(let h=1;h<arguments.length;h++){const f=arguments[h];if(u(f)){const w=o.length||0,C=f.length||0;o.length=w+C;for(let k=0;k<C;k++)o[w+k]=f[k]}else o.push(f)}}class K{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function F(o){return/^[\s\xa0]*$/.test(o)}function W(){var o=l.navigator;return o&&(o=o.userAgent)?o:""}function re(o){return re[" "](o),o}re[" "]=function(){};var tt=W().indexOf("Gecko")!=-1&&!(W().toLowerCase().indexOf("webkit")!=-1&&W().indexOf("Edge")==-1)&&!(W().indexOf("Trident")!=-1||W().indexOf("MSIE")!=-1)&&W().indexOf("Edge")==-1;function he(o,c,h){for(const f in o)c.call(h,o[f],f,o)}function I(o,c){for(const h in o)c.call(void 0,o[h],h,o)}function m(o){const c={};for(const h in o)c[h]=o[h];return c}const y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,c){let h,f;for(let w=1;w<arguments.length;w++){f=arguments[w];for(h in f)o[h]=f[h];for(let C=0;C<y.length;C++)h=y[C],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function T(o){var c=1;o=o.split(":");const h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){l.setTimeout(()=>{throw o},0)}function g(){var o=jr;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class ct{constructor(){this.h=this.g=null}add(c,h){const f=ei.get();f.set(c,h),this.h?this.h.next=f:this.g=f,this.h=f}}var ei=new K(()=>new Op,o=>o.reset());class Op{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let ti,ni=!1,jr=new ct,vl=()=>{const o=l.Promise.resolve(void 0);ti=()=>{o.then(Mp)}};var Mp=()=>{for(var o;o=g();){try{o.h.call(o.g)}catch(h){A(h)}var c=ei;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}ni=!1};function St(){this.s=this.s,this.C=this.C}St.prototype.s=!1,St.prototype.ma=function(){this.s||(this.s=!0,this.N())},St.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ie(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}Ie.prototype.h=function(){this.defaultPrevented=!0};var Vp=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};l.addEventListener("test",h,c),l.removeEventListener("test",h,c)}catch{}return o})();function ii(o,c){if(Ie.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(tt){e:{try{re(c.nodeName);var w=!0;break e}catch{}w=!1}w||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Lp[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&ii.aa.h.call(this)}}b(ii,Ie);var Lp={2:"touch",3:"pen",4:"mouse"};ii.prototype.h=function(){ii.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var as="closure_listenable_"+(1e6*Math.random()|0),xp=0;function Fp(o,c,h,f,w){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!f,this.ha=w,this.key=++xp,this.da=this.fa=!1}function ls(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function cs(o){this.src=o,this.g={},this.h=0}cs.prototype.add=function(o,c,h,f,w){var C=o.toString();o=this.g[C],o||(o=this.g[C]=[],this.h++);var k=$r(o,c,f,w);return-1<k?(c=o[k],h||(c.fa=!1)):(c=new Fp(c,this.src,C,!!f,w),c.fa=h,o.push(c)),c};function Wr(o,c){var h=c.type;if(h in o.g){var f=o.g[h],w=Array.prototype.indexOf.call(f,c,void 0),C;(C=0<=w)&&Array.prototype.splice.call(f,w,1),C&&(ls(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function $r(o,c,h,f){for(var w=0;w<o.length;++w){var C=o[w];if(!C.da&&C.listener==c&&C.capture==!!h&&C.ha==f)return w}return-1}var Hr="closure_lm_"+(1e6*Math.random()|0),qr={};function El(o,c,h,f,w){if(Array.isArray(c)){for(var C=0;C<c.length;C++)El(o,c[C],h,f,w);return null}return h=wl(h),o&&o[as]?o.K(c,h,d(f)?!!f.capture:!1,w):Up(o,c,h,!1,f,w)}function Up(o,c,h,f,w,C){if(!c)throw Error("Invalid event type");var k=d(w)?!!w.capture:!!w,X=Gr(o);if(X||(o[Hr]=X=new cs(o)),h=X.add(c,h,f,k,C),h.proxy)return h;if(f=Bp(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)Vp||(w=k),w===void 0&&(w=!1),o.addEventListener(c.toString(),f,w);else if(o.attachEvent)o.attachEvent(Il(c.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Bp(){function o(h){return c.call(o.src,o.listener,h)}const c=jp;return o}function Tl(o,c,h,f,w){if(Array.isArray(c))for(var C=0;C<c.length;C++)Tl(o,c[C],h,f,w);else f=d(f)?!!f.capture:!!f,h=wl(h),o&&o[as]?(o=o.i,c=String(c).toString(),c in o.g&&(C=o.g[c],h=$r(C,h,f,w),-1<h&&(ls(C[h]),Array.prototype.splice.call(C,h,1),C.length==0&&(delete o.g[c],o.h--)))):o&&(o=Gr(o))&&(c=o.g[c.toString()],o=-1,c&&(o=$r(c,h,f,w)),(h=-1<o?c[o]:null)&&zr(h))}function zr(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[as])Wr(c.i,o);else{var h=o.type,f=o.proxy;c.removeEventListener?c.removeEventListener(h,f,o.capture):c.detachEvent?c.detachEvent(Il(h),f):c.addListener&&c.removeListener&&c.removeListener(f),(h=Gr(c))?(Wr(h,o),h.h==0&&(h.src=null,c[Hr]=null)):ls(o)}}}function Il(o){return o in qr?qr[o]:qr[o]="on"+o}function jp(o,c){if(o.da)o=!0;else{c=new ii(c,this);var h=o.listener,f=o.ha||o.src;o.fa&&zr(o),o=h.call(f,c)}return o}function Gr(o){return o=o[Hr],o instanceof cs?o:null}var Kr="__closure_events_fn_"+(1e9*Math.random()>>>0);function wl(o){return typeof o=="function"?o:(o[Kr]||(o[Kr]=function(c){return o.handleEvent(c)}),o[Kr])}function we(){St.call(this),this.i=new cs(this),this.M=this,this.F=null}b(we,St),we.prototype[as]=!0,we.prototype.removeEventListener=function(o,c,h,f){Tl(this,o,c,h,f)};function Me(o,c){var h,f=o.F;if(f)for(h=[];f;f=f.F)h.push(f);if(o=o.M,f=c.type||c,typeof c=="string")c=new Ie(c,o);else if(c instanceof Ie)c.target=c.target||o;else{var w=c;c=new Ie(f,o),E(c,w)}if(w=!0,h)for(var C=h.length-1;0<=C;C--){var k=c.g=h[C];w=us(k,f,!0,c)&&w}if(k=c.g=o,w=us(k,f,!0,c)&&w,w=us(k,f,!1,c)&&w,h)for(C=0;C<h.length;C++)k=c.g=h[C],w=us(k,f,!1,c)&&w}we.prototype.N=function(){if(we.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],f=0;f<h.length;f++)ls(h[f]);delete o.g[c],o.h--}}this.F=null},we.prototype.K=function(o,c,h,f){return this.i.add(String(o),c,!1,h,f)},we.prototype.L=function(o,c,h,f){return this.i.add(String(o),c,!0,h,f)};function us(o,c,h,f){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var w=!0,C=0;C<c.length;++C){var k=c[C];if(k&&!k.da&&k.capture==h){var X=k.listener,ge=k.ha||k.src;k.fa&&Wr(o.i,k),w=X.call(ge,f)!==!1&&w}}return w&&!f.defaultPrevented}function Al(o,c,h){if(typeof o=="function")h&&(o=v(o,h));else if(o&&typeof o.handleEvent=="function")o=v(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:l.setTimeout(o,c||0)}function Cl(o){o.g=Al(()=>{o.g=null,o.i&&(o.i=!1,Cl(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class Wp extends St{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Cl(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function si(o){St.call(this),this.h=o,this.g={}}b(si,St);var Sl=[];function Rl(o){he(o.g,function(c,h){this.g.hasOwnProperty(h)&&zr(c)},o),o.g={}}si.prototype.N=function(){si.aa.N.call(this),Rl(this)},si.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Qr=l.JSON.stringify,$p=l.JSON.parse,Hp=class{stringify(o){return l.JSON.stringify(o,void 0)}parse(o){return l.JSON.parse(o,void 0)}};function Yr(){}Yr.prototype.h=null;function bl(o){return o.h||(o.h=o.i())}function Pl(){}var ri={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Xr(){Ie.call(this,"d")}b(Xr,Ie);function Jr(){Ie.call(this,"c")}b(Jr,Ie);var Gt={},kl=null;function hs(){return kl=kl||new we}Gt.La="serverreachability";function Nl(o){Ie.call(this,Gt.La,o)}b(Nl,Ie);function oi(o){const c=hs();Me(c,new Nl(c))}Gt.STAT_EVENT="statevent";function Dl(o,c){Ie.call(this,Gt.STAT_EVENT,o),this.stat=c}b(Dl,Ie);function Ve(o){const c=hs();Me(c,new Dl(c,o))}Gt.Ma="timingevent";function Ol(o,c){Ie.call(this,Gt.Ma,o),this.size=c}b(Ol,Ie);function ai(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){o()},c)}function li(){this.g=!0}li.prototype.xa=function(){this.g=!1};function qp(o,c,h,f,w,C){o.info(function(){if(o.g)if(C)for(var k="",X=C.split("&"),ge=0;ge<X.length;ge++){var G=X[ge].split("=");if(1<G.length){var Ae=G[0];G=G[1];var Ce=Ae.split("_");k=2<=Ce.length&&Ce[1]=="type"?k+(Ae+"="+G+"&"):k+(Ae+"=redacted&")}}else k=null;else k=C;return"XMLHTTP REQ ("+f+") [attempt "+w+"]: "+c+`
`+h+`
`+k})}function zp(o,c,h,f,w,C,k){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+w+"]: "+c+`
`+h+`
`+C+" "+k})}function En(o,c,h,f){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Kp(o,h)+(f?" "+f:"")})}function Gp(o,c){o.info(function(){return"TIMEOUT: "+c})}li.prototype.info=function(){};function Kp(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var f=h[o];if(!(2>f.length)){var w=f[1];if(Array.isArray(w)&&!(1>w.length)){var C=w[0];if(C!="noop"&&C!="stop"&&C!="close")for(var k=1;k<w.length;k++)w[k]=""}}}}return Qr(h)}catch{return c}}var ds={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ml={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Zr;function fs(){}b(fs,Yr),fs.prototype.g=function(){return new XMLHttpRequest},fs.prototype.i=function(){return{}},Zr=new fs;function Rt(o,c,h,f){this.j=o,this.i=c,this.l=h,this.R=f||1,this.U=new si(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Vl}function Vl(){this.i=null,this.g="",this.h=!1}var Ll={},eo={};function to(o,c,h){o.L=1,o.v=gs(ut(c)),o.m=h,o.P=!0,xl(o,null)}function xl(o,c){o.F=Date.now(),ps(o),o.A=ut(o.v);var h=o.A,f=o.R;Array.isArray(f)||(f=[String(f)]),Xl(h.i,"t",f),o.C=0,h=o.j.J,o.h=new Vl,o.g=_c(o.j,h?c:null,!o.m),0<o.O&&(o.M=new Wp(v(o.Y,o,o.g),o.O)),c=o.U,h=o.g,f=o.ca;var w="readystatechange";Array.isArray(w)||(w&&(Sl[0]=w.toString()),w=Sl);for(var C=0;C<w.length;C++){var k=El(h,w[C],f||c.handleEvent,!1,c.h||c);if(!k)break;c.g[k.key]=k}c=o.H?m(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),oi(),qp(o.i,o.u,o.A,o.l,o.R,o.m)}Rt.prototype.ca=function(o){o=o.target;const c=this.M;c&&ht(o)==3?c.j():this.Y(o)},Rt.prototype.Y=function(o){try{if(o==this.g)e:{const Ce=ht(this.g);var c=this.g.Ba();const wn=this.g.Z();if(!(3>Ce)&&(Ce!=3||this.g&&(this.h.h||this.g.oa()||sc(this.g)))){this.J||Ce!=4||c==7||(c==8||0>=wn?oi(3):oi(2)),no(this);var h=this.g.Z();this.X=h;t:if(Fl(this)){var f=sc(this.g);o="";var w=f.length,C=ht(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Kt(this),ci(this);var k="";break t}this.h.i=new l.TextDecoder}for(c=0;c<w;c++)this.h.h=!0,o+=this.h.i.decode(f[c],{stream:!(C&&c==w-1)});f.length=0,this.h.g+=o,this.C=0,k=this.h.g}else k=this.g.oa();if(this.o=h==200,zp(this.i,this.u,this.A,this.l,this.R,Ce,h),this.o){if(this.T&&!this.K){t:{if(this.g){var X,ge=this.g;if((X=ge.g?ge.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(X)){var G=X;break t}}G=null}if(h=G)En(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,io(this,h);else{this.o=!1,this.s=3,Ve(12),Kt(this),ci(this);break e}}if(this.P){h=!0;let He;for(;!this.J&&this.C<k.length;)if(He=Qp(this,k),He==eo){Ce==4&&(this.s=4,Ve(14),h=!1),En(this.i,this.l,null,"[Incomplete Response]");break}else if(He==Ll){this.s=4,Ve(15),En(this.i,this.l,k,"[Invalid Chunk]"),h=!1;break}else En(this.i,this.l,He,null),io(this,He);if(Fl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ce!=4||k.length!=0||this.h.h||(this.s=1,Ve(16),h=!1),this.o=this.o&&h,!h)En(this.i,this.l,k,"[Invalid Chunked Response]"),Kt(this),ci(this);else if(0<k.length&&!this.W){this.W=!0;var Ae=this.j;Ae.g==this&&Ae.ba&&!Ae.M&&(Ae.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),co(Ae),Ae.M=!0,Ve(11))}}else En(this.i,this.l,k,null),io(this,k);Ce==4&&Kt(this),this.o&&!this.J&&(Ce==4?hc(this.j,this):(this.o=!1,ps(this)))}else d_(this.g),h==400&&0<k.indexOf("Unknown SID")?(this.s=3,Ve(12)):(this.s=0,Ve(13)),Kt(this),ci(this)}}}catch{}};function Fl(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Qp(o,c){var h=o.C,f=c.indexOf(`
`,h);return f==-1?eo:(h=Number(c.substring(h,f)),isNaN(h)?Ll:(f+=1,f+h>c.length?eo:(c=c.slice(f,f+h),o.C=f+h,c)))}Rt.prototype.cancel=function(){this.J=!0,Kt(this)};function ps(o){o.S=Date.now()+o.I,Ul(o,o.I)}function Ul(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=ai(v(o.ba,o),c)}function no(o){o.B&&(l.clearTimeout(o.B),o.B=null)}Rt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(Gp(this.i,this.A),this.L!=2&&(oi(),Ve(17)),Kt(this),this.s=2,ci(this)):Ul(this,this.S-o)};function ci(o){o.j.G==0||o.J||hc(o.j,o)}function Kt(o){no(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Rl(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function io(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||so(h.h,o))){if(!o.K&&so(h.h,o)&&h.G==3){try{var f=h.Da.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var w=f;if(w[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)ws(h),Ts(h);else break e;lo(h),Ve(18)}}else h.za=w[1],0<h.za-h.T&&37500>w[2]&&h.F&&h.v==0&&!h.C&&(h.C=ai(v(h.Za,h),6e3));if(1>=Wl(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Yt(h,11)}else if((o.K||h.g==o)&&ws(h),!F(c))for(w=h.Da.g.parse(c),c=0;c<w.length;c++){let G=w[c];if(h.T=G[0],G=G[1],h.G==2)if(G[0]=="c"){h.K=G[1],h.ia=G[2];const Ae=G[3];Ae!=null&&(h.la=Ae,h.j.info("VER="+h.la));const Ce=G[4];Ce!=null&&(h.Aa=Ce,h.j.info("SVER="+h.Aa));const wn=G[5];wn!=null&&typeof wn=="number"&&0<wn&&(f=1.5*wn,h.L=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;const He=o.g;if(He){const Cs=He.g?He.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Cs){var C=f.h;C.g||Cs.indexOf("spdy")==-1&&Cs.indexOf("quic")==-1&&Cs.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(ro(C,C.h),C.h=null))}if(f.D){const uo=He.g?He.g.getResponseHeader("X-HTTP-Session-Id"):null;uo&&(f.ya=uo,Z(f.I,f.D,uo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),f=h;var k=o;if(f.qa=pc(f,f.J?f.ia:null,f.W),k.K){$l(f.h,k);var X=k,ge=f.L;ge&&(X.I=ge),X.B&&(no(X),ps(X)),f.g=k}else cc(f);0<h.i.length&&Is(h)}else G[0]!="stop"&&G[0]!="close"||Yt(h,7);else h.G==3&&(G[0]=="stop"||G[0]=="close"?G[0]=="stop"?Yt(h,7):ao(h):G[0]!="noop"&&h.l&&h.l.ta(G),h.v=0)}}oi(4)}catch{}}var Yp=class{constructor(o,c){this.g=o,this.map=c}};function Bl(o){this.l=o||10,l.PerformanceNavigationTiming?(o=l.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function jl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Wl(o){return o.h?1:o.g?o.g.size:0}function so(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function ro(o,c){o.g?o.g.add(c):o.h=c}function $l(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}Bl.prototype.cancel=function(){if(this.i=Hl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Hl(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const h of o.g.values())c=c.concat(h.D);return c}return O(o.i)}function Xp(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(u(o)){for(var c=[],h=o.length,f=0;f<h;f++)c.push(o[f]);return c}c=[],h=0;for(f in o)c[h++]=o[f];return c}function Jp(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(u(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(const f in o)c[h++]=f;return c}}}function ql(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(u(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=Jp(o),f=Xp(o),w=f.length,C=0;C<w;C++)c.call(void 0,f[C],h&&h[C],o)}var zl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zp(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var f=o[h].indexOf("="),w=null;if(0<=f){var C=o[h].substring(0,f);w=o[h].substring(f+1)}else C=o[h];c(C,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}function Qt(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Qt){this.h=o.h,_s(this,o.j),this.o=o.o,this.g=o.g,ms(this,o.s),this.l=o.l;var c=o.i,h=new di;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),Gl(this,h),this.m=o.m}else o&&(c=String(o).match(zl))?(this.h=!1,_s(this,c[1]||"",!0),this.o=ui(c[2]||""),this.g=ui(c[3]||"",!0),ms(this,c[4]),this.l=ui(c[5]||"",!0),Gl(this,c[6]||"",!0),this.m=ui(c[7]||"")):(this.h=!1,this.i=new di(null,this.h))}Qt.prototype.toString=function(){var o=[],c=this.j;c&&o.push(hi(c,Kl,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(hi(c,Kl,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(hi(h,h.charAt(0)=="/"?n_:t_,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",hi(h,s_)),o.join("")};function ut(o){return new Qt(o)}function _s(o,c,h){o.j=h?ui(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function ms(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Gl(o,c,h){c instanceof di?(o.i=c,r_(o.i,o.h)):(h||(c=hi(c,i_)),o.i=new di(c,o.h))}function Z(o,c,h){o.i.set(c,h)}function gs(o){return Z(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function ui(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function hi(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,e_),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function e_(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Kl=/[#\/\?@]/g,t_=/[#\?:]/g,n_=/[#\?]/g,i_=/[#\?@]/g,s_=/#/g;function di(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function bt(o){o.g||(o.g=new Map,o.h=0,o.i&&Zp(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=di.prototype,n.add=function(o,c){bt(this),this.i=null,o=Tn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Ql(o,c){bt(o),c=Tn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Yl(o,c){return bt(o),c=Tn(o,c),o.g.has(c)}n.forEach=function(o,c){bt(this),this.g.forEach(function(h,f){h.forEach(function(w){o.call(c,w,f,this)},this)},this)},n.na=function(){bt(this);const o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let f=0;f<c.length;f++){const w=o[f];for(let C=0;C<w.length;C++)h.push(c[f])}return h},n.V=function(o){bt(this);let c=[];if(typeof o=="string")Yl(this,o)&&(c=c.concat(this.g.get(Tn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},n.set=function(o,c){return bt(this),this.i=null,o=Tn(this,o),Yl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function Xl(o,c,h){Ql(o,c),0<h.length&&(o.i=null,o.g.set(Tn(o,c),O(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var f=c[h];const C=encodeURIComponent(String(f)),k=this.V(f);for(f=0;f<k.length;f++){var w=C;k[f]!==""&&(w+="="+encodeURIComponent(String(k[f]))),o.push(w)}}return this.i=o.join("&")};function Tn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function r_(o,c){c&&!o.j&&(bt(o),o.i=null,o.g.forEach(function(h,f){var w=f.toLowerCase();f!=w&&(Ql(this,f),Xl(this,w,h))},o)),o.j=c}function o_(o,c){const h=new li;if(l.Image){const f=new Image;f.onload=S(Pt,h,"TestLoadImage: loaded",!0,c,f),f.onerror=S(Pt,h,"TestLoadImage: error",!1,c,f),f.onabort=S(Pt,h,"TestLoadImage: abort",!1,c,f),f.ontimeout=S(Pt,h,"TestLoadImage: timeout",!1,c,f),l.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else c(!1)}function a_(o,c){const h=new li,f=new AbortController,w=setTimeout(()=>{f.abort(),Pt(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:f.signal}).then(C=>{clearTimeout(w),C.ok?Pt(h,"TestPingServer: ok",!0,c):Pt(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),Pt(h,"TestPingServer: error",!1,c)})}function Pt(o,c,h,f,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),f(h)}catch{}}function l_(){this.g=new Hp}function c_(o,c,h){const f=h||"";try{ql(o,function(w,C){let k=w;d(w)&&(k=Qr(w)),c.push(f+C+"="+encodeURIComponent(k))})}catch(w){throw c.push(f+"type="+encodeURIComponent("_badmap")),w}}function ys(o){this.l=o.Ub||null,this.j=o.eb||!1}b(ys,Yr),ys.prototype.g=function(){return new vs(this.l,this.j)},ys.prototype.i=(function(o){return function(){return o}})({});function vs(o,c){we.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}b(vs,we),n=vs.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,pi(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||l).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fi(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,pi(this)),this.g&&(this.readyState=3,pi(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Jl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Jl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?fi(this):pi(this),this.readyState==3&&Jl(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,fi(this))},n.Qa=function(o){this.g&&(this.response=o,fi(this))},n.ga=function(){this.g&&fi(this)};function fi(o){o.readyState=4,o.l=null,o.j=null,o.v=null,pi(o)}n.setRequestHeader=function(o,c){this.u.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function pi(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(vs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Zl(o){let c="";return he(o,function(h,f){c+=f,c+=":",c+=h,c+=`\r
`}),c}function oo(o,c,h){e:{for(f in h){var f=!1;break e}f=!0}f||(h=Zl(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):Z(o,c,h))}function ae(o){we.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}b(ae,we);var u_=/^https?$/i,h_=["POST","PUT"];n=ae.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,c,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Zr.g(),this.v=this.o?bl(this.o):bl(Zr),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(C){ec(this,C);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var w in f)h.set(w,f[w]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const C of f.keys())h.set(C,f.get(C));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(C=>C.toLowerCase()=="content-type"),w=l.FormData&&o instanceof l.FormData,!(0<=Array.prototype.indexOf.call(h_,c,void 0))||f||w||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[C,k]of h)this.g.setRequestHeader(C,k);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ic(this),this.u=!0,this.g.send(o),this.u=!1}catch(C){ec(this,C)}};function ec(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,tc(o),Es(o)}function tc(o){o.A||(o.A=!0,Me(o,"complete"),Me(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Me(this,"complete"),Me(this,"abort"),Es(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Es(this,!0)),ae.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?nc(this):this.bb())},n.bb=function(){nc(this)};function nc(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ht(o)!=4||o.Z()!=2)){if(o.u&&ht(o)==4)Al(o.Ea,0,o);else if(Me(o,"readystatechange"),ht(o)==4){o.h=!1;try{const k=o.Z();e:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var f;if(f=k===0){var w=String(o.D).match(zl)[1]||null;!w&&l.self&&l.self.location&&(w=l.self.location.protocol.slice(0,-1)),f=!u_.test(w?w.toLowerCase():"")}h=f}if(h)Me(o,"complete"),Me(o,"success");else{o.m=6;try{var C=2<ht(o)?o.g.statusText:""}catch{C=""}o.l=C+" ["+o.Z()+"]",tc(o)}}finally{Es(o)}}}}function Es(o,c){if(o.g){ic(o);const h=o.g,f=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Me(o,"ready");try{h.onreadystatechange=f}catch{}}}function ic(o){o.I&&(l.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function ht(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<ht(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),$p(c)}};function sc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function d_(o){const c={};o=(o.g&&2<=ht(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(F(o[f]))continue;var h=T(o[f]);const w=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const C=c[w]||[];c[w]=C,C.push(h)}I(c,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function _i(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function rc(o){this.Aa=0,this.i=[],this.j=new li,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=_i("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=_i("baseRetryDelayMs",5e3,o),this.cb=_i("retryDelaySeedMs",1e4,o),this.Wa=_i("forwardChannelMaxRetries",2,o),this.wa=_i("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Bl(o&&o.concurrentRequestLimit),this.Da=new l_,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=rc.prototype,n.la=8,n.G=1,n.connect=function(o,c,h,f){Ve(0),this.W=o,this.H=c||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.I=pc(this,null,this.W),Is(this)};function ao(o){if(oc(o),o.G==3){var c=o.U++,h=ut(o.I);if(Z(h,"SID",o.K),Z(h,"RID",c),Z(h,"TYPE","terminate"),mi(o,h),c=new Rt(o,o.j,c),c.L=2,c.v=gs(ut(h)),h=!1,l.navigator&&l.navigator.sendBeacon)try{h=l.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&l.Image&&(new Image().src=c.v,h=!0),h||(c.g=_c(c.j,null),c.g.ea(c.v)),c.F=Date.now(),ps(c)}fc(o)}function Ts(o){o.g&&(co(o),o.g.cancel(),o.g=null)}function oc(o){Ts(o),o.u&&(l.clearTimeout(o.u),o.u=null),ws(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&l.clearTimeout(o.s),o.s=null)}function Is(o){if(!jl(o.h)&&!o.s){o.s=!0;var c=o.Ga;ti||vl(),ni||(ti(),ni=!0),jr.add(c,o),o.B=0}}function f_(o,c){return Wl(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=ai(v(o.Ga,o,c),dc(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const w=new Rt(this,this.j,o);let C=this.o;if(this.S&&(C?(C=m(C),E(C,this.S)):C=this.S),this.m!==null||this.O||(w.H=C,C=null),this.P)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,4096<c){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=lc(this,w,c),h=ut(this.I),Z(h,"RID",o),Z(h,"CVER",22),this.D&&Z(h,"X-HTTP-Session-Id",this.D),mi(this,h),C&&(this.O?c="headers="+encodeURIComponent(String(Zl(C)))+"&"+c:this.m&&oo(h,this.m,C)),ro(this.h,w),this.Ua&&Z(h,"TYPE","init"),this.P?(Z(h,"$req",c),Z(h,"SID","null"),w.T=!0,to(w,h,null)):to(w,h,c),this.G=2}}else this.G==3&&(o?ac(this,o):this.i.length==0||jl(this.h)||ac(this))};function ac(o,c){var h;c?h=c.l:h=o.U++;const f=ut(o.I);Z(f,"SID",o.K),Z(f,"RID",h),Z(f,"AID",o.T),mi(o,f),o.m&&o.o&&oo(f,o.m,o.o),h=new Rt(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=lc(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),ro(o.h,h),to(h,f,c)}function mi(o,c){o.H&&he(o.H,function(h,f){Z(c,f,h)}),o.l&&ql({},function(h,f){Z(c,f,h)})}function lc(o,c,h){h=Math.min(o.i.length,h);var f=o.l?v(o.l.Na,o.l,o):null;e:{var w=o.i;let C=-1;for(;;){const k=["count="+h];C==-1?0<h?(C=w[0].g,k.push("ofs="+C)):C=0:k.push("ofs="+C);let X=!0;for(let ge=0;ge<h;ge++){let G=w[ge].g;const Ae=w[ge].map;if(G-=C,0>G)C=Math.max(0,w[ge].g-100),X=!1;else try{c_(Ae,k,"req"+G+"_")}catch{f&&f(Ae)}}if(X){f=k.join("&");break e}}}return o=o.i.splice(0,h),c.D=o,f}function cc(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;ti||vl(),ni||(ti(),ni=!0),jr.add(c,o),o.v=0}}function lo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=ai(v(o.Fa,o),dc(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,uc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=ai(v(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ve(10),Ts(this),uc(this))};function co(o){o.A!=null&&(l.clearTimeout(o.A),o.A=null)}function uc(o){o.g=new Rt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=ut(o.qa);Z(c,"RID","rpc"),Z(c,"SID",o.K),Z(c,"AID",o.T),Z(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&Z(c,"TO",o.ja),Z(c,"TYPE","xmlhttp"),mi(o,c),o.m&&o.o&&oo(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=gs(ut(c)),h.m=null,h.P=!0,xl(h,o)}n.Za=function(){this.C!=null&&(this.C=null,Ts(this),lo(this),Ve(19))};function ws(o){o.C!=null&&(l.clearTimeout(o.C),o.C=null)}function hc(o,c){var h=null;if(o.g==c){ws(o),co(o),o.g=null;var f=2}else if(so(o.h,c))h=c.D,$l(o.h,c),f=1;else return;if(o.G!=0){if(c.o)if(f==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var w=o.B;f=hs(),Me(f,new Ol(f,h)),Is(o)}else cc(o);else if(w=c.s,w==3||w==0&&0<c.X||!(f==1&&f_(o,c)||f==2&&lo(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),w){case 1:Yt(o,5);break;case 4:Yt(o,10);break;case 3:Yt(o,6);break;default:Yt(o,2)}}}function dc(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function Yt(o,c){if(o.j.info("Error code "+c),c==2){var h=v(o.fb,o),f=o.Xa;const w=!f;f=new Qt(f||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||_s(f,"https"),gs(f),w?o_(f.toString(),h):a_(f.toString(),h)}else Ve(2);o.G=0,o.l&&o.l.sa(c),fc(o),oc(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ve(2)):(this.j.info("Failed to ping google.com"),Ve(1))};function fc(o){if(o.G=0,o.ka=[],o.l){const c=Hl(o.h);(c.length!=0||o.i.length!=0)&&(D(o.ka,c),D(o.ka,o.i),o.h.i.length=0,O(o.i),o.i.length=0),o.l.ra()}}function pc(o,c,h){var f=h instanceof Qt?ut(h):new Qt(h);if(f.g!="")c&&(f.g=c+"."+f.g),ms(f,f.s);else{var w=l.location;f=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;var C=new Qt(null);f&&_s(C,f),c&&(C.g=c),w&&ms(C,w),h&&(C.l=h),f=C}return h=o.D,c=o.ya,h&&c&&Z(f,h,c),Z(f,"VER",o.la),mi(o,f),f}function _c(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new ae(new ys({eb:h})):new ae(o.pa),c.Ha(o.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function mc(){}n=mc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function As(){}As.prototype.g=function(o,c){return new Ue(o,c)};function Ue(o,c){we.call(this),this.g=new rc(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!F(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!F(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new In(this)}b(Ue,we),Ue.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ue.prototype.close=function(){ao(this.g)},Ue.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=Qr(o),o=h);c.i.push(new Yp(c.Ya++,o)),c.G==3&&Is(c)},Ue.prototype.N=function(){this.g.l=null,delete this.j,ao(this.g),delete this.g,Ue.aa.N.call(this)};function gc(o){Xr.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const h in c){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}b(gc,Xr);function yc(){Jr.call(this),this.status=1}b(yc,Jr);function In(o){this.g=o}b(In,mc),In.prototype.ua=function(){Me(this.g,"a")},In.prototype.ta=function(o){Me(this.g,new gc(o))},In.prototype.sa=function(o){Me(this.g,new yc)},In.prototype.ra=function(){Me(this.g,"b")},As.prototype.createWebChannel=As.prototype.g,Ue.prototype.send=Ue.prototype.o,Ue.prototype.open=Ue.prototype.m,Ue.prototype.close=Ue.prototype.close,Bh=function(){return new As},Uh=function(){return hs()},Fh=Gt,Vo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ds.NO_ERROR=0,ds.TIMEOUT=8,ds.HTTP_ERROR=6,Ls=ds,Ml.COMPLETE="complete",xh=Ml,Pl.EventType=ri,ri.OPEN="a",ri.CLOSE="b",ri.ERROR="c",ri.MESSAGE="d",we.prototype.listen=we.prototype.K,Ii=Pl,ae.prototype.listenOnce=ae.prototype.L,ae.prototype.getLastError=ae.prototype.Ka,ae.prototype.getLastErrorCode=ae.prototype.Ba,ae.prototype.getStatus=ae.prototype.Z,ae.prototype.getResponseJson=ae.prototype.Oa,ae.prototype.getResponseText=ae.prototype.oa,ae.prototype.send=ae.prototype.ea,ae.prototype.setWithCredentials=ae.prototype.Ha,Lh=ae}).apply(typeof Ss<"u"?Ss:typeof self<"u"?self:typeof window<"u"?window:{});const Oc="@firebase/firestore",Mc="4.8.0";class Re{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Re.UNAUTHENTICATED=new Re(null),Re.GOOGLE_CREDENTIALS=new Re("google-credentials-uid"),Re.FIRST_PARTY=new Re("first-party-uid"),Re.MOCK_USER=new Re("mock-user");let Kn="11.10.0";const an=new Ir("@firebase/firestore");function Cn(){return an.logLevel}function M(n,...e){if(an.logLevel<=B.DEBUG){const t=e.map(ga);an.debug(`Firestore (${Kn}): ${n}`,...t)}}function ln(n,...e){if(an.logLevel<=B.ERROR){const t=e.map(ga);an.error(`Firestore (${Kn}): ${n}`,...t)}}function xn(n,...e){if(an.logLevel<=B.WARN){const t=e.map(ga);an.warn(`Firestore (${Kn}): ${n}`,...t)}}function ga(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function U(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,jh(n,i,t)}function jh(n,e,t){let i=`FIRESTORE (${Kn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw ln(i),new Error(i)}function le(n,e,t,i){let s="Unexpected state";typeof t=="string"?s=t:i=t,n||jh(e,s,i)}function J(n,e){return n}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends At{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Wh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class fg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Re.UNAUTHENTICATED)))}shutdown(){}}class pg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class _g{constructor(e){this.t=e,this.currentUser=Re.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){le(this.o===void 0,42304);let i=this.i;const s=u=>this.i!==i?(i=this.i,t(u)):Promise.resolve();let r=new nn;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new nn,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=r;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},l=u=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new nn)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(le(typeof i.accessToken=="string",31837,{l:i}),new Wh(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return le(e===null||typeof e=="string",2055,{h:e}),new Re(e)}}class mg{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=Re.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class gg{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new mg(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Re.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Vc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class yg{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,je(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){le(this.o===void 0,3512);const i=r=>{r.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const a=r.token!==this.m;return this.m=r.token,M("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable((()=>i(r)))};const s=r=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((r=>s(r))),setTimeout((()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?s(r):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Vc(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(le(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Vc(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function vg(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}function Eg(){return new TextEncoder}class ya{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const s=vg(40);for(let r=0;r<s.length;++r)i.length<20&&s[r]<t&&(i+=e.charAt(s[r]%62))}return i}}function z(n,e){return n<e?-1:n>e?1:0}function Lo(n,e){let t=0;for(;t<n.length&&t<e.length;){const i=n.codePointAt(t),s=e.codePointAt(t);if(i!==s){if(i<128&&s<128)return z(i,s);{const r=Eg(),a=Tg(r.encode(Lc(n,t)),r.encode(Lc(e,t)));return a!==0?a:z(i,s)}}t+=i>65535?2:1}return z(n.length,e.length)}function Lc(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function Tg(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return z(n[t],e[t]);return z(n.length,e.length)}function Fn(n,e,t){return n.length===e.length&&n.every(((i,s)=>t(i,e[s])))}const xc="__name__";class nt{constructor(e,t,i){t===void 0?t=0:t>e.length&&U(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&U(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return nt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof nt?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const r=nt.compareSegments(e.get(s),t.get(s));if(r!==0)return r}return z(e.length,t.length)}static compareSegments(e,t){const i=nt.isNumericId(e),s=nt.isNumericId(t);return i&&!s?-1:!i&&s?1:i&&s?nt.extractNumericId(e).compare(nt.extractNumericId(t)):Lo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ma.fromString(e.substring(4,e.length-2))}}class oe extends nt{construct(e,t,i){return new oe(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new V(P.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((s=>s.length>0)))}return new oe(t)}static emptyPath(){return new oe([])}}const Ig=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ee extends nt{construct(e,t,i){return new Ee(e,t,i)}static isValidIdentifier(e){return Ig.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ee.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xc}static keyField(){return new Ee([xc])}static fromServerFormat(e){const t=[];let i="",s=0;const r=()=>{if(i.length===0)throw new V(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new V(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new V(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(i+=l,s++):(r(),s++)}if(r(),a)throw new V(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ee(t)}static emptyPath(){return new Ee([])}}class x{constructor(e){this.path=e}static fromPath(e){return new x(oe.fromString(e))}static fromName(e){return new x(oe.fromString(e).popFirst(5))}static empty(){return new x(oe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&oe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return oe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new x(new oe(e.slice()))}}function $h(n,e,t){if(!t)throw new V(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function wg(n,e,t,i){if(e===!0&&i===!0)throw new V(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Fc(n){if(!x.isDocumentKey(n))throw new V(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Uc(n){if(x.isDocumentKey(n))throw new V(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Hh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function va(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U(12329,{type:typeof n})}function qh(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=va(n);throw new V(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ue(n,e){const t={typeString:n};return e&&(t.value=e),t}function Gi(n,e){if(!Hh(n))throw new V(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const s=e[i].typeString,r="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const a=n[i];if(s&&typeof a!==s){t=`JSON field '${i}' must be a ${s}.`;break}if(r!==void 0&&a!==r.value){t=`Expected '${i}' field to equal '${r.value}'`;break}}if(t)throw new V(P.INVALID_ARGUMENT,t);return!0}const Bc=-62135596800,jc=1e6;class se{static now(){return se.fromMillis(Date.now())}static fromDate(e){return se.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*jc);return new se(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Bc)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/jc}_compareTo(e){return this.seconds===e.seconds?z(this.nanoseconds,e.nanoseconds):z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:se._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Gi(e,se._jsonSchema))return new se(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Bc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}se._jsonSchemaVersion="firestore/timestamp/1.0",se._jsonSchema={type:ue("string",se._jsonSchemaVersion),seconds:ue("number"),nanoseconds:ue("number")};class ie{static fromTimestamp(e){return new ie(e)}static min(){return new ie(new se(0,0))}static max(){return new ie(new se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const xi=-1;function Ag(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=ie.fromTimestamp(i===1e9?new se(t+1,0):new se(t,i));return new jt(s,x.empty(),e)}function Cg(n){return new jt(n.readTime,n.key,xi)}class jt{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new jt(ie.min(),x.empty(),xi)}static max(){return new jt(ie.max(),x.empty(),xi)}}function Sg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=x.comparator(n.documentKey,e.documentKey),t!==0?t:z(n.largestBatchId,e.largestBatchId))}const Rg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bg{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ea(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==Rg)throw n;M("LocalStore","Unexpectedly lost primary lease")}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R(((i,s)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(i,s)},this.catchCallback=r=>{this.wrapFailure(t,r).next(i,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):R.reject(t)}static resolve(e){return new R(((t,i)=>{t(e)}))}static reject(e){return new R(((t,i)=>{i(e)}))}static waitFor(e){return new R(((t,i)=>{let s=0,r=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++r,a&&r===s&&t()}),(u=>i(u)))})),a=!0,r===s&&t()}))}static or(e){let t=R.resolve(!1);for(const i of e)t=t.next((s=>s?R.resolve(s):i()));return t}static forEach(e,t){const i=[];return e.forEach(((s,r)=>{i.push(t.call(this,s,r))})),this.waitFor(i)}static mapArray(e,t){return new R(((i,s)=>{const r=e.length,a=new Array(r);let l=0;for(let u=0;u<r;u++){const d=u;t(e[d]).next((p=>{a[d]=p,++l,l===r&&i(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new R(((i,s)=>{const r=()=>{e()===!0?t().next((()=>{r()}),s):i()};r()}))}}function Pg(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ki(n){return n.name==="IndexedDbTransactionError"}class Ta{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this._e(i),this.ae=i=>t.writeSequenceNumber(i))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}Ta.ue=-1;const Ia=-1;function wa(n){return n==null}function Qs(n){return n===0&&1/n==-1/0}function kg(n){return typeof n=="number"&&Number.isInteger(n)&&!Qs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const zh="";function Ng(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Wc(e)),e=Dg(n.get(t),e);return Wc(e)}function Dg(n,e){let t=e;const i=n.length;for(let s=0;s<i;s++){const r=n.charAt(s);switch(r){case"\0":t+="";break;case zh:t+="";break;default:t+=r}}return t}function Wc(n){return n+zh+""}function $c(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Qn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Gh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}let et=class xo{constructor(e,t){this.comparator=e,this.root=t||Lt.EMPTY}insert(e,t){return new xo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Lt.BLACK,null,null))}remove(e){return new xo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Lt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return t+i.left.size;s<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Rs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Rs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Rs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Rs(this.root,e,this.comparator,!0)}},Rs=class{constructor(e,t,i,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?i(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Lt=class dt{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i??dt.RED,this.left=s??dt.EMPTY,this.right=r??dt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,s,r){return new dt(e??this.key,t??this.value,i??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return dt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return dt.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,dt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,dt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw U(43730,{key:this.key,value:this.value});if(this.right.isRed())throw U(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw U(27949);return e+(this.isRed()?0:1)}};Lt.EMPTY=null,Lt.RED=!0,Lt.BLACK=!1;Lt.EMPTY=new class{constructor(){this.size=0}get key(){throw U(57766)}get value(){throw U(16141)}get color(){throw U(16727)}get left(){throw U(29726)}get right(){throw U(36894)}copy(e,t,i,s,r){return this}insert(e,t,i){return new Lt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Te{constructor(e){this.comparator=e,this.data=new et(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Hc(this.data.getIterator())}getIteratorFrom(e){return new Hc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof Te)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,r=i.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Te(this.comparator);return t.data=e,t}}class Hc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Qe{constructor(e){this.fields=e,e.sort(Ee.comparator)}static empty(){return new Qe([])}unionWith(e){let t=new Te(Ee.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Qe(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fn(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}class Og extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ot{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new Og("Invalid base64 string: "+r):r}})(e);return new ot(t)}static fromUint8Array(e){const t=(function(s){let r="";for(let a=0;a<s.length;++a)r+=String.fromCharCode(s[a]);return r})(e);return new ot(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ot.EMPTY_BYTE_STRING=new ot("");const Mg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cn(n){if(le(!!n,39018),typeof n=="string"){let e=0;const t=Mg.exec(n);if(le(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ye(n.seconds),nanos:ye(n.nanos)}}function ye(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Un(n){return typeof n=="string"?ot.fromBase64String(n):ot.fromUint8Array(n)}const Kh="server_timestamp",Qh="__type__",Yh="__previous_value__",Xh="__local_write_time__";function Aa(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Qh])===null||t===void 0?void 0:t.stringValue)===Kh}function Ca(n){const e=n.mapValue.fields[Yh];return Aa(e)?Ca(e):e}function Ys(n){const e=cn(n.mapValue.fields[Xh].timestampValue);return new se(e.seconds,e.nanos)}class Vg{constructor(e,t,i,s,r,a,l,u,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=s,this.ssl=r,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=p}}const Xs="(default)";class Js{constructor(e,t){this.projectId=e,this.database=t||Xs}static empty(){return new Js("","")}get isDefaultDatabase(){return this.database===Xs}isEqual(e){return e instanceof Js&&e.projectId===this.projectId&&e.database===this.database}}const Jh="__type__",Lg="__max__",bs={mapValue:{}},Zh="__vector__",Fo="value";function un(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Aa(n)?4:Fg(n)?9007199254740991:xg(n)?10:11:U(28295,{value:n})}function at(n,e){if(n===e)return!0;const t=un(n);if(t!==un(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ys(n).isEqual(Ys(e));case 3:return(function(s,r){if(typeof s.timestampValue=="string"&&typeof r.timestampValue=="string"&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;const a=cn(s.timestampValue),l=cn(r.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,r){return Un(s.bytesValue).isEqual(Un(r.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,r){return ye(s.geoPointValue.latitude)===ye(r.geoPointValue.latitude)&&ye(s.geoPointValue.longitude)===ye(r.geoPointValue.longitude)})(n,e);case 2:return(function(s,r){if("integerValue"in s&&"integerValue"in r)return ye(s.integerValue)===ye(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){const a=ye(s.doubleValue),l=ye(r.doubleValue);return a===l?Qs(a)===Qs(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return Fn(n.arrayValue.values||[],e.arrayValue.values||[],at);case 10:case 11:return(function(s,r){const a=s.mapValue.fields||{},l=r.mapValue.fields||{};if($c(a)!==$c(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!at(a[u],l[u])))return!1;return!0})(n,e);default:return U(52216,{left:n})}}function Fi(n,e){return(n.values||[]).find((t=>at(t,e)))!==void 0}function Bn(n,e){if(n===e)return 0;const t=un(n),i=un(e);if(t!==i)return z(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return z(n.booleanValue,e.booleanValue);case 2:return(function(r,a){const l=ye(r.integerValue||r.doubleValue),u=ye(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return qc(n.timestampValue,e.timestampValue);case 4:return qc(Ys(n),Ys(e));case 5:return Lo(n.stringValue,e.stringValue);case 6:return(function(r,a){const l=Un(r),u=Un(a);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(r,a){const l=r.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const p=z(l[d],u[d]);if(p!==0)return p}return z(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(r,a){const l=z(ye(r.latitude),ye(a.latitude));return l!==0?l:z(ye(r.longitude),ye(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return zc(n.arrayValue,e.arrayValue);case 10:return(function(r,a){var l,u,d,p;const _=r.fields||{},v=a.fields||{},S=(l=_[Fo])===null||l===void 0?void 0:l.arrayValue,b=(u=v[Fo])===null||u===void 0?void 0:u.arrayValue,O=z(((d=S?.values)===null||d===void 0?void 0:d.length)||0,((p=b?.values)===null||p===void 0?void 0:p.length)||0);return O!==0?O:zc(S,b)})(n.mapValue,e.mapValue);case 11:return(function(r,a){if(r===bs.mapValue&&a===bs.mapValue)return 0;if(r===bs.mapValue)return 1;if(a===bs.mapValue)return-1;const l=r.fields||{},u=Object.keys(l),d=a.fields||{},p=Object.keys(d);u.sort(),p.sort();for(let _=0;_<u.length&&_<p.length;++_){const v=Lo(u[_],p[_]);if(v!==0)return v;const S=Bn(l[u[_]],d[p[_]]);if(S!==0)return S}return z(u.length,p.length)})(n.mapValue,e.mapValue);default:throw U(23264,{le:t})}}function qc(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return z(n,e);const t=cn(n),i=cn(e),s=z(t.seconds,i.seconds);return s!==0?s:z(t.nanos,i.nanos)}function zc(n,e){const t=n.values||[],i=e.values||[];for(let s=0;s<t.length&&s<i.length;++s){const r=Bn(t[s],i[s]);if(r)return r}return z(t.length,i.length)}function jn(n){return Uo(n)}function Uo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=cn(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Un(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return x.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",s=!0;for(const r of t.values||[])s?s=!1:i+=",",i+=Uo(r);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let s="{",r=!0;for(const a of i)r?r=!1:s+=",",s+=`${a}:${Uo(t.fields[a])}`;return s+"}"})(n.mapValue):U(61005,{value:n})}function xs(n){switch(un(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ca(n);return e?16+xs(e):16;case 5:return 2*n.stringValue.length;case 6:return Un(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(i){return(i.values||[]).reduce(((s,r)=>s+xs(r)),0)})(n.arrayValue);case 10:case 11:return(function(i){let s=0;return Qn(i.fields,((r,a)=>{s+=r.length+xs(a)})),s})(n.mapValue);default:throw U(13486,{value:n})}}function Bo(n){return!!n&&"integerValue"in n}function Sa(n){return!!n&&"arrayValue"in n}function Fs(n){return!!n&&"mapValue"in n}function xg(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Jh])===null||t===void 0?void 0:t.stringValue)===Zh}function Ai(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Qn(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=Ai(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ai(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Fg(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Lg}class ze{constructor(e){this.value=e}static empty(){return new ze({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Fs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ai(t)}setAll(e){let t=Ee.emptyPath(),i={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,i,s),i={},s=[],t=l.popLast()}a?i[l.lastSegment()]=Ai(a):s.push(l.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,i,s)}delete(e){const t=this.field(e.popLast());Fs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return at(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=t.mapValue.fields[e.get(i)];Fs(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,i){Qn(t,((s,r)=>e[s]=r));for(const s of i)delete e[s]}clone(){return new ze(Ai(this.value))}}function ed(n){const e=[];return Qn(n.fields,((t,i)=>{const s=new Ee([t]);if(Fs(i)){const r=ed(i.mapValue).fields;if(r.length===0)e.push(s);else for(const a of r)e.push(s.child(a))}else e.push(s)})),new Qe(e)}class qe{constructor(e,t,i,s,r,a,l){this.key=e,this.documentType=t,this.version=i,this.readTime=s,this.createTime=r,this.data=a,this.documentState=l}static newInvalidDocument(e){return new qe(e,0,ie.min(),ie.min(),ie.min(),ze.empty(),0)}static newFoundDocument(e,t,i,s){return new qe(e,1,t,ie.min(),i,s,0)}static newNoDocument(e,t){return new qe(e,2,t,ie.min(),ie.min(),ze.empty(),0)}static newUnknownDocument(e,t){return new qe(e,3,t,ie.min(),ie.min(),ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ie.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof qe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Zs{constructor(e,t){this.position=e,this.inclusive=t}}function Gc(n,e,t){let i=0;for(let s=0;s<n.position.length;s++){const r=e[s],a=n.position[s];if(r.field.isKeyField()?i=x.comparator(x.fromName(a.referenceValue),t.key):i=Bn(a,t.data.field(r.field)),r.dir==="desc"&&(i*=-1),i!==0)break}return i}function Kc(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!at(n.position[t],e.position[t]))return!1;return!0}class er{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ug(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class td{}class _e extends td{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new jg(e,t,i):t==="array-contains"?new Hg(e,i):t==="in"?new qg(e,i):t==="not-in"?new zg(e,i):t==="array-contains-any"?new Gg(e,i):new _e(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new Wg(e,i):new $g(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Bn(t,this.value)):t!==null&&un(this.value)===un(t)&&this.matchesComparison(Bn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Wt extends td{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new Wt(e,t)}matches(e){return nd(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function nd(n){return n.op==="and"}function id(n){return Bg(n)&&nd(n)}function Bg(n){for(const e of n.filters)if(e instanceof Wt)return!1;return!0}function jo(n){if(n instanceof _e)return n.field.canonicalString()+n.op.toString()+jn(n.value);if(id(n))return n.filters.map((e=>jo(e))).join(",");{const e=n.filters.map((t=>jo(t))).join(",");return`${n.op}(${e})`}}function sd(n,e){return n instanceof _e?(function(i,s){return s instanceof _e&&i.op===s.op&&i.field.isEqual(s.field)&&at(i.value,s.value)})(n,e):n instanceof Wt?(function(i,s){return s instanceof Wt&&i.op===s.op&&i.filters.length===s.filters.length?i.filters.reduce(((r,a,l)=>r&&sd(a,s.filters[l])),!0):!1})(n,e):void U(19439)}function rd(n){return n instanceof _e?(function(t){return`${t.field.canonicalString()} ${t.op} ${jn(t.value)}`})(n):n instanceof Wt?(function(t){return t.op.toString()+" {"+t.getFilters().map(rd).join(" ,")+"}"})(n):"Filter"}class jg extends _e{constructor(e,t,i){super(e,t,i),this.key=x.fromName(i.referenceValue)}matches(e){const t=x.comparator(e.key,this.key);return this.matchesComparison(t)}}class Wg extends _e{constructor(e,t){super(e,"in",t),this.keys=od("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class $g extends _e{constructor(e,t){super(e,"not-in",t),this.keys=od("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function od(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map((i=>x.fromName(i.referenceValue)))}class Hg extends _e{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Sa(t)&&Fi(t.arrayValue,this.value)}}class qg extends _e{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Fi(this.value.arrayValue,t)}}class zg extends _e{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Fi(this.value.arrayValue,t)}}class Gg extends _e{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Sa(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>Fi(this.value.arrayValue,i)))}}class Kg{constructor(e,t=null,i=[],s=[],r=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=s,this.limit=r,this.startAt=a,this.endAt=l,this.Pe=null}}function Qc(n,e=null,t=[],i=[],s=null,r=null,a=null){return new Kg(n,e,t,i,s,r,a)}function Ra(n){const e=J(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>jo(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(r){return r.field.canonicalString()+r.dir})(i))).join(","),wa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>jn(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>jn(i))).join(",")),e.Pe=t}return e.Pe}function ba(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Ug(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!sd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Kc(n.startAt,e.startAt)&&Kc(n.endAt,e.endAt)}class Cr{constructor(e,t=null,i=[],s=[],r=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=r,this.limitType=a,this.startAt=l,this.endAt=u,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function Qg(n,e,t,i,s,r,a,l){return new Cr(n,e,t,i,s,r,a,l)}function Yg(n){return new Cr(n)}function Yc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Xg(n){return n.collectionGroup!==null}function Ci(n){const e=J(n);if(e.Te===null){e.Te=[];const t=new Set;for(const r of e.explicitOrderBy)e.Te.push(r),t.add(r.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new Te(Ee.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Te.push(new er(r,i))})),t.has(Ee.keyField().canonicalString())||e.Te.push(new er(Ee.keyField(),i))}return e.Te}function sn(n){const e=J(n);return e.Ie||(e.Ie=Jg(e,Ci(n))),e.Ie}function Jg(n,e){if(n.limitType==="F")return Qc(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const r=s.dir==="desc"?"asc":"desc";return new er(s.field,r)}));const t=n.endAt?new Zs(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Zs(n.startAt.position,n.startAt.inclusive):null;return Qc(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function Wo(n,e,t){return new Cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ad(n,e){return ba(sn(n),sn(e))&&n.limitType===e.limitType}function ld(n){return`${Ra(sn(n))}|lt:${n.limitType}`}function gi(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((s=>rd(s))).join(", ")}]`),wa(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((s=>jn(s))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((s=>jn(s))).join(",")),`Target(${i})`})(sn(n))}; limitType=${n.limitType})`}function Pa(n,e){return e.isFoundDocument()&&(function(i,s){const r=s.key.path;return i.collectionGroup!==null?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(r):x.isDocumentKey(i.path)?i.path.isEqual(r):i.path.isImmediateParentOf(r)})(n,e)&&(function(i,s){for(const r of Ci(i))if(!r.field.isKeyField()&&s.data.field(r.field)===null)return!1;return!0})(n,e)&&(function(i,s){for(const r of i.filters)if(!r.matches(s))return!1;return!0})(n,e)&&(function(i,s){return!(i.startAt&&!(function(a,l,u){const d=Gc(a,l,u);return a.inclusive?d<=0:d<0})(i.startAt,Ci(i),s)||i.endAt&&!(function(a,l,u){const d=Gc(a,l,u);return a.inclusive?d>=0:d>0})(i.endAt,Ci(i),s))})(n,e)}function Zg(n){return(e,t)=>{let i=!1;for(const s of Ci(n)){const r=ey(s,e,t);if(r!==0)return r;i=i||s.field.isKeyField()}return 0}}function ey(n,e,t){const i=n.field.isKeyField()?x.comparator(e.key,t.key):(function(r,a,l){const u=a.data.field(r),d=l.data.field(r);return u!==null&&d!==null?Bn(u,d):U(42886)})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return U(19790,{direction:n.dir})}}class mn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[s,r]of i)if(this.equalsFn(s,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[t]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Qn(this.inner,((t,i)=>{for(const[s,r]of i)e(s,r)}))}isEmpty(){return Gh(this.inner)}size(){return this.innerSize}}const ty=new et(x.comparator);function tr(){return ty}const cd=new et(x.comparator);function Ps(...n){let e=cd;for(const t of n)e=e.insert(t.key,t);return e}function ud(n){let e=cd;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function Zt(){return Si()}function hd(){return Si()}function Si(){return new mn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const ny=new et(x.comparator),iy=new Te(x.comparator);function be(...n){let e=iy;for(const t of n)e=e.add(t);return e}const sy=new Te(z);function ry(){return sy}function ka(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qs(e)?"-0":e}}function dd(n){return{integerValue:""+n}}function oy(n,e){return kg(e)?dd(e):ka(n,e)}class Sr{constructor(){this._=void 0}}function ay(n,e,t){return n instanceof Ui?(function(s,r){const a={fields:{[Qh]:{stringValue:Kh},[Xh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&Aa(r)&&(r=Ca(r)),r&&(a.fields[Yh]=r),{mapValue:a}})(t,e):n instanceof Bi?pd(n,e):n instanceof ji?_d(n,e):(function(s,r){const a=fd(s,r),l=Xc(a)+Xc(s.Ee);return Bo(a)&&Bo(s.Ee)?dd(l):ka(s.serializer,l)})(n,e)}function ly(n,e,t){return n instanceof Bi?pd(n,e):n instanceof ji?_d(n,e):t}function fd(n,e){return n instanceof nr?(function(i){return Bo(i)||(function(r){return!!r&&"doubleValue"in r})(i)})(e)?e:{integerValue:0}:null}class Ui extends Sr{}class Bi extends Sr{constructor(e){super(),this.elements=e}}function pd(n,e){const t=md(e);for(const i of n.elements)t.some((s=>at(s,i)))||t.push(i);return{arrayValue:{values:t}}}class ji extends Sr{constructor(e){super(),this.elements=e}}function _d(n,e){let t=md(e);for(const i of n.elements)t=t.filter((s=>!at(s,i)));return{arrayValue:{values:t}}}class nr extends Sr{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Xc(n){return ye(n.integerValue||n.doubleValue)}function md(n){return Sa(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class cy{constructor(e,t){this.field=e,this.transform=t}}function uy(n,e){return n.field.isEqual(e.field)&&(function(i,s){return i instanceof Bi&&s instanceof Bi||i instanceof ji&&s instanceof ji?Fn(i.elements,s.elements,at):i instanceof nr&&s instanceof nr?at(i.Ee,s.Ee):i instanceof Ui&&s instanceof Ui})(n.transform,e.transform)}class hy{constructor(e,t){this.version=e,this.transformResults=t}}class gt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new gt}static exists(e){return new gt(void 0,e)}static updateTime(e){return new gt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Us(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Rr{}function gd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new vd(n.key,gt.none()):new Qi(n.key,n.data,gt.none());{const t=n.data,i=ze.empty();let s=new Te(Ee.comparator);for(let r of e.fields)if(!s.has(r)){let a=t.field(r);a===null&&r.length>1&&(r=r.popLast(),a=t.field(r)),a===null?i.delete(r):i.set(r,a),s=s.add(r)}return new gn(n.key,i,new Qe(s.toArray()),gt.none())}}function dy(n,e,t){n instanceof Qi?(function(s,r,a){const l=s.value.clone(),u=Zc(s.fieldTransforms,r,a.transformResults);l.setAll(u),r.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof gn?(function(s,r,a){if(!Us(s.precondition,r))return void r.convertToUnknownDocument(a.version);const l=Zc(s.fieldTransforms,r,a.transformResults),u=r.data;u.setAll(yd(s)),u.setAll(l),r.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,r,a){r.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Ri(n,e,t,i){return n instanceof Qi?(function(r,a,l,u){if(!Us(r.precondition,a))return l;const d=r.value.clone(),p=eu(r.fieldTransforms,u,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,i):n instanceof gn?(function(r,a,l,u){if(!Us(r.precondition,a))return l;const d=eu(r.fieldTransforms,u,a),p=a.data;return p.setAll(yd(r)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map((_=>_.field)))})(n,e,t,i):(function(r,a,l){return Us(r.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function fy(n,e){let t=null;for(const i of n.fieldTransforms){const s=e.data.field(i.field),r=fd(i.transform,s||null);r!=null&&(t===null&&(t=ze.empty()),t.set(i.field,r))}return t||null}function Jc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,s){return i===void 0&&s===void 0||!(!i||!s)&&Fn(i,s,((r,a)=>uy(r,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Qi extends Rr{constructor(e,t,i,s=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class gn extends Rr{constructor(e,t,i,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function yd(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function Zc(n,e,t){const i=new Map;le(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let s=0;s<t.length;s++){const r=n[s],a=r.transform,l=e.data.field(r.field);i.set(r.field,ly(a,l,t[s]))}return i}function eu(n,e,t){const i=new Map;for(const s of n){const r=s.transform,a=t.data.field(s.field);i.set(s.field,ay(r,a,e))}return i}class vd extends Rr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class py extends Rr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class _y{constructor(e,t,i,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const r=this.mutations[s];r.key.isEqual(e.key)&&dy(r,e,i[s])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Ri(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Ri(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=hd();return this.mutations.forEach((s=>{const r=e.get(s.key),a=r.overlayedDocument;let l=this.applyToLocalView(a,r.mutatedFields);l=t.has(s.key)?null:l;const u=gd(a,l);u!==null&&i.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(ie.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),be())}isEqual(e){return this.batchId===e.batchId&&Fn(this.mutations,e.mutations,((t,i)=>Jc(t,i)))&&Fn(this.baseMutations,e.baseMutations,((t,i)=>Jc(t,i)))}}class Na{constructor(e,t,i,s){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=s}static from(e,t,i){le(e.mutations.length===i.length,58842,{Ve:e.mutations.length,me:i.length});let s=(function(){return ny})();const r=e.mutations;for(let a=0;a<r.length;a++)s=s.insert(r[a].key,i[a].version);return new Na(e,t,i,s)}}class my{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}var ce,$;function gy(n){switch(n){case P.OK:return U(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return U(15467,{code:n})}}function yy(n){if(n===void 0)return ln("GRPC error has no .code"),P.UNKNOWN;switch(n){case ce.OK:return P.OK;case ce.CANCELLED:return P.CANCELLED;case ce.UNKNOWN:return P.UNKNOWN;case ce.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ce.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ce.INTERNAL:return P.INTERNAL;case ce.UNAVAILABLE:return P.UNAVAILABLE;case ce.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ce.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ce.NOT_FOUND:return P.NOT_FOUND;case ce.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ce.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ce.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ce.ABORTED:return P.ABORTED;case ce.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ce.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ce.DATA_LOSS:return P.DATA_LOSS;default:return U(39323,{code:n})}}($=ce||(ce={}))[$.OK=0]="OK",$[$.CANCELLED=1]="CANCELLED",$[$.UNKNOWN=2]="UNKNOWN",$[$.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$[$.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$[$.NOT_FOUND=5]="NOT_FOUND",$[$.ALREADY_EXISTS=6]="ALREADY_EXISTS",$[$.PERMISSION_DENIED=7]="PERMISSION_DENIED",$[$.UNAUTHENTICATED=16]="UNAUTHENTICATED",$[$.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$[$.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$[$.ABORTED=10]="ABORTED",$[$.OUT_OF_RANGE=11]="OUT_OF_RANGE",$[$.UNIMPLEMENTED=12]="UNIMPLEMENTED",$[$.INTERNAL=13]="INTERNAL",$[$.UNAVAILABLE=14]="UNAVAILABLE",$[$.DATA_LOSS=15]="DATA_LOSS";new ma([4294967295,4294967295],0);class vy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function $o(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ey(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Ty(n,e){return $o(n,e.toTimestamp())}function Pn(n){return le(!!n,49232),ie.fromTimestamp((function(t){const i=cn(t);return new se(i.seconds,i.nanos)})(n))}function Ed(n,e){return Ho(n,e).canonicalString()}function Ho(n,e){const t=(function(s){return new oe(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Iy(n){const e=oe.fromString(n);return le(ky(e),10190,{key:e.toString()}),e}function qo(n,e){return Ed(n.databaseId,e.path)}function wy(n){const e=Iy(n);return e.length===4?oe.emptyPath():Cy(e)}function Ay(n){return new oe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Cy(n){return le(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function tu(n,e,t){return{name:qo(n,e),fields:t.value.mapValue.fields}}function Sy(n,e){let t;if(e instanceof Qi)t={update:tu(n,e.key,e.value)};else if(e instanceof vd)t={delete:qo(n,e.key)};else if(e instanceof gn)t={update:tu(n,e.key,e.data),updateMask:Py(e.fieldMask)};else{if(!(e instanceof py))return U(16599,{Rt:e.type});t={verify:qo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(r,a){const l=a.transform;if(l instanceof Ui)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Bi)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ji)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof nr)return{fieldPath:a.field.canonicalString(),increment:l.Ee};throw U(20930,{transform:a.transform})})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(s,r){return r.updateTime!==void 0?{updateTime:Ty(s,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:U(27497)})(n,e.precondition)),t}function Ry(n,e){return n&&n.length>0?(le(e!==void 0,14353),n.map((t=>(function(s,r){let a=s.updateTime?Pn(s.updateTime):Pn(r);return a.isEqual(ie.min())&&(a=Pn(r)),new hy(a,s.transformResults||[])})(t,e)))):[]}function by(n){let e=wy(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let s=null;if(i>0){le(i===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let r=[];t.where&&(r=(function(_){const v=Td(_);return v instanceof Wt&&id(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(_){return _.map((v=>(function(b){return new er(Sn(b.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(v)))})(t.orderBy));let l=null;t.limit&&(l=(function(_){let v;return v=typeof _=="object"?_.value:_,wa(v)?null:v})(t.limit));let u=null;t.startAt&&(u=(function(_){const v=!!_.before,S=_.values||[];return new Zs(S,v)})(t.startAt));let d=null;return t.endAt&&(d=(function(_){const v=!_.before,S=_.values||[];return new Zs(S,v)})(t.endAt)),Qg(e,s,a,r,l,"F",u,d)}function Td(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Sn(t.unaryFilter.field);return _e.create(i,"==",{doubleValue:NaN});case"IS_NULL":const s=Sn(t.unaryFilter.field);return _e.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Sn(t.unaryFilter.field);return _e.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Sn(t.unaryFilter.field);return _e.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return U(61313);default:return U(60726)}})(n):n.fieldFilter!==void 0?(function(t){return _e.create(Sn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return U(58110);default:return U(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Wt.create(t.compositeFilter.filters.map((i=>Td(i))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return U(1026)}})(t.compositeFilter.op))})(n):U(30097,{filter:n})}function Sn(n){return Ee.fromServerFormat(n.fieldPath)}function Py(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ky(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Ny{constructor(e){this.gt=e}}function Dy(n){const e=by({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Wo(e,e.limit,"L"):e}class Oy{constructor(){this.Dn=new My}addToCollectionParentIndex(e,t){return this.Dn.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(jt.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(jt.min())}updateCollectionGroup(e,t,i){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class My{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t]||new Te(oe.comparator),r=!s.has(i);return this.index[t]=s.add(i),r}has(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t];return s&&s.has(i)}getEntries(e){return(this.index[e]||new Te(oe.comparator)).toArray()}}const nu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Id=41943040;class xe{static withCacheSize(e){return new xe(e,xe.DEFAULT_COLLECTION_PERCENTILE,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}xe.DEFAULT_COLLECTION_PERCENTILE=10,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,xe.DEFAULT=new xe(Id,xe.DEFAULT_COLLECTION_PERCENTILE,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),xe.DISABLED=new xe(-1,0,0);class Wn{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Wn(0)}static ur(){return new Wn(-1)}}const iu="LruGarbageCollector",Vy=1048576;function su([n,e],[t,i]){const s=z(n,t);return s===0?z(e,i):s}class Ly{constructor(e){this.Tr=e,this.buffer=new Te(su),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();su(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class xy{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){M(iu,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ki(t)?M(iu,"Ignoring IndexedDB error during garbage collection: ",t):await Ea(t)}await this.Rr(3e5)}))}}class Fy{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next((i=>Math.floor(t/100*i)))}nthSequenceNumber(e,t){if(t===0)return R.resolve(Ta.ue);const i=new Ly(t);return this.Vr.forEachTarget(e,(s=>i.Er(s.sequenceNumber))).next((()=>this.Vr.gr(e,(s=>i.Er(s))))).next((()=>i.maxValue))}removeTargets(e,t,i){return this.Vr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(nu)):this.getCacheSize(e).next((i=>i<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nu):this.pr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let i,s,r,a,l,u,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),s=this.params.maximumSequenceNumbersToCollect):s=_,a=Date.now(),this.nthSequenceNumber(e,s)))).next((_=>(i=_,l=Date.now(),this.removeTargets(e,i,t)))).next((_=>(r=_,u=Date.now(),this.removeOrphanedDocuments(e,i)))).next((_=>(d=Date.now(),Cn()<=B.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${r} targets in `+(u-l)+`ms
	Removed ${_} documents in `+(d-u)+`ms
Total Duration: ${d-p}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:_}))))}}function Uy(n,e){return new Fy(n,e)}class By{constructor(){this.changes=new mn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?R.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class jy{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Wy{constructor(e,t,i,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(i=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(i!==null&&Ri(i.mutation,s,Qe.empty(),se.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,be()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=be()){const s=Zt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,i).next((r=>{let a=Ps();return r.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const i=Zt();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,be())))}populateOverlays(e,t,i){const s=[];return i.forEach((r=>{t.has(r)||s.push(r)})),this.documentOverlayCache.getOverlays(e,s).next((r=>{r.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,i,s){let r=tr();const a=Si(),l=(function(){return Si()})();return t.forEach(((u,d)=>{const p=i.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof gn)?r=r.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Ri(p.mutation,d,p.mutation.getFieldMask(),se.now())):a.set(d.key,Qe.empty())})),this.recalculateAndSaveOverlays(e,r).next((u=>(u.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>{var _;return l.set(d,new jy(p,(_=a.get(d))!==null&&_!==void 0?_:null))})),l)))}recalculateAndSaveOverlays(e,t){const i=Si();let s=new et(((a,l)=>a-l)),r=be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const d=t.get(u);if(d===null)return;let p=i.get(u)||Qe.empty();p=l.applyToLocalView(d,p),i.set(u,p);const _=(s.get(l.batchId)||be()).add(u);s=s.insert(l.batchId,_)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,p=u.value,_=hd();p.forEach((v=>{if(!r.has(v)){const S=gd(t.get(v),i.get(v));S!==null&&_.set(v,S),r=r.add(v)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,_))}return R.waitFor(a)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,s){return(function(a){return x.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Xg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,s):this.getDocumentsMatchingCollectionQuery(e,t,i,s)}getNextDocuments(e,t,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,s).next((r=>{const a=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,s-r.size):R.resolve(Zt());let l=xi,u=r;return a.next((d=>R.forEach(d,((p,_)=>(l<_.largestBatchId&&(l=_.largestBatchId),r.get(p)?R.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{u=u.insert(p,v)}))))).next((()=>this.populateOverlays(e,d,r))).next((()=>this.computeViews(e,u,d,be()))).next((p=>({batchId:l,changes:ud(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next((i=>{let s=Ps();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,s){const r=t.collectionGroup;let a=Ps();return this.indexManager.getCollectionParents(e,r).next((l=>R.forEach(l,(u=>{const d=(function(_,v){return new Cr(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,u.child(r));return this.getDocumentsMatchingCollectionQuery(e,d,i,s).next((p=>{p.forEach(((_,v)=>{a=a.insert(_,v)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,i,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((a=>(r=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,r,s)))).next((a=>{r.forEach(((u,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,qe.newInvalidDocument(p)))}));let l=Ps();return a.forEach(((u,d)=>{const p=r.get(u);p!==void 0&&Ri(p.mutation,d,Qe.empty(),se.now()),Pa(t,d)&&(l=l.insert(u,d))})),l}))}}class $y{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return R.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Pn(s.createTime)}})(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(s){return{name:s.name,query:Dy(s.bundledQuery),readTime:Pn(s.readTime)}})(t)),R.resolve()}}class Hy{constructor(){this.overlays=new et(x.comparator),this.kr=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Zt();return R.forEach(t,(s=>this.getOverlay(e,s).next((r=>{r!==null&&i.set(s,r)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((s,r)=>{this.wt(e,t,r)})),R.resolve()}removeOverlaysForBatchId(e,t,i){const s=this.kr.get(i);return s!==void 0&&(s.forEach((r=>this.overlays=this.overlays.remove(r))),this.kr.delete(i)),R.resolve()}getOverlaysForCollection(e,t,i){const s=Zt(),r=t.length+1,a=new x(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===r&&u.largestBatchId>i&&s.set(u.getKey(),u)}return R.resolve(s)}getOverlaysForCollectionGroup(e,t,i,s){let r=new et(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>i){let p=r.get(d.largestBatchId);p===null&&(p=Zt(),r=r.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const l=Zt(),u=r.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((d,p)=>l.set(d,p))),!(l.size()>=s)););return R.resolve(l)}wt(e,t,i){const s=this.overlays.get(i.key);if(s!==null){const a=this.kr.get(s.largestBatchId).delete(i.key);this.kr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(i.key,new my(t,i));let r=this.kr.get(t);r===void 0&&(r=be(),this.kr.set(t,r)),this.kr.set(t,r.add(i.key))}}class qy{constructor(){this.sessionToken=ot.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}}class Da{constructor(){this.qr=new Te(fe.Qr),this.$r=new Te(fe.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const i=new fe(e,t);this.qr=this.qr.add(i),this.$r=this.$r.add(i)}Kr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Wr(new fe(e,t))}Gr(e,t){e.forEach((i=>this.removeReference(i,t)))}zr(e){const t=new x(new oe([])),i=new fe(t,e),s=new fe(t,e+1),r=[];return this.$r.forEachInRange([i,s],(a=>{this.Wr(a),r.push(a.key)})),r}jr(){this.qr.forEach((e=>this.Wr(e)))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new x(new oe([])),i=new fe(t,e),s=new fe(t,e+1);let r=be();return this.$r.forEachInRange([i,s],(a=>{r=r.add(a.key)})),r}containsKey(e){const t=new fe(e,0),i=this.qr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class fe{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return x.comparator(e.key,t.key)||z(e.Hr,t.Hr)}static Ur(e,t){return z(e.Hr,t.Hr)||x.comparator(e.key,t.key)}}class zy{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Te(fe.Qr)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,s){const r=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new _y(r,t,i,s);this.mutationQueue.push(a);for(const l of s)this.Yr=this.Yr.add(new fe(l.key,r)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return R.resolve(a)}lookupMutationBatch(e,t){return R.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=this.Xr(i),r=s<0?0:s;return R.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?Ia:this.er-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new fe(t,0),s=new fe(t,Number.POSITIVE_INFINITY),r=[];return this.Yr.forEachInRange([i,s],(a=>{const l=this.Zr(a.Hr);r.push(l)})),R.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Te(z);return t.forEach((s=>{const r=new fe(s,0),a=new fe(s,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([r,a],(l=>{i=i.add(l.Hr)}))})),R.resolve(this.ei(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1;let r=i;x.isDocumentKey(r)||(r=r.child(""));const a=new fe(new x(r),0);let l=new Te(z);return this.Yr.forEachWhile((u=>{const d=u.key.path;return!!i.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.Hr)),!0)}),a),R.resolve(this.ei(l))}ei(e){const t=[];return e.forEach((i=>{const s=this.Zr(i);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){le(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Yr;return R.forEach(t.mutations,(s=>{const r=new fe(s.key,t.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Yr=i}))}rr(e){}containsKey(e,t){const i=new fe(t,0),s=this.Yr.firstAfterOrEqual(i);return R.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Gy{constructor(e){this.ni=e,this.docs=(function(){return new et(x.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,s=this.docs.get(i),r=s?s.size:0,a=this.ni(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:a}),this.size+=a-r,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return R.resolve(i?i.document.mutableCopy():qe.newInvalidDocument(t))}getEntries(e,t){let i=tr();return t.forEach((s=>{const r=this.docs.get(s);i=i.insert(s,r?r.document.mutableCopy():qe.newInvalidDocument(s))})),R.resolve(i)}getDocumentsMatchingQuery(e,t,i,s){let r=tr();const a=t.path,l=new x(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:p}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Sg(Cg(p),i)<=0||(s.has(p.key)||Pa(t,p))&&(r=r.insert(p.key,p.mutableCopy()))}return R.resolve(r)}getAllFromCollectionGroup(e,t,i,s){U(9500)}ri(e,t){return R.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new Ky(this)}getSize(e){return R.resolve(this.size)}}class Ky extends By{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach(((i,s)=>{s.isValidDocument()?t.push(this.Or.addEntry(e,s)):this.Or.removeEntry(i)})),R.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class Qy{constructor(e){this.persistence=e,this.ii=new mn((t=>Ra(t)),ba),this.lastRemoteSnapshotVersion=ie.min(),this.highestTargetId=0,this.si=0,this.oi=new Da,this.targetCount=0,this._i=Wn.ar()}forEachTarget(e,t){return this.ii.forEach(((i,s)=>t(s))),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.si&&(this.si=t),R.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new Wn(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.hr(t),R.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,i){let s=0;const r=[];return this.ii.forEach(((a,l)=>{l.sequenceNumber<=t&&i.get(l.targetId)===null&&(this.ii.delete(a),r.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),R.waitFor(r).next((()=>s))}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const i=this.ii.get(t)||null;return R.resolve(i)}addMatchingKeys(e,t,i){return this.oi.Kr(t,i),R.resolve()}removeMatchingKeys(e,t,i){this.oi.Gr(t,i);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach((a=>{r.push(s.markPotentiallyOrphaned(e,a))})),R.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const i=this.oi.Jr(t);return R.resolve(i)}containsKey(e,t){return R.resolve(this.oi.containsKey(t))}}class wd{constructor(e,t){this.ai={},this.overlays={},this.ui=new Ta(0),this.ci=!1,this.ci=!0,this.li=new qy,this.referenceDelegate=e(this),this.hi=new Qy(this),this.indexManager=new Oy,this.remoteDocumentCache=(function(s){return new Gy(s)})((i=>this.referenceDelegate.Pi(i))),this.serializer=new Ny(t),this.Ti=new $y(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ai[e.toKey()];return i||(i=new zy(t,this.referenceDelegate),this.ai[e.toKey()]=i),i}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,i){M("MemoryPersistence","Starting transaction:",e);const s=new Yy(this.ui.next());return this.referenceDelegate.Ii(),i(s).next((r=>this.referenceDelegate.di(s).next((()=>r)))).toPromise().then((r=>(s.raiseOnCommittedEvent(),r)))}Ei(e,t){return R.or(Object.values(this.ai).map((i=>()=>i.containsKey(e,t))))}}class Yy extends bg{constructor(e){super(),this.currentSequenceNumber=e}}class Oa{constructor(e){this.persistence=e,this.Ai=new Da,this.Ri=null}static Vi(e){return new Oa(e)}get mi(){if(this.Ri)return this.Ri;throw U(60996)}addReference(e,t,i){return this.Ai.addReference(i,t),this.mi.delete(i.toString()),R.resolve()}removeReference(e,t,i){return this.Ai.removeReference(i,t),this.mi.add(i.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),R.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach((s=>this.mi.add(s.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((r=>this.mi.add(r.toString())))})).next((()=>i.removeTargetData(e,t)))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.mi,(i=>{const s=x.fromPath(i);return this.fi(e,s).next((r=>{r||t.removeEntry(s,ie.min())}))})).next((()=>(this.Ri=null,t.apply(e))))}updateLimboDocument(e,t){return this.fi(e,t).next((i=>{i?this.mi.delete(t.toString()):this.mi.add(t.toString())}))}Pi(e){return 0}fi(e,t){return R.or([()=>R.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class ir{constructor(e,t){this.persistence=e,this.gi=new mn((i=>Ng(i.path)),((i,s)=>i.isEqual(s))),this.garbageCollector=Uy(this,t)}static Vi(e,t){return new ir(e,t)}Ii(){}di(e){return R.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next((i=>t.next((s=>i+s))))}yr(e){let t=0;return this.gr(e,(i=>{t++})).next((()=>t))}gr(e,t){return R.forEach(this.gi,((i,s)=>this.Sr(e,i,s).next((r=>r?R.resolve():t(s)))))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const s=this.persistence.getRemoteDocumentCache(),r=s.newChangeBuffer();return s.ri(e,(a=>this.Sr(e,a,t).next((l=>{l||(i++,r.removeEntry(a,ie.min()))})))).next((()=>r.apply(e))).next((()=>i))}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),R.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.gi.set(i,e.currentSequenceNumber),R.resolve()}removeReference(e,t,i){return this.gi.set(i,e.currentSequenceNumber),R.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),R.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=xs(e.data.value)),t}Sr(e,t,i){return R.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.gi.get(t);return R.resolve(s!==void 0&&s>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Ma{constructor(e,t,i,s){this.targetId=e,this.fromCache=t,this.Is=i,this.ds=s}static Es(e,t){let i=be(),s=be();for(const r of t.docChanges)switch(r.type){case 0:i=i.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new Ma(e,t.fromCache,i,s)}}class Xy{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Jy{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return W_()?8:Pg(Oe())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,i,s){const r={result:null};return this.ps(e,t).next((a=>{r.result=a})).next((()=>{if(!r.result)return this.ys(e,t,s,i).next((a=>{r.result=a}))})).next((()=>{if(r.result)return;const a=new Xy;return this.ws(e,t,a).next((l=>{if(r.result=l,this.Rs)return this.Ss(e,t,a,l.size)}))})).next((()=>r.result))}Ss(e,t,i,s){return i.documentReadCount<this.Vs?(Cn()<=B.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",gi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),R.resolve()):(Cn()<=B.DEBUG&&M("QueryEngine","Query:",gi(t),"scans",i.documentReadCount,"local documents and returns",s,"documents as results."),i.documentReadCount>this.fs*s?(Cn()<=B.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",gi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sn(t))):R.resolve())}ps(e,t){if(Yc(t))return R.resolve(null);let i=sn(t);return this.indexManager.getIndexType(e,i).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Wo(t,null,"F"),i=sn(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((r=>{const a=be(...r);return this.gs.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,i).next((u=>{const d=this.bs(t,l);return this.Ds(t,d,a,u.readTime)?this.ps(e,Wo(t,null,"F")):this.vs(e,d,t,u)}))))})))))}ys(e,t,i,s){return Yc(t)||s.isEqual(ie.min())?R.resolve(null):this.gs.getDocuments(e,i).next((r=>{const a=this.bs(t,r);return this.Ds(t,a,i,s)?R.resolve(null):(Cn()<=B.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),gi(t)),this.vs(e,a,t,Ag(s,xi)).next((l=>l)))}))}bs(e,t){let i=new Te(Zg(e));return t.forEach(((s,r)=>{Pa(e,r)&&(i=i.add(r))})),i}Ds(e,t,i,s){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}ws(e,t,i){return Cn()<=B.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",gi(t)),this.gs.getDocumentsMatchingQuery(e,t,jt.min(),i)}vs(e,t,i,s){return this.gs.getDocumentsMatchingQuery(e,i,s).next((r=>(t.forEach((a=>{r=r.insert(a.key,a)})),r)))}}const Zy="LocalStore";class ev{constructor(e,t,i,s){this.persistence=e,this.Cs=t,this.serializer=s,this.Fs=new et(z),this.Ms=new mn((r=>Ra(r)),ba),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(i)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Wy(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Fs)))}}function tv(n,e,t,i){return new ev(n,e,t,i)}async function Ad(n,e){const t=J(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next((r=>(s=r,t.Ns(e),t.mutationQueue.getAllMutationBatches(i)))).next((r=>{const a=[],l=[];let u=be();for(const d of s){a.push(d.batchId);for(const p of d.mutations)u=u.add(p.key)}for(const d of r){l.push(d.batchId);for(const p of d.mutations)u=u.add(p.key)}return t.localDocuments.getDocuments(i,u).next((d=>({Bs:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function nv(n,e){const t=J(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const s=e.batch.keys(),r=t.Os.newChangeBuffer({trackRemovals:!0});return(function(l,u,d,p){const _=d.batch,v=_.keys();let S=R.resolve();return v.forEach((b=>{S=S.next((()=>p.getEntry(u,b))).next((O=>{const D=d.docVersions.get(b);le(D!==null,48541),O.version.compareTo(D)<0&&(_.applyToRemoteDocument(O,d),O.isValidDocument()&&(O.setReadTime(d.commitVersion),p.addEntry(O)))}))})),S.next((()=>l.mutationQueue.removeMutationBatch(u,_)))})(t,i,e,r).next((()=>r.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(l){let u=be();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(i,s)))}))}function iv(n){const e=J(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.hi.getLastRemoteSnapshotVersion(t)))}function sv(n,e){const t=J(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=Ia),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}class ru{constructor(){this.activeTargetIds=ry()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class rv{constructor(){this.Fo=new ru,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,i){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new ru,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ov{xo(e){}shutdown(){}}const ou="ConnectivityMonitor";class au{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){M(ou,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){M(ou,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ks=null;function zo(){return ks===null?ks=(function(){return 268435456+Math.round(2147483648*Math.random())})():ks++,"0x"+ks.toString(16)}const go="RestConnection",av={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lv{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${i}/databases/${s}`,this.Ko=this.databaseId.database===Xs?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Wo(e,t,i,s,r){const a=zo(),l=this.Go(e,t.toUriEncodedString());M(go,`Sending RPC '${e}' ${a}:`,l,i);const u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(u,s,r);const{host:d}=new URL(l),p=zt(d);return this.jo(e,l,u,i,p).then((_=>(M(go,`Received RPC '${e}' ${a}: `,_),_)),(_=>{throw xn(go,`RPC '${e}' ${a} failed with error: `,_,"url: ",l,"request:",i),_}))}Jo(e,t,i,s,r,a){return this.Wo(e,t,i,s,r)}zo(e,t,i){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Kn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,r)=>e[r]=s)),i&&i.headers.forEach(((s,r)=>e[r]=s))}Go(e,t){const i=av[e];return`${this.$o}/v1/${t}:${i}`}terminate(){}}class cv{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const Se="WebChannelConnection";class uv extends lv{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,i,s,r){const a=zo();return new Promise(((l,u)=>{const d=new Lh;d.setWithCredentials(!0),d.listenOnce(xh.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Ls.NO_ERROR:const _=d.getResponseJson();M(Se,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(_)),l(_);break;case Ls.TIMEOUT:M(Se,`RPC '${e}' ${a} timed out`),u(new V(P.DEADLINE_EXCEEDED,"Request time out"));break;case Ls.HTTP_ERROR:const v=d.getStatus();if(M(Se,`RPC '${e}' ${a} failed with status:`,v,"response text:",d.getResponseText()),v>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);const b=S?.error;if(b&&b.status&&b.message){const O=(function(K){const F=K.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(F)>=0?F:P.UNKNOWN})(b.status);u(new V(O,b.message))}else u(new V(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new V(P.UNAVAILABLE,"Connection failed."));break;default:U(9055,{c_:e,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{M(Se,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);M(Se,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,i,15)}))}P_(e,t,i){const s=zo(),r=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Bh(),l=Uh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.zo(u.initMessageHeaders,t,i),u.encodeInitMessageHeaders=!0;const p=r.join("");M(Se,`Creating RPC '${e}' stream ${s}: ${p}`,u);const _=a.createWebChannel(p,u);this.T_(_);let v=!1,S=!1;const b=new cv({Ho:D=>{S?M(Se,`Not sending because RPC '${e}' stream ${s} is closed:`,D):(v||(M(Se,`Opening RPC '${e}' stream ${s} transport.`),_.open(),v=!0),M(Se,`RPC '${e}' stream ${s} sending:`,D),_.send(D))},Yo:()=>_.close()}),O=(D,K,F)=>{D.listen(K,(W=>{try{F(W)}catch(re){setTimeout((()=>{throw re}),0)}}))};return O(_,Ii.EventType.OPEN,(()=>{S||(M(Se,`RPC '${e}' stream ${s} transport opened.`),b.s_())})),O(_,Ii.EventType.CLOSE,(()=>{S||(S=!0,M(Se,`RPC '${e}' stream ${s} transport closed`),b.__(),this.I_(_))})),O(_,Ii.EventType.ERROR,(D=>{S||(S=!0,xn(Se,`RPC '${e}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),b.__(new V(P.UNAVAILABLE,"The operation could not be completed")))})),O(_,Ii.EventType.MESSAGE,(D=>{var K;if(!S){const F=D.data[0];le(!!F,16349);const W=F,re=W?.error||((K=W[0])===null||K===void 0?void 0:K.error);if(re){M(Se,`RPC '${e}' stream ${s} received error:`,re);const tt=re.status;let he=(function(y){const E=ce[y];if(E!==void 0)return yy(E)})(tt),I=re.message;he===void 0&&(he=P.INTERNAL,I="Unknown error status: "+tt+" with message "+re.message),S=!0,b.__(new V(he,I)),_.close()}else M(Se,`RPC '${e}' stream ${s} received:`,F),b.a_(F)}})),O(l,Fh.STAT_EVENT,(D=>{D.stat===Vo.PROXY?M(Se,`RPC '${e}' stream ${s} detected buffering proxy`):D.stat===Vo.NOPROXY&&M(Se,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{b.o_()}),0),b}terminate(){this.u_.forEach((e=>e.close())),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter((t=>t===e))}}function yo(){return typeof document<"u"?document:null}function br(n){return new vy(n,!0)}class Cd{constructor(e,t,i=1e3,s=1.5,r=6e4){this.Fi=e,this.timerId=t,this.d_=i,this.E_=s,this.A_=r,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),i=Math.max(0,Date.now()-this.m_),s=Math.max(0,t-i);s>0&&M("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,s,(()=>(this.m_=Date.now(),e()))),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const lu="PersistentStream";class hv{constructor(e,t,i,s,r,a,l,u){this.Fi=e,this.w_=i,this.S_=s,this.connection=r,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Cd(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,(()=>this.L_())))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(ln(t.toString()),ln("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,s])=>{this.b_===t&&this.W_(i,s)}),(i=>{e((()=>{const s=new V(P.UNKNOWN,"Fetching auth token failed: "+i.message);return this.G_(s)}))}))}W_(e,t){const i=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo((()=>{i((()=>this.listener.Zo()))})),this.stream.e_((()=>{i((()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,(()=>(this.x_()&&(this.state=3),Promise.resolve()))),this.listener.e_())))})),this.stream.n_((s=>{i((()=>this.G_(s)))})),this.stream.onMessage((s=>{i((()=>++this.C_==1?this.j_(s):this.onNext(s)))}))}O_(){this.state=5,this.F_.g_((async()=>{this.state=0,this.start()}))}G_(e){return M(lu,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget((()=>this.b_===e?t():(M(lu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class dv extends hv{constructor(e,t,i,s,r,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,s,a),this.serializer=r}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return le(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,le(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){le(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=Ry(e.writeResults,e.commitTime),i=Pn(e.commitTime);return this.listener.ta(i,t)}na(){const e={};e.database=Ay(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>Sy(this.serializer,i)))};this.k_(t)}}class fv{}class pv extends fv{constructor(e,t,i,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=s,this.ra=!1}ia(){if(this.ra)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,a])=>this.connection.Wo(e,Ho(t,i),s,r,a))).catch((r=>{throw r.name==="FirebaseError"?(r.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new V(P.UNKNOWN,r.toString())}))}Jo(e,t,i,s,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Jo(e,Ho(t,i),s,a,l,r))).catch((a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(P.UNKNOWN,a.toString())}))}terminate(){this.ra=!0,this.connection.terminate()}}class _v{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve()))))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ln(t),this._a=!1):M("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}const Yi="RemoteStore";class mv{constructor(e,t,i,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=r,this.Ea.xo((a=>{i.enqueueAndForget((async()=>{Ji(this)&&(M(Yi,"Restarting streams for network reachability change."),await(async function(u){const d=J(u);d.Ia.add(4),await Xi(d),d.Aa.set("Unknown"),d.Ia.delete(4),await Pr(d)})(this))}))})),this.Aa=new _v(i,s)}}async function Pr(n){if(Ji(n))for(const e of n.da)await e(!0)}async function Xi(n){for(const e of n.da)await e(!1)}function Ji(n){return J(n).Ia.size===0}async function Sd(n,e,t){if(!Ki(e))throw e;n.Ia.add(1),await Xi(n),n.Aa.set("Offline"),t||(t=()=>iv(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{M(Yi,"Retrying IndexedDB access"),await t(),n.Ia.delete(1),await Pr(n)}))}function Rd(n,e){return e().catch((t=>Sd(n,t,e)))}async function kr(n){const e=J(n),t=$t(e);let i=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Ia;for(;gv(e);)try{const s=await sv(e.localStore,i);if(s===null){e.Pa.length===0&&t.B_();break}i=s.batchId,yv(e,s)}catch(s){await Sd(e,s)}bd(e)&&Pd(e)}function gv(n){return Ji(n)&&n.Pa.length<10}function yv(n,e){n.Pa.push(e);const t=$t(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function bd(n){return Ji(n)&&!$t(n).M_()&&n.Pa.length>0}function Pd(n){$t(n).start()}async function vv(n){$t(n).na()}async function Ev(n){const e=$t(n);for(const t of n.Pa)e.X_(t.mutations)}async function Tv(n,e,t){const i=n.Pa.shift(),s=Na.from(i,e,t);await Rd(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await kr(n)}async function Iv(n,e){e&&$t(n).Z_&&await(async function(i,s){if((function(a){return gy(a)&&a!==P.ABORTED})(s.code)){const r=i.Pa.shift();$t(i).N_(),await Rd(i,(()=>i.remoteSyncer.rejectFailedWrite(r.batchId,s))),await kr(i)}})(n,e),bd(n)&&Pd(n)}async function cu(n,e){const t=J(n);t.asyncQueue.verifyOperationInProgress(),M(Yi,"RemoteStore received new credentials");const i=Ji(t);t.Ia.add(3),await Xi(t),i&&t.Aa.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),await Pr(t)}async function wv(n,e){const t=J(n);e?(t.Ia.delete(2),await Pr(t)):e||(t.Ia.add(2),await Xi(t),t.Aa.set("Unknown"))}function $t(n){return n.ma||(n.ma=(function(t,i,s){const r=J(t);return r.ia(),new dv(i,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:vv.bind(null,n),n_:Iv.bind(null,n),ea:Ev.bind(null,n),ta:Tv.bind(null,n)}),n.da.push((async e=>{e?(n.ma.N_(),await kr(n)):(await n.ma.stop(),n.Pa.length>0&&(M(Yi,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}class Va{constructor(e,t,i,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=r,this.deferred=new nn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,s,r){const a=Date.now()+i,l=new Va(e,t,a,s,r);return l.start(i),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function kd(n,e){if(ln("AsyncQueue",`${e}: ${n}`),Ki(n))return new V(P.UNAVAILABLE,`${e}: ${n}`);throw n}class Av{constructor(){this.queries=uu(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,i){const s=J(t),r=s.queries;s.queries=uu(),r.forEach(((a,l)=>{for(const u of l.wa)u.onError(i)}))})(this,new V(P.ABORTED,"Firestore shutting down"))}}function uu(){return new mn((n=>ld(n)),ad)}function Cv(n){n.Da.forEach((e=>{e.next()}))}var hu,du;(du=hu||(hu={})).Fa="default",du.Cache="cache";const Sv="SyncEngine";class Rv{constructor(e,t,i,s,r,a){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new mn((l=>ld(l)),ad),this.Tu=new Map,this.Iu=new Set,this.du=new et(x.comparator),this.Eu=new Map,this.Au=new Da,this.Ru={},this.Vu=new Map,this.mu=Wn.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function bv(n,e,t){const i=Dv(n);try{const s=await(function(a,l){const u=J(a),d=se.now(),p=l.reduce(((S,b)=>S.add(b.key)),be());let _,v;return u.persistence.runTransaction("Locally write mutations","readwrite",(S=>{let b=tr(),O=be();return u.Os.getEntries(S,p).next((D=>{b=D,b.forEach(((K,F)=>{F.isValidDocument()||(O=O.add(K))}))})).next((()=>u.localDocuments.getOverlayedDocuments(S,b))).next((D=>{_=D;const K=[];for(const F of l){const W=fy(F,_.get(F.key).overlayedDocument);W!=null&&K.push(new gn(F.key,W,ed(W.value.mapValue),gt.exists(!0)))}return u.mutationQueue.addMutationBatch(S,d,K,l)})).next((D=>{v=D;const K=D.applyToLocalDocumentSet(_,O);return u.documentOverlayCache.saveOverlays(S,D.batchId,K)}))})).then((()=>({batchId:v.batchId,changes:ud(_)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),(function(a,l,u){let d=a.Ru[a.currentUser.toKey()];d||(d=new et(z)),d=d.insert(l,u),a.Ru[a.currentUser.toKey()]=d})(i,s.batchId,t),await Nr(i,s.changes),await kr(i.remoteStore)}catch(s){const r=kd(s,"Failed to persist write");t.reject(r)}}function fu(n,e,t){const i=J(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const s=[];i.Pu.forEach(((r,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const u=J(a);u.onlineState=l;let d=!1;u.queries.forEach(((p,_)=>{for(const v of _.wa)v.va(l)&&(d=!0)})),d&&Cv(u)})(i.eventManager,e),s.length&&i.hu.J_(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Pv(n,e){const t=J(n),i=e.batch.batchId;try{const s=await nv(t.localStore,e);Dd(t,i,null),Nd(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await Nr(t,s)}catch(s){await Ea(s)}}async function kv(n,e,t){const i=J(n);try{const s=await(function(a,l){const u=J(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return u.mutationQueue.lookupMutationBatch(d,l).next((_=>(le(_!==null,37113),p=_.keys(),u.mutationQueue.removeMutationBatch(d,_)))).next((()=>u.mutationQueue.performConsistencyCheck(d))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(d,p,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>u.localDocuments.getDocuments(d,p)))}))})(i.localStore,e);Dd(i,e,t),Nd(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await Nr(i,s)}catch(s){await Ea(s)}}function Nd(n,e){(n.Vu.get(e)||[]).forEach((t=>{t.resolve()})),n.Vu.delete(e)}function Dd(n,e,t){const i=J(n);let s=i.Ru[i.currentUser.toKey()];if(s){const r=s.get(e);r&&(t?r.reject(t):r.resolve(),s=s.remove(e)),i.Ru[i.currentUser.toKey()]=s}}async function Nr(n,e,t){const i=J(n),s=[],r=[],a=[];i.Pu.isEmpty()||(i.Pu.forEach(((l,u)=>{a.push(i.gu(u,e,t).then((d=>{var p;if((d||t)&&i.isPrimaryClient){const _=d?!d.fromCache:(p=void 0)===null||p===void 0?void 0:p.current;i.sharedClientState.updateQueryState(u.targetId,_?"current":"not-current")}if(d){s.push(d);const _=Ma.Es(u.targetId,d);r.push(_)}})))})),await Promise.all(a),i.hu.J_(s),await(async function(u,d){const p=J(u);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>R.forEach(d,(v=>R.forEach(v.Is,(S=>p.persistence.referenceDelegate.addReference(_,v.targetId,S))).next((()=>R.forEach(v.ds,(S=>p.persistence.referenceDelegate.removeReference(_,v.targetId,S)))))))))}catch(_){if(!Ki(_))throw _;M(Zy,"Failed to update sequence numbers: "+_)}for(const _ of d){const v=_.targetId;if(!_.fromCache){const S=p.Fs.get(v),b=S.snapshotVersion,O=S.withLastLimboFreeSnapshotVersion(b);p.Fs=p.Fs.insert(v,O)}}})(i.localStore,r))}async function Nv(n,e){const t=J(n);if(!t.currentUser.isEqual(e)){M(Sv,"User change. New user:",e.toKey());const i=await Ad(t.localStore,e);t.currentUser=e,(function(r,a){r.Vu.forEach((l=>{l.forEach((u=>{u.reject(new V(P.CANCELLED,a))}))})),r.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Nr(t,i.Bs)}}function Dv(n){const e=J(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Pv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kv.bind(null,e),e}class sr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=br(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return tv(this.persistence,new Jy,e.initialUser,this.serializer)}Du(e){return new wd(Oa.Vi,this.serializer)}bu(e){return new rv}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}sr.provider={build:()=>new sr};class Ov extends sr{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){le(this.persistence.referenceDelegate instanceof ir,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new xy(i,e.asyncQueue,t)}Du(e){const t=this.cacheSizeBytes!==void 0?xe.withCacheSize(this.cacheSizeBytes):xe.DEFAULT;return new wd((i=>ir.Vi(i,t)),this.serializer)}}class Go{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>fu(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Nv.bind(null,this.syncEngine),await wv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Av})()}createDatastore(e){const t=br(e.databaseInfo.databaseId),i=(function(r){return new uv(r)})(e.databaseInfo);return(function(r,a,l,u){return new pv(r,a,l,u)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,s,r,a,l){return new mv(i,s,r,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>fu(this.syncEngine,t,0)),(function(){return au.C()?new au:new ov})())}createSyncEngine(e,t){return(function(s,r,a,l,u,d,p){const _=new Rv(s,r,a,l,u,d);return p&&(_.fu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(s){const r=J(s);M(Yi,"RemoteStore shutting down."),r.Ia.add(5),await Xi(r),r.Ea.shutdown(),r.Aa.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Go.provider={build:()=>new Go};const Ht="FirestoreClient";class Mv{constructor(e,t,i,s,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=s,this.user=Re.UNAUTHENTICATED,this.clientId=ya.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(i,(async a=>{M(Ht,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(i,(a=>(M(Ht,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new nn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=kd(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function vo(n,e){n.asyncQueue.verifyOperationInProgress(),M(Ht,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async s=>{i.isEqual(s)||(await Ad(e.localStore,s),i=s)})),e.persistence.setDatabaseDeletedListener((()=>{xn("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then((()=>{M("Terminating Firestore due to IndexedDb database deletion completed successfully")})).catch((s=>{xn("Terminating Firestore due to IndexedDb database deletion failed",s)}))})),n._offlineComponents=e}async function pu(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Vv(n);M(Ht,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>cu(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,s)=>cu(e.remoteStore,s))),n._onlineComponents=e}async function Vv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M(Ht,"Using user provided OfflineComponentProvider");try{await vo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;xn("Error using user provided cache. Falling back to memory cache: "+t),await vo(n,new sr)}}else M(Ht,"Using default OfflineComponentProvider"),await vo(n,new Ov(void 0));return n._offlineComponents}async function Lv(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(M(Ht,"Using user provided OnlineComponentProvider"),await pu(n,n._uninitializedComponentsProvider._online)):(M(Ht,"Using default OnlineComponentProvider"),await pu(n,new Go))),n._onlineComponents}function xv(n){return Lv(n).then((e=>e.syncEngine))}function Od(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const _u=new Map;const Md="firestore.googleapis.com",mu=!0;class gu{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new V(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Md,this.ssl=mu}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:mu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Id;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Vy)throw new V(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}wg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Od((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,s){return i.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Dr{constructor(e,t,i,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new fg;switch(i.type){case"firstParty":return new gg(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new V(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=_u.get(t);i&&(M("ComponentProvider","Removing Datastore"),_u.delete(t),i.terminate())})(this),Promise.resolve()}}function Fv(n,e,t,i={}){var s;n=qh(n,Dr);const r=zt(e),a=n._getSettings(),l=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;r&&(da(`https://${u}`),fa("Firestore",!0)),a.host!==Md&&a.host!==u&&xn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d=Object.assign(Object.assign({},a),{host:u,ssl:r,emulatorOptions:i});if(!Ut(d,l)&&(n._setSettings(d),i.mockUserToken)){let p,_;if(typeof i.mockUserToken=="string")p=i.mockUserToken,_=Re.MOCK_USER;else{p=bh(i.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const v=i.mockUserToken.sub||i.mockUserToken.user_id;if(!v)throw new V(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new Re(v)}n._authCredentials=new pg(new Wh(p,_))}}class La{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new La(this.firestore,e,this._query)}}class Ne{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ne(this.firestore,e,this._key)}toJSON(){return{type:Ne._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(Gi(t,Ne._jsonSchema))return new Ne(e,i||null,new x(oe.fromString(t.referencePath)))}}Ne._jsonSchemaVersion="firestore/documentReference/1.0",Ne._jsonSchema={type:ue("string",Ne._jsonSchemaVersion),referencePath:ue("string")};class xt extends La{constructor(e,t,i){super(e,t,Yg(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ne(this.firestore,null,new x(e))}withConverter(e){return new xt(this.firestore,e,this._path)}}function QA(n,e,...t){if(n=Le(n),$h("collection","path",e),n instanceof Dr){const i=oe.fromString(e,...t);return Uc(i),new xt(n,null,i)}{if(!(n instanceof Ne||n instanceof xt))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(oe.fromString(e,...t));return Uc(i),new xt(n.firestore,null,i)}}function Uv(n,e,...t){if(n=Le(n),arguments.length===1&&(e=ya.newId()),$h("doc","path",e),n instanceof Dr){const i=oe.fromString(e,...t);return Fc(i),new Ne(n,null,new x(i))}{if(!(n instanceof Ne||n instanceof xt))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(oe.fromString(e,...t));return Fc(i),new Ne(n.firestore,n instanceof xt?n.converter:null,new x(i))}}const yu="AsyncQueue";class vu{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Cd(this,"async_queue_retry"),this.oc=()=>{const i=yo();i&&M(yu,"Visibility state changed to "+i.visibilityState),this.F_.y_()},this._c=e;const t=yo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=yo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise((()=>{}));const t=new nn;return this.uc((()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Zu.push(e),this.cc())))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Ki(e))throw e;M(yu,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_((()=>this.cc()))}}uc(e){const t=this._c.then((()=>(this.nc=!0,e().catch((i=>{throw this.tc=i,this.nc=!1,ln("INTERNAL UNHANDLED ERROR: ",Eu(i)),i})).then((i=>(this.nc=!1,i))))));return this._c=t,t}enqueueAfterDelay(e,t,i){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const s=Va.createAndSchedule(this,e,t,i,(r=>this.lc(r)));return this.ec.push(s),s}ac(){this.tc&&U(47125,{hc:Eu(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then((()=>{this.ec.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()}))}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function Eu(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Vd extends Dr{constructor(e,t,i,s){super(e,t,i,s),this.type="firestore",this._queue=new vu,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new vu(e),this._firestoreClient=void 0,await e}}}function Bv(n,e){const t=typeof n=="object"?n:Ar(),i=typeof n=="string"?n:Xs,s=wr(t,"firestore").getImmediate({identifier:i});if(!s._initialized){const r=Ch("firestore");r&&Fv(s,...r)}return s}function jv(n){if(n._terminated)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Wv(n),n._firestoreClient}function Wv(n){var e,t,i;const s=n._freezeSettings(),r=(function(l,u,d,p){return new Vg(l,u,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Od(p.experimentalLongPollingOptions),p.useFetchStreams,p.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=s.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new Mv(n._authCredentials,n._appCheckCredentials,n._queue,r,n._componentsProvider&&(function(l){const u=l?._online.build();return{_offline:l?._offline.build(u),_online:u}})(n._componentsProvider))}class Ge{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ge(ot.fromBase64String(e))}catch(t){throw new V(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ge(ot.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ge._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Gi(e,Ge._jsonSchema))return Ge.fromBase64String(e.bytes)}}Ge._jsonSchemaVersion="firestore/bytes/1.0",Ge._jsonSchema={type:ue("string",Ge._jsonSchemaVersion),bytes:ue("string")};class xa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ee(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Fa{constructor(e){this._methodName=e}}class yt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return z(this._lat,e._lat)||z(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:yt._jsonSchemaVersion}}static fromJSON(e){if(Gi(e,yt._jsonSchema))return new yt(e.latitude,e.longitude)}}yt._jsonSchemaVersion="firestore/geoPoint/1.0",yt._jsonSchema={type:ue("string",yt._jsonSchemaVersion),latitude:ue("number"),longitude:ue("number")};class vt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,s){if(i.length!==s.length)return!1;for(let r=0;r<i.length;++r)if(i[r]!==s[r])return!1;return!0})(this._values,e._values)}toJSON(){return{type:vt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Gi(e,vt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new vt(e.vectorValues);throw new V(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}vt._jsonSchemaVersion="firestore/vectorValue/1.0",vt._jsonSchema={type:ue("string",vt._jsonSchemaVersion),vectorValues:ue("object")};const $v=/^__.*__$/;class Hv{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new gn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qi(e,this.data,t,this.fieldTransforms)}}function Ld(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U(40011,{Ec:n})}}class Ua{constructor(e,t,i,s,r,a){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=s,r===void 0&&this.Ac(),this.fieldTransforms=r||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new Ua(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Rc({path:i,mc:!1});return s.fc(e),s}gc(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Rc({path:i,mc:!1});return s.Ac(),s}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return rr(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(Ld(this.Ec)&&$v.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class qv{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||br(e)}Dc(e,t,i,s=!1){return new Ua({Ec:e,methodName:t,bc:i,path:Ee.emptyPath(),mc:!1,Sc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function zv(n){const e=n._freezeSettings(),t=br(n._databaseId);return new qv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Gv(n,e,t,i,s,r={}){const a=n.Dc(r.merge||r.mergeFields?2:0,e,t,s);Bd("Data must be an object, but it was:",a,i);const l=Fd(i,a);let u,d;if(r.merge)u=new Qe(a.fieldMask),d=a.fieldTransforms;else if(r.mergeFields){const p=[];for(const _ of r.mergeFields){const v=Kv(e,_,t);if(!a.contains(v))throw new V(P.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Yv(p,v)||p.push(v)}u=new Qe(p),d=a.fieldTransforms.filter((_=>u.covers(_.field)))}else u=null,d=a.fieldTransforms;return new Hv(new ze(l),u,d)}class Ba extends Fa{_toFieldTransform(e){return new cy(e.path,new Ui)}isEqual(e){return e instanceof Ba}}function xd(n,e){if(Ud(n=Le(n)))return Bd("Unsupported field value:",e,n),Fd(n,e);if(n instanceof Fa)return(function(i,s){if(!Ld(s.Ec))throw s.wc(`${i._methodName}() can only be used with update() and set()`);if(!s.path)throw s.wc(`${i._methodName}() is not currently supported inside arrays`);const r=i._toFieldTransform(s);r&&s.fieldTransforms.push(r)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(i,s){const r=[];let a=0;for(const l of i){let u=xd(l,s.yc(a));u==null&&(u={nullValue:"NULL_VALUE"}),r.push(u),a++}return{arrayValue:{values:r}}})(n,e)}return(function(i,s){if((i=Le(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return oy(s.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const r=se.fromDate(i);return{timestampValue:$o(s.serializer,r)}}if(i instanceof se){const r=new se(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:$o(s.serializer,r)}}if(i instanceof yt)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Ge)return{bytesValue:Ey(s.serializer,i._byteString)};if(i instanceof Ne){const r=s.databaseId,a=i.firestore._databaseId;if(!a.isEqual(r))throw s.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Ed(i.firestore._databaseId||s.databaseId,i._key.path)}}if(i instanceof vt)return(function(a,l){return{mapValue:{fields:{[Jh]:{stringValue:Zh},[Fo]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.wc("VectorValues must only contain numeric values.");return ka(l.serializer,d)}))}}}}}})(i,s);throw s.wc(`Unsupported field value: ${va(i)}`)})(n,e)}function Fd(n,e){const t={};return Gh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Qn(n,((i,s)=>{const r=xd(s,e.Vc(i));r!=null&&(t[i]=r)})),{mapValue:{fields:t}}}function Ud(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof se||n instanceof yt||n instanceof Ge||n instanceof Ne||n instanceof Fa||n instanceof vt)}function Bd(n,e,t){if(!Ud(t)||!Hh(t)){const i=va(t);throw i==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+i)}}function Kv(n,e,t){if((e=Le(e))instanceof xa)return e._internalPath;if(typeof e=="string")return jd(n,e);throw rr("Field path arguments must be of type string or ",n,!1,void 0,t)}const Qv=new RegExp("[~\\*/\\[\\]]");function jd(n,e,t){if(e.search(Qv)>=0)throw rr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new xa(...e.split("."))._internalPath}catch{throw rr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function rr(n,e,t,i,s){const r=i&&!i.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(r||a)&&(u+=" (found",r&&(u+=` in field ${i}`),a&&(u+=` in document ${s}`),u+=")"),new V(P.INVALID_ARGUMENT,l+n+u)}function Yv(n,e){return n.some((t=>t.isEqual(e)))}class Wd{constructor(e,t,i,s,r){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Ne(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Xv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($d("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Xv extends Wd{data(){return super.data()}}function $d(n,e){return typeof e=="string"?jd(n,e):e instanceof xa?e._internalPath:e._delegate._internalPath}function Jv(n,e,t){let i;return i=n?n.toFirestore(e):e,i}class Ns{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class kn extends Wd{constructor(e,t,i,s,r,a){super(e,t,i,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Bs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field($d("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=kn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}kn._jsonSchemaVersion="firestore/documentSnapshot/1.0",kn._jsonSchema={type:ue("string",kn._jsonSchemaVersion),bundleSource:ue("string","DocumentSnapshot"),bundleName:ue("string"),bundle:ue("string")};class Bs extends kn{data(e={}){return super.data(e)}}class bi{constructor(e,t,i,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ns(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new Bs(this._firestore,this._userDataWriter,i.key,i,new Ns(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,r){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const u=new Bs(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ns(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>r||l.type!==3)).map((l=>{const u=new Bs(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ns(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:Zv(l.type),doc:u,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=bi._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ya.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],s=[];return this.docs.forEach((r=>{r._document!==null&&(t.push(r._document),i.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),s.push(r.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Zv(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U(61501,{type:n})}}bi._jsonSchemaVersion="firestore/querySnapshot/1.0",bi._jsonSchema={type:ue("string",bi._jsonSchemaVersion),bundleSource:ue("string","QuerySnapshot"),bundleName:ue("string"),bundle:ue("string")};function YA(n,e){const t=qh(n.firestore,Vd),i=Uv(n),s=Jv(n.converter,e);return eE(t,[Gv(zv(n.firestore),"addDoc",i._key,s,n.converter!==null,{}).toMutation(i._key,gt.exists(!1))]).then((()=>i))}function eE(n,e){return(function(i,s){const r=new nn;return i.asyncQueue.enqueueAndForget((async()=>bv(await xv(i),s,r))),r.promise})(jv(n),e)}function XA(){return new Ba("serverTimestamp")}(function(e,t=!0){(function(s){Kn=s})(_n),on(new Bt("firestore",((i,{instanceIdentifier:s,options:r})=>{const a=i.getProvider("app").getImmediate(),l=new Vd(new _g(i.getProvider("auth-internal")),new yg(a,i.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Js(d.options.projectId,p)})(a,s),a);return r=Object.assign({useFetchStreams:t},r),l._setSettings(r),l}),"PUBLIC").setMultipleInstances(!0)),st(Oc,Mc,e),st(Oc,Mc,"esm2017")})();var Tu={};const Iu="@firebase/database",wu="1.0.20";let Hd="";function tE(n){Hd=n}class nE{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ve(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Mi(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class iE{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ct(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const qd=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new nE(e)}}catch{}return new iE},en=qd("localStorage"),sE=qd("sessionStorage");const Nn=new Ir("@firebase/database"),rE=(function(){let n=1;return function(){return n++}})(),zd=function(n){const e=tm(n),t=new Y_;t.update(e);const i=t.digest();return ua.encodeByteArray(i)},Zi=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Zi.apply(null,i):typeof i=="object"?e+=ve(i):e+=i,e+=" "}return e};let Pi=null,Au=!0;const oE=function(n,e){N(!0,"Can't turn on custom loggers persistently."),Nn.logLevel=B.VERBOSE,Pi=Nn.log.bind(Nn)},Pe=function(...n){if(Au===!0&&(Au=!1,Pi===null&&sE.get("logging_enabled")===!0&&oE()),Pi){const e=Zi.apply(null,n);Pi(e)}},es=function(n){return function(...e){Pe(n,...e)}},Ko=function(...n){const e="FIREBASE INTERNAL ERROR: "+Zi(...n);Nn.error(e)},It=function(...n){const e=`FIREBASE FATAL ERROR: ${Zi(...n)}`;throw Nn.error(e),new Error(e)},Be=function(...n){const e="FIREBASE WARNING: "+Zi(...n);Nn.warn(e)},aE=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Be("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Gd=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},lE=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},$n="[MIN_NAME]",hn="[MAX_NAME]",Yn=function(n,e){if(n===e)return 0;if(n===$n||e===hn)return-1;if(e===$n||n===hn)return 1;{const t=Cu(n),i=Cu(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},cE=function(n,e){return n===e?0:n<e?-1:1},yi=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ve(e))},ja=function(n){if(typeof n!="object"||n===null)return ve(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=ve(e[i]),t+=":",t+=ja(n[e[i]]);return t+="}",t},Kd=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function $e(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Qd=function(n){N(!Gd(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,r,a,l,u;n===0?(r=0,a=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=l+i,a=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(r=0,a=Math.round(n/Math.pow(2,1-i-t))));const d=[];for(u=t;u;u-=1)d.push(a%2?1:0),a=Math.floor(a/2);for(u=e;u;u-=1)d.push(r%2?1:0),r=Math.floor(r/2);d.push(s?1:0),d.reverse();const p=d.join("");let _="";for(u=0;u<64;u+=8){let v=parseInt(p.substr(u,8),2).toString(16);v.length===1&&(v="0"+v),_=_+v}return _.toLowerCase()},uE=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},hE=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},dE=new RegExp("^-?(0*)\\d{1,10}$"),fE=-2147483648,pE=2147483647,Cu=function(n){if(dE.test(n)){const e=Number(n);if(e>=fE&&e<=pE)return e}return null},ts=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Be("Exception was thrown by user callback.",t),e},Math.floor(0))}},_E=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ki=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class mE{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,je(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){Be(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class gE{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Pe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Be(e)}}class js{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}js.OWNER="owner";const Wa="5",Yd="v",Xd="s",Jd="r",Zd="f",ef=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,tf="ls",nf="p",Qo="ac",sf="websocket",rf="long_polling";class of{constructor(e,t,i,s,r=!1,a="",l=!1,u=!1,d=null){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=u,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=en.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&en.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function yE(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function af(n,e,t){N(typeof e=="string","typeof type must == string"),N(typeof t=="object","typeof params must == object");let i;if(e===sf)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===rf)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);yE(n)&&(t.ns=n.namespace);const s=[];return $e(t,(r,a)=>{s.push(r+"="+a)}),i+s.join("&")}class vE{constructor(){this.counters_={}}incrementCounter(e,t=1){Ct(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return P_(this.counters_)}}const Eo={},To={};function $a(n){const e=n.toString();return Eo[e]||(Eo[e]=new vE),Eo[e]}function EE(n,e){const t=n.toString();return To[t]||(To[t]=e()),To[t]}class TE{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&ts(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Su="start",IE="close",wE="pLPCommand",AE="pRTLPCB",lf="id",cf="pw",uf="ser",CE="cb",SE="seg",RE="ts",bE="d",PE="dframe",hf=1870,df=30,kE=hf-df,NE=25e3,DE=3e4;class Rn{constructor(e,t,i,s,r,a,l){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=es(e),this.stats_=$a(t),this.urlFn=u=>(this.appCheckToken&&(u[Qo]=this.appCheckToken),af(t,rf,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new TE(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(DE)),lE(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ha((...r)=>{const[a,l,u,d,p]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===Su)this.id=l,this.password=u;else if(a===IE)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...r)=>{const[a,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);const i={};i[Su]="t",i[uf]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[CE]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Yd]=Wa,this.transportSessionId&&(i[Xd]=this.transportSessionId),this.lastSessionId&&(i[tf]=this.lastSessionId),this.applicationId&&(i[nf]=this.applicationId),this.appCheckToken&&(i[Qo]=this.appCheckToken),typeof location<"u"&&location.hostname&&ef.test(location.hostname)&&(i[Jd]=Zd);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Rn.forceAllow_=!0}static forceDisallow(){Rn.forceDisallow_=!0}static isAvailable(){return Rn.forceAllow_?!0:!Rn.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!uE()&&!hE()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Ih(t),s=Kd(i,kE);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[PE]="t",i[lf]=e,i[cf]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=ve(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ha{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=rE(),window[wE+this.uniqueCallbackIdentifier]=e,window[AE+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ha.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){Pe("frame writing exception"),l.stack&&Pe(l.stack),Pe(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Pe("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[lf]=this.myID,e[cf]=this.myPW,e[uf]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+df+i.length<=hf;){const a=this.pendingSegs.shift();i=i+"&"+SE+s+"="+a.seg+"&"+RE+s+"="+a.ts+"&"+bE+s+"="+a.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(NE)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Pe("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}const OE=16384,ME=45e3;let or=null;typeof MozWebSocket<"u"?or=MozWebSocket:typeof WebSocket<"u"&&(or=WebSocket);class Ke{constructor(e,t,i,s,r,a,l){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=es(this.connId),this.stats_=$a(t),this.connURL=Ke.connectionURL_(t,a,l,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s,r){const a={};return a[Yd]=Wa,typeof location<"u"&&location.hostname&&ef.test(location.hostname)&&(a[Jd]=Zd),t&&(a[Xd]=t),i&&(a[tf]=i),s&&(a[Qo]=s),r&&(a[nf]=r),af(e,sf,a)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,en.set("previous_websocket_failure",!0);try{let i;j_(),this.mySock=new or(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Ke.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&or!==null&&!Ke.forceDisallow_}static previouslyFailed(){return en.isInMemoryStorage||en.get("previous_websocket_failure")===!0}markConnectionHealthy(){en.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=Mi(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(N(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Kd(t,OE);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(ME))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ke.responsesRequiredToBeHealthy=2;Ke.healthyTimeout=3e4;class Wi{static get ALL_TRANSPORTS(){return[Rn,Ke]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Ke&&Ke.isAvailable();let i=t&&!Ke.previouslyFailed();if(e.webSocketOnly&&(t||Be("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ke];else{const s=this.transports_=[];for(const r of Wi.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);Wi.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Wi.globalTransportInitialized_=!1;const VE=6e4,LE=5e3,xE=10*1024,FE=100*1024,Io="t",Ru="d",UE="s",bu="r",BE="e",Pu="o",ku="a",Nu="n",Du="p",jE="h";class WE{constructor(e,t,i,s,r,a,l,u,d,p){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=u,this.onKill_=d,this.lastSessionId=p,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=es("c:"+this.id+":"),this.transportManager_=new Wi(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=ki(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>FE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>xE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Io in e){const t=e[Io];t===ku?this.upgradeIfSecondaryHealthy_():t===bu?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Pu&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=yi("t",e),i=yi("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Du,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ku,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Nu,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=yi("t",e),i=yi("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=yi(Io,e);if(Ru in e){const i=e[Ru];if(t===jE){const s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===Nu){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===UE?this.onConnectionShutdown_(i):t===bu?this.onReset_(i):t===BE?Ko("Server Error: "+i):t===Pu?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ko("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Wa!==i&&Be("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ki(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(VE))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ki(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(LE))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Du,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(en.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ff{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class pf{constructor(e){this.allowedEvents_=e,this.listeners_={},N(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){N(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ar extends pf{static getInstance(){return new ar}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!pa()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return N(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Ou=32,Mu=768;class ne{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Y(){return new ne("")}function H(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function qt(n){return n.pieces_.length-n.pieceNum_}function te(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ne(n.pieces_,e)}function _f(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function $E(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function mf(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function gf(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ne(e,0)}function me(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof ne)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new ne(t,0)}function j(n){return n.pieceNum_>=n.pieces_.length}function We(n,e){const t=H(n),i=H(e);if(t===null)return e;if(t===i)return We(te(n),te(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function yf(n,e){if(qt(n)!==qt(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Ye(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(qt(n)>qt(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class HE{constructor(e,t){this.errorPrefix_=t,this.parts_=mf(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Tr(this.parts_[i]);vf(this)}}function qE(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Tr(e),vf(n)}function zE(n){const e=n.parts_.pop();n.byteLength_-=Tr(e),n.parts_.length>0&&(n.byteLength_-=1)}function vf(n){if(n.byteLength_>Mu)throw new Error(n.errorPrefix_+"has a key path longer than "+Mu+" bytes ("+n.byteLength_+").");if(n.parts_.length>Ou)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ou+") or object contains a cycle "+Jt(n))}function Jt(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class qa extends pf{static getInstance(){return new qa}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return N(e==="visible","Unknown event type: "+e),[this.visible_]}}const vi=1e3,GE=300*1e3,Vu=30*1e3,KE=1.3,QE=3e4,YE="server_kill",Lu=3;class Et extends ff{constructor(e,t,i,s,r,a,l,u){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=u,this.id=Et.nextPersistentConnectionId_++,this.log_=es("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=vi,this.maxReconnectDelay_=GE,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");qa.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ar.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,r={r:s,a:e,b:t};this.log_(ve(r)),N(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new ha,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const l=a.d;a.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,i,s){this.initConnection_();const r=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+r),this.listens.has(a)||this.listens.set(a,new Map),N(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),N(!this.listens.get(a).has(r),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(a).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i},a="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(a,r,l=>{const u=l.d,d=l.s;Et.warnOnListenWarnings_(u,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(d,u))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ct(e,"w")){const i=Ln(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();Be(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Q_(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Vu)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=K_(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const r=s.s,a=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),N(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const r={p:e},a="n";s&&(r.q=i,r.t=s),this.sendRequest(a,r)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const r={p:t,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,r){this.initConnection_();const a={p:t,d:i};r!==void 0&&(a.h=r),this.outstandingPuts_.push({action:e,request:a,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ve(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Ko("Unrecognized action received from server: "+ve(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){N(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=vi,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=vi,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>QE&&(this.reconnectDelay_=vi),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*KE)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Et.nextConnectionId_++,r=this.lastSessionId;let a=!1,l=null;const u=function(){l?l.close():(a=!0,i())},d=function(_){N(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(_)};this.realtime_={close:u,sendRequest:d};const p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[_,v]=await Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?Pe("getToken() completed but was canceled"):(Pe("getToken() completed. Creating connection."),this.authToken_=_&&_.accessToken,this.appCheckToken_=v&&v.token,l=new WE(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,S=>{Be(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(YE)},r))}catch(_){this.log_("Failed to get token: "+_),a||(this.repoInfo_.nodeAdmin&&Be(_),u())}}}interrupt(e){Pe("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Pe("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Po(this.interruptReasons_)&&(this.reconnectDelay_=vi,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(r=>ja(r)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new ne(e).toString();let s;if(this.listens.has(i)){const r=this.listens.get(i);s=r.get(t),r.delete(t),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){Pe("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Lu&&(this.reconnectDelay_=Vu,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Pe("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Lu&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Hd.replace(/\./g,"-")]=1,pa()?e["framework.cordova"]=1:Ph()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ar.getInstance().currentlyOnline();return Po(this.interruptReasons_)&&e}}Et.nextPersistentConnectionId_=0;Et.nextConnectionId_=0;class q{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new q(e,t)}}class Or{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new q($n,e),s=new q($n,t);return this.compare(i,s)!==0}minPost(){return q.MIN}}let Ds;class Ef extends Or{static get __EMPTY_NODE(){return Ds}static set __EMPTY_NODE(e){Ds=e}compare(e,t){return Yn(e.name,t.name)}isDefinedOn(e){throw zn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return q.MIN}maxPost(){return new q(hn,Ds)}makePost(e,t){return N(typeof e=="string","KeyIndex indexValue must always be a string."),new q(e,Ds)}toString(){return".key"}}const Dn=new Ef;class Os{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=t?i(e.key,t):1,s&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class pe{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i??pe.RED,this.left=s??Fe.EMPTY_NODE,this.right=r??Fe.EMPTY_NODE}copy(e,t,i,s,r){return new pe(e??this.key,t??this.value,i??this.color,s??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Fe.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return Fe.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,pe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,pe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}pe.RED=!0;pe.BLACK=!1;class XE{copy(e,t,i,s,r){return this}insert(e,t,i){return new pe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Fe{constructor(e,t=Fe.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Fe(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,pe.BLACK,null,null))}remove(e){return new Fe(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,pe.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Os(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Os(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Os(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Os(this.root_,null,this.comparator_,!0,e)}}Fe.EMPTY_NODE=new XE;function JE(n,e){return Yn(n.name,e.name)}function za(n,e){return Yn(n,e)}let Yo;function ZE(n){Yo=n}const Tf=function(n){return typeof n=="number"?"number:"+Qd(n):"string:"+n},If=function(n){if(n.isLeafNode()){const e=n.val();N(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ct(e,".sv"),"Priority must be a string or number.")}else N(n===Yo||n.isEmpty(),"priority of unexpected type.");N(n===Yo||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let xu;class de{static set __childrenNodeConstructor(e){xu=e}static get __childrenNodeConstructor(){return xu}constructor(e,t=de.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,N(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),If(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new de(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:de.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return j(e)?this:H(e)===".priority"?this.priorityNode_:de.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:de.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=H(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(N(i!==".priority"||qt(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,de.__childrenNodeConstructor.EMPTY_NODE.updateChild(te(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Tf(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Qd(this.value_):e+=this.value_,this.lazyHash_=zd(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===de.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof de.__childrenNodeConstructor?-1:(N(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=de.VALUE_TYPE_ORDER.indexOf(t),r=de.VALUE_TYPE_ORDER.indexOf(i);return N(s>=0,"Unknown leaf type: "+t),N(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}de.VALUE_TYPE_ORDER=["object","boolean","number","string"];let wf,Af;function eT(n){wf=n}function tT(n){Af=n}class nT extends Or{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?Yn(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return q.MIN}maxPost(){return new q(hn,new de("[PRIORITY-POST]",Af))}makePost(e,t){const i=wf(e);return new q(t,new de("[PRIORITY-POST]",i))}toString(){return".priority"}}const De=new nT;const iT=Math.log(2);class sT{constructor(e){const t=r=>parseInt(Math.log(r)/iT,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const lr=function(n,e,t,i){n.sort(e);const s=function(u,d){const p=d-u;let _,v;if(p===0)return null;if(p===1)return _=n[u],v=t?t(_):_,new pe(v,_.node,pe.BLACK,null,null);{const S=parseInt(p/2,10)+u,b=s(u,S),O=s(S+1,d);return _=n[S],v=t?t(_):_,new pe(v,_.node,pe.BLACK,b,O)}},r=function(u){let d=null,p=null,_=n.length;const v=function(b,O){const D=_-b,K=_;_-=b;const F=s(D+1,K),W=n[D],re=t?t(W):W;S(new pe(re,W.node,O,null,F))},S=function(b){d?(d.left=b,d=b):(p=b,d=b)};for(let b=0;b<u.count;++b){const O=u.nextBitIsOne(),D=Math.pow(2,u.count-(b+1));O?v(D,pe.BLACK):(v(D,pe.BLACK),v(D,pe.RED))}return p},a=new sT(n.length),l=r(a);return new Fe(i||e,l)};let wo;const An={};class pt{static get Default(){return N(An&&De,"ChildrenNode.ts has not been loaded"),wo=wo||new pt({".priority":An},{".priority":De}),wo}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ln(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Fe?t:null}hasIndex(e){return Ct(this.indexSet_,e.toString())}addIndex(e,t){N(e!==Dn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(q.Wrap);let a=r.getNext();for(;a;)s=s||e.isDefinedOn(a.node),i.push(a),a=r.getNext();let l;s?l=lr(i,e.getCompare()):l=An;const u=e.toString(),d=Object.assign({},this.indexSet_);d[u]=e;const p=Object.assign({},this.indexes_);return p[u]=l,new pt(p,d)}addToIndexes(e,t){const i=Ks(this.indexes_,(s,r)=>{const a=Ln(this.indexSet_,r);if(N(a,"Missing index implementation for "+r),s===An)if(a.isDefinedOn(e.node)){const l=[],u=t.getIterator(q.Wrap);let d=u.getNext();for(;d;)d.name!==e.name&&l.push(d),d=u.getNext();return l.push(e),lr(l,a.getCompare())}else return An;else{const l=t.get(e.name);let u=s;return l&&(u=u.remove(new q(e.name,l))),u.insert(e,e.node)}});return new pt(i,this.indexSet_)}removeFromIndexes(e,t){const i=Ks(this.indexes_,s=>{if(s===An)return s;{const r=t.get(e.name);return r?s.remove(new q(e.name,r)):s}});return new pt(i,this.indexSet_)}}let Ei;class Q{static get EMPTY_NODE(){return Ei||(Ei=new Q(new Fe(za),null,pt.Default))}constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&If(this.priorityNode_),this.children_.isEmpty()&&N(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ei}updatePriority(e){return this.children_.isEmpty()?this:new Q(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Ei:t}}getChild(e){const t=H(e);return t===null?this:this.getImmediateChild(t).getChild(te(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(N(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new q(e,t);let s,r;t.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));const a=s.isEmpty()?Ei:this.priorityNode_;return new Q(s,a,r)}}updateChild(e,t){const i=H(e);if(i===null)return t;{N(H(e)!==".priority"||qt(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(te(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,r=!0;if(this.forEachChild(De,(a,l)=>{t[a]=l.val(e),i++,r&&Q.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):r=!1}),!e&&r&&s<2*i){const a=[];for(const l in t)a[l]=t[l];return a}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Tf(this.getPriority().val())+":"),this.forEachChild(De,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":zd(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const r=s.getPredecessorKey(new q(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new q(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new q(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,q.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,q.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ns?-1:0}withIndex(e){if(e===Dn||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Q(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Dn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(De),s=t.getIterator(De);let r=i.getNext(),a=s.getNext();for(;r&&a;){if(r.name!==a.name||!r.node.equals(a.node))return!1;r=i.getNext(),a=s.getNext()}return r===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===Dn?null:this.indexMap_.get(e.toString())}}Q.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class rT extends Q{constructor(){super(new Fe(za),Q.EMPTY_NODE,pt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Q.EMPTY_NODE}isEmpty(){return!1}}const ns=new rT;Object.defineProperties(q,{MIN:{value:new q($n,Q.EMPTY_NODE)},MAX:{value:new q(hn,ns)}});Ef.__EMPTY_NODE=Q.EMPTY_NODE;de.__childrenNodeConstructor=Q;ZE(ns);tT(ns);const oT=!0;function ke(n,e=null){if(n===null)return Q.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),N(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new de(t,ke(e))}if(!(n instanceof Array)&&oT){const t=[];let i=!1;if($e(n,(a,l)=>{if(a.substring(0,1)!=="."){const u=ke(l);u.isEmpty()||(i=i||!u.getPriority().isEmpty(),t.push(new q(a,u)))}}),t.length===0)return Q.EMPTY_NODE;const r=lr(t,JE,a=>a.name,za);if(i){const a=lr(t,De.getCompare());return new Q(r,ke(e),new pt({".priority":a},{".priority":De}))}else return new Q(r,ke(e),pt.Default)}else{let t=Q.EMPTY_NODE;return $e(n,(i,s)=>{if(Ct(n,i)&&i.substring(0,1)!=="."){const r=ke(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(ke(e))}}eT(ke);class aT extends Or{constructor(e){super(),this.indexPath_=e,N(!j(e)&&H(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?Yn(e.name,t.name):r}makePost(e,t){const i=ke(e),s=Q.EMPTY_NODE.updateChild(this.indexPath_,i);return new q(t,s)}maxPost(){const e=Q.EMPTY_NODE.updateChild(this.indexPath_,ns);return new q(hn,e)}toString(){return mf(this.indexPath_,0).join("/")}}class lT extends Or{compare(e,t){const i=e.node.compareTo(t.node);return i===0?Yn(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return q.MIN}maxPost(){return q.MAX}makePost(e,t){const i=ke(e);return new q(t,i)}toString(){return".value"}}const cT=new lT;function uT(n){return{type:"value",snapshotNode:n}}function hT(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function dT(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Fu(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function fT(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Ga{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=De}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return N(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return N(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:$n}hasEnd(){return this.endSet_}getIndexEndValue(){return N(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return N(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:hn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return N(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===De}copy(){const e=new Ga;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Uu(n){const e={};if(n.isDefault())return e;let t;if(n.index_===De?t="$priority":n.index_===cT?t="$value":n.index_===Dn?t="$key":(N(n.index_ instanceof aT,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ve(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=ve(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+ve(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=ve(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+ve(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Bu(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==De&&(e.i=n.index_.toString()),e}class cr extends ff{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(N(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=es("p:rest:"),this.listens_={}}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const a=cr.getListenId_(e,i),l={};this.listens_[a]=l;const u=Uu(e._queryParams);this.restRequest_(r+".json",u,(d,p)=>{let _=p;if(d===404&&(_=null,d=null),d===null&&this.onDataUpdate_(r,_,!1,i),Ln(this.listens_,a)===l){let v;d?d===401?v="permission_denied":v="rest_error:"+d:v="ok",s(v,null)}})}unlisten(e,t){const i=cr.getListenId_(e,t);delete this.listens_[i]}get(e){const t=Uu(e._queryParams),i=e._path.toString(),s=new ha;return this.restRequest_(i+".json",t,(r,a)=>{let l=a;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(i,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Gn(t);this.log_("Sending REST request for "+a);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(i&&l.readyState===4){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let u=null;if(l.status>=200&&l.status<300){try{u=Mi(l.responseText)}catch{Be("Failed to parse JSON response for "+a+": "+l.responseText)}i(null,u)}else l.status!==401&&l.status!==404&&Be("Got unsuccessful REST response for "+a+" Status: "+l.status),i(l.status);i=null}},l.open("GET",a,!0),l.send()})}}class pT{constructor(){this.rootNode_=Q.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ur(){return{value:null,children:new Map}}function Cf(n,e,t){if(j(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=H(e);n.children.has(i)||n.children.set(i,ur());const s=n.children.get(i);e=te(e),Cf(s,e,t)}}function Xo(n,e,t){n.value!==null?t(e,n.value):_T(n,(i,s)=>{const r=new ne(e.toString()+"/"+i);Xo(s,r,t)})}function _T(n,e){n.children.forEach((t,i)=>{e(i,t)})}class mT{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&$e(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}const ju=10*1e3,gT=30*1e3,yT=300*1e3;class vT{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new mT(e);const i=ju+(gT-ju)*Math.random();ki(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;$e(e,(s,r)=>{r>0&&Ct(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),ki(this.reportStats_.bind(this),Math.floor(Math.random()*2*yT))}}var it;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(it||(it={}));function Sf(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Rf(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function bf(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class hr{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=it.ACK_USER_WRITE,this.source=Sf()}operationForChild(e){if(j(this.path)){if(this.affectedTree.value!=null)return N(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ne(e));return new hr(Y(),t,this.revert)}}else return N(H(this.path)===e,"operationForChild called for unrelated child."),new hr(te(this.path),this.affectedTree,this.revert)}}class dn{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=it.OVERWRITE}operationForChild(e){return j(this.path)?new dn(this.source,Y(),this.snap.getImmediateChild(e)):new dn(this.source,te(this.path),this.snap)}}class $i{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=it.MERGE}operationForChild(e){if(j(this.path)){const t=this.children.subtree(new ne(e));return t.isEmpty()?null:t.value?new dn(this.source,Y(),t.value):new $i(this.source,Y(),t)}else return N(H(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new $i(this.source,te(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ka{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(j(e))return this.isFullyInitialized()&&!this.filtered_;const t=H(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function ET(n,e,t,i){const s=[],r=[];return e.forEach(a=>{a.type==="child_changed"&&n.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&r.push(fT(a.childName,a.snapshotNode))}),Ti(n,s,"child_removed",e,i,t),Ti(n,s,"child_added",e,i,t),Ti(n,s,"child_moved",r,i,t),Ti(n,s,"child_changed",e,i,t),Ti(n,s,"value",e,i,t),s}function Ti(n,e,t,i,s,r){const a=i.filter(l=>l.type===t);a.sort((l,u)=>IT(n,l,u)),a.forEach(l=>{const u=TT(n,l,r);s.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(u,n.query_))})})}function TT(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function IT(n,e,t){if(e.childName==null||t.childName==null)throw zn("Should only compare child_ events.");const i=new q(e.childName,e.snapshotNode),s=new q(t.childName,t.snapshotNode);return n.index_.compare(i,s)}function Pf(n,e){return{eventCache:n,serverCache:e}}function Ni(n,e,t,i){return Pf(new Ka(e,t,i),n.serverCache)}function kf(n,e,t,i){return Pf(n.eventCache,new Ka(e,t,i))}function Jo(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function fn(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Ao;const wT=()=>(Ao||(Ao=new Fe(cE)),Ao);class ee{static fromObject(e){let t=new ee(null);return $e(e,(i,s)=>{t=t.set(new ne(i),s)}),t}constructor(e,t=wT()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Y(),value:this.value};if(j(e))return null;{const i=H(e),s=this.children.get(i);if(s!==null){const r=s.findRootMostMatchingPathAndValue(te(e),t);return r!=null?{path:me(new ne(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(j(e))return this;{const t=H(e),i=this.children.get(t);return i!==null?i.subtree(te(e)):new ee(null)}}set(e,t){if(j(e))return new ee(t,this.children);{const i=H(e),r=(this.children.get(i)||new ee(null)).set(te(e),t),a=this.children.insert(i,r);return new ee(this.value,a)}}remove(e){if(j(e))return this.children.isEmpty()?new ee(null):new ee(null,this.children);{const t=H(e),i=this.children.get(t);if(i){const s=i.remove(te(e));let r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new ee(null):new ee(this.value,r)}else return this}}get(e){if(j(e))return this.value;{const t=H(e),i=this.children.get(t);return i?i.get(te(e)):null}}setTree(e,t){if(j(e))return t;{const i=H(e),r=(this.children.get(i)||new ee(null)).setTree(te(e),t);let a;return r.isEmpty()?a=this.children.remove(i):a=this.children.insert(i,r),new ee(this.value,a)}}fold(e){return this.fold_(Y(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(me(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Y(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(j(e))return null;{const r=H(e),a=this.children.get(r);return a?a.findOnPath_(te(e),me(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Y(),t)}foreachOnPath_(e,t,i){if(j(e))return this;{this.value&&i(t,this.value);const s=H(e),r=this.children.get(s);return r?r.foreachOnPath_(te(e),me(t,s),i):new ee(null)}}foreach(e){this.foreach_(Y(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(me(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class Je{constructor(e){this.writeTree_=e}static empty(){return new Je(new ee(null))}}function Di(n,e,t){if(j(e))return new Je(new ee(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let r=i.value;const a=We(s,e);return r=r.updateChild(a,t),new Je(n.writeTree_.set(s,r))}else{const s=new ee(t),r=n.writeTree_.setTree(e,s);return new Je(r)}}}function Wu(n,e,t){let i=n;return $e(t,(s,r)=>{i=Di(i,me(e,s),r)}),i}function $u(n,e){if(j(e))return Je.empty();{const t=n.writeTree_.setTree(e,new ee(null));return new Je(t)}}function Zo(n,e){return yn(n,e)!=null}function yn(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(We(t.path,e)):null}function Hu(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(De,(i,s)=>{e.push(new q(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new q(i,s.value))}),e}function Ft(n,e){if(j(e))return n;{const t=yn(n,e);return t!=null?new Je(new ee(t)):new Je(n.writeTree_.subtree(e))}}function ea(n){return n.writeTree_.isEmpty()}function Hn(n,e){return Nf(Y(),n.writeTree_,e)}function Nf(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(N(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=Nf(me(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(me(n,".priority"),i)),t}}function Df(n,e){return xf(e,n)}function AT(n,e,t,i,s){N(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=Di(n.visibleWrites,e,t)),n.lastWriteId=i}function CT(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function ST(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);N(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,a=n.allWrites.length-1;for(;s&&a>=0;){const l=n.allWrites[a];l.visible&&(a>=t&&RT(l,i.path)?s=!1:Ye(i.path,l.path)&&(r=!0)),a--}if(s){if(r)return bT(n),!0;if(i.snap)n.visibleWrites=$u(n.visibleWrites,i.path);else{const l=i.children;$e(l,u=>{n.visibleWrites=$u(n.visibleWrites,me(i.path,u))})}return!0}else return!1}function RT(n,e){if(n.snap)return Ye(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ye(me(n.path,t),e))return!0;return!1}function bT(n){n.visibleWrites=Of(n.allWrites,PT,Y()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function PT(n){return n.visible}function Of(n,e,t){let i=Je.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const a=r.path;let l;if(r.snap)Ye(t,a)?(l=We(t,a),i=Di(i,l,r.snap)):Ye(a,t)&&(l=We(a,t),i=Di(i,Y(),r.snap.getChild(l)));else if(r.children){if(Ye(t,a))l=We(t,a),i=Wu(i,l,r.children);else if(Ye(a,t))if(l=We(a,t),j(l))i=Wu(i,Y(),r.children);else{const u=Ln(r.children,H(l));if(u){const d=u.getChild(te(l));i=Di(i,Y(),d)}}}else throw zn("WriteRecord should have .snap or .children")}}return i}function Mf(n,e,t,i,s){if(!i&&!s){const r=yn(n.visibleWrites,e);if(r!=null)return r;{const a=Ft(n.visibleWrites,e);if(ea(a))return t;if(t==null&&!Zo(a,Y()))return null;{const l=t||Q.EMPTY_NODE;return Hn(a,l)}}}else{const r=Ft(n.visibleWrites,e);if(!s&&ea(r))return t;if(!s&&t==null&&!Zo(r,Y()))return null;{const a=function(d){return(d.visible||s)&&(!i||!~i.indexOf(d.writeId))&&(Ye(d.path,e)||Ye(e,d.path))},l=Of(n.allWrites,a,e),u=t||Q.EMPTY_NODE;return Hn(l,u)}}}function kT(n,e,t){let i=Q.EMPTY_NODE;const s=yn(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(De,(r,a)=>{i=i.updateImmediateChild(r,a)}),i;if(t){const r=Ft(n.visibleWrites,e);return t.forEachChild(De,(a,l)=>{const u=Hn(Ft(r,new ne(a)),l);i=i.updateImmediateChild(a,u)}),Hu(r).forEach(a=>{i=i.updateImmediateChild(a.name,a.node)}),i}else{const r=Ft(n.visibleWrites,e);return Hu(r).forEach(a=>{i=i.updateImmediateChild(a.name,a.node)}),i}}function NT(n,e,t,i,s){N(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=me(e,t);if(Zo(n.visibleWrites,r))return null;{const a=Ft(n.visibleWrites,r);return ea(a)?s.getChild(t):Hn(a,s.getChild(t))}}function DT(n,e,t,i){const s=me(e,t),r=yn(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){const a=Ft(n.visibleWrites,s);return Hn(a,i.getNode().getImmediateChild(t))}else return null}function OT(n,e){return yn(n.visibleWrites,e)}function MT(n,e,t,i,s,r,a){let l;const u=Ft(n.visibleWrites,e),d=yn(u,Y());if(d!=null)l=d;else if(t!=null)l=Hn(u,t);else return[];if(l=l.withIndex(a),!l.isEmpty()&&!l.isLeafNode()){const p=[],_=a.getCompare(),v=r?l.getReverseIteratorFrom(i,a):l.getIteratorFrom(i,a);let S=v.getNext();for(;S&&p.length<s;)_(S,i)!==0&&p.push(S),S=v.getNext();return p}else return[]}function VT(){return{visibleWrites:Je.empty(),allWrites:[],lastWriteId:-1}}function ta(n,e,t,i){return Mf(n.writeTree,n.treePath,e,t,i)}function Vf(n,e){return kT(n.writeTree,n.treePath,e)}function qu(n,e,t,i){return NT(n.writeTree,n.treePath,e,t,i)}function dr(n,e){return OT(n.writeTree,me(n.treePath,e))}function LT(n,e,t,i,s,r){return MT(n.writeTree,n.treePath,e,t,i,s,r)}function Qa(n,e,t){return DT(n.writeTree,n.treePath,e,t)}function Lf(n,e){return xf(me(n.treePath,e),n.writeTree)}function xf(n,e){return{treePath:n,writeTree:e}}class xT{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;N(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),N(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,Fu(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,dT(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,hT(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,Fu(i,e.snapshotNode,s.oldSnap));else throw zn("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}class FT{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const Ff=new FT;class Ya{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new Ka(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Qa(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:fn(this.viewCache_),r=LT(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}}function UT(n,e){N(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),N(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function BT(n,e,t,i,s){const r=new xT;let a,l;if(t.type===it.OVERWRITE){const d=t;d.source.fromUser?a=na(n,e,d.path,d.snap,i,s,r):(N(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!j(d.path),a=fr(n,e,d.path,d.snap,i,s,l,r))}else if(t.type===it.MERGE){const d=t;d.source.fromUser?a=WT(n,e,d.path,d.children,i,s,r):(N(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),a=ia(n,e,d.path,d.children,i,s,l,r))}else if(t.type===it.ACK_USER_WRITE){const d=t;d.revert?a=qT(n,e,d.path,i,s,r):a=$T(n,e,d.path,d.affectedTree,i,s,r)}else if(t.type===it.LISTEN_COMPLETE)a=HT(n,e,t.path,i,r);else throw zn("Unknown operation type: "+t.type);const u=r.getChanges();return jT(e,a,u),{viewCache:a,changes:u}}function jT(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Jo(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(uT(Jo(e)))}}function Uf(n,e,t,i,s,r){const a=e.eventCache;if(dr(i,t)!=null)return e;{let l,u;if(j(t))if(N(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=fn(e),p=d instanceof Q?d:Q.EMPTY_NODE,_=Vf(i,p);l=n.filter.updateFullNode(e.eventCache.getNode(),_,r)}else{const d=ta(i,fn(e));l=n.filter.updateFullNode(e.eventCache.getNode(),d,r)}else{const d=H(t);if(d===".priority"){N(qt(t)===1,"Can't have a priority with additional path components");const p=a.getNode();u=e.serverCache.getNode();const _=qu(i,t,p,u);_!=null?l=n.filter.updatePriority(p,_):l=a.getNode()}else{const p=te(t);let _;if(a.isCompleteForChild(d)){u=e.serverCache.getNode();const v=qu(i,t,a.getNode(),u);v!=null?_=a.getNode().getImmediateChild(d).updateChild(p,v):_=a.getNode().getImmediateChild(d)}else _=Qa(i,d,e.serverCache);_!=null?l=n.filter.updateChild(a.getNode(),d,_,p,s,r):l=a.getNode()}}return Ni(e,l,a.isFullyInitialized()||j(t),n.filter.filtersNodes())}}function fr(n,e,t,i,s,r,a,l){const u=e.serverCache;let d;const p=a?n.filter:n.filter.getIndexedFilter();if(j(t))d=p.updateFullNode(u.getNode(),i,null);else if(p.filtersNodes()&&!u.isFiltered()){const S=u.getNode().updateChild(t,i);d=p.updateFullNode(u.getNode(),S,null)}else{const S=H(t);if(!u.isCompleteForPath(t)&&qt(t)>1)return e;const b=te(t),D=u.getNode().getImmediateChild(S).updateChild(b,i);S===".priority"?d=p.updatePriority(u.getNode(),D):d=p.updateChild(u.getNode(),S,D,b,Ff,null)}const _=kf(e,d,u.isFullyInitialized()||j(t),p.filtersNodes()),v=new Ya(s,_,r);return Uf(n,_,t,s,v,l)}function na(n,e,t,i,s,r,a){const l=e.eventCache;let u,d;const p=new Ya(s,e,r);if(j(t))d=n.filter.updateFullNode(e.eventCache.getNode(),i,a),u=Ni(e,d,!0,n.filter.filtersNodes());else{const _=H(t);if(_===".priority")d=n.filter.updatePriority(e.eventCache.getNode(),i),u=Ni(e,d,l.isFullyInitialized(),l.isFiltered());else{const v=te(t),S=l.getNode().getImmediateChild(_);let b;if(j(v))b=i;else{const O=p.getCompleteChild(_);O!=null?_f(v)===".priority"&&O.getChild(gf(v)).isEmpty()?b=O:b=O.updateChild(v,i):b=Q.EMPTY_NODE}if(S.equals(b))u=e;else{const O=n.filter.updateChild(l.getNode(),_,b,v,p,a);u=Ni(e,O,l.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function zu(n,e){return n.eventCache.isCompleteForChild(e)}function WT(n,e,t,i,s,r,a){let l=e;return i.foreach((u,d)=>{const p=me(t,u);zu(e,H(p))&&(l=na(n,l,p,d,s,r,a))}),i.foreach((u,d)=>{const p=me(t,u);zu(e,H(p))||(l=na(n,l,p,d,s,r,a))}),l}function Gu(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function ia(n,e,t,i,s,r,a,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,d;j(t)?d=i:d=new ee(null).setTree(t,i);const p=e.serverCache.getNode();return d.children.inorderTraversal((_,v)=>{if(p.hasChild(_)){const S=e.serverCache.getNode().getImmediateChild(_),b=Gu(n,S,v);u=fr(n,u,new ne(_),b,s,r,a,l)}}),d.children.inorderTraversal((_,v)=>{const S=!e.serverCache.isCompleteForChild(_)&&v.value===null;if(!p.hasChild(_)&&!S){const b=e.serverCache.getNode().getImmediateChild(_),O=Gu(n,b,v);u=fr(n,u,new ne(_),O,s,r,a,l)}}),u}function $T(n,e,t,i,s,r,a){if(dr(s,t)!=null)return e;const l=e.serverCache.isFiltered(),u=e.serverCache;if(i.value!=null){if(j(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return fr(n,e,t,u.getNode().getChild(t),s,r,l,a);if(j(t)){let d=new ee(null);return u.getNode().forEachChild(Dn,(p,_)=>{d=d.set(new ne(p),_)}),ia(n,e,t,d,s,r,l,a)}else return e}else{let d=new ee(null);return i.foreach((p,_)=>{const v=me(t,p);u.isCompleteForPath(v)&&(d=d.set(p,u.getNode().getChild(v)))}),ia(n,e,t,d,s,r,l,a)}}function HT(n,e,t,i,s){const r=e.serverCache,a=kf(e,r.getNode(),r.isFullyInitialized()||j(t),r.isFiltered());return Uf(n,a,t,i,Ff,s)}function qT(n,e,t,i,s,r){let a;if(dr(i,t)!=null)return e;{const l=new Ya(i,e,s),u=e.eventCache.getNode();let d;if(j(t)||H(t)===".priority"){let p;if(e.serverCache.isFullyInitialized())p=ta(i,fn(e));else{const _=e.serverCache.getNode();N(_ instanceof Q,"serverChildren would be complete if leaf node"),p=Vf(i,_)}p=p,d=n.filter.updateFullNode(u,p,r)}else{const p=H(t);let _=Qa(i,p,e.serverCache);_==null&&e.serverCache.isCompleteForChild(p)&&(_=u.getImmediateChild(p)),_!=null?d=n.filter.updateChild(u,p,_,te(t),l,r):e.eventCache.getNode().hasChild(p)?d=n.filter.updateChild(u,p,Q.EMPTY_NODE,te(t),l,r):d=u,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=ta(i,fn(e)),a.isLeafNode()&&(d=n.filter.updateFullNode(d,a,r)))}return a=e.serverCache.isFullyInitialized()||dr(i,Y())!=null,Ni(e,d,a,n.filter.filtersNodes())}}function zT(n,e){const t=fn(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!j(e)&&!t.getImmediateChild(H(e)).isEmpty())?t.getChild(e):null}function Ku(n,e,t,i){e.type===it.MERGE&&e.source.queryId!==null&&(N(fn(n.viewCache_),"We should always have a full cache before handling merges"),N(Jo(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=BT(n.processor_,s,e,t,i);return UT(n.processor_,r.viewCache),N(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,GT(n,r.changes,r.viewCache.eventCache.getNode())}function GT(n,e,t,i){const s=n.eventRegistrations_;return ET(n.eventGenerator_,e,t,s)}let Qu;function KT(n){N(!Qu,"__referenceConstructor has already been defined"),Qu=n}function Xa(n,e,t,i){const s=e.source.queryId;if(s!==null){const r=n.views.get(s);return N(r!=null,"SyncTree gave us an op for an invalid query."),Ku(r,e,t,i)}else{let r=[];for(const a of n.views.values())r=r.concat(Ku(a,e,t,i));return r}}function Ja(n,e){let t=null;for(const i of n.views.values())t=t||zT(i,e);return t}let Yu;function QT(n){N(!Yu,"__referenceConstructor has already been defined"),Yu=n}class Xu{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ee(null),this.pendingWriteTree_=VT(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function YT(n,e,t,i,s){return AT(n.pendingWriteTree_,e,t,i,s),s?Vr(n,new dn(Sf(),e,t)):[]}function bn(n,e,t=!1){const i=CT(n.pendingWriteTree_,e);if(ST(n.pendingWriteTree_,e)){let r=new ee(null);return i.snap!=null?r=r.set(Y(),!0):$e(i.children,a=>{r=r.set(new ne(a),!0)}),Vr(n,new hr(i.path,r,t))}else return[]}function Mr(n,e,t){return Vr(n,new dn(Rf(),e,t))}function XT(n,e,t){const i=ee.fromObject(t);return Vr(n,new $i(Rf(),e,i))}function JT(n,e,t,i){const s=$f(n,i);if(s!=null){const r=Hf(s),a=r.path,l=r.queryId,u=We(a,e),d=new dn(bf(l),u,t);return qf(n,a,d)}else return[]}function ZT(n,e,t,i){const s=$f(n,i);if(s){const r=Hf(s),a=r.path,l=r.queryId,u=We(a,e),d=ee.fromObject(t),p=new $i(bf(l),u,d);return qf(n,a,p)}else return[]}function Bf(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(a,l)=>{const u=We(a,e),d=Ja(l,u);if(d)return d});return Mf(s,e,r,t,!0)}function Vr(n,e){return jf(e,n.syncPointTree_,null,Df(n.pendingWriteTree_,Y()))}function jf(n,e,t,i){if(j(n.path))return Wf(n,e,t,i);{const s=e.get(Y());t==null&&s!=null&&(t=Ja(s,Y()));let r=[];const a=H(n.path),l=n.operationForChild(a),u=e.children.get(a);if(u&&l){const d=t?t.getImmediateChild(a):null,p=Lf(i,a);r=r.concat(jf(l,u,d,p))}return s&&(r=r.concat(Xa(s,n,i,t))),r}}function Wf(n,e,t,i){const s=e.get(Y());t==null&&s!=null&&(t=Ja(s,Y()));let r=[];return e.children.inorderTraversal((a,l)=>{const u=t?t.getImmediateChild(a):null,d=Lf(i,a),p=n.operationForChild(a);p&&(r=r.concat(Wf(p,l,u,d)))}),s&&(r=r.concat(Xa(s,n,i,t))),r}function $f(n,e){return n.tagToQueryMap.get(e)}function Hf(n){const e=n.indexOf("$");return N(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ne(n.substr(0,e))}}function qf(n,e,t){const i=n.syncPointTree_.get(e);N(i,"Missing sync point for query tag that we're tracking");const s=Df(n.pendingWriteTree_,e);return Xa(i,t,s,null)}class Za{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Za(t)}node(){return this.node_}}class el{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=me(this.path_,e);return new el(this.syncTree_,t)}node(){return Bf(this.syncTree_,this.path_)}}const eI=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ju=function(n,e,t){if(!n||typeof n!="object")return n;if(N(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return tI(n[".sv"],e,t);if(typeof n[".sv"]=="object")return nI(n[".sv"],e);N(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},tI=function(n,e,t){if(n==="timestamp")return t.timestamp;N(!1,"Unexpected server value: "+n)},nI=function(n,e,t){n.hasOwnProperty("increment")||N(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&N(!1,"Unexpected increment value: "+i);const s=e.node();if(N(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const a=s.getValue();return typeof a!="number"?i:a+i},iI=function(n,e,t,i){return tl(e,new el(t,n),i)},sI=function(n,e,t){return tl(n,new Za(e),t)};function tl(n,e,t){const i=n.getPriority().val(),s=Ju(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const a=n,l=Ju(a.getValue(),e,t);return l!==a.getValue()||s!==a.getPriority().val()?new de(l,ke(s)):n}else{const a=n;return r=a,s!==a.getPriority().val()&&(r=r.updatePriority(new de(s))),a.forEachChild(De,(l,u)=>{const d=tl(u,e.getImmediateChild(l),t);d!==u&&(r=r.updateImmediateChild(l,d))}),r}}class nl{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function il(n,e){let t=e instanceof ne?e:new ne(e),i=n,s=H(t);for(;s!==null;){const r=Ln(i.node.children,s)||{children:{},childCount:0};i=new nl(s,i,r),t=te(t),s=H(t)}return i}function Xn(n){return n.node.value}function zf(n,e){n.node.value=e,sa(n)}function Gf(n){return n.node.childCount>0}function rI(n){return Xn(n)===void 0&&!Gf(n)}function Lr(n,e){$e(n.node.children,(t,i)=>{e(new nl(t,n,i))})}function Kf(n,e,t,i){t&&e(n),Lr(n,s=>{Kf(s,e,!0)})}function oI(n,e,t){let i=n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function is(n){return new ne(n.parent===null?n.name:is(n.parent)+"/"+n.name)}function sa(n){n.parent!==null&&aI(n.parent,n.name,n)}function aI(n,e,t){const i=rI(t),s=Ct(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,sa(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,sa(n))}const lI=/[\[\].#$\/\u0000-\u001F\u007F]/,cI=/[\[\].#$\u0000-\u001F\u007F]/,Co=10*1024*1024,Qf=function(n){return typeof n=="string"&&n.length!==0&&!lI.test(n)},uI=function(n){return typeof n=="string"&&n.length!==0&&!cI.test(n)},hI=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),uI(n)},Yf=function(n,e,t){const i=t instanceof ne?new HE(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Jt(i));if(typeof e=="function")throw new Error(n+"contains a function "+Jt(i)+" with contents = "+e.toString());if(Gd(e))throw new Error(n+"contains "+e.toString()+" "+Jt(i));if(typeof e=="string"&&e.length>Co/3&&Tr(e)>Co)throw new Error(n+"contains a string greater than "+Co+" utf8 bytes "+Jt(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if($e(e,(a,l)=>{if(a===".value")s=!0;else if(a!==".priority"&&a!==".sv"&&(r=!0,!Qf(a)))throw new Error(n+" contains an invalid key ("+a+") "+Jt(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);qE(i,a),Yf(n,l,i),zE(i)}),s&&r)throw new Error(n+' contains ".value" child '+Jt(i)+" in addition to actual children.")}},dI=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Qf(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!hI(t))throw new Error(em(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class fI{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function pI(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();t!==null&&!yf(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function vn(n,e,t){pI(n,t),_I(n,i=>Ye(i,e)||Ye(e,i))}function _I(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const r=s.path;e(r)?(mI(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function mI(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();Pi&&Pe("event: "+t.toString()),ts(i)}}}const gI="repo_interrupt",yI=25;class vI{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fI,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ur(),this.transactionQueueTree_=new nl,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function EI(n,e,t){if(n.stats_=$a(n.repoInfo_),n.forceRestClient_||_E())n.server_=new cr(n.repoInfo_,(i,s,r,a)=>{Zu(n,i,s,r,a)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>eh(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ve(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Et(n.repoInfo_,e,(i,s,r,a)=>{Zu(n,i,s,r,a)},i=>{eh(n,i)},i=>{II(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=EE(n.repoInfo_,()=>new vT(n.stats_,n.server_)),n.infoData_=new pT,n.infoSyncTree_=new Xu({startListening:(i,s,r,a)=>{let l=[];const u=n.infoData_.getNode(i._path);return u.isEmpty()||(l=Mr(n.infoSyncTree_,i._path,u),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),sl(n,"connected",!1),n.serverSyncTree_=new Xu({startListening:(i,s,r,a)=>(n.server_.listen(i,r,s,(l,u)=>{const d=a(l,u);vn(n.eventQueue_,i._path,d)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function TI(n){const t=n.infoData_.getNode(new ne(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Xf(n){return eI({timestamp:TI(n)})}function Zu(n,e,t,i,s){n.dataUpdateCount++;const r=new ne(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let a=[];if(s)if(i){const u=Ks(t,d=>ke(d));a=ZT(n.serverSyncTree_,r,u,s)}else{const u=ke(t);a=JT(n.serverSyncTree_,r,u,s)}else if(i){const u=Ks(t,d=>ke(d));a=XT(n.serverSyncTree_,r,u)}else{const u=ke(t);a=Mr(n.serverSyncTree_,r,u)}let l=r;a.length>0&&(l=ol(n,r)),vn(n.eventQueue_,l,a)}function eh(n,e){sl(n,"connected",e),e===!1&&AI(n)}function II(n,e){$e(e,(t,i)=>{sl(n,t,i)})}function sl(n,e,t){const i=new ne("/.info/"+e),s=ke(t);n.infoData_.updateSnapshot(i,s);const r=Mr(n.infoSyncTree_,i,s);vn(n.eventQueue_,i,r)}function wI(n){return n.nextWriteId_++}function AI(n){Jf(n,"onDisconnectEvents");const e=Xf(n),t=ur();Xo(n.onDisconnect_,Y(),(s,r)=>{const a=iI(s,r,n.serverSyncTree_,e);Cf(t,s,a)});let i=[];Xo(t,Y(),(s,r)=>{i=i.concat(Mr(n.serverSyncTree_,s,r));const a=bI(n,s);ol(n,a)}),n.onDisconnect_=ur(),vn(n.eventQueue_,Y(),i)}function CI(n){n.persistentConnection_&&n.persistentConnection_.interrupt(gI)}function Jf(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Pe(t,...e)}function Zf(n,e,t){return Bf(n.serverSyncTree_,e,t)||Q.EMPTY_NODE}function rl(n,e=n.transactionQueueTree_){if(e||xr(n,e),Xn(e)){const t=tp(n,e);N(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&SI(n,is(e),t)}else Gf(e)&&Lr(e,t=>{rl(n,t)})}function SI(n,e,t){const i=t.map(d=>d.currentWriteId),s=Zf(n,e,i);let r=s;const a=s.hash();for(let d=0;d<t.length;d++){const p=t[d];N(p.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++;const _=We(e,p.path);r=r.updateChild(_,p.currentOutputSnapshotRaw)}const l=r.val(!0),u=e;n.server_.put(u.toString(),l,d=>{Jf(n,"transaction put response",{path:u.toString(),status:d});let p=[];if(d==="ok"){const _=[];for(let v=0;v<t.length;v++)t[v].status=2,p=p.concat(bn(n.serverSyncTree_,t[v].currentWriteId)),t[v].onComplete&&_.push(()=>t[v].onComplete(null,!0,t[v].currentOutputSnapshotResolved)),t[v].unwatcher();xr(n,il(n.transactionQueueTree_,e)),rl(n,n.transactionQueueTree_),vn(n.eventQueue_,e,p);for(let v=0;v<_.length;v++)ts(_[v])}else{if(d==="datastale")for(let _=0;_<t.length;_++)t[_].status===3?t[_].status=4:t[_].status=0;else{Be("transaction at "+u.toString()+" failed: "+d);for(let _=0;_<t.length;_++)t[_].status=4,t[_].abortReason=d}ol(n,e)}},a)}function ol(n,e){const t=ep(n,e),i=is(t),s=tp(n,t);return RI(n,s,i),i}function RI(n,e,t){if(e.length===0)return;const i=[];let s=[];const a=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const u=e[l],d=We(t,u.path);let p=!1,_;if(N(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)p=!0,_=u.abortReason,s=s.concat(bn(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=yI)p=!0,_="maxretry",s=s.concat(bn(n.serverSyncTree_,u.currentWriteId,!0));else{const v=Zf(n,u.path,a);u.currentInputSnapshot=v;const S=e[l].update(v.val());if(S!==void 0){Yf("transaction failed: Data returned ",S,u.path);let b=ke(S);typeof S=="object"&&S!=null&&Ct(S,".priority")||(b=b.updatePriority(v.getPriority()));const D=u.currentWriteId,K=Xf(n),F=sI(b,v,K);u.currentOutputSnapshotRaw=b,u.currentOutputSnapshotResolved=F,u.currentWriteId=wI(n),a.splice(a.indexOf(D),1),s=s.concat(YT(n.serverSyncTree_,u.path,F,u.currentWriteId,u.applyLocally)),s=s.concat(bn(n.serverSyncTree_,D,!0))}else p=!0,_="nodata",s=s.concat(bn(n.serverSyncTree_,u.currentWriteId,!0))}vn(n.eventQueue_,t,s),s=[],p&&(e[l].status=2,(function(v){setTimeout(v,Math.floor(0))})(e[l].unwatcher),e[l].onComplete&&(_==="nodata"?i.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):i.push(()=>e[l].onComplete(new Error(_),!1,null))))}xr(n,n.transactionQueueTree_);for(let l=0;l<i.length;l++)ts(i[l]);rl(n,n.transactionQueueTree_)}function ep(n,e){let t,i=n.transactionQueueTree_;for(t=H(e);t!==null&&Xn(i)===void 0;)i=il(i,t),e=te(e),t=H(e);return i}function tp(n,e){const t=[];return np(n,e,t),t.sort((i,s)=>i.order-s.order),t}function np(n,e,t){const i=Xn(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);Lr(e,s=>{np(n,s,t)})}function xr(n,e){const t=Xn(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,zf(e,t.length>0?t:void 0)}Lr(e,i=>{xr(n,i)})}function bI(n,e){const t=is(ep(n,e)),i=il(n.transactionQueueTree_,e);return oI(i,s=>{So(n,s)}),So(n,i),Kf(i,s=>{So(n,s)}),t}function So(n,e){const t=Xn(e);if(t){const i=[];let s=[],r=-1;for(let a=0;a<t.length;a++)t[a].status===3||(t[a].status===1?(N(r===a-1,"All SENT items should be at beginning of queue."),r=a,t[a].status=3,t[a].abortReason="set"):(N(t[a].status===0,"Unexpected transaction status in abort"),t[a].unwatcher(),s=s.concat(bn(n.serverSyncTree_,t[a].currentWriteId,!0)),t[a].onComplete&&i.push(t[a].onComplete.bind(null,new Error("set"),!1,null))));r===-1?zf(e,void 0):t.length=r+1,vn(n.eventQueue_,is(e),s);for(let a=0;a<i.length;a++)ts(i[a])}}function PI(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function kI(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Be(`Invalid query segment '${t}' in query '${n}'`)}return e}const th=function(n,e){const t=NI(n),i=t.namespace;t.domain==="firebase.com"&&It(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&It("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||aE();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new of(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new ne(t.pathString)}},NI=function(n){let e="",t="",i="",s="",r="",a=!0,l="https",u=443;if(typeof n=="string"){let d=n.indexOf("//");d>=0&&(l=n.substring(0,d-1),n=n.substring(d+2));let p=n.indexOf("/");p===-1&&(p=n.length);let _=n.indexOf("?");_===-1&&(_=n.length),e=n.substring(0,Math.min(p,_)),p<_&&(s=PI(n.substring(p,_)));const v=kI(n.substring(Math.min(n.length,_)));d=e.indexOf(":"),d>=0?(a=l==="https"||l==="wss",u=parseInt(e.substring(d+1),10)):d=e.length;const S=e.slice(0,d);if(S.toLowerCase()==="localhost")t="localhost";else if(S.split(".").length<=2)t=S;else{const b=e.indexOf(".");i=e.substring(0,b).toLowerCase(),t=e.substring(b+1),r=i}"ns"in v&&(r=v.ns)}return{host:e,port:u,domain:t,subdomain:i,secure:a,scheme:l,pathString:s,namespace:r}};class al{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return j(this._path)?null:_f(this._path)}get ref(){return new Jn(this._repo,this._path)}get _queryIdentifier(){const e=Bu(this._queryParams),t=ja(e);return t==="{}"?"default":t}get _queryObject(){return Bu(this._queryParams)}isEqual(e){if(e=Le(e),!(e instanceof al))return!1;const t=this._repo===e._repo,i=yf(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+$E(this._path)}}class Jn extends al{constructor(e,t){super(e,t,new Ga,!1)}get parent(){const e=gf(this._path);return e===null?null:new Jn(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}KT(Jn);QT(Jn);const DI="FIREBASE_DATABASE_EMULATOR_HOST",ra={};let OI=!1;function MI(n,e,t,i){const s=e.lastIndexOf(":"),r=e.substring(0,s),a=zt(r);n.repoInfo_=new of(e,a,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function VI(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||It("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Pe("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let a=th(r,s),l=a.repoInfo,u;typeof process<"u"&&Tu&&(u=Tu[DI]),u?(r=`http://${u}?ns=${l.namespace}`,a=th(r,s),l=a.repoInfo):a.repoInfo.secure;const d=new gE(n.name,n.options,e);dI("Invalid Firebase Database URL",a),j(a.path)||It("Database URL must point to the root of a Firebase Database (not including a child path).");const p=xI(l,n,d,new mE(n,t));return new FI(p,n)}function LI(n,e){const t=ra[e];(!t||t[n.key]!==n)&&It(`Database ${e}(${n.repoInfo_}) has already been deleted.`),CI(n),delete t[n.key]}function xI(n,e,t,i){let s=ra[e.name];s||(s={},ra[e.name]=s);let r=s[n.toURLString()];return r&&It("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new vI(n,OI,t,i),s[n.toURLString()]=r,r}class FI{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(EI(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Jn(this._repo,Y())),this._rootInternal}_delete(){return this._rootInternal!==null&&(LI(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&It("Cannot call "+e+" on a deleted database.")}}function UI(n=Ar(),e){const t=wr(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const i=Ch("database");i&&BI(t,...i)}return t}function BI(n,e,t,i={}){n=Le(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Ut(i,r.repoInfo_.emulatorOptions))return;It("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let a;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&It('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new js(js.OWNER);else if(i.mockUserToken){const l=typeof i.mockUserToken=="string"?i.mockUserToken:bh(i.mockUserToken,n.app.options.projectId);a=new js(l)}zt(e)&&(da(e),fa("Database",!0)),MI(r,s,i,a)}function jI(n){tE(_n),on(new Bt("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return VI(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),st(Iu,wu,n),st(Iu,wu,"esm2017")}Et.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Et.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};jI();function ll(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(t[i[s]]=n[i[s]]);return t}function ip(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const WI=ip,sp=new zi("auth","Firebase",ip());const pr=new Ir("@firebase/auth");function $I(n,...e){pr.logLevel<=B.WARN&&pr.warn(`Auth (${_n}): ${n}`,...e)}function Ws(n,...e){pr.logLevel<=B.ERROR&&pr.error(`Auth (${_n}): ${n}`,...e)}function lt(n,...e){throw ul(n,...e)}function Ze(n,...e){return ul(n,...e)}function cl(n,e,t){const i=Object.assign(Object.assign({},WI()),{[e]:t});return new zi("auth","Firebase",i).create(e,{appName:n.name})}function rn(n){return cl(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function HI(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&lt(n,"argument-error"),cl(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ul(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return sp.create(n,...e)}function L(n,e,...t){if(!n)throw ul(e,...t)}function _t(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ws(e),new Error(e)}function wt(n,e){n||_t(e)}function oa(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function qI(){return nh()==="http:"||nh()==="https:"}function nh(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function zI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(qI()||U_()||"connection"in navigator)?navigator.onLine:!0}function GI(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class ss{constructor(e,t){this.shortDelay=e,this.longDelay=t,wt(t>e,"Short delay should be less than long delay!"),this.isMobile=pa()||Ph()}get(){return zI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function hl(n,e){wt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class rp{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;_t("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;_t("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;_t("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const KI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const QI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],YI=new ss(3e4,6e4);function dl(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Zn(n,e,t,i,s={}){return op(n,s,async()=>{let r={},a={};i&&(e==="GET"?a=i:r={body:JSON.stringify(i)});const l=Gn(Object.assign({key:n.config.apiKey},a)).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const d=Object.assign({method:e,headers:u},r);return F_()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&zt(n.emulatorConfig.host)&&(d.credentials="include"),rp.fetch()(await ap(n,n.config.apiHost,t,l),d)})}async function op(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},KI),e);try{const s=new JI(n),r=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await r.json();if("needConfirmation"in a)throw Ms(n,"account-exists-with-different-credential",a);if(r.ok&&!("errorMessage"in a))return a;{const l=r.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ms(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Ms(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw Ms(n,"user-disabled",a);const p=i[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw cl(n,p,d);lt(n,p)}}catch(s){if(s instanceof At)throw s;lt(n,"network-request-failed",{message:String(s)})}}async function XI(n,e,t,i,s={}){const r=await Zn(n,e,t,i,s);return"mfaPendingCredential"in r&&lt(n,"multi-factor-auth-required",{_serverResponse:r}),r}async function ap(n,e,t,i){const s=`${e}${t}?${i}`,r=n,a=r.config.emulator?hl(n.config,s):`${n.config.apiScheme}://${s}`;return QI.includes(t)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(a).toString():a}class JI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Ze(this.auth,"network-request-failed")),YI.get())})}}function Ms(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const s=Ze(n,e,i);return s.customData._tokenResponse=t,s}async function ZI(n,e){return Zn(n,"POST","/v1/accounts:delete",e)}async function _r(n,e){return Zn(n,"POST","/v1/accounts:lookup",e)}function Oi(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ew(n,e=!1){const t=Le(n),i=await t.getIdToken(e),s=fl(i);L(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,a=r?.sign_in_provider;return{claims:s,token:i,authTime:Oi(Ro(s.auth_time)),issuedAtTime:Oi(Ro(s.iat)),expirationTime:Oi(Ro(s.exp)),signInProvider:a||null,signInSecondFactor:r?.sign_in_second_factor||null}}function Ro(n){return Number(n)*1e3}function fl(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Ws("JWT malformed, contained fewer than 3 sections"),null;try{const s=Gs(t);return s?JSON.parse(s):(Ws("Failed to decode base64 JWT payload"),null)}catch(s){return Ws("Caught error parsing JWT payload as JSON",s?.toString()),null}}function ih(n){const e=fl(n);return L(e,"internal-error"),L(typeof e.exp<"u","internal-error"),L(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Hi(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof At&&tw(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function tw({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class nw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class aa{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Oi(this.lastLoginAt),this.creationTime=Oi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function mr(n){var e;const t=n.auth,i=await n.getIdToken(),s=await Hi(n,_r(t,{idToken:i}));L(s?.users.length,t,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const a=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?lp(r.providerUserInfo):[],l=sw(n.providerData,a),u=n.isAnonymous,d=!(n.email&&r.passwordHash)&&!l?.length,p=u?d:!1,_={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:l,metadata:new aa(r.createdAt,r.lastLoginAt),isAnonymous:p};Object.assign(n,_)}async function iw(n){const e=Le(n);await mr(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function sw(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function lp(n){return n.map(e=>{var{providerId:t}=e,i=ll(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}async function rw(n,e){const t=await op(n,{},async()=>{const i=Gn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,a=await ap(n,s,"/v1/token",`key=${r}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:i};return n.emulatorConfig&&zt(n.emulatorConfig.host)&&(u.credentials="include"),rp.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function ow(n,e){return Zn(n,"POST","/v2/accounts:revokeToken",dl(n,e))}class On{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){L(e.idToken,"internal-error"),L(typeof e.idToken<"u","internal-error"),L(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ih(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){L(e.length!==0,"internal-error");const t=ih(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(L(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:s,expiresIn:r}=await rw(e,t);this.updateTokensAndExpiration(i,s,Number(r))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:s,expirationTime:r}=t,a=new On;return i&&(L(typeof i=="string","internal-error",{appName:e}),a.refreshToken=i),s&&(L(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),r&&(L(typeof r=="number","internal-error",{appName:e}),a.expirationTime=r),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new On,this.toJSON())}_performRefresh(){return _t("not implemented")}}function kt(n,e){L(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Xe{constructor(e){var{uid:t,auth:i,stsTokenManager:s}=e,r=ll(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new nw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new aa(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Hi(this,this.stsTokenManager.getToken(this.auth,e));return L(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ew(this,e)}reload(){return iw(this)}_assign(e){this!==e&&(L(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Xe(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){L(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await mr(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(je(this.auth.app))return Promise.reject(rn(this.auth));const e=await this.getIdToken();return await Hi(this,ZI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,s,r,a,l,u,d,p;const _=(i=t.displayName)!==null&&i!==void 0?i:void 0,v=(s=t.email)!==null&&s!==void 0?s:void 0,S=(r=t.phoneNumber)!==null&&r!==void 0?r:void 0,b=(a=t.photoURL)!==null&&a!==void 0?a:void 0,O=(l=t.tenantId)!==null&&l!==void 0?l:void 0,D=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,K=(d=t.createdAt)!==null&&d!==void 0?d:void 0,F=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:W,emailVerified:re,isAnonymous:tt,providerData:he,stsTokenManager:I}=t;L(W&&I,e,"internal-error");const m=On.fromJSON(this.name,I);L(typeof W=="string",e,"internal-error"),kt(_,e.name),kt(v,e.name),L(typeof re=="boolean",e,"internal-error"),L(typeof tt=="boolean",e,"internal-error"),kt(S,e.name),kt(b,e.name),kt(O,e.name),kt(D,e.name),kt(K,e.name),kt(F,e.name);const y=new Xe({uid:W,auth:e,email:v,emailVerified:re,displayName:_,isAnonymous:tt,photoURL:b,phoneNumber:S,tenantId:O,stsTokenManager:m,createdAt:K,lastLoginAt:F});return he&&Array.isArray(he)&&(y.providerData=he.map(E=>Object.assign({},E))),D&&(y._redirectEventId=D),y}static async _fromIdTokenResponse(e,t,i=!1){const s=new On;s.updateFromServerResponse(t);const r=new Xe({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return await mr(r),r}static async _fromGetAccountInfoResponse(e,t,i){const s=t.users[0];L(s.localId!==void 0,"internal-error");const r=s.providerUserInfo!==void 0?lp(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!r?.length,l=new On;l.updateFromIdToken(i);const u=new Xe({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new aa(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!r?.length};return Object.assign(u,d),u}}const sh=new Map;function mt(n){wt(n instanceof Function,"Expected a class definition");let e=sh.get(n);return e?(wt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,sh.set(n,e),e)}class cp{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}cp.type="NONE";const rh=cp;function $s(n,e,t){return`firebase:${n}:${e}:${t}`}class Mn{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:s,name:r}=this.auth;this.fullUserKey=$s(this.userKey,s.apiKey,r),this.fullPersistenceKey=$s("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await _r(this.auth,{idToken:e}).catch(()=>{});return t?Xe._fromGetAccountInfoResponse(this.auth,t,e):null}return Xe._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new Mn(mt(rh),e,i);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let r=s[0]||mt(rh);const a=$s(i,e.config.apiKey,e.name);let l=null;for(const d of t)try{const p=await d._get(a);if(p){let _;if(typeof p=="string"){const v=await _r(e,{idToken:p}).catch(()=>{});if(!v)break;_=await Xe._fromGetAccountInfoResponse(e,v,p)}else _=Xe._fromJSON(e,p);d!==r&&(l=_),r=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!r._shouldAllowMigration||!u.length?new Mn(r,e,i):(r=u[0],l&&await r._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==r)try{await d._remove(a)}catch{}})),new Mn(r,e,i))}}function oh(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fp(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(up(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_p(e))return"Blackberry";if(mp(e))return"Webos";if(hp(e))return"Safari";if((e.includes("chrome/")||dp(e))&&!e.includes("edge/"))return"Chrome";if(pp(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function up(n=Oe()){return/firefox\//i.test(n)}function hp(n=Oe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function dp(n=Oe()){return/crios\//i.test(n)}function fp(n=Oe()){return/iemobile/i.test(n)}function pp(n=Oe()){return/android/i.test(n)}function _p(n=Oe()){return/blackberry/i.test(n)}function mp(n=Oe()){return/webos/i.test(n)}function pl(n=Oe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function aw(n=Oe()){var e;return pl(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function lw(){return B_()&&document.documentMode===10}function gp(n=Oe()){return pl(n)||pp(n)||mp(n)||_p(n)||/windows phone/i.test(n)||fp(n)}function yp(n,e=[]){let t;switch(n){case"Browser":t=oh(Oe());break;case"Worker":t=`${oh(Oe())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${_n}/${i}`}class cw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=r=>new Promise((a,l)=>{try{const u=e(r);a(u)}catch(u){l(u)}});i.onAbort=t,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}async function uw(n,e={}){return Zn(n,"GET","/v2/passwordPolicy",dl(n,e))}const hw=6;class dw{constructor(e){var t,i,s,r;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:hw,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,s,r,a,l;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(i=u.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(r=u.containsUppercaseLetter)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(l=u.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),u}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let s=0;s<e.length;s++)i=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,s,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class fw{constructor(e,t,i,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ah(this),this.idTokenSubscription=new ah(this),this.beforeStateQueue=new cw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=mt(t)),this._initializationPromise=this.queue(async()=>{var i,s,r;if(!this._deleted&&(this.persistenceManager=await Mn.create(this,e),(i=this._resolvePersistenceManagerAvailable)===null||i===void 0||i.call(this),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await _r(this,{idToken:e}),i=await Xe._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(je(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let s=i,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=s?._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===l)&&u?.user&&(s=u.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return L(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mr(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=GI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(je(this.app))return Promise.reject(rn(this));const t=e?Le(e):null;return t&&L(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&L(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return je(this.app)?Promise.reject(rn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return je(this.app)?Promise.reject(rn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await uw(this),t=new dw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new zi("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await ow(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&mt(e)||this._popupRedirectResolver;L(t,this,"argument-error"),this.redirectPersistenceManager=await Mn.create(this,[mt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(L(l,this,"internal-error"),l.then(()=>{a||r(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,i,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return L(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;if(je(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&$I(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Fr(n){return Le(n)}class ah{constructor(e){this.auth=e,this.observer=null,this.addObserver=X_(t=>this.observer=t)}get next(){return L(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let _l={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function pw(n){_l=n}function _w(n){return _l.loadJS(n)}function mw(){return _l.gapiScript}function gw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function yw(n,e){const t=wr(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),r=t.getOptions();if(Ut(r,e??{}))return s;lt(s,"already-initialized")}return t.initialize({options:e})}function vw(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(mt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function Ew(n,e,t){const i=Fr(n);L(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const s=!1,r=vp(e),{host:a,port:l}=Tw(e),u=l===null?"":`:${l}`,d={url:`${r}//${a}${u}/`},p=Object.freeze({host:a,port:l,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!i._canInitEmulator){L(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),L(Ut(d,i.config.emulator)&&Ut(p,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=d,i.emulatorConfig=p,i.settings.appVerificationDisabledForTesting=!0,zt(a)?(da(`${r}//${a}${u}`),fa("Auth",!0)):Iw()}function vp(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Tw(n){const e=vp(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const r=s[1];return{host:r,port:lh(i.substr(r.length+1))}}else{const[r,a]=i.split(":");return{host:r,port:lh(a)}}}function lh(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Iw(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Ep{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return _t("not implemented")}_getIdTokenResponse(e){return _t("not implemented")}_linkToIdToken(e,t){return _t("not implemented")}_getReauthenticationResolver(e){return _t("not implemented")}}async function Vn(n,e){return XI(n,"POST","/v1/accounts:signInWithIdp",dl(n,e))}const ww="http://localhost";class pn extends Ep{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new pn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):lt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s}=t,r=ll(t,["providerId","signInMethod"]);if(!i||!s)return null;const a=new pn(i,s);return a.idToken=r.idToken||void 0,a.accessToken=r.accessToken||void 0,a.secret=r.secret,a.nonce=r.nonce,a.pendingToken=r.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Vn(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Vn(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Vn(e,t)}buildRequest(){const e={requestUri:ww,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Gn(t)}return e}}class ml{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rs extends ml{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Nt extends rs{constructor(){super("facebook.com")}static credential(e){return pn._fromParams({providerId:Nt.PROVIDER_ID,signInMethod:Nt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Nt.credentialFromTaggedObject(e)}static credentialFromError(e){return Nt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Nt.credential(e.oauthAccessToken)}catch{return null}}}Nt.FACEBOOK_SIGN_IN_METHOD="facebook.com";Nt.PROVIDER_ID="facebook.com";class ft extends rs{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return pn._fromParams({providerId:ft.PROVIDER_ID,signInMethod:ft.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ft.credentialFromTaggedObject(e)}static credentialFromError(e){return ft.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return ft.credential(t,i)}catch{return null}}}ft.GOOGLE_SIGN_IN_METHOD="google.com";ft.PROVIDER_ID="google.com";class Dt extends rs{constructor(){super("github.com")}static credential(e){return pn._fromParams({providerId:Dt.PROVIDER_ID,signInMethod:Dt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Dt.credentialFromTaggedObject(e)}static credentialFromError(e){return Dt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Dt.credential(e.oauthAccessToken)}catch{return null}}}Dt.GITHUB_SIGN_IN_METHOD="github.com";Dt.PROVIDER_ID="github.com";class Ot extends rs{constructor(){super("twitter.com")}static credential(e,t){return pn._fromParams({providerId:Ot.PROVIDER_ID,signInMethod:Ot.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ot.credentialFromTaggedObject(e)}static credentialFromError(e){return Ot.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return Ot.credential(t,i)}catch{return null}}}Ot.TWITTER_SIGN_IN_METHOD="twitter.com";Ot.PROVIDER_ID="twitter.com";class qn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,s=!1){const r=await Xe._fromIdTokenResponse(e,i,s),a=ch(i);return new qn({user:r,providerId:a,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const s=ch(i);return new qn({user:e,providerId:s,_tokenResponse:i,operationType:t})}}function ch(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class gr extends At{constructor(e,t,i,s){var r;super(t.code,t.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,gr.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new gr(e,t,i,s)}}function Tp(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?gr._fromErrorAndOperation(n,r,e,i):r})}async function Aw(n,e,t=!1){const i=await Hi(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return qn._forOperation(n,"link",i)}async function Cw(n,e,t=!1){const{auth:i}=n;if(je(i.app))return Promise.reject(rn(i));const s="reauthenticate";try{const r=await Hi(n,Tp(i,s,e,n),t);L(r.idToken,i,"internal-error");const a=fl(r.idToken);L(a,i,"internal-error");const{sub:l}=a;return L(n.uid===l,i,"user-mismatch"),qn._forOperation(n,s,r)}catch(r){throw r?.code==="auth/user-not-found"&&lt(i,"user-mismatch"),r}}async function Sw(n,e,t=!1){if(je(n.app))return Promise.reject(rn(n));const i="signIn",s=await Tp(n,i,e),r=await qn._fromIdTokenResponse(n,i,s);return t||await n._updateCurrentUser(r.user),r}function Rw(n,e,t,i){return Le(n).onIdTokenChanged(e,t,i)}function bw(n,e,t){return Le(n).beforeAuthStateChanged(e,t)}function JA(n,e,t,i){return Le(n).onAuthStateChanged(e,t,i)}function Pw(n){return Le(n).signOut()}const yr="__sak";class Ip{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yr,"1"),this.storage.removeItem(yr),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const kw=1e3,Nw=10;class wp extends Ip{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=gp(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),s=this.localCache[t];i!==s&&e(t,s,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const i=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(i);!t&&this.localCache[i]===a||this.notifyListeners(i,a)},r=this.storage.getItem(i);lw()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Nw):s()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},kw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}wp.type="LOCAL";const Dw=wp;class Ap extends Ip{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ap.type="SESSION";const Cp=Ap;function Ow(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Ur{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const i=new Ur(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:s,data:r}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,r)),u=await Ow(l);t.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ur.receivers=[];function gl(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}class Mw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,a;return new Promise((l,u)=>{const d=gl("",20);s.port1.start();const p=setTimeout(()=>{u(new Error("unsupported_event"))},i);a={messageChannel:s,onMessage(_){const v=_;if(v.data.eventId===d)switch(v.data.status){case"ack":clearTimeout(p),r=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),l(v.data.response);break;default:clearTimeout(p),clearTimeout(r),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function rt(){return window}function Vw(n){rt().location.href=n}function Sp(){return typeof rt().WorkerGlobalScope<"u"&&typeof rt().importScripts=="function"}async function Lw(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function xw(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Fw(){return Sp()?self:null}const Rp="firebaseLocalStorageDb",Uw=1,vr="firebaseLocalStorage",bp="fbase_key";class os{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Br(n,e){return n.transaction([vr],e?"readwrite":"readonly").objectStore(vr)}function Bw(){const n=indexedDB.deleteDatabase(Rp);return new os(n).toPromise()}function la(){const n=indexedDB.open(Rp,Uw);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(vr,{keyPath:bp})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(vr)?e(i):(i.close(),await Bw(),e(await la()))})})}async function uh(n,e,t){const i=Br(n,!0).put({[bp]:e,value:t});return new os(i).toPromise()}async function jw(n,e){const t=Br(n,!1).get(e),i=await new os(t).toPromise();return i===void 0?null:i.value}function hh(n,e){const t=Br(n,!0).delete(e);return new os(t).toPromise()}const Ww=800,$w=3;class Pp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await la(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>$w)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Sp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ur._getInstance(Fw()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Lw(),!this.activeServiceWorker)return;this.sender=new Mw(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||xw()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await la();return await uh(e,yr,"1"),await hh(e,yr),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>uh(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>jw(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>hh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const r=Br(s,!1).getAll();return new os(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:s,value:r}of e)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Ww)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Pp.type="LOCAL";const Hw=Pp;new ss(3e4,6e4);function kp(n,e){return e?mt(e):(L(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class yl extends Ep{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Vn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Vn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Vn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function qw(n){return Sw(n.auth,new yl(n),n.bypassAuthState)}function zw(n){const{auth:e,user:t}=n;return L(t,e,"internal-error"),Cw(t,new yl(n),n.bypassAuthState)}async function Gw(n){const{auth:e,user:t}=n;return L(t,e,"internal-error"),Aw(t,new yl(n),n.bypassAuthState)}class Np{constructor(e,t,i,s,r=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:s,tenantId:r,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:i,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return qw;case"linkViaPopup":case"linkViaRedirect":return Gw;case"reauthViaPopup":case"reauthViaRedirect":return zw;default:lt(this.auth,"internal-error")}}resolve(e){wt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){wt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Kw=new ss(2e3,1e4);async function Qw(n,e,t){if(je(n.app))return Promise.reject(Ze(n,"operation-not-supported-in-this-environment"));const i=Fr(n);HI(n,e,ml);const s=kp(i,t);return new tn(i,"signInViaPopup",e,s).executeNotNull()}class tn extends Np{constructor(e,t,i,s,r){super(e,t,s,r),this.provider=i,this.authWindow=null,this.pollId=null,tn.currentPopupAction&&tn.currentPopupAction.cancel(),tn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return L(e,this.auth,"internal-error"),e}async onExecution(){wt(this.filter.length===1,"Popup operations only handle one event");const e=gl();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ze(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ze(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ze(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Kw.get())};e()}}tn.currentPopupAction=null;const Yw="pendingRedirect",Hs=new Map;class Xw extends Np{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=Hs.get(this.auth._key());if(!e){try{const i=await Jw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Hs.set(this.auth._key(),e)}return this.bypassAuthState||Hs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Jw(n,e){const t=tA(e),i=eA(n);if(!await i._isAvailable())return!1;const s=await i._get(t)==="true";return await i._remove(t),s}function Zw(n,e){Hs.set(n._key(),e)}function eA(n){return mt(n._redirectPersistence)}function tA(n){return $s(Yw,n.config.apiKey,n.name)}async function nA(n,e,t=!1){if(je(n.app))return Promise.reject(rn(n));const i=Fr(n),s=kp(i,e),a=await new Xw(i,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,e)),a}const iA=600*1e3;class sA{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!rA(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!Dp(e)){const s=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Ze(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=iA&&this.cachedEventUids.clear(),this.cachedEventUids.has(dh(e))}saveEventToCache(e){this.cachedEventUids.add(dh(e)),this.lastProcessedEventTime=Date.now()}}function dh(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Dp({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function rA(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Dp(n);default:return!1}}async function oA(n,e={}){return Zn(n,"GET","/v1/projects",e)}const aA=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,lA=/^https?/;async function cA(n){if(n.config.emulator)return;const{authorizedDomains:e}=await oA(n);for(const t of e)try{if(uA(t))return}catch{}lt(n,"unauthorized-domain")}function uA(n){const e=oa(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===i}if(!lA.test(t))return!1;if(aA.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const hA=new ss(3e4,6e4);function fh(){const n=rt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function dA(n){return new Promise((e,t)=>{var i,s,r;function a(){fh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fh(),t(Ze(n,"network-request-failed"))},timeout:hA.get()})}if(!((s=(i=rt().gapi)===null||i===void 0?void 0:i.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((r=rt().gapi)===null||r===void 0)&&r.load)a();else{const l=gw("iframefcb");return rt()[l]=()=>{gapi.load?a():t(Ze(n,"network-request-failed"))},_w(`${mw()}?onload=${l}`).catch(u=>t(u))}}).catch(e=>{throw qs=null,e})}let qs=null;function fA(n){return qs=qs||dA(n),qs}const pA=new ss(5e3,15e3),_A="__/auth/iframe",mA="emulator/auth/iframe",gA={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},yA=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vA(n){const e=n.config;L(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?hl(e,mA):`https://${n.config.authDomain}/${_A}`,i={apiKey:e.apiKey,appName:n.name,v:_n},s=yA.get(n.config.apiHost);s&&(i.eid=s);const r=n._getFrameworks();return r.length&&(i.fw=r.join(",")),`${t}?${Gn(i).slice(1)}`}async function EA(n){const e=await fA(n),t=rt().gapi;return L(t,n,"internal-error"),e.open({where:document.body,url:vA(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gA,dontclear:!0},i=>new Promise(async(s,r)=>{await i.restyle({setHideOnLeave:!1});const a=Ze(n,"network-request-failed"),l=rt().setTimeout(()=>{r(a)},pA.get());function u(){rt().clearTimeout(l),s(i)}i.ping(u).then(u,()=>{r(a)})}))}const TA={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},IA=500,wA=600,AA="_blank",CA="http://localhost";class ph{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function SA(n,e,t,i=IA,s=wA){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let l="";const u=Object.assign(Object.assign({},TA),{width:i.toString(),height:s.toString(),top:r,left:a}),d=Oe().toLowerCase();t&&(l=dp(d)?AA:t),up(d)&&(e=e||CA,u.scrollbars="yes");const p=Object.entries(u).reduce((v,[S,b])=>`${v}${S}=${b},`,"");if(aw(d)&&l!=="_self")return RA(e||"",l),new ph(null);const _=window.open(e||"",l,p);L(_,n,"popup-blocked");try{_.focus()}catch{}return new ph(_)}function RA(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}const bA="__/auth/handler",PA="emulator/auth/handler",kA=encodeURIComponent("fac");async function _h(n,e,t,i,s,r){L(n.config.authDomain,n,"auth-domain-config-required"),L(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:_n,eventId:s};if(e instanceof ml){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Po(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,_]of Object.entries({}))a[p]=_}if(e instanceof rs){const p=e.getScopes().filter(_=>_!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const p of Object.keys(l))l[p]===void 0&&delete l[p];const u=await n._getAppCheckToken(),d=u?`#${kA}=${encodeURIComponent(u)}`:"";return`${NA(n)}?${Gn(l).slice(1)}${d}`}function NA({config:n}){return n.emulator?hl(n,PA):`https://${n.authDomain}/${bA}`}const bo="webStorageSupport";class DA{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Cp,this._completeRedirectFn=nA,this._overrideRedirectResult=Zw}async _openPopup(e,t,i,s){var r;wt((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const a=await _h(e,t,i,oa(),s);return SA(e,a,gl())}async _openRedirect(e,t,i,s){await this._originValidation(e);const r=await _h(e,t,i,oa(),s);return Vw(r),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:r}=this.eventManagers[t];return s?Promise.resolve(s):(wt(r,"If manager is not set, promise should be"),r)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await EA(e),i=new sA(e);return t.register("authEvent",s=>(L(s?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(bo,{type:bo},s=>{var r;const a=(r=s?.[0])===null||r===void 0?void 0:r[bo];a!==void 0&&t(!!a),lt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=cA(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return gp()||hp()||pl()}}const OA=DA;var mh="@firebase/auth",gh="1.10.8";class MA{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){L(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function VA(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function LA(n){on(new Bt("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=i.options;L(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const u={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yp(n)},d=new fw(i,s,r,u);return vw(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),on(new Bt("auth-internal",e=>{const t=Fr(e.getProvider("auth").getImmediate());return(i=>new MA(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),st(mh,gh,VA(n)),st(mh,gh,"esm2017")}const xA=300,FA=Rh("authIdTokenMaxAge")||xA;let yh=null;const UA=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>FA)return;const s=t?.token;yh!==s&&(yh=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function BA(n=Ar()){const e=wr(n,"auth");if(e.isInitialized())return e.getImmediate();const t=yw(n,{popupRedirectResolver:OA,persistence:[Hw,Dw,Cp]}),i=Rh("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(i,location.origin);if(location.origin===r.origin){const a=UA(r.toString());bw(t,a,()=>a(t.currentUser)),Rw(t,l=>a(l))}}const s=Ah("auth");return s&&Ew(t,`http://${s}`),t}function jA(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}pw({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{const r=Ze("internal-error");r.customData=s,t(r)},i.type="text/javascript",i.charset="UTF-8",jA().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});LA("Browser");const WA={apiKey:"dummy",authDomain:"dummy",projectId:"dummy",storageBucket:"dummy",messagingSenderId:"dummy",appId:"dummy",databaseURL:"dummy"};let Vs,$A,HA,qi,ca;try{Vs=eg().length?Ar():Oh(WA),$A=Bv(Vs),HA=UI(Vs),qi=BA(Vs),ca=new ft}catch(n){console.error("[FIREBASE] Initialization failed",n)}async function ZA(){if(!(!qi||!ca))try{await Qw(qi,ca)}catch(n){console.error("Sign in failed",n)}}async function eC(){if(qi)try{await Pw(qi)}catch(n){console.error("Sign out failed",n)}}export{YA as a,qi as b,QA as c,$A as d,eC as e,ZA as f,vc as g,JA as o,zA as r,XA as s};
